{"version":3,"file":"express-checkout.bundle.js","mappings":"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","sources":["webpack://peachpay-for-woocommerce/webpack/runtime/load script","webpack://peachpay-for-woocommerce/./node_modules/tslib/tslib.es6.js","webpack://peachpay-for-woocommerce/./node_modules/url-search-params-polyfill/index.js","webpack://peachpay-for-woocommerce/./frontend/@shared/ts/dom.ts","webpack://peachpay-for-woocommerce/./frontend/@shared/ts/error.ts","webpack://peachpay-for-woocommerce/./frontend/@shared/ts/maybe.ts","webpack://peachpay-for-woocommerce/./frontend/@shared/ts/sentry.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/deprecated/global.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/features/additionalFields.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/features/billingShippingFields.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/features/botProtection.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/util/customer.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/features/customer.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/features/orderDelivery.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/features/shipping.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/models/GatewayConfiguration.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/payment/order.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/payment/session.ts","webpack://peachpay-for-woocommerce/./frontend/@shared/ts/uuid.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/reducers/cartReducer.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/reducers/environmentReducer.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/reducers/initialState.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/reducers/merchantConfigurationReducer.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/reducers/paymentConfigurationReducer.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/reducers/peachPayCustomerReducer.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/reducers/peachPayOrderReducer.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/reducers/rootReducer.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/store.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/util/string.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/util/cart.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/util/country.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/util/currency.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/util/environment.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/util/form.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/util/subscription.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/util/translation.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/util/ui.ts","webpack://peachpay-for-woocommerce/webpack/bootstrap","webpack://peachpay-for-woocommerce/webpack/runtime/define property getters","webpack://peachpay-for-woocommerce/webpack/runtime/ensure chunk","webpack://peachpay-for-woocommerce/webpack/runtime/get javascript chunk filename","webpack://peachpay-for-woocommerce/webpack/runtime/get mini-css chunk filename","webpack://peachpay-for-woocommerce/webpack/runtime/global","webpack://peachpay-for-woocommerce/webpack/runtime/hasOwnProperty shorthand","webpack://peachpay-for-woocommerce/webpack/runtime/make namespace object","webpack://peachpay-for-woocommerce/webpack/runtime/publicPath","webpack://peachpay-for-woocommerce/webpack/runtime/jsonp chunk loading","webpack://peachpay-for-woocommerce/./node_modules/whatwg-fetch/fetch.js","webpack://peachpay-for-woocommerce/./frontend/polyfills.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/features/account.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/features/addressAutocomplete.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/util/dom.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/features/quantityChanger.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/features/cart.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/features/coupon.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/features/currency.ts","webpack://peachpay-for-woocommerce/./frontend/@shared/ts/currency.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/features/language.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/features/metrics.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/features/currencySwitch.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/features/customOrderMessaging.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/features/giftCard.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/features/slideUpView.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/features/modalPage.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/features/navigation.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/features/modal.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/features/oneClickUpsell.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/features/paymentSelector.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/features/relatedProducts.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/features/summary.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/features/vat.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/payment/peachpay/button.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/payment/peachpay/purchaseOrder.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/payment/free/button.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/payment/free/free.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/payment/peachpay/cod.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/payment/peachpay/cheque.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/payment/peachpay/bacs.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/payment/peachpay/peachpay.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/main.ts","webpack://peachpay-for-woocommerce/./frontend/git.ts","webpack://peachpay-for-woocommerce/./frontend/express-checkout/ts/features/merchantLogo.ts"],"sourcesContent":["var inProgress = {};\nvar dataWebpackPrefix = \"peachpay-for-woocommerce:\";\n// loadScript function to load a script via script tag\n__webpack_require__.l = (url, done, key, chunkId) => {\n\tif(inProgress[url]) { inProgress[url].push(done); return; }\n\tvar script, needAttach;\n\tif(key !== undefined) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tfor(var i = 0; i < scripts.length; i++) {\n\t\t\tvar s = scripts[i];\n\t\t\tif(s.getAttribute(\"src\") == url || s.getAttribute(\"data-webpack\") == dataWebpackPrefix + key) { script = s; break; }\n\t\t}\n\t}\n\tif(!script) {\n\t\tneedAttach = true;\n\t\tscript = document.createElement('script');\n\n\t\tscript.charset = 'utf-8';\n\t\tscript.timeout = 120;\n\t\tif (__webpack_require__.nc) {\n\t\t\tscript.setAttribute(\"nonce\", __webpack_require__.nc);\n\t\t}\n\t\tscript.setAttribute(\"data-webpack\", dataWebpackPrefix + key);\n\t\tscript.src = url;\n\t}\n\tinProgress[url] = [done];\n\tvar onScriptComplete = (prev, event) => {\n\t\t// avoid mem leaks in IE.\n\t\tscript.onerror = script.onload = null;\n\t\tclearTimeout(timeout);\n\t\tvar doneFns = inProgress[url];\n\t\tdelete inProgress[url];\n\t\tscript.parentNode && script.parentNode.removeChild(script);\n\t\tdoneFns && doneFns.forEach((fn) => (fn(event)));\n\t\tif(prev) return prev(event);\n\t}\n\t;\n\tvar timeout = setTimeout(onScriptComplete.bind(null, undefined, { type: 'timeout', target: script }), 120000);\n\tscript.onerror = onScriptComplete.bind(null, script.onerror);\n\tscript.onload = onScriptComplete.bind(null, script.onload);\n\tneedAttach && document.head.appendChild(script);\n};","/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    var desc = Object.getOwnPropertyDescriptor(m, k);\r\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\r\n        desc = { enumerable: true, get: function() { return m[k]; } };\r\n    }\r\n    Object.defineProperty(o, k2, desc);\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n}\r\n\r\nexport function __classPrivateFieldIn(state, receiver) {\r\n    if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\r\n    return typeof state === \"function\" ? receiver === state : state.has(receiver);\r\n}\r\n","/**\n *\n *\n * @author Jerry Bendy <jerry@icewingcc.com>\n * @licence MIT\n *\n */\n\n(function(self) {\n    'use strict';\n\n    var nativeURLSearchParams = (function() {\n            // #41 Fix issue in RN\n            try {\n                if (self.URLSearchParams && (new self.URLSearchParams('foo=bar')).get('foo') === 'bar') {\n                    return self.URLSearchParams;\n                }\n            } catch (e) {}\n            return null;\n        })(),\n        isSupportObjectConstructor = nativeURLSearchParams && (new nativeURLSearchParams({a: 1})).toString() === 'a=1',\n        // There is a bug in safari 10.1 (and earlier) that incorrectly decodes `%2B` as an empty space and not a plus.\n        decodesPlusesCorrectly = nativeURLSearchParams && (new nativeURLSearchParams('s=%2B').get('s') === '+'),\n        __URLSearchParams__ = \"__URLSearchParams__\",\n        // Fix bug in Edge which cannot encode ' &' correctly\n        encodesAmpersandsCorrectly = nativeURLSearchParams ? (function() {\n            var ampersandTest = new nativeURLSearchParams();\n            ampersandTest.append('s', ' &');\n            return ampersandTest.toString() === 's=+%26';\n        })() : true,\n        prototype = URLSearchParamsPolyfill.prototype,\n        iterable = !!(self.Symbol && self.Symbol.iterator);\n\n    if (nativeURLSearchParams && isSupportObjectConstructor && decodesPlusesCorrectly && encodesAmpersandsCorrectly) {\n        return;\n    }\n\n\n    /**\n     * Make a URLSearchParams instance\n     *\n     * @param {object|string|URLSearchParams} search\n     * @constructor\n     */\n    function URLSearchParamsPolyfill(search) {\n        search = search || \"\";\n\n        // support construct object with another URLSearchParams instance\n        if (search instanceof URLSearchParams || search instanceof URLSearchParamsPolyfill) {\n            search = search.toString();\n        }\n        this [__URLSearchParams__] = parseToDict(search);\n    }\n\n\n    /**\n     * Appends a specified key/value pair as a new search parameter.\n     *\n     * @param {string} name\n     * @param {string} value\n     */\n    prototype.append = function(name, value) {\n        appendTo(this [__URLSearchParams__], name, value);\n    };\n\n    /**\n     * Deletes the given search parameter, and its associated value,\n     * from the list of all search parameters.\n     *\n     * @param {string} name\n     */\n    prototype['delete'] = function(name) {\n        delete this [__URLSearchParams__] [name];\n    };\n\n    /**\n     * Returns the first value associated to the given search parameter.\n     *\n     * @param {string} name\n     * @returns {string|null}\n     */\n    prototype.get = function(name) {\n        var dict = this [__URLSearchParams__];\n        return this.has(name) ? dict[name][0] : null;\n    };\n\n    /**\n     * Returns all the values association with a given search parameter.\n     *\n     * @param {string} name\n     * @returns {Array}\n     */\n    prototype.getAll = function(name) {\n        var dict = this [__URLSearchParams__];\n        return this.has(name) ? dict [name].slice(0) : [];\n    };\n\n    /**\n     * Returns a Boolean indicating if such a search parameter exists.\n     *\n     * @param {string} name\n     * @returns {boolean}\n     */\n    prototype.has = function(name) {\n        return hasOwnProperty(this [__URLSearchParams__], name);\n    };\n\n    /**\n     * Sets the value associated to a given search parameter to\n     * the given value. If there were several values, delete the\n     * others.\n     *\n     * @param {string} name\n     * @param {string} value\n     */\n    prototype.set = function set(name, value) {\n        this [__URLSearchParams__][name] = ['' + value];\n    };\n\n    /**\n     * Returns a string containg a query string suitable for use in a URL.\n     *\n     * @returns {string}\n     */\n    prototype.toString = function() {\n        var dict = this[__URLSearchParams__], query = [], i, key, name, value;\n        for (key in dict) {\n            name = encode(key);\n            for (i = 0, value = dict[key]; i < value.length; i++) {\n                query.push(name + '=' + encode(value[i]));\n            }\n        }\n        return query.join('&');\n    };\n\n    // There is a bug in Safari 10.1 and `Proxy`ing it is not enough.\n    var forSureUsePolyfill = !decodesPlusesCorrectly;\n    var useProxy = (!forSureUsePolyfill && nativeURLSearchParams && !isSupportObjectConstructor && self.Proxy);\n    var propValue; \n    if (useProxy) {\n        // Safari 10.0 doesn't support Proxy, so it won't extend URLSearchParams on safari 10.0\n        propValue = new Proxy(nativeURLSearchParams, {\n            construct: function (target, args) {\n                return new target((new URLSearchParamsPolyfill(args[0]).toString()));\n            }\n        })\n        // Chrome <=60 .toString() on a function proxy got error \"Function.prototype.toString is not generic\"\n        propValue.toString = Function.prototype.toString.bind(URLSearchParamsPolyfill);\n    } else {\n        propValue = URLSearchParamsPolyfill;\n    }\n    /*\n     * Apply polifill to global object and append other prototype into it\n     */\n    Object.defineProperty(self, 'URLSearchParams', {\n        value: propValue\n    });\n\n    var USPProto = self.URLSearchParams.prototype;\n\n    USPProto.polyfill = true;\n\n    /**\n     *\n     * @param {function} callback\n     * @param {object} thisArg\n     */\n    USPProto.forEach = USPProto.forEach || function(callback, thisArg) {\n        var dict = parseToDict(this.toString());\n        Object.getOwnPropertyNames(dict).forEach(function(name) {\n            dict[name].forEach(function(value) {\n                callback.call(thisArg, value, name, this);\n            }, this);\n        }, this);\n    };\n\n    /**\n     * Sort all name-value pairs\n     */\n    USPProto.sort = USPProto.sort || function() {\n        var dict = parseToDict(this.toString()), keys = [], k, i, j;\n        for (k in dict) {\n            keys.push(k);\n        }\n        keys.sort();\n\n        for (i = 0; i < keys.length; i++) {\n            this['delete'](keys[i]);\n        }\n        for (i = 0; i < keys.length; i++) {\n            var key = keys[i], values = dict[key];\n            for (j = 0; j < values.length; j++) {\n                this.append(key, values[j]);\n            }\n        }\n    };\n\n    /**\n     * Returns an iterator allowing to go through all keys of\n     * the key/value pairs contained in this object.\n     *\n     * @returns {function}\n     */\n    USPProto.keys = USPProto.keys || function() {\n        var items = [];\n        this.forEach(function(item, name) {\n            items.push(name);\n        });\n        return makeIterator(items);\n    };\n\n    /**\n     * Returns an iterator allowing to go through all values of\n     * the key/value pairs contained in this object.\n     *\n     * @returns {function}\n     */\n    USPProto.values = USPProto.values || function() {\n        var items = [];\n        this.forEach(function(item) {\n            items.push(item);\n        });\n        return makeIterator(items);\n    };\n\n    /**\n     * Returns an iterator allowing to go through all key/value\n     * pairs contained in this object.\n     *\n     * @returns {function}\n     */\n    USPProto.entries = USPProto.entries || function() {\n        var items = [];\n        this.forEach(function(item, name) {\n            items.push([name, item]);\n        });\n        return makeIterator(items);\n    };\n\n\n    if (iterable) {\n        USPProto[self.Symbol.iterator] = USPProto[self.Symbol.iterator] || USPProto.entries;\n    }\n\n\n    function encode(str) {\n        var replace = {\n            '!': '%21',\n            \"'\": '%27',\n            '(': '%28',\n            ')': '%29',\n            '~': '%7E',\n            '%20': '+',\n            '%00': '\\x00'\n        };\n        return encodeURIComponent(str).replace(/[!'\\(\\)~]|%20|%00/g, function(match) {\n            return replace[match];\n        });\n    }\n\n    function decode(str) {\n        return str\n            .replace(/[ +]/g, '%20')\n            .replace(/(%[a-f0-9]{2})+/ig, function(match) {\n                return decodeURIComponent(match);\n            });\n    }\n\n    function makeIterator(arr) {\n        var iterator = {\n            next: function() {\n                var value = arr.shift();\n                return {done: value === undefined, value: value};\n            }\n        };\n\n        if (iterable) {\n            iterator[self.Symbol.iterator] = function() {\n                return iterator;\n            };\n        }\n\n        return iterator;\n    }\n\n    function parseToDict(search) {\n        var dict = {};\n\n        if (typeof search === \"object\") {\n            // if `search` is an array, treat it as a sequence\n            if (isArray(search)) {\n                for (var i = 0; i < search.length; i++) {\n                    var item = search[i];\n                    if (isArray(item) && item.length === 2) {\n                        appendTo(dict, item[0], item[1]);\n                    } else {\n                        throw new TypeError(\"Failed to construct 'URLSearchParams': Sequence initializer must only contain pair elements\");\n                    }\n                }\n\n            } else {\n                for (var key in search) {\n                    if (search.hasOwnProperty(key)) {\n                        appendTo(dict, key, search[key]);\n                    }\n                }\n            }\n\n        } else {\n            // remove first '?'\n            if (search.indexOf(\"?\") === 0) {\n                search = search.slice(1);\n            }\n\n            var pairs = search.split(\"&\");\n            for (var j = 0; j < pairs.length; j++) {\n                var value = pairs [j],\n                    index = value.indexOf('=');\n\n                if (-1 < index) {\n                    appendTo(dict, decode(value.slice(0, index)), decode(value.slice(index + 1)));\n\n                } else {\n                    if (value) {\n                        appendTo(dict, decode(value), '');\n                    }\n                }\n            }\n        }\n\n        return dict;\n    }\n\n    function appendTo(dict, name, value) {\n        var val = typeof value === 'string' ? value : (\n            value !== null && value !== undefined && typeof value.toString === 'function' ? value.toString() : JSON.stringify(value)\n        );\n\n        // #47 Prevent using `hasOwnProperty` as a property name\n        if (hasOwnProperty(dict, name)) {\n            dict[name].push(val);\n        } else {\n            dict[name] = [val];\n        }\n    }\n\n    function isArray(val) {\n        return !!val && '[object Array]' === Object.prototype.toString.call(val);\n    }\n\n    function hasOwnProperty(obj, prop) {\n        return Object.prototype.hasOwnProperty.call(obj, prop);\n    }\n\n})(typeof global !== 'undefined' ? global : (typeof window !== 'undefined' ? window : this));\n","import {getErrorString} from './error';\nimport {type IWindowFetchMessage, type IWindowMessage} from '../../@type/window-messages';\nimport {captureSentryException} from './sentry';\n\n/**\n * Resulting helper function to comply with typescript by\n * always checking the result of $qs\n *\n * @param { string } \t\tselector html query selector string\n * @param { (T) => void } \tcb callback function that will only be called if the element is found\n */\nfunction $qs<T extends HTMLElement>(selector: string, cb: null | (($element: T) => void) = null): T | null {\n\tconst $element = document.querySelector<T>(selector);\n\tif ($element && cb !== null) {\n\t\tcb($element);\n\t}\n\n\treturn $element;\n}\n\n/**\n * Helper function for \"document.querySelectorAll\" that always returns a proper array\n * and has the base type \"HTMLElement\" instead of the almost never used \"Element\".\n */\nfunction $qsAll<T extends HTMLElement>(selector: string, callback?: ($element: T) => void): T[] {\n\tconst result = Array.from(document.querySelectorAll<T>(selector));\n\n\tif (callback) {\n\t\tfor (const $element of result) {\n\t\t\tcallback($element);\n\t\t}\n\t}\n\n\treturn result;\n}\n\n/**\n * Loads a given JS script.\n *\n * @param src URL of the script\n * @param scriptWindowObject Name of the object the script defines if the script defines any objects\n */\nasync function loadScript(src: string, scriptWindowObject: string | null, callback?: () => void): Promise<void> {\n\treturn new Promise((resolve, reject) => {\n\t\tif (document.querySelector(`script[src=\"${src}\"]`) ?? (window as any)[scriptWindowObject ?? '']) {\n\t\t\tcallback?.();\n\t\t\tresolve();\n\t\t}\n\n\t\tconst $script = document.createElement('script');\n\t\t$script.type = 'text/javascript';\n\t\t$script.src = src;\n\n\t\t($script as any).onreadystatechange = () => {\n\t\t\tcallback?.();\n\t\t\tresolve();\n\t\t};\n\n\t\t$script.onload = () => {\n\t\t\tcallback?.();\n\t\t\tresolve();\n\t\t};\n\n\t\t$script.onerror = reject;\n\n\t\tdocument.head.appendChild($script);\n\t});\n}\n\ninterface WindowFetchData<T> {\n\terror: Error;\n\tresult: T;\n}\n\nasync function fetchWindowData<TRequest, TResponse>(targetWindow: Window | null, endpoint: string, request?: TRequest): Promise<TResponse> {\n\treturn new Promise((resolve, reject) => {\n\t\tconst channel = new MessageChannel();\n\t\tchannel.port1.onmessage = ({data}) => {\n\t\t\tchannel.port1.close();\n\n\t\t\tif ((data as WindowFetchData<TResponse>).error) {\n\t\t\t\treject((data as WindowFetchData<TResponse>).error);\n\t\t\t} else {\n\t\t\t\tresolve((data as WindowFetchData<TResponse>).result);\n\t\t\t}\n\t\t};\n\n\t\tif (targetWindow) {\n\t\t\ttargetWindow.postMessage(\n\t\t\t\t{\n\t\t\t\t\tevent: endpoint,\n\t\t\t\t\trequest,\n\t\t\t\t},\n\t\t\t\tlocation.origin,\n\t\t\t\t[channel.port2],\n\t\t\t);\n\t\t} else {\n\t\t\treject(new Error('Target window is not valid.'));\n\t\t}\n\t});\n}\n\n/**\n * Allows for async request from the host page for data.\n */\nfunction onWindowDataFetch<TRequest, TResponse>(endpoint: string, requestCallback: (request: TRequest) => Promise<TResponse> | TResponse): void {\n\twindow.addEventListener('message', async (message: MessageEvent<IWindowFetchMessage<TRequest>>) => {\n\t\tif (message.origin !== location.origin) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (message.data.event === endpoint) {\n\t\t\ttry {\n\t\t\t\tconst response = await requestCallback(message.data.request as unknown as TRequest);\n\n\t\t\t\tmessage.ports?.[0]?.postMessage({result: response});\n\t\t\t} catch (error: unknown) {\n\t\t\t\ttry {\n\t\t\t\t\tmessage.ports?.[0]?.postMessage({error});\n\t\t\t\t} catch (secondaryError: unknown) {\n\t\t\t\t\tmessage.ports?.[0]?.postMessage({error: new Error(getErrorString(error))});\n\t\t\t\t\tcaptureSentryException(secondaryError as Error, {\n\t\t\t\t\t\toriginalError: error,\n\t\t\t\t\t\toriginalErrorString: getErrorString(error),\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n}\n\nasync function fetchHostWindowData<TRequest, TResponse>(endpoint: string, request?: TRequest): Promise<TResponse> {\n\treturn fetchWindowData(window.top, endpoint, request);\n}\n\n/**\n * Helper function to give strong typing to a Message Event\n */\nfunction onWindowMessage<T extends IWindowMessage>(eventName: string, cb: (event: T) => void | Promise<void>) {\n\twindow.addEventListener('message', async (event: MessageEvent<T>) => {\n\t\tif (event.origin !== location.origin) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (event.data.event === eventName) {\n\t\t\tawait cb(event.data);\n\t\t}\n\t}, false);\n}\n\n// https://ourcodeworld.com/articles/read/376/how-to-strip-html-from-a-string-extract-only-text-content-in-javascript\nfunction stripHtml(html: string, preFilterSelector: string | null = 'a'): string {\n\tconst temporalDivElement = document.createElement('div');\n\ttemporalDivElement.innerHTML = html;\n\n\tif (preFilterSelector) {\n\t\ttemporalDivElement.querySelectorAll(preFilterSelector).forEach($el => {\n\t\t\t$el.remove();\n\t\t});\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/prefer-nullish-coalescing\n\treturn (temporalDivElement.textContent || temporalDivElement.innerText || '').trim();\n}\n\nfunction isMobile() {\n\treturn window.innerWidth < 900;\n}\n\nexport {\n\t$qs,\n\t$qsAll,\n\tstripHtml,\n\tloadScript,\n\tfetchWindowData,\n\tfetchHostWindowData,\n\tonWindowMessage,\n\tonWindowDataFetch,\n\tisMobile,\n};\n","/**\n * Gets a stringified error or if the stringified result is an empy string or empty object the default .toString() is used.\n * Created because JSON.stringify(error) will return {} for Error objects (https://stackoverflow.com/a/50738205/16998523).\n *\n * @param {unknown} error\n */\nexport function getErrorString(error: unknown): string {\n\tif (error instanceof Error && error.stack) {\n\t\treturn error.stack;\n\t}\n\n\tconst errorString = JSON.stringify(error);\n\treturn errorString && errorString !== '{}' ? errorString : `${error as string}`;\n}\n","type Maybe<T> = {result?: T; error?: unknown};\n\n/**\n * Takes a promise and returns a Maybe type of the result or an error. This can be used to\n * avoid try/catch blocks which can be difficult to read and maintain.\n */\nasync function maybe<TResult>(promise: Promise<TResult>): Promise<Maybe<TResult>> {\n\treturn promise\n\t\t.then(result => ({result}))\n\t\t.catch((error: unknown) => ({error})) as unknown as Maybe<TResult>;\n}\n\n/**\n * Wraps a fetch request and returns a Maybe type of the resulting JSON or an error. This\n * can be used to avoid try/catch blocks which can be difficult to read and maintain.\n */\nasync function maybeFetch<TResult>(input: RequestInfo | URL, init?: RequestInit | undefined): Promise<Maybe<TResult>> {\n\treturn fetch(input, init)\n\t\t.then(async response => response.json() as Promise<TResult>)\n\t\t.then(result => ({result}))\n\t\t.catch((error: unknown) => ({error})) as unknown as Maybe<TResult>;\n}\n\nexport {\n\ttype Maybe,\n\n\tmaybe,\n\tmaybeFetch,\n};\n","/**\n * Sentry Types. These may not be accurate but we just need typescript happy\n */\ninterface SentryScope {\n\tsetFingerprint(fingerprint: any[]): void;\n\n\t// Debug, error,or other...\n\tsetLevel(level: string): void;\n\tsetExtra(key: string, value: string): void;\n}\n\ninterface SentryHub {\n\tonLoad(callback: () => void): void;\n\tinit(settings: any): void;\n\twithScope(cb: (scope: SentryScope) => void): void;\n\tcaptureException(ex: Error): void;\n\tcaptureMessage(message: string, level?: string): void;\n\tgetCurrentHub(): SentryHub;\n}\n\ndeclare const Sentry: SentryHub;\n\nfunction initSentry(release: string, dsn: string) {\n\tconst isStagingSite = /^(woo|qa|demo|ui-test|theme\\d*)\\.peachpay\\.app/i;\n\tconst isLocalSite = /^(store\\.local|localhost|127\\.0\\.0\\.1)/i;\n\n\tconst isDevelopmentMode = isStagingSite.test(location.hostname) || isLocalSite.test(location.hostname);\n\n\ttry {\n\t\tSentry.onLoad(() => {\n\t\t\tSentry.init({\n\t\t\t\tdsn,\n\t\t\t\tenvironment: isDevelopmentMode ? 'development' : 'production',\n\t\t\t\trelease,\n\t\t\t\tbeforeSend(event: any, hint: any) {\n\t\t\t\t\t// This is to prevent receiving errors from Google Recaptcha which are not relevant to us: https://github.com/getsentry/sentry-javascript/issues/2514#issuecomment-603971338\n\t\t\t\t\tif (hint.originalException === 'Timeout') {\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\n\t\t\t\t\t// This prevents collecting \"Non-Error promise rejection captured with value: undefined\". These are caused by third party scripts and are not relevant to us which throw non\n\t\t\t\t\t// Error instances.\n\t\t\t\t\tif (hint.originalException === 'undefined' || hint.originalException === undefined) {\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\n\t\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-return\n\t\t\t\t\treturn event;\n\t\t\t\t},\n\t\t\t\t// Ignore errors produced by Chrome, Firefox, and Safari upon\n\t\t\t\t// navigating away from a page that has a fetch request in progress.\n\t\t\t\t// See https://forum.sentry.io/t/typeerror-failed-to-fetch-reported-over-and-overe/8447/2\n\t\t\t\tignoreErrors: [\n\t\t\t\t\t'TypeError: Failed to fetch',\n\t\t\t\t\t'TypeError: NetworkError when attempting to fetch resource.',\n\t\t\t\t\t'TypeError: cancelled',\n\t\t\t\t\t'TypeError: cancelado',\n\t\t\t\t\t'TypeError: Abgebrochen',\n\t\t\t\t\t'TypeError: annulé',\n\t\t\t\t\t'Window navigated away',\n\t\t\t\t\t'annullato',\n\t\t\t\t\t'Load failed',\n\t\t\t\t],\n\t\t\t\tallowUrls: [\n\t\t\t\t\t/peachpay-for-woocommerce/i,\n\t\t\t\t],\n\t\t\t});\n\t\t});\n\t} catch {\n\t// Sentry is not present. Do not make things worse!\n\t}\n}\n\n/**\n * Used to capture a exception with sentry\n *\n * @param error The error/exception to report\n * @param extra Details to include with the sentry report\n * @param fingerprint Fingerprint to identify a sequence of events?\n */\nfunction captureSentryException(error: Error, extra?: Record<string, any> | null, fingerprint?: any[] | null) {\n\ttry {\n\t\tSentry.withScope(scope => {\n\t\t\tif (extra) {\n\t\t\t\t// Attempt extras\n\t\t\t\ttry {\n\t\t\t\t\tObject.entries(extra).forEach(([key, value]) => {\n\t\t\t\t\t\tscope.setExtra(key, value);\n\t\t\t\t\t});\n\t\t\t\t} catch {\n\t\t\t\t\t// Do no harm.\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (fingerprint) {\n\t\t\t\t// Attempt Fingerprint\n\t\t\t\ttry {\n\t\t\t\t\tscope.setFingerprint(fingerprint);\n\t\t\t\t} catch {\n\t\t\t\t\t// Do no harm.\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Capture exception with any above set extras and/or fingerprint\n\t\t\tSentry.captureException(error);\n\t\t});\n\t} catch {\n\t\t// Sentry is not present. Don't make things worse.\n\t}\n}\n\n/**\n * Captures a message of some sort of application event. This can be an\n * error or just a situation the application encountered that may need\n * reported.\n */\nfunction captureSentryEvent(eventMessage: string) {\n\ttry {\n\t\tSentry.captureMessage(eventMessage);\n\t} catch {\n\t\t// Sentry is not present. Don't make things worse.\n\t}\n}\n\nexport {\n\tinitSentry,\n\tcaptureSentryEvent,\n\tcaptureSentryException,\n};\n","import {type IGLOBAL} from './IGlobal';\n\n/**\n * Global variable object. It should be avoided importing other then in main.ts or phased\n * out completely in the future through a more robust data structure to allow for better\n * testing and more deterministic code\n * @deprecated New use of globals should be done though the redux\n * store with dispatching changes and subscribing for updates.\n */\nexport const GLOBAL: IGLOBAL = {\n\tphpData: null,\n\tlinkedProductsIds: [],\n};\n","import {type WCFieldData} from './../../../@type/woocommerce/field-data';\nimport chevronDownImageURL from '../../img/chevron-down-solid.svg';\n\n/**\n * All rendering additional fields functions.\n */\n\nimport {getLocaleText} from '../util/translation';\nimport {type WCFieldsData} from '../../../@type/woocommerce/field-data';\nimport {PeachPayCustomer} from '../reducers/peachPayCustomerReducer';\nimport {Environment, Feature, updateEnvironment} from '../reducers/environmentReducer';\nimport {PeachPayOrder, setExtraFields} from '../reducers/peachPayOrderReducer';\nimport {store} from '../store';\nimport {cleanFormFields} from '../util/form';\nimport {$qs, $qsAll} from '../../../@shared/ts/dom';\nimport {type WCPHPData} from '../../../@type/woocommerce/php-data';\nimport {type InitMessage} from '../../../@type/window-messages';\nimport {FeatureFlag} from '../../../@type/features';\n\nexport function addOrderNotesToAdditionalFields(phpData: WCPHPData) {\n\tconst fieldData: WCFieldsData[] = phpData?.additional_fields ?? ([] as WCFieldsData[]);\n\tconst fieldOrder: number[] = phpData?.additional_fields_order?.map(fo => Number(fo)) ?? [];\n\n\tif (Feature.enabled(FeatureFlag.ORDER_NOTES_INPUT)) {\n\t\tconst orderNotesData: WCFieldsData = {\n\t\t\tfield_default: '',\n\t\t\tfield_enable: 'yes',\n\t\t\tfield_label: getLocaleText('Order notes'),\n\t\t\tfield_name: 'order_comments',\n\t\t\tfield_required: '',\n\t\t\ttype_list: 'text',\n\t\t\tfield_placeholder: ' ',\n\t\t\twidth: '100',\n\t\t};\n\t\t// Example: if fieldOrder = [1, 3], make the array [1, 2, 3] and get the diff\n\t\tlet temp = Array.from(Array(Object.keys(fieldData).length + 2).keys()).slice(1);\n\t\ttemp = temp.filter(n => !fieldOrder.includes(n));\n\t\tconst fieldId = temp[0];\n\n\t\tif (fieldId) {\n\t\t\tfieldData[fieldId] = orderNotesData;\n\t\t\tfieldOrder.push(fieldId);\n\t\t}\n\t}\n\n\treturn {fieldData, fieldOrder};\n}\n\nexport function initAdditionalFields(message: InitMessage) {\n\tconst {fieldData, fieldOrder} = addOrderNotesToAdditionalFields(message.phpData);\n\trenderAdditionalFields(fieldData, fieldOrder);\n}\n\nfunction syncFields(event: Event) {\n\tconst $form = (event.target as HTMLElement).closest('form');\n\tconst fieldRecord: Record<string, string> = {};\n\n\tfor (const $element of Array.from($form?.elements ?? []) as HTMLElement[]) {\n\t\tif ($element.tagName === 'INPUT') {\n\t\t\tconst $input = $element as HTMLInputElement;\n\t\t\tif ($input.type === 'radio') {\n\t\t\t\tif ($input.checked) {\n\t\t\t\t\tfieldRecord[$input.name] = $input.value;\n\t\t\t\t} else {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t} else if ($input.type === 'checkbox') {\n\t\t\t\tif ($input.checked) {\n\t\t\t\t\tfieldRecord[$input.name] = 'checked';\n\t\t\t\t} else {\n\t\t\t\t\tfieldRecord[$input.name] = 'unchecked';\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfieldRecord[$input.name] = $input.value;\n\t\t\t}\n\t\t} else if ($element.tagName === 'SELECT') {\n\t\t\tconst $select = $element as HTMLSelectElement;\n\t\t\tfieldRecord[$select.name] = $select.value;\n\t\t} else if ($element.tagName === 'TEXTAREA') {\n\t\t\tconst $textarea = $element as HTMLTextAreaElement;\n\t\t\tfieldRecord[$textarea.name] = $textarea.value;\n\t\t}\n\t}\n\n\t// Collect only extra fields from form into fieldRecord\n\tcleanFormFields(fieldRecord);\n\tstore.dispatch(setExtraFields(fieldRecord));\n}\n\n/* Updates the UI based on whether or not additional field is filled in / required */\nfunction displayInputStatus(accordionHeader: HTMLElement, isInitial: boolean) {\n\t// Update the 'initial' classname for accordion-inner\n\tif (isInitial) {\n\t\taccordionHeader.classList.add('initial');\n\t} else {\n\t\taccordionHeader.classList.remove('initial');\n\t}\n}\n\n/* Allows the customer to navigate through / enter input into the radio/checkbox fields\n   using keyboard events. */\nfunction handleNonTextInputAccessibility(event: Event) {\n\tif (['ENTER', ' '].includes((event as KeyboardEvent).key)) {\n\t\tconst $element = event.target as HTMLInputElement | HTMLTextAreaElement;\n\t\tconst input = $element.querySelector('input');\n\t\tif (input) {\n\t\t\tif (input.type === 'radio') {\n\t\t\t\tinput.checked = true;\n\t\t\t} else {\n\t\t\t\tinput.checked = !input.checked;\n\t\t\t}\n\t\t}\n\t}\n\n\tsyncFields(event);\n}\n\n/* Toggles the collapsed/expanded state of an accordion section, given its header element. */\nfunction toggleAccordionCollapseState(accordionHeader: HTMLElement) {\n\tif (accordionHeader.classList.contains('fill')) {\n\t\taccordionHeader.classList.remove('fill');\n\t} else {\n\t\taccordionHeader.classList.add('fill');\n\t}\n\n\tconst $inner = accordionHeader.nextElementSibling;\n\tif ($inner) {\n\t\t// Expand\n\t\tif ($inner.classList.contains('collapse')) {\n\t\t\t$inner.classList.remove('collapse');\n\t\t\t$inner.classList.remove('dim');\n\t\t\t$inner.querySelectorAll('input, textarea, select, .pp-radio-line, .pp-checkbox-input-container').forEach($element => {\n\t\t\t\t$element.setAttribute('tabindex', '0');\n\t\t\t\tif ($element.classList.contains('pp-radio-line') || $element.classList.contains('pp-checkbox-input-container')) {\n\t\t\t\t\t$element.addEventListener('keypress', handleNonTextInputAccessibility);\n\t\t\t\t}\n\t\t\t});\n\t\t} else { // Collapse\n\t\t\t$inner.classList.add('dim');\n\t\t\tsetTimeout(() => {\n\t\t\t\t$inner.classList.add('collapse');\n\t\t\t}, 300);\n\t\t\t$inner.querySelectorAll('input, textarea, select, .pp-radio-line, .pp-checkbox-input-container').forEach($element => {\n\t\t\t\t$element.setAttribute('tabindex', '-1');\n\t\t\t\tif ($element.classList.contains('pp-radio-line') || $element.classList.contains('pp-checkbox-input-container')) {\n\t\t\t\t\t$element.removeEventListener('keypress', handleNonTextInputAccessibility);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tconst $chevron = accordionHeader.getElementsByTagName('img')?.[0];\n\tif ($chevron) {\n\t\tif ($chevron.style.transform === 'scaleY(-1)') {\n\t\t\t$chevron.style.transform = 'scaleY(1)';\n\t\t} else {\n\t\t\t$chevron.style.transform = 'scaleY(-1)';\n\t\t}\n\t}\n}\n\n/* Determines if the input field is at an initial state. */\nfunction inputIsInitial($inner: HTMLElement, $field: HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement) {\n\tlet isInitial = true;\n\tif ($field.tagName === 'INPUT') {\n\t\tif ($field.type === 'checkbox') {\n\t\t\tisInitial = !($field as HTMLInputElement).checked;\n\t\t} else if ($field.type === 'radio') {\n\t\t\tconst $selectedOption: HTMLInputElement | null = $inner.querySelector('.extra-field:checked');\n\t\t\tisInitial = $selectedOption === null;\n\t\t} else {\n\t\t\tisInitial = $field.value === '';\n\t\t}\n\t} else if ($field.tagName === 'SELECT') {\n\t\tisInitial = $field.value === '' || $field.value.toLowerCase() === 'please select';\n\t} else {\n\t\tisInitial = $field.value === '';\n\t}\n\n\treturn isInitial;\n}\n\n// KeyboardEvent listener for accessibility: accordion can be expanded/collapsed using keyboard events.\nfunction accordionHeaderListener(event: KeyboardEvent) {\n\tconst $ah = event.target as HTMLElement;\n\tif ($ah) {\n\t\tif (['ENTER', ' '].includes(event.key)) {\n\t\t\tevent.stopImmediatePropagation();\n\t\t\ttoggleAccordionCollapseState($ah);\n\t\t}\n\t}\n}\n\n/* Adds event handlers for focusing/opening/closing the additional fields. */\nfunction addAdditionalFieldsEventHandlers() {\n\t$qsAll('.pp-accordion-header').forEach(($ah: HTMLElement) => {\n\t\t$ah.addEventListener('click', (event: Event) => {\n\t\t\tevent.stopImmediatePropagation();\n\t\t\ttoggleAccordionCollapseState($ah);\n\t\t});\n\t});\n\n\t// Adds event listeners to be able to press a key to open\n\t$qsAll('.pp-accordion-section').forEach(($as: HTMLElement) => {\n\t\t// Set the initial tabindex of the inner elements to -1 because we only want them to be\n\t\t// focusable when the accordion's expanded. Otherwise there is a UI bug\n\t\t$as.querySelectorAll('input, textarea, select, .pp-radio-line, .pp-checkbox-input-container').forEach($element => {\n\t\t\t$element.setAttribute('tabindex', '-1');\n\t\t});\n\n\t\tconst $ah = $as.querySelector<HTMLElement>('.pp-accordion-header');\n\t\tif ($ah) {\n\t\t\t$ah.addEventListener('focus', () => {\n\t\t\t\t$ah?.addEventListener('keypress', accordionHeaderListener);\n\t\t\t});\n\t\t\t$ah.addEventListener('blur', () => {\n\t\t\t\t$ah?.removeEventListener('keypress', accordionHeaderListener);\n\t\t\t});\n\t\t}\n\t});\n\t$qsAll('.pp-new-field input, .pp-new-field textarea, .pp-new-field select').forEach($element => {\n\t\t$element.addEventListener('change', (event: Event) => {\n\t\t\tsyncFields(event);\n\t\t});\n\t});\n\t$qs('#additional-fields-new')?.addEventListener('change', syncFields);\n}\n\nfunction renderAdditionalFields(fieldData: WCFieldsData[], fieldOrder: number[]) {\n\tif (fieldData.length === 0 || fieldOrder.length === 0) {\n\t\treturn;\n\t}\n\n\t$qsAll('#additional-fields-new', $element => {\n\t\t$element.addEventListener('submit', (e: Event) => {\n\t\t\te.preventDefault();\n\t\t\treturn false;\n\t\t});\n\t});\n\n\t$qs('#additional-fields-new')?.classList.remove('hide');\n\n\tgenerateFields(fieldData, fieldOrder);\n\n\taddAdditionalFieldsEventHandlers();\n\n\tlet previousExtraFields = PeachPayOrder.extraFieldsRecord();\n\trenderExtraFields(previousExtraFields);\n\tstore.subscribe(() => {\n\t\tconst extraFields = PeachPayOrder.extraFieldsRecord();\n\t\tif (JSON.stringify(previousExtraFields) !== JSON.stringify(extraFields)) {\n\t\t\trenderExtraFields(extraFields);\n\t\t\tpreviousExtraFields = extraFields;\n\t\t}\n\t});\n}\n\n/* Renders the additional fields with the given set of field data. */\nfunction renderExtraFields(extraFieldData: Record<string, string>) {\n\tfor (const [key, value] of Object.entries(extraFieldData)) {\n\t\tconst $element = $qs<HTMLElement>(`[name=\"${key}\"].extra-field`);\n\t\tif ($element?.tagName === 'INPUT') {\n\t\t\tconst $input = $element as HTMLInputElement;\n\t\t\tif (['radio', 'checkbox'].includes($input.type)) {\n\t\t\t\t$qsAll<HTMLInputElement>(`[name=\"${key}\"][value=\"${value}\"].extra-field`, $radio => {\n\t\t\t\t\t$radio.checked = true;\n\t\t\t\t});\n\t\t\t\tcontinue;\n\t\t\t} else {\n\t\t\t\t$input.value = value;\n\t\t\t}\n\t\t} else if ($element?.tagName === 'SELECT') {\n\t\t\tconst $select = $element as HTMLSelectElement;\n\t\t\t$select.value = value;\n\t\t} else if ($element?.tagName === 'TEXTAREA') {\n\t\t\tconst $textarea = $element as HTMLTextAreaElement;\n\t\t\t$textarea.value = value;\n\t\t}\n\t}\n\n\t// Render the accordion header text so that it correctly indicates whether or not there is input.\n\t$qsAll('.pp-accordion-header').forEach(($ah: HTMLElement) => {\n\t\tconst $inner = $ah.nextElementSibling as HTMLElement;\n\t\tconst $field = $inner.querySelector<HTMLInputElement>('input, textarea, select');\n\t\tif ($field) {\n\t\t\tconst isInitial = inputIsInitial($inner, $field);\n\t\t\tdisplayInputStatus($ah, isInitial);\n\t\t}\n\t});\n}\n\nfunction generateFields(fieldData: WCFieldsData[], fieldOrder: number[]) {\n\tconst field = (fieldDataSingle: WCFieldsData, accordion: boolean) =>\n\t\t`<div class=\"pp-new-field\">\n\t\t\t${generateFieldElement(fieldDataSingle, accordion)}\n\t\t</div>`;\n\n\tconst newPageElement = document.querySelector('#additional-fields-new')!;\n\n\tif (fieldOrder.length === 1) {\n\t\tconst f = fieldData?.[fieldOrder?.[0] ?? -1];\n\t\tif (f && newPageElement) {\n\t\t\tnewPageElement.innerHTML += field(f, false);\n\t\t}\n\t} else if (newPageElement) {\n\t\tlet fields = '';\n\t\tfieldOrder.forEach((orderNumber, index) => {\n\t\t\tconst datum = fieldData[orderNumber];\n\t\t\tif (!datum) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet fieldItem = field(datum, true);\n\n\t\t\tif (index === 0) {\n\t\t\t\tfieldItem = fieldItem.replace('pp-new-field', 'pp-new-field pp-new-field-first');\n\t\t\t}\n\n\t\t\tif (index + 1 === fieldOrder.length) {\n\t\t\t\tfieldItem = fieldItem.replace('pp-new-field', 'pp-new-field pp-new-field-last');\n\t\t\t}\n\n\t\t\tfields += fieldItem;\n\t\t});\n\t\tnewPageElement.innerHTML += fields;\n\t}\n}\n\nfunction generateFieldElement(fieldData: WCFieldsData, accordion: boolean): string {\n\tlet elementString = '';\n\n\tconst accordionBuilder = (inner: string) => `\n\t\t\t<div class=\"pp-accordion-section\">\n\t\t\t\t<div class=\"pp-accordion-header${fieldData.field_required ? ' required' : ''}\" tabindex=\"0\">\n\t\t\t\t\t<div class=\"pp-accordion-header-text\">\n\t\t\t\t\t\t${fieldData.field_label + (fieldData.field_required ? '*' : '')}\n\t\t\t\t\t</div>\n\t\t\t\t\t<img src=\"${chevronDownImageURL}\" class=\"pp-accordion-arrow\"/>\n\t\t\t\t\t<div class=\"pp-accordion-header-bg\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"accordion-inner dim collapse\" tabindex=\"-1\">\n\t\t\t\t\t${inner}\n\t\t\t\t</div>\n\t\t\t</div>`;\n\n\tconst formLabelBuilder = (labelText?: string) => {\n\t\tif (!labelText) {\n\t\t\tlabelText = fieldData.field_label + (fieldData.field_required ? '*' : accordion ? '' : ' (optional)');\n\t\t}\n\n\t\treturn `<label for=\"${fieldData.field_name}-new\" class=\"pp-form-label-text\">\n\t\t\t${labelText}\n\t\t</label>`;\n\t};\n\n\tconst labelBuilder = (isAdditionalFieldOuterLabel?: boolean) => `<label ${isAdditionalFieldOuterLabel ? 'class=\"pp-additional-field-label\" ' : ''} for=\"${fieldData.field_name}-new\">\n\t\t\t${fieldData.field_label + (fieldData.field_required ? '*' : '')}\n\t\t</label>`;\n\n\tconst textAreaBuilder = () => {\n\t\tconst inner = `<textarea type=\"text\"\n\t\t\tname=\"${fieldData.field_name}\"\n\t\t\tclass=\"text-input\"\n\t\t\tid=\"${fieldData.field_name}-new\"\n\t\t\tplaceholder=\"${fieldData.field_placeholder ?? ' '}\"\n\t\t\t${(fieldData.field_default ? `value=\"${fieldData.field_default}\"` : '')}\n\t\t\t${(fieldData.field_required ? 'required' : '')}></textarea>`;\n\n\t\tif (!accordion) {\n\t\t\treturn `<div class=\"flex-col\">\n\t\t\t\t${fieldData.field_label ? labelBuilder(true) : ''}\n\t\t\t\t<div class=\"flex-col\">\n\t\t\t\t\t${inner}\n\t\t\t\t</div>\n\t\t\t</div>`;\n\t\t}\n\n\t\treturn accordionBuilder(`\n\t\t\t<div class=\"flex-col\">\n\t\t\t\t${inner}\n\t\t\t</div>`);\n\t};\n\n\tconst genericInputAreaBuilder = () => {\n\t\tconst inner = `<input type=\"${fieldData.type_list}\"\n\t\t\tname=\"${fieldData.field_name}\"\n\t\t\tclass=\"pp-input-box-text\"\n\t\t\tid=\"${fieldData.field_name}-new\"\n\t\t\tplaceholder=\"${fieldData.field_placeholder ?? ' '}\"\n\t\t\t${(fieldData.field_default ? `value=\"${fieldData.field_default}\"` : '')}\n\t\t\t${(fieldData.field_required ? 'required' : '')}>`;\n\n\t\tif (!accordion) {\n\t\t\treturn `<div class=\"flex-col\">\n\t\t\t\t${inner}\n\t\t\t\t${fieldData.field_label ? formLabelBuilder() : ''}\n\t\t\t</div>`;\n\t\t}\n\n\t\treturn accordionBuilder(`\n\t\t\t\t<div class=\"flex-col\">\n\t\t\t\t\t${inner}\n\t\t\t\t\t${fieldData.field_label ? formLabelBuilder() : ''}\n\t\t\t\t</div>`);\n\t};\n\n\tconst headerBuilder = () => {\n\t\tif (!accordion) {\n\t\t\treturn `\n\t\t\t\t<div class=\"pp-accordion-section-header pp-accordion-header-text\">\n\t\t\t\t\t${fieldData.field_label + (fieldData.field_required ? '*' : '')}\n\t\t\t\t</div>`;\n\t\t}\n\n\t\treturn `\n\t\t\t\t<div class=\"pp-accordion-section\">\n\t\t\t\t\t<div class=\"pp-accordion-section-header pp-accordion-header-text\">\n\t\t\t\t\t\t${fieldData.field_label + (fieldData.field_required ? '*' : '')}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"pp-accordion-section-header pp-accordion-header-bg\"></div>\n\t\t\t\t</div>`;\n\t};\n\n\tconst selectBuilder = (optionOrder: string[][]) => {\n\t\tconst inner = `<div class=\"pp-select-container\"><select name=${fieldData.field_name}\n\t\t\tid=\"${fieldData.field_name}-new\"\n\t\t\tclass=\"pp-${fieldData.type_list}-box new-text w-100 extra-field\" ${fieldData.field_required ? 'required' : ''}\n\t\t\t>\n\t\t\t${optionBuilder(optionOrder) ?? ''}\n\t\t</select><div class=\"pp-select-chevron\"><span></span></div></div>`;\n\t\tif (!accordion) {\n\t\t\treturn `<div class=\"flex-col\">\n\t\t\t\t${labelBuilder(true)}\n\t\t\t\t${inner}</div>`;\n\t\t}\n\n\t\treturn accordionBuilder(inner);\n\t};\n\n\tconst optionBuilder = (optionOrder: string[][]) => {\n\t\tif (optionOrder.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet optionList = '<option value=\"\">Please Select</option>';\n\t\toptionOrder.forEach(value => {\n\t\t\tif (value[0] && value[1]) {\n\t\t\t\toptionList += `<option value=\"${value[0]}\">${value[1]}</option>`;\n\t\t\t}\n\t\t});\n\t\treturn optionList;\n\t};\n\n\t/**\n\t * value[0] is converted to a string because while it is typed to be a string there is a\n\t * situation where it is not. A string with an integer inside is converted to a number when used\n\t * as a key in a JS object. The `option_order` property is set as an array in php which then\n\t * gets converted to a JS object.\n\t *\n\t * Ex: setting radio button option values to integer strings gives the options object:\n\t * {\n\t *   1: \"Option Text One\",\n\t *   2: \"Option Text Two\"\n\t * }\n\t */\n\tconst radioFieldBuilder = (optionOrder: string[][]) => {\n\t\tlet inner = '';\n\t\toptionOrder.forEach(value => {\n\t\t\tif (value[0] && value[1]) {\n\t\t\t\tinner += `\n\t\t\t\t\t<div class=\"pp-radio-line\">\n\t\t\t\t\t\t<input type=${fieldData.type_list}\n\t\t\t\t\t\t\tname=${fieldData.field_name} \n\t\t\t\t\t\t\tid=\"${fieldData.field_name + '-new-' + value[0]}\"\n\t\t\t\t\t\t\tvalue=\"${value[0]}\"\n\t\t\t\t\t\t\tclass=\"input-${fieldData.type_list} extra-field\"\n\t\t\t\t\t\t\t${(fieldData.field_required ? 'required' : '')}\n\t\t\t\t\t\t\t${fieldData.field_default === value[0].toString() ? 'checked=\"checked\"' : ''}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<label for=\"${fieldData.field_name}-new-${value[0]}\">\n\t\t\t\t\t\t\t${value[1]}\n\t\t\t\t\t\t</label>\n\t\t\t\t\t</div>`;\n\t\t\t}\n\t\t});\n\t\tif (!accordion) {\n\t\t\treturn `<div class=\"flex-col\">\n\t\t\t\t${labelBuilder(true)}\n\t\t\t\t${inner}</div>`;\n\t\t}\n\n\t\treturn accordionBuilder(inner);\n\t};\n\n\tconst checkboxBuilder = () => {\n\t\tconst inner = `\n\t\t<div class=\"pp-checkbox-input-container\">\n\t\t<input\n\t\t\ttype=\"checkbox\"\n\t\t\tid=\"${fieldData.field_name}-new\"\n\t\t\tclass=\"pp-form-checkbox extra-field\"\n\t\t\tname=\"${fieldData.field_name}\"\n\t\t\tvalue=\"${fieldData.field_default ? fieldData.field_default : '1'}\"\n\t\t\t${fieldData.field_required ? 'required' : ''}\n\t\t>\n\t\t${labelBuilder()}\n\t\t</div>`;\n\t\tif (!accordion) {\n\t\t\treturn `<div class=\"flex-col\">\n\t\t\t\t${labelBuilder(true)}\n\t\t\t\t${inner}</div>`;\n\t\t}\n\n\t\tif (!accordion) {\n\t\t\treturn inner;\n\t\t}\n\n\t\treturn accordionBuilder(inner);\n\t};\n\n\tif (fieldData.type_list === 'text') {\n\t\telementString = textAreaBuilder();\n\t\treturn elementString;\n\t}\n\n\tif (fieldData.type_list === 'select') {\n\t\telementString += selectBuilder(fieldData.option_order ?? []);\n\t\treturn elementString;\n\t}\n\n\tif (fieldData.type_list === 'radio') {\n\t\telementString += radioFieldBuilder(fieldData.option_order ?? []);\n\t\treturn elementString;\n\t}\n\n\tif (fieldData.type_list === 'checkbox') {\n\t\telementString += checkboxBuilder();\n\t\treturn elementString;\n\t}\n\n\tif (fieldData.type_list === 'header') {\n\t\telementString += headerBuilder();\n\t\treturn elementString;\n\t}\n\n\telementString = genericInputAreaBuilder();\n\treturn elementString;\n}\n\nexport function collectAdditionalFieldData(fieldData: WCFieldsData[], fieldOrder: number[]): Record<string, string> {\n\tconst fieldDataRecord: Record<string, string> = {};\n\tfor (const orderNumber of fieldOrder) {\n\t\tconst field = fieldData[orderNumber];\n\t\tif (!field) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tconst fieldName = field.field_name;\n\t\tconst temporaryData: WCFieldData = {name: ''};\n\t\ttemporaryData.label = field.field_label;\n\t\ttemporaryData.name = fieldName;\n\t\tif (field.field_enable) {\n\t\t\tif (field.type_list === 'radio') {\n\t\t\t\tconst $selectedRadio = $qs<HTMLInputElement>(`input[type=\"radio\"][name=${fieldName}]:checked`);\n\t\t\t\tif ($selectedRadio?.value) {\n\t\t\t\t\ttemporaryData.value = $selectedRadio?.value;\n\t\t\t\t\tfieldDataRecord[temporaryData.name] = temporaryData.value ?? '';\n\t\t\t\t}\n\t\t\t} else if (field.type_list === 'checkbox') {\n\t\t\t\tconst $checkbox = $qs<HTMLInputElement>(`input[type=\"checkbox\"][name=${fieldName}]`);\n\t\t\t\ttemporaryData.value = $checkbox?.checked ? 'yes' : 'no';\n\t\t\t\tfieldDataRecord[temporaryData.name] = temporaryData.value ?? '';\n\t\t\t} else {\n\t\t\t\tconst $element = $qs<HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement>(`#${fieldName}-new`);\n\t\t\t\ttemporaryData.value = $element?.value;\n\t\t\t\tfieldDataRecord[temporaryData.name] = temporaryData.value ?? '';\n\t\t\t}\n\t\t}\n\t}\n\n\treturn fieldDataRecord;\n}\n\n/**\n * Checks the info page form and the additional fields.\n * If there are invalid additional fields, expands only the invalid fields before showing the help message.\n */\nexport function checkRequiredFields(): boolean {\n\t// Unless checkRequiredFields is called from the returning customer checkout\n\t// or the customer hasn't moved past the info page of the new customer checkout,\n\t// it would be redundant to check the info fields.\n\tconst shouldCheckInfoForm = Environment.modalUI.page() === 'info' || Environment.modalUI.page() === 'shipping';\n\n\tif (shouldCheckInfoForm) {\n\t\tconst modalPage = Environment.modalUI.page();\n\t\tconst forms = modalPage === 'shipping' && PeachPayCustomer.shipToDifferentAddress() ? '#pp-different-shipping-details' : '#pp-info-form';\n\t\tconst primaryFormValidity = $qsAll<HTMLFormElement>(`${forms}`).map($el => $el.checkValidity()).reduce((acc, validity) => acc === validity, true);\n\t\tif (!primaryFormValidity) {\n\t\t\tif (modalPage !== 'shipping') {\n\t\t\t\tstore.dispatch(updateEnvironment({\n\t\t\t\t\tmodalPageType: 'info',\n\t\t\t\t\trequestedPage: undefined,\n\t\t\t\t}));\n\t\t\t}\n\n\t\t\t$qs<HTMLFormElement>(`${forms}`)?.reportValidity();\n\t\t\treturn false;\n\t\t}\n\t}\n\n\t// When checkRequiredFields is called for the purpose of checking the info form\n\t// and moving to the shipping page, it is unnecessary to validate the additional\n\t// fields or the account info.\n\tconst shouldCheckAdditionalFieldsOrAccountInfo = Environment.modalUI.requestedPage() !== 'shipping';\n\tif (!shouldCheckAdditionalFieldsOrAccountInfo) {\n\t\treturn true;\n\t}\n\n\tconst additionalFieldsValidity = $qs<HTMLFormElement>('#additional-fields-new')?.checkValidity();\n\n\tif (!additionalFieldsValidity) {\n\t\t// If the user attempted to skip the shipping page despite the required additional\n\t\t// fields being incomplete, they will be taken to the shipping page and then shown the\n\t\t// incomplete fields.\n\t\tif (Environment.modalUI.requestedPage() === 'payment' && Environment.modalUI.page() !== 'shipping') {\n\t\t\tstore.dispatch(updateEnvironment({\n\t\t\t\tmodalPageType: 'shipping',\n\t\t\t\trequestedPage: undefined,\n\t\t\t}));\n\t\t}\n\n\t\tlet additionalFieldsCount = 0;\n\n\t\t// Selects and expands only the invalid fields.\n\t\t$qsAll('.extra-field:invalid').forEach($el => {\n\t\t\tadditionalFieldsCount++;\n\t\t\t// The inner div of an accordion row\n\t\t\tconst accordionInner\n\t\t\t\t= (($el.inputMode === 'checkbox') ? $el.parentNode?.parentNode?.parentNode : ['INPUT', 'TEXTAREA'].includes($el.tagName) ? $el.parentNode?.parentNode : $el.parentNode) as HTMLElement;\n\t\t\tif (accordionInner) {\n\t\t\t\t// Styles the accordion header for the expanded state.\n\t\t\t\tconst accordionHeader = accordionInner.parentNode?.firstElementChild as HTMLElement;\n\t\t\t\tif (accordionHeader) {\n\t\t\t\t\taccordionHeader.classList.add('fill');\n\t\t\t\t\tconst $chevron = accordionHeader.getElementsByTagName('img')?.[0];\n\t\t\t\t\tif ($chevron) {\n\t\t\t\t\t\t$chevron.style.transform = 'scaleY(-1)';\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Expands the accordion header.\n\t\t\t\taccordionInner.classList.remove('collapse');\n\t\t\t\taccordionInner.classList.remove('dim');\n\t\t\t}\n\t\t});\n\n\t\t// Waits for all the invalid accordions to open before showing message.\n\t\tsetTimeout(() => {\n\t\t\t$qs<HTMLFormElement>('#additional-fields-new')?.reportValidity();\n\t\t}, (additionalFieldsCount > 1) ? 600 : 0);\n\n\t\treturn false;\n\t}\n\n\t// Only check account info when the pay button is clicked from either new or\n\t// returning checkout.\n\tconst shouldCheckAccountInfo = Environment.modalUI.requestedPage() === undefined;\n\n\t// When checkRequiredFields is called to get to the payment page and the additional\n\t// fields are validated, it is unnecessary to validate the account info.\n\tif (!shouldCheckAccountInfo) {\n\t\treturn true;\n\t}\n\n\t// Return true if the account form is not found (means it wasn't required)\n\tconst accountInfoValidity = $qs<HTMLFormElement>('#pp-store-account-info-form')?.checkValidity() ?? true;\n\n\tif (accountInfoValidity) {\n\t\treturn true;\n\t}\n\n\t$qs<HTMLFormElement>('#pp-store-account-info-form')?.reportValidity();\n\treturn false;\n}\n","import {$qs, fetchHostWindowData} from '../../../@shared/ts/dom';\nimport {type InitMessage} from '../../../@type/window-messages';\nimport {type WCFieldsData} from '../../../@type/woocommerce/field-data';\nimport {getLocaleText} from '../util/translation';\nimport chevronDownImageURL from '../../img/chevron-down-solid.svg';\n\nexport function generateMainForm(message: InitMessage): HTMLElement {\n\tconst form = document.createElement('form');\n\tform.id = 'pp-info-form';\n\tform.classList.add('pp-info-form', 'pp-info-form-new', 'flex', 'col');\n\tconst container = document.createElement('div');\n\tcontainer.classList.add('flex', 'col', 'pp-form-rows-container');\n\tcontainer.appendChild(formGenerator(message.phpData?.billing_fields ?? [], message.phpData?.billing_fields_order ?? [], 'billing'));\n\tform.appendChild(container);\n\treturn form;\n}\n\nexport function generateShippingForm(message: InitMessage): HTMLDivElement {\n\tconst container = document.createElement('div');\n\tcontainer.classList.add('flex', 'col', 'pp-form-rows-container');\n\tcontainer.appendChild(formGenerator(message.phpData?.shipping_fields ?? [], message.phpData?.shipping_fields_order ?? [], 'shipping'));\n\treturn container;\n}\n\nexport function initShippingForm() {\n\t$qs('#pp-different-shipping-details', $element => {\n\t\t$element.addEventListener('submit', (e: Event) => {\n\t\t\te.preventDefault();\n\t\t\treturn false;\n\t\t});\n\t});\n}\n\nfunction formGenerator(fieldData: WCFieldsData[], fieldOrder: number[], section: string, formIdDifferentiator = ''): HTMLDivElement {\n\tconst formId = `pp-${formIdDifferentiator + (formIdDifferentiator ? '-' : '')}info-form`;\n\t// This creates 2 layers of container divs, which works but isn't clean. Here to \"End block\" should be standardized to just return the\n\t// flex container.\n\tlet form = document.createElement('div');\n\tform.classList.add('flex', 'col', 'pp-form-rows-container');\n\tif (section === '') {\n\t\tconst formForm = document.createElement('form');\n\t\tformForm.id = formId;\n\t\tformForm.classList.add('pp-info-form', 'flex', 'col');\n\t\tconst formFormDiv = document.createElement('div');\n\t\tformFormDiv.classList.add('flex', 'col', 'pp-form-rows-container');\n\t\tformForm.appendChild(formFormDiv);\n\t\tform.appendChild(formForm);\n\t\t// Enables consistent referencing for adding children.\n\t\tform = formFormDiv;\n\t}\n\t// End block\n\n\tlet i = 0;\n\tlet rowSpace = 100;\n\tlet rowElement = document.createElement('div');\n\n\tconst labelNameTranslations: Record<string, string> = {\n\t\tShipping: getLocaleText('Shipping'),\n\t\tBilling: getLocaleText('Billing'),\n\t\tPersonal: getLocaleText('Personal'),\n\t};\n\n\tlet field: WCFieldsData | undefined = fieldData[fieldOrder?.[i] ?? -1] ?? undefined;\n\n\twhile (field) {\n\t\tconst fieldWidth: number = parseInt(field.width);\n\t\tconst label = labelNameTranslations[field.field_label] ?? field.field_label;\n\t\tif (field.type_list === 'header') {\n\t\t\tif (rowElement.innerHTML.length !== 0) {\n\t\t\t\t// Add a filler div to finish the row\n\t\t\t\tif (rowSpace !== 0) {\n\t\t\t\t\tconst element = document.createElement('div');\n\t\t\t\t\telement.classList.add('pp-fw-' + rowSpace);\n\t\t\t\t\trowElement.appendChild(element);\n\t\t\t\t}\n\n\t\t\t\tform.appendChild(rowElement);\n\t\t\t\t// Reset.\n\t\t\t\trowSpace = 100;\n\t\t\t\trowElement = document.createElement('div');\n\t\t\t}\n\n\t\t\tform.innerHTML += `<div id=\"${field.field_name}-field\" class=\"${field.field_name}\"><span class=\"pp-info-form-header\">${label}</span></div>`;\n\t\t\ti++;\n\t\t\tfield = fieldData[fieldOrder?.[i] ?? -1] ?? undefined;\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (rowSpace < fieldWidth) {\n\t\t\tif (rowSpace !== 0) {\n\t\t\t\tconst element = document.createElement('div');\n\t\t\t\telement.classList.add('pp-fw-' + rowSpace);\n\t\t\t\trowElement.appendChild(element);\n\t\t\t}\n\n\t\t\tform.appendChild(rowElement);\n\t\t\t// Reset.\n\t\t\trowSpace = 100;\n\t\t\trowElement = document.createElement('div');\n\t\t}\n\n\t\tif (rowSpace >= fieldWidth) {\n\t\t\tif (rowElement.innerHTML.length === 0) {\n\t\t\t\trowElement.classList.add('flex', 'pp-form-row');\n\t\t\t}\n\n\t\t\trowElement.appendChild(generateFieldElement(field, section));\n\t\t\trowSpace -= fieldWidth;\n\t\t\ti++;\n\t\t\tfield = fieldData[fieldOrder?.[i] ?? -1] ?? undefined;\n\t\t}\n\t}\n\n\tif (rowElement.innerHTML.length !== 0) {\n\t\tif (rowSpace !== 0) {\n\t\t\tconst element = document.createElement('div');\n\t\t\telement.classList.add('pp-fw-' + rowSpace);\n\t\t\trowElement.appendChild(element);\n\t\t}\n\n\t\tform.appendChild(rowElement);\n\t}\n\n\treturn form;\n}\n\nfunction generateFieldElement(fieldData: WCFieldsData, section: string): HTMLDivElement {\n\tconst fieldWidth: number = parseInt(fieldData.width);\n\t// New\n\tconst element = document.createElement('div');\n\telement.classList.add(fieldData.field_name + '-field', 'pp-fw-' + fieldWidth, fieldData.type_list === 'radio' ? 'flex-col' : 'flex');\n\tif (fieldData.type_list === 'checkbox') {\n\t\telement.style.alignItems = 'center';\n\t}\n\n\tconst optional = fieldWidth <= 30 ? '<span class=\"optional\"> (opt.) </span>' : '<span class=\"optional\"> (optional) </span>';\n\n\tconst labelNameTranslations: Record<string, string> = {\n\t\t'Street address': getLocaleText('Street address'),\n\t\tApartment: getLocaleText('Apartment'),\n\t\tCity: getLocaleText('City'),\n\t\tCountry: getLocaleText('Country'),\n\t\tEmail: getLocaleText('Email'),\n\t\t'First name': getLocaleText('First name'),\n\t\t'Last name': getLocaleText('Last name'),\n\t\t'Phone number': getLocaleText('Phone number'),\n\t\t'Postal code': getLocaleText('Postal code'),\n\t\tState: getLocaleText('State'),\n\t\tProvince: getLocaleText('Province'),\n\t};\n\n\tconst label = labelNameTranslations[fieldData.field_label] ?? fieldData.field_label;\n\n\tconst labelBuilder = () =>\n\t\t`<label title=\"${label}\" for=\"${fieldData.field_name}\"\n\t\tclass=\"${(fieldData.type_list === 'checkbox' || fieldData.type_list === 'radio') ? 'pp-alt-label' : 'pp-form-label'}\n\t\t${fieldData.type_list === 'select' ? ' pp-select-label' : ''}\">\n\t\t\t${getLimitedLabel(fieldData, label)}\n\t\t\t${(fieldData.field_required !== 'yes' && !['Apartment', 'Apt.'].includes(fieldData.field_label)) ? optional : ''}\n\t\t</label>${(fieldData.type_list === 'select') ? `<div class=\"pp-form-chevron\"><img src=\"${chevronDownImageURL}\"/></div>` : ''}`;\n\n\tconst inputBuilder = () =>\n\t\t`<input type=\"${fieldData.type_list}\"\n\t\t\tname=\"${fieldData.field_name}\"\n\t\t\tplaceholder=\" \"`\n\t\t+ (fieldData.field_default ? `value=\"${fieldData.field_default.replace(/\"/g, '&quot;')}\"` : '')\n\t\t+ 'class=\"pp-fw-100 text-input\"'\n\t\t+ (fieldData.field_required === 'yes' ? ' required' : '')\n\t\t+ '/>';\n\n\tconst selectBuilder = (optionOrder: string[][]) =>\n\t\t`<select name=${fieldData.field_name}\n\t\t\tclass=\"pp-fw-100\"\n\t\t\t${fieldData.field_required === 'yes' ? 'required' : ''}>\n\t\t\t\t${optionBuilder(optionOrder)}\n\t\t</select>\n\t\t${labelBuilder()}`;\n\n\tconst optionBuilder = (optionOrder: string[][]) => {\n\t\tif (optionOrder.length === 0) {\n\t\t\treturn '';\n\t\t}\n\n\t\tlet optionList = '<option value=\"\">Please Select</option>';\n\t\toptionOrder.forEach(value => {\n\t\t\tif (value[0] && value[1]) {\n\t\t\t\toptionList += `<option value=\"${value[0]}\">${value[1].replace(/\\\\\"/g, '\"').replace(/\\\\'/g, '\\'')}</option>`;\n\t\t\t}\n\t\t});\n\t\treturn optionList;\n\t};\n\n\tconst radioFieldBuilder = (optionOrder: string[][]) => {\n\t\tlet radioFields = '<div class=\"pp-radio-field\">';\n\t\tradioFields += fieldData.field_label ? labelBuilder() : '';\n\t\tradioFields += '<div class=\"pp-radio-option-container\">';\n\t\tlet first = true;\n\t\toptionOrder.forEach(value => {\n\t\t\tif (value[0] && value[1]) {\n\t\t\t\tradioFields += `<label class=\"pp-radio-line\"><input type=${fieldData.type_list}\n\t\t\t\tname=\"${fieldData.field_name}\"`\n\t\t\t\t\t+ `value=\"${value[0]}\"`\n\t\t\t\t\t+ 'class=\"pp-radio-input\"'\n\t\t\t\t\t+ (fieldData.field_required === 'yes' && first ? ' required' : '')\n\t\t\t\t\t+ (fieldData.field_default === value[0] ? ' checked' : '')\n\t\t\t\t\t+ '/>';\n\t\t\t\tradioFields += `<span class=\"radio-option-label\">${value[1].replace(/\\\\\"/g, '\"').replace(/\\\\'/g, '\\'')}</span></label>`;\n\t\t\t\tif (first) {\n\t\t\t\t\tfirst = false;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tradioFields += '</div></div>';\n\t\treturn radioFields;\n\t};\n\n\tconst checkbox = () => `\n\t<div class=\"pp-checkbox-input-container\">\n\t\t<input\n\t\t\ttype=\"checkbox\"\n\t\t\tclass=\"pp-form-checkbox\"\n\t\t\tname=\"${fieldData.field_name}\"\n\t\t\tvalue=\"${fieldData.field_default ? fieldData.field_default : '1'}\"\n\t\t\tstyle=\"float: right;\"\n\t\t\t${fieldData.field_required === 'yes' ? 'required' : ''}\n\t\t>\n\t</div>\n\t${labelBuilder()}\n\t`;\n\n\tconst stateRegionBuilder = (section: string) => `\n\t\t<input name=\"${section}_province\" class=\"pp-fw-100 text-input\" type=\"text\" name=\"off\" placeholder=\" \">\n\t\t<label for=\"${section}_province\" class=\"pp-form-label\">${labelNameTranslations['Province'] + optional}</label>\n\t\t<select name=\"${fieldData.field_name}\" class=\"pp-fw-100 select hide\" size=\"1\">\n\t\t\t<option hidden disabled selected value></option>\n\t\t</select>\n\t\t<label for=\"${fieldData.field_name}\" class=\"pp-form-label pp-select-label hide\"></label>\n\t\t<div class=\"pp-form-chevron\"><img src=\"${chevronDownImageURL}\"/></div>\n\t\t`;\n\n\tconst countryFieldBuilder = () => `\n\t\t<select class=\"w-100\" name=\"${fieldData.field_name}\" size=\"1\" ${(fieldData.field_required === 'yes' ? 'required' : '')}>\n\t\t\t<option hidden disabled selected>\n\t\t\t\t${getLocaleText('Select a country')}\n\t\t\t</option>\n\t\t</select>\n\t\t<label for=\"${fieldData.field_name}\" class=\"pp-form-label pp-select-label\">\n\t\t\t${getLocaleText('Country')}\n\t\t</label>\n\t\t<div class=\"pp-form-chevron\"><img src=\"${chevronDownImageURL}\"/></div>\n\t`;\n\n\tconst passwordInputBuilder = () =>\n\t\t`<input type=\"${fieldData.type_list}\"\n\t\t\tname=\"${fieldData.field_name}\"\n\t\t\tplaceholder=\" \"\n\t\t\tminlength=\"8\"`\n\t\t+ (fieldData.field_default ? `value=\"${fieldData.field_default.replace(/\"/g, '&quot;')}\"` : '')\n\t\t+ 'class=\"pp-fw-100 text-input\"'\n\t\t+ (fieldData.field_required === 'yes' ? ' required' : '')\n\t\t+ '/>';\n\n\tif (fieldData.type_list === 'text' || fieldData.type_list === 'email' || fieldData.type_list === 'tel') {\n\t\telement.innerHTML = inputBuilder() + (fieldData.field_label ? labelBuilder() : '');\n\t\tif (fieldData.type_list === 'email') {\n\t\t\t// Email grabbing for abandoned cart analytics.\n\t\t\telement.addEventListener('focusout', updateEmail);\n\t\t}\n\t} else if (fieldData.type_list === 'select') {\n\t\telement.innerHTML = selectBuilder(fieldData.option_order ?? []);\n\t} else if (fieldData.type_list === 'radio') {\n\t\telement.innerHTML = radioFieldBuilder(fieldData.option_order ?? []);\n\t} else if (fieldData.type_list === 'checkbox') {\n\t\telement.innerHTML = checkbox();\n\t} else if (fieldData.type_list === 'country') {\n\t\telement.innerHTML = countryFieldBuilder();\n\t} else if (fieldData.type_list === 'state') {\n\t\telement.innerHTML = stateRegionBuilder(section);\n\t} else if (fieldData.type_list === 'password') {\n\t\telement.innerHTML = passwordInputBuilder() + (fieldData.field_label ? labelBuilder() : '');\n\t}\n\n\treturn element;\n}\n\n/**\n * Takes a fieldData and returns its label, truncated based on its width so that the label doesn't overflow.\n * An ellipsis is appended as needed.\n * @param fieldData\n * @returns truncated label\n */\nfunction getLimitedLabel(fieldData: WCFieldsData, label: string): string {\n\tconst fieldWidth: number = parseInt(fieldData.width);\n\tif ((fieldWidth === 100) && (fieldData.type_list === 'radio')) {\n\t\treturn label;\n\t}\n\n\ttry {\n\t\t// Since apt. number is universally optional, make sure it isn't required\n\t\tconst isOptional = fieldData.field_required !== 'yes' && !['Apartment', 'Apt.'].includes(fieldData.field_label);\n\t\tlet optionalTagWidth = 0;\n\t\tif (isOptional) {\n\t\t\toptionalTagWidth = fieldWidth <= 30 ? 40 : 68;\n\t\t}\n\n\t\tlet maxWidth = 0;\n\t\tif (fieldWidth <= 30) {\n\t\t\tmaxWidth = 75;\n\t\t} else if (fieldWidth <= 50) {\n\t\t\tmaxWidth = 164;\n\t\t} else if (fieldWidth <= 70) {\n\t\t\tmaxWidth = 250;\n\t\t} else {\n\t\t\tmaxWidth = 378;\n\t\t}\n\n\t\tconst $canvas: HTMLCanvasElement = document.createElement('canvas');\n\t\tconst ctx: CanvasRenderingContext2D | null = $canvas?.getContext('2d');\n\t\tif (!ctx) {\n\t\t\t$canvas.remove();\n\t\t\treturn label;\n\t\t}\n\n\t\t// Poor font flexibility, but this is the best that can be done before rendering.\n\t\tconst font\n\t\t\t\t= '14.4px Inter, -apple-system, BlinkMacSystemFont, \\'Segoe UI\\', Roboto, \\'Noto Sans\\', Ubuntu, Cantarell, \\'Helvetica Neue\\', sans-serif, \\'Apple Color Emoji\\', \\'Segoe UI Emoji\\', \\'Segoe UI Symbol\\', \\'Noto Color Emoji\\'';\n\t\tctx.font = font;\n\n\t\tconst tooLong = () => ctx.measureText(label).width + optionalTagWidth > maxWidth;\n\n\t\tif (tooLong()) {\n\t\t\twhile (tooLong()) {\n\t\t\t\tlabel = label.slice(0, label.length - 1);\n\t\t\t}\n\n\t\t\tlabel += '…';\n\t\t}\n\n\t\t$canvas.remove();\n\n\t\treturn label;\n\t} catch {\n\t\treturn label;\n\t}\n}\n\nasync function updateEmail(e: Event) {\n\tconst email = (e.target as HTMLInputElement).value;\n\tawait fetchHostWindowData('pp-update-email', {\n\t\temail,\n\t});\n}\n","import {Feature} from '../reducers/environmentReducer';\nimport {FeatureFlag} from '../../../@type/features';\n\nexport function initBotProtection() {\n\tif (!Feature.enabled(FeatureFlag.BOT_PROTECTION)) {\n\t\treturn;\n\t}\n\n\tinstallCaptchaScript();\n}\n\nfunction installCaptchaScript() {\n\tconst script = document.createElement('script');\n\tscript.setAttribute('src', 'https://www.google.com/recaptcha/api.js?render=' + Feature.metadata(FeatureFlag.BOT_PROTECTION, 'site_key'));\n\n\tscript.async = true;\n\tscript.defer = true;\n\n\tdocument.body.appendChild(script);\n}\n\n/**\n * Returns a string (recaptcha token or placeholder) that gets appended to form data for captcha validation\n */\nexport async function getCaptchaToken(): Promise<string> {\n\tif (!Feature.enabled(FeatureFlag.BOT_PROTECTION)) {\n\t\treturn Promise.resolve('placeholder');\n\t}\n\n\treturn new Promise(resolve => {\n\t\tgrecaptcha.ready(async () => {\n\t\t\ttry {\n\t\t\t\tconst token = await grecaptcha.execute(Feature.metadata(FeatureFlag.BOT_PROTECTION, 'site_key') ?? '', {action: 'EXPRESS_CHECKOUT'});\n\t\t\t\tresolve(token);\n\t\t\t} catch (error: any) {\n\t\t\t\tresolve('');\n\t\t\t}\n\t\t});\n\t});\n}\n","import {type IPeachPayCustomer} from '../../../@type/peachpay/customer';\n\nconst CHECKOUT_CUSTOMER_KEY = 'peachpay_checkout_customer';\nconst INPROGRESS_CUSTOMER_KEY = 'peachpay_inprogress_customer';\n\nexport function getCustomer(inprogress = false): IPeachPayCustomer | null {\n\ttry {\n\t\treturn JSON.parse(localStorage.getItem(inprogress ? INPROGRESS_CUSTOMER_KEY : CHECKOUT_CUSTOMER_KEY) ?? 'null') as IPeachPayCustomer;\n\t} catch {\n\t\t// If the browser blocks third party cookies, just skip the existing\n\t\t// customer feature for now since we cannot use local storage\n\t\treturn null;\n\t}\n}\n\nexport function setCustomer(customer: IPeachPayCustomer, inprogress = false): boolean {\n\tif (!customer) {\n\t\treturn false;\n\t}\n\n\ttry {\n\t\tlocalStorage.setItem(inprogress ? INPROGRESS_CUSTOMER_KEY : CHECKOUT_CUSTOMER_KEY, JSON.stringify(customer));\n\n\t\treturn true;\n\t} catch {\n\t\treturn false;\n\t}\n}\n\nexport function clearCustomer(): boolean {\n\ttry {\n\t\tlocalStorage.removeItem(CHECKOUT_CUSTOMER_KEY);\n\t\tlocalStorage.removeItem(INPROGRESS_CUSTOMER_KEY);\n\n\t\treturn true;\n\t} catch {\n\t\treturn false;\n\t}\n}\n","import {type IPeachPayCustomer} from '../../../@type/peachpay/customer';\nimport {renderDropDownList, selectDropdown} from '../util/ui';\nimport {cleanFormFields, formEntry, isRequiredField, isShortAddressEmpty} from '../util/form';\nimport {stateProvinceOrCounty} from '../util/country';\nimport {getLocaleText} from '../util/translation';\nimport {type WCFieldInfo, type WCLocationInfo} from '../../../@type/woocommerce/location-info';\nimport {store} from '../store';\nimport {Environment, Feature, startModalLoading, stopModalLoading, updateEnvironment} from '../reducers/environmentReducer';\nimport {MerchantConfiguration} from '../reducers/merchantConfigurationReducer';\nimport {type ModalPage} from '../models/IEnvironment';\nimport {GLOBAL} from '../deprecated/global';\nimport {clearCustomer, getCustomer, setCustomer} from '../util/customer';\nimport {Carts} from '../reducers/cartReducer';\nimport {generateMainForm, generateShippingForm} from './billingShippingFields';\nimport {type WCFieldsData} from '../../../@type/woocommerce/field-data';\nimport {requestCartCalculation} from '../payment/order';\nimport {validateAddress} from './shipping';\nimport {$qs, $qsAll} from '../../../@shared/ts/dom';\nimport {type WCPHPData} from '../../../@type/woocommerce/php-data';\nimport {type InitMessage} from '../../../@type/window-messages';\nimport {FeatureFlag} from '../../../@type/features';\nimport {PeachPayCustomer, updateCustomerFields, updateCustomer} from '../reducers/peachPayCustomerReducer';\nimport {PeachPayOrder} from '../reducers/peachPayOrderReducer';\nimport {checkRequiredFields} from './additionalFields';\n\nexport function installCustomerFormFields(message: InitMessage): void {\n\tconst form = generateMainForm(message);\n\n\tconst ppInfo = $qs('#pp-info');\n\tif (ppInfo) {\n\t\tppInfo.insertBefore(form, ppInfo.firstChild);\n\t}\n}\n\nexport function installCustomerBillingFields(message: InitMessage): void {\n\tconst newForm = generateShippingForm(message);\n\t$qs('#shipping-details fieldset')?.appendChild(newForm);\n}\n\nexport function initCustomer(message: InitMessage) {\n\tinitCustomerEvents(message);\n}\n\nfunction initCustomerEvents(message: InitMessage) {\n\t$qsAll('.save-payment-info-checkbox', $el => {\n\t\t$el?.addEventListener('change', function (this: HTMLInputElement) {\n\t\t\tconst isChecked = this.checked;\n\n\t\t\tstore.dispatch(updateEnvironment({\n\t\t\t\tcustomerSaveToBrowserSelected: isChecked,\n\t\t\t}));\n\t\t});\n\t});\n\n\tinitCustomerFormEvents(message);\n\n\t// Ensure changes to the customer data get rendered\n\tlet previousShipToDifferentAddress = PeachPayCustomer.shipToDifferentAddress();\n\tlet previousCustomerStr = JSON.stringify(PeachPayCustomer.data());\n\tlet previousOpen = Environment.modalUI.open();\n\tlet previousModalPage = Environment.modalUI.page();\n\n\tstore.subscribe(async () => {\n\t\tif (Environment.modalUI.open()) {\n\t\t\tconst customer = PeachPayCustomer.data();\n\t\t\tconst shipToDifferentAddress = PeachPayCustomer.shipToDifferentAddress();\n\t\t\tconst customerStr = JSON.stringify(customer);\n\t\t\tconst modalPage = Environment.modalUI.page();\n\n\t\t\t// #region Render or re-render the country and correct state/province field in the following cases:\n\t\t\t// * after opening the modal\n\t\t\t// * after expanding the separate shipping fields\n\t\t\t// * after switching to new customer checkout\n\t\t\tif (Environment.modalUI.open() && !previousOpen) {\n\t\t\t\trenderCountryAndStateList(message.phpData.wc_location_info ?? undefined);\n\t\t\t\trenderCorrectProvinceField(message.phpData);\n\n\t\t\t\tif (Feature.enabled(FeatureFlag.USE_WC_COUNTRY_LOCALE)) {\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\twcCountryLocaleRuleRender(modalPage);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (shipToDifferentAddress && !previousShipToDifferentAddress) {\n\t\t\t\trenderCountryAndStateList(message.phpData.wc_location_info ?? undefined);\n\n\t\t\t\trenderCorrectProvinceField(message.phpData);\n\n\t\t\t\tif (Feature.enabled(FeatureFlag.USE_WC_COUNTRY_LOCALE)) {\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\twcCountryLocaleRuleRender(modalPage);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\t// #endregion\n\n\t\t\tif (modalPage === 'info' || modalPage === 'shipping') {\n\t\t\t\trenderShippingElements(message);\n\t\t\t}\n\n\t\t\tif (modalPage === 'shipping') {\n\t\t\t\trenderCustomerHeader();\n\t\t\t}\n\n\t\t\tif ((previousCustomerStr !== customerStr || previousModalPage !== modalPage)) {\n\t\t\t\trenderCustomerFields(customer);\n\t\t\t\tsetCustomer(customer, true);\n\t\t\t}\n\n\t\t\tpreviousShipToDifferentAddress = shipToDifferentAddress;\n\t\t\tpreviousCustomerStr = customerStr;\n\t\t\tpreviousModalPage = modalPage;\n\t\t\tpreviousOpen = true;\n\t\t} else {\n\t\t\tpreviousOpen = false;\n\t\t}\n\t});\n}\n\n/**\n * Attaches event listeners to form elements so that changes can be synced with the PeachPay data and then reflected in the modal state.\n * Zero Length Timeout is needed at times to ensure that the changes we are seeing are after the change is made and not right before which is the default.\n *\n * @param message The initial message with PHP data.\n */\nfunction initCustomerFormEvents(message: InitMessage) {\n\t$qs('#pp-info-form')?.addEventListener('change', (event: Event) => {\n\t\t// If the country field changed\n\t\tconst target = event.target as HTMLElement;\n\t\tif (target && target.closest('select')?.name === 'billing_country') {\n\t\t\trenderCorrectProvinceField(message.phpData);\n\t\t\tif (Feature.enabled(FeatureFlag.USE_WC_COUNTRY_LOCALE)) {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\twcCountryLocaleRuleRender('info');\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tsetTimeout(() => {\n\t\t\tsyncCustomerFieldChanges('#pp-info-form');\n\t\t});\n\t});\n\t// EDIT button on shipping page\n\t$qs('#open-shipping-details')?.addEventListener('change', async (event: Event) => {\n\t\tif ((event.target as HTMLInputElement).checked) {\n\t\t\tconst formFields = PeachPayCustomer.data().form_fields;\n\t\t\tformFields['ship_to_different_address'] = '1';\n\t\t\tstore.dispatch(updateCustomerFields(formFields));\n\t\t} else {\n\t\t\tconst formFields = PeachPayCustomer.data().form_fields;\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-dynamic-delete\n\t\t\tdelete formFields['ship_to_different_address'];\n\t\t\tstore.dispatch(updateCustomerFields(formFields));\n\t\t}\n\n\t\tstore.dispatch(startModalLoading());\n\t\tawait requestCartCalculation();\n\t\tstore.dispatch(stopModalLoading());\n\t});\n\t// shipping form element with shipping fields, including separate shipping address option\n\t$qs('#pp-different-shipping-details')?.addEventListener('change', (event: Event) => {\n\t\t// If the country field changed\n\t\tconst target = event.target as HTMLElement;\n\t\tif (target && target.closest('select')?.name === 'shipping_country') {\n\t\t\trenderCorrectProvinceField(message.phpData);\n\t\t\tif (Feature.enabled(FeatureFlag.USE_WC_COUNTRY_LOCALE)) {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\twcCountryLocaleRuleRender('shipping');\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tsetTimeout(async () => {\n\t\t\tlet canMoveOn = false;\n\t\t\tif (!Carts.virtual()) {\n\t\t\t\tif (PeachPayCustomer.shipToDifferentAddress()) {\n\t\t\t\t\tsyncCustomerFieldChanges('#pp-different-shipping-details');\n\t\t\t\t}\n\n\t\t\t\tif (checkRequiredFields() && !isShortAddressEmpty('shipping')) {\n\t\t\t\t\tstore.dispatch(startModalLoading());\n\t\t\t\t\tcanMoveOn = await validateAddress();\n\t\t\t\t\tawait requestCartCalculation();\n\t\t\t\t\tstore.dispatch(stopModalLoading());\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tdocument.querySelectorAll('#pp-continue-to-payment, #pp-continue-to-payment-mobile, #pp-checkout-status-right').forEach($forwardButton => {\n\t\t\t\tconst toggle = $qs('#open-shipping-details');\n\t\t\t\tif ((toggle as HTMLInputElement).checked) {\n\t\t\t\t\tif (canMoveOn && PeachPayOrder.errorMessage() === '') {\n\t\t\t\t\t\t$forwardButton.removeAttribute('disabled');\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$forwardButton.setAttribute('disabled', '');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t});\n}\n\n/**\n * Renders elements that depend on the customer's shipping eligibility and configuration (virtual cart, hidden shipping fields for virtual products, separate shipping address).\n *\n * @param message The initial message with PHP data.\n */\nfunction renderShippingElements(message: InitMessage) {\n\t// #open-shipping-details (EDIT button on shipping page)\n\tconst $openShippingDetails = $qs('#open-shipping-details');\n\tif ($openShippingDetails) {\n\t\t($openShippingDetails as HTMLInputElement).checked = !Carts.virtual() && PeachPayCustomer.shipToDifferentAddress();\n\t\t($openShippingDetails as HTMLInputElement).disabled = Carts.virtual();\n\t}\n\n\t// #pp-shipping-options (shipping method radio fields)\n\tif (Carts.virtual()) {\n\t\t$qs('#pp-shipping-options')?.classList.add('hide');\n\t} else {\n\t\t$qs('#pp-shipping-options')?.classList.remove('hide');\n\t}\n\n\t// (form fields that affect shipping)\n\tif (Carts.virtual() && Feature.enabled(FeatureFlag.VIRTUAL_PRODUCT_FIELDS)) {\n\t\thideShippingDetails(true, message.phpData?.billing_fields ?? [], message.phpData?.billing_fields_order ?? []);\n\t} else {\n\t\thideShippingDetails(false, message.phpData?.billing_fields ?? [], message.phpData?.billing_fields_order ?? []);\n\t}\n\n\t// #shipping-details, $shipping-details fieldset (shipping form container and fieldset)\n\tif (PeachPayCustomer.shipToDifferentAddress()) {\n\t\t$qs('#shipping-details')?.classList.remove('hide');\n\t\t$qs('#shipping-details fieldset')?.removeAttribute('disabled');\n\t} else {\n\t\t$qs('#shipping-details')?.classList.add('hide');\n\t\t$qs('#shipping-details fieldset')?.setAttribute('disabled', '');\n\t}\n\n\t// #shipping-options-container-address (shipping address preview)\n\tif (PeachPayCustomer.shipToDifferentAddress()) {\n\t\t$qs('#shipping-options-container-address')?.classList.add('pp-opacity-0');\n\t} else {\n\t\t$qs('#shipping-options-container-address')?.classList.remove('pp-opacity-0');\n\t}\n\n\t// #pp-shipping-details-container\n\tif (Carts.virtual()) {\n\t\t$qs('#pp-shipping-details-container')?.classList.add('hide');\n\t} else {\n\t\t$qs('#pp-shipping-details-container')?.classList.remove('hide');\n\t}\n}\n\n/* Hides the address-related billing fields. This function is called if the merchant has\n   enabled the setting to hide the address fields for virtual products. */\nfunction hideShippingDetails(hide: boolean, fieldData: WCFieldsData[], fieldOrder: number[]) {\n\t// The section we need to hide.\n\tconst defaultFieldNames: string[] = [\n\t\t'billing_address_1',\n\t\t'billing_address_2',\n\t\t'billing_postcode',\n\t\t'billing_city',\n\t\t'billing_state',\n\t\t'billing_country',\n\t];\n\n\tconst customerDataRequiredFields: string[] = [];\n\tfieldOrder.forEach(order => {\n\t\tconst field = fieldData[order];\n\t\tif (field && (defaultFieldNames.includes(field.field_name) && field.field_required)) {\n\t\t\tcustomerDataRequiredFields.push(field.field_name);\n\t\t}\n\t});\n\n\tconst customerDataEnableFields: string[] = [];\n\tfieldOrder.forEach(order => {\n\t\tconst field = fieldData[order];\n\t\tif (field && (defaultFieldNames.includes(field.field_name) && field.field_enable)) {\n\t\t\tcustomerDataEnableFields.push(field.field_name);\n\t\t}\n\t});\n\n\tif (hide) {\n\t\tcustomerDataEnableFields.forEach(fieldName => {\n\t\t\t$qsAll<HTMLElement>(`.pp-info-form-new .${fieldName}-field`, $element => {\n\t\t\t\t$element.classList.add('hide');\n\t\t\t});\n\t\t});\n\t} else if (!hide) {\n\t\tcustomerDataEnableFields.forEach(fieldName => {\n\t\t\t$qsAll<HTMLElement>(`.pp-info-form-new .${fieldName}-field`, $element => {\n\t\t\t\t$element.classList.remove('hide');\n\t\t\t});\n\t\t});\n\t}\n\n\tconst info = PeachPayCustomer.billing;\n\tconst stateFieldInfo = GLOBAL.phpData?.wc_location_info?.country_locale_data?.[info.country()]?.['state'];\n\tconst postalFieldInfo = GLOBAL.phpData?.wc_location_info?.country_locale_data?.[info.country()]?.['state'];\n\tif (hide) {\n\t\tcustomerDataRequiredFields.forEach(fieldName => {\n\t\t\tif ((fieldName === 'billing_country' || fieldName === 'billing_state') && !isRequiredField(fieldName, fieldData)) {\n\t\t\t\t$qs<HTMLSelectElement>(`.pp-info-form-new .${fieldName}-field select`, $element => {\n\t\t\t\t\t$element.removeAttribute('required');\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t$qs<HTMLInputElement>(`.pp-info-form-new .${fieldName}-field input`, $element => {\n\t\t\t\t$element.removeAttribute('required');\n\t\t\t});\n\t\t});\n\t} else if (!hide) {\n\t\tcustomerDataRequiredFields.forEach(fieldName => {\n\t\t\tif (fieldName === 'billing_country') {\n\t\t\t\t$qs<HTMLSelectElement>(`.pp-info-form-new .${fieldName}-field select`, $element => {\n\t\t\t\t\t$element.setAttribute('required', '');\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (fieldName === 'billing_state') {\n\t\t\t\t$qs<HTMLSelectElement>(`.pp-info-form-new .${fieldName}-field select`, $element => {\n\t\t\t\t\t$element.required = isRequiredField(fieldName, fieldData, stateFieldInfo);\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (fieldName === 'billing_postcode') {\n\t\t\t\t$qs<HTMLInputElement>(`.pp-info-form-new .${fieldName}-field input`, $element => {\n\t\t\t\t\t$element.required = isRequiredField(fieldName, fieldData, postalFieldInfo);\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t$qs<HTMLInputElement>(`.pp-info-form-new .${fieldName}-field input`, $element => {\n\t\t\t\t$element.setAttribute('required', '');\n\t\t\t});\n\t\t});\n\t}\n}\n\n/* This is used to render the right form fields if the merchant opted in for Woocommerce\n   locale overrides. */\nexport function wcCountryLocaleRuleRender(page: string) {\n\tlet infoFormName: string;\n\tlet section: string;\n\tif (page === 'shipping') {\n\t\tinfoFormName = '#pp-different-shipping-details';\n\t\tsection = 'shipping';\n\t} else if (page === 'info') {\n\t\tinfoFormName = '#pp-info-form';\n\t\tsection = 'billing';\n\t} else {\n\t\treturn;\n\t}\n\n\tconst countryElement = $qs<HTMLInputElement>(`${infoFormName} [name=\"${section}_country\"]`);\n\tconst country = countryElement?.value;\n\tif (!country) {\n\t\treturn;\n\t}\n\n\tconst fieldData = section === 'billing' ? GLOBAL.phpData?.billing_fields ?? [] : GLOBAL.phpData?.shipping_fields ?? [];\n\tconst fieldStateFieldInfo = GLOBAL.phpData?.wc_location_info?.country_locale_data[country]?.['state'];\n\tconst fieldPostalCodeFieldInfo = GLOBAL.phpData?.wc_location_info?.country_locale_data[country]?.['postcode'];\n\tconst fieldCityFieldInfo = GLOBAL.phpData?.wc_location_info?.country_locale_data[country]?.['city'];\n\n\tif (fieldStateFieldInfo) {\n\t\twcStatefieldRule(fieldStateFieldInfo, section, infoFormName);\n\t} else {\n\t\tunhideFields('state', section, fieldData, infoFormName);\n\t}\n\n\tif (fieldPostalCodeFieldInfo) {\n\t\twcPostalCodeFieldRule(fieldPostalCodeFieldInfo, section, infoFormName);\n\t} else {\n\t\tunhideFields('postcode', section, fieldData, infoFormName);\n\t}\n\n\tif (fieldCityFieldInfo) {\n\t\twcCityFieldRule(fieldCityFieldInfo, section, infoFormName);\n\t} else {\n\t\tunhideFields('city', section, fieldData, infoFormName);\n\t}\n}\n\nfunction wcStatefieldRule(stateFieldInfo: WCFieldInfo, section: string, formIdentifier: string) {\n\tconst stateField = `${section}_state-field`;\n\tconst fieldData = section === 'billing' ? GLOBAL.phpData?.billing_fields ?? [] : GLOBAL.phpData?.shipping_fields ?? [];\n\tconst fieldIsRequired = isRequiredField(`${section}_state`, fieldData, stateFieldInfo);\n\tconst label = $qs<HTMLLabelElement>(`${formIdentifier} .${stateField} label:not(.hide)`);\n\tif (label?.textContent) {\n\t\tif (fieldIsRequired && /\\(.*\\)/.exec((label.textContent))) {\n\t\t\tlabel.textContent?.replace(/[ ]*\\(.*\\)[ ]*/, '');\n\t\t} else if (!fieldIsRequired && !/\\(.*\\)/.exec((label?.textContent))) {\n\t\t\tlabel.textContent += ' (optional) ';\n\t\t}\n\t}\n\n\t$qs<HTMLInputElement | HTMLSelectElement>(`${formIdentifier} [name=\"${section}_state\"]`, $element => {\n\t\t$element.required = fieldIsRequired;\n\t});\n}\n\nfunction wcPostalCodeFieldRule(postcodeFieldInfo: WCFieldInfo, section: string, formIdentifier: string) {\n\tconst postcodeField = `${section}_postcode-field`;\n\tconst fieldData = section === 'billing' ? GLOBAL.phpData?.billing_fields ?? [] : GLOBAL.phpData?.shipping_fields ?? [];\n\t// Hide the postal field.\n\tif (postcodeFieldInfo?.hidden !== undefined && postcodeFieldInfo.hidden) {\n\t\t$qs<HTMLElement>(`${formIdentifier} .${postcodeField}`, $element => {\n\t\t\t$element.setAttribute('style', 'display : none;');\n\t\t\tconst list = $element.closest('.pp-form-row')?.children;\n\t\t\tif (list !== undefined) {\n\t\t\t\tfor (const formElement of Array.from(list)) {\n\t\t\t\t\tif (formElement.classList.contains(postcodeField)) {\n\t\t\t\t\t\tformElement.classList.add('hide');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tformElement.setAttribute('style', 'flex-grow : 1;');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t} else {\n\t\t// Unhide the postal field.\n\t\t$qs<HTMLElement>(`${formIdentifier} .${postcodeField}`, $element => {\n\t\t\t$element.removeAttribute('style');\n\t\t\tconst list = $element.closest('.pp-form-row')?.children;\n\t\t\tif (list !== undefined) {\n\t\t\t\tfor (const formElement of Array.from(list)) {\n\t\t\t\t\tif (formElement.classList.contains(postcodeField)) {\n\t\t\t\t\t\tformElement.classList.remove('hide');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tformElement.removeAttribute('style');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\t$qs<HTMLInputElement>(`${formIdentifier} [name=\"${section}_postcode\"]`, $element => {\n\t\t$element.required = isRequiredField(`${section}_postcode`, fieldData, postcodeFieldInfo);\n\t});\n}\n\nfunction wcCityFieldRule(cityFieldInfo: WCFieldInfo, section: string, formIdentifier: string) {\n\tconst fieldData = section === 'billing' ? GLOBAL.phpData?.billing_fields ?? [] : GLOBAL.phpData?.shipping_fields ?? [];\n\t$qs<HTMLInputElement>(`${formIdentifier} [name=\"${section}_city\"]`, $element => {\n\t\t$element.required = isRequiredField(`${section}_city`, fieldData, cityFieldInfo);\n\t});\n}\n\nfunction unhideFields(fieldName: string, section: string, fieldData: WCFieldsData[], formIdentifier: string) {\n\tconst fieldAttributeName = section + '_' + fieldName;\n\t// Make sure the fields are not required or required.\n\t$qs<HTMLInputElement>(`${formIdentifier} [name=\"${fieldAttributeName}\"]`, $element => {\n\t\t$element.required = isRequiredField(`${fieldAttributeName}`, fieldData);\n\t});\n\n\tif (fieldName === 'city') {\n\t\treturn;\n\t}\n\n\tconst fieldOrder = section === 'billing' ? GLOBAL.phpData?.billing_fields_order ?? [] : GLOBAL.phpData?.shipping_fields_order ?? [];\n\n\tlet enabledField = false;\n\n\tfieldOrder.forEach(order => {\n\t\tif ((fieldData?.[order]?.field_name === fieldAttributeName && fieldData[order]?.field_enable)) {\n\t\t\tenabledField = true;\n\t\t}\n\t});\n\tif (enabledField) {\n\t\t$qs<HTMLElement>(`${formIdentifier} .${fieldAttributeName}-field`, $element => {\n\t\t\t$element.removeAttribute('style');\n\t\t\tconst list = $element.closest('.pp-form-row')?.children;\n\t\t\tif (list !== undefined) {\n\t\t\t\tfor (const formElement of Array.from(list)) {\n\t\t\t\t\tif (formElement.classList.contains(`${fieldAttributeName}-field`)) {\n\t\t\t\t\t\tformElement.classList.remove('hide');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tformElement.removeAttribute('style');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n}\n\nexport function collectCustomerFieldData(formIdentifier: string, requestedFields?: string[]) {\n\tconst $form = $qs<HTMLFormElement>(formIdentifier);\n\tif ($form) {\n\t\tconst formData = new FormData($form);\n\t\tconst formFields = {...PeachPayCustomer.data().form_fields};\n\n\t\tlet selector = '';\n\t\tif (requestedFields) {\n\t\t\trequestedFields.forEach((fieldName, index) => {\n\t\t\t\tselector += `${formIdentifier} [name=\"${fieldName}\"]`;\n\t\t\t\tif (index < requestedFields.length - 1) {\n\t\t\t\t\tselector += ', ';\n\t\t\t\t}\n\t\t\t});\n\t\t\tObject.keys(formFields).forEach(fieldName => {\n\t\t\t\tif (!requestedFields.includes(fieldName)) {\n\t\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-dynamic-delete\n\t\t\t\t\tdelete formFields[fieldName];\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tselector = `${formIdentifier} .pp-form-row :not(label):not(div):not(span):not([disabled]):not([name=\"off\"])`;\n\t\t}\n\n\t\t$qsAll(selector, (element: HTMLElement) => {\n\t\t\tswitch (element.tagName) {\n\t\t\t\tcase 'INPUT': {\n\t\t\t\t\tconst input = element as HTMLInputElement;\n\t\t\t\t\tif (input.type === 'radio' && input.checked) {\n\t\t\t\t\t\tconst fieldName = input.closest('.pp-radio-field')?.firstElementChild?.getAttribute('for') ?? '';\n\t\t\t\t\t\tformFields[fieldName] = formEntry(formData, input.name);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tformFields[input.name] = formEntry(formData, input.name);\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tcase 'SELECT': {\n\t\t\t\t\tconst select = element as HTMLSelectElement;\n\t\t\t\t\tformFields[select.name] = formEntry(formData, select.name);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\treturn formFields;\n\t}\n\n\treturn null;\n}\n\n/**\n * Saves the customer information from the form fields to the redux store.\n */\nexport function syncCustomerFieldChanges(formIdentifier: string) {\n\tconst formFields = collectCustomerFieldData(formIdentifier);\n\tif (formFields) {\n\t\tcleanFormFields(formFields);\n\t\tconst refreshCountryFeatures = formFields['billing_country'] !== PeachPayCustomer.billing.country();\n\t\tstore.dispatch(updateCustomerFields(formFields));\n\t\tif (refreshCountryFeatures) {\n\t\t\t// When billing country is changed and currency based on billing country, refresh currency switcher.\n\t\t\twindow.dispatchEvent(new CustomEvent('pp-update-currency-switcher-feature'));\n\t\t\twindow.dispatchEvent(new CustomEvent('pp-update-afterpay-branding'));\n\t\t}\n\t}\n}\n\nexport async function loadCustomer(): Promise<void> {\n\tconst customer = getCustomer();\n\n\tif (customer === null) {\n\t\tconst inprogressCustomer = getCustomer(true);\n\t\tif (inprogressCustomer !== null) {\n\t\t\tstore.dispatch(updateCustomer(inprogressCustomer));\n\t\t\treturn;\n\t\t}\n\n\t\tconst locationInfo = MerchantConfiguration.general.wcLocationInfoData();\n\t\tstore.dispatch(updateCustomerFields({\n\t\t\t...PeachPayCustomer.data().form_fields,\n\t\t\tshipping_country: locationInfo?.customer_default_country ?? locationInfo?.store_country ?? '',\n\t\t\tshipping_state: locationInfo?.customer_default_state_or_province ?? '',\n\t\t\tbilling_country: locationInfo?.customer_default_country ?? locationInfo?.store_country ?? '',\n\t\t\tbilling_state: locationInfo?.customer_default_state_or_province ?? '',\n\t\t}));\n\n\t\treturn;\n\t}\n\n\tcleanFormFields(customer.form_fields);\n\tstore.dispatch(updateCustomer(customer));\n}\n\n/**\n * Saves the current customer state to the local storage.\n */\nexport function updateCustomerDataInBrowser(): void {\n\tif (Environment.customer.saveToBrowserSelected()) {\n\t\tconst customer = PeachPayCustomer.data();\n\n\t\tsetCustomer(customer);\n\t} else {\n\t\tclearCustomer();\n\t}\n}\n\n/**\n * Shows the correct dropdown/text-box with translated placeholder text based on the country\n *\n * @returns { void }\n */\nexport function renderCorrectProvinceField(phpData: WCPHPData, modalPage?: ModalPage): void {\n\tconst merchantShipping = MerchantConfiguration.general.wcLocationInfoData();\n\tif (merchantShipping) {\n\t\tlet name: string;\n\t\tlet section: string;\n\t\tif (modalPage === undefined) {\n\t\t\tmodalPage = Environment.modalUI.page();\n\t\t}\n\n\t\tif (modalPage === 'info') {\n\t\t\tname = '#pp-info-form';\n\t\t\tsection = 'billing';\n\t\t} else if ((modalPage === 'shipping') && PeachPayCustomer.shipToDifferentAddress()) {\n\t\t\tname = '#pp-different-shipping-details';\n\t\t\tsection = 'shipping';\n\t\t} else {\n\t\t\treturn;\n\t\t}\n\n\t\tconst countryElement = $qs<HTMLInputElement>(`${name} [name=\"${section}_country\"]`);\n\t\tlet country = '';\n\n\t\tif (countryElement) {\n\t\t\tcountry = countryElement.value;\n\t\t} else {\n\t\t\tcountry = phpData.wc_location_info?.customer_default_country ?? '';\n\t\t}\n\n\t\tconst [defaultOption, label] = stateProvinceOrCounty(country);\n\t\tconst stateOrProvinceOptions = merchantShipping.allowed_states_or_provinces[country] ?? {};\n\n\t\tif (stateOrProvinceOptions && Object.keys(stateOrProvinceOptions).length > 0) {\n\t\t\t// Enable select list\n\t\t\t$qs<HTMLSelectElement>(`${name} .${section}_state-field select`, $stateOrProvincesSelect => {\n\t\t\t\t$stateOrProvincesSelect.innerHTML = renderDropDownList(stateOrProvinceOptions, defaultOption);\n\t\t\t\t$stateOrProvincesSelect.disabled = false;\n\t\t\t\t$stateOrProvincesSelect.setAttribute('name', `${section}_state`);\n\t\t\t\t$stateOrProvincesSelect.required = isRequiredField(`${section}_state`, section === 'billing' ? phpData.billing_fields ?? [] : phpData.shipping_fields ?? [] as WCFieldsData[]);\n\t\t\t\t$stateOrProvincesSelect.value = section === 'billing' ? PeachPayCustomer.billing.state() : PeachPayCustomer.shipping.state();\n\t\t\t\t$stateOrProvincesSelect.classList.remove('hide');\n\t\t\t\tconst chevron = $stateOrProvincesSelect.parentNode?.lastElementChild as HTMLElement;\n\t\t\t\tchevron?.classList.remove('hide');\n\t\t\t});\n\t\t\t$qs<HTMLLabelElement>(`${name} .${section}_state-field label.pp-select-label`, $element => {\n\t\t\t\t$element.textContent = label ?? defaultOption;\n\t\t\t\t$element.classList.remove('hide');\n\t\t\t});\n\t\t\t// Disable text box if present\n\t\t\t$qs<HTMLInputElement>(`${name} .${section}_state-field input`, $stateOrProvincesText => {\n\t\t\t\t$stateOrProvincesText.disabled = true;\n\t\t\t\t$stateOrProvincesText.setAttribute('name', 'off');\n\t\t\t\t$stateOrProvincesText.required = false;\n\t\t\t\t$stateOrProvincesText.value = '';\n\t\t\t\t$stateOrProvincesText.classList.add('hide');\n\t\t\t});\n\t\t\t$qs<HTMLLabelElement>(`${name} .${section}_state-field label:not(.pp-select-label)`)?.classList.add('hide');\n\t\t} else {\n\t\t\t// Disable select list\n\t\t\t$qs<HTMLSelectElement>(`${name} .${section}_state-field select`, $stateOrProvincesSelect => {\n\t\t\t\t$stateOrProvincesSelect.disabled = true;\n\t\t\t\t$stateOrProvincesSelect.setAttribute('name', 'off');\n\t\t\t\t$stateOrProvincesSelect.required = false;\n\t\t\t\t$stateOrProvincesSelect.classList.add('hide');\n\t\t\t\tconst chevron = $stateOrProvincesSelect.parentNode?.lastElementChild as HTMLElement;\n\t\t\t\tchevron?.classList.add('hide');\n\t\t\t});\n\t\t\t$qs<HTMLLabelElement>(`${name} .${section}_state-field label.pp-select-label`)?.classList.add('hide');\n\n\t\t\t// Enable text box option\n\t\t\t$qs<HTMLInputElement>(`${name} .${section}_state-field input`, $stateOrProvincesText => {\n\t\t\t\t$stateOrProvincesText.disabled = false;\n\t\t\t\t$stateOrProvincesText.setAttribute('name', `${section}_state`);\n\t\t\t\t$stateOrProvincesText.required = isRequiredField(`${section}_state`, section === 'billing' ? phpData.billing_fields ?? [] : phpData.shipping_fields ?? [] as WCFieldsData[]);\n\t\t\t\t$stateOrProvincesText.value = '';\n\t\t\t\t$stateOrProvincesText.classList.remove('hide');\n\t\t\t});\n\t\t\t$qs<HTMLLabelElement>(`${name} .${section}_state-field label:not(.pp-select-label)`, $element => {\n\t\t\t\t$element.textContent = label ?? defaultOption;\n\t\t\t\t$element.classList.remove('hide');\n\t\t\t});\n\t\t}\n\t}\n}\n\nfunction renderCountryAndStateList(merchantLocationInfo?: WCLocationInfo) {\n\tif (!merchantLocationInfo) {\n\t\tconsole.warn('Warning: No WC Location info. Please update the PeachPay Plugin.');\n\t\treturn;\n\t}\n\n\tconst infoForms = [{name: '#pp-info-form', section: 'billing'}];\n\tif (PeachPayCustomer.shipToDifferentAddress()) {\n\t\tinfoForms.push({name: '#pp-different-shipping-details', section: 'shipping'});\n\t}\n\n\tinfoForms.forEach(({name, section}) => {\n\t\tconst $countries = $qs<HTMLSelectElement>(`${name} [name=\"${section}_country\"]`);\n\t\t// Render dropdown list if it hasn't been initialized yet.\n\t\tif ($countries && ($countries.children.length <= 1)) {\n\t\t\tconst selectACountry = getLocaleText('Select a country');\n\t\t\tconst countryOptions = merchantLocationInfo.allowed_countries;\n\t\t\t$countries.innerHTML = renderDropDownList(countryOptions, selectACountry);\n\t\t\tconst country = section === 'billing' ? PeachPayCustomer.billing.country() : PeachPayCustomer.shipping.country();\n\t\t\tselectDropdown($countries, country || merchantLocationInfo.customer_default_country || merchantLocationInfo.store_country);\n\n\t\t\t// Auto select the only option valid if the store ships to only a single country.\n\t\t\tif ($countries.options.length === 2) {\n\t\t\t\t$countries.selectedIndex = 1; // Zero indexed\n\t\t\t}\n\n\t\t\t$countries.dispatchEvent(new Event('change'));\n\t\t}\n\t});\n}\n\n/**\n * Sets the customer fields to a given set of peachpay customer data.\n */\nexport function renderCustomerFields(customer: IPeachPayCustomer, page: null | 'info' | 'shipping' = null): void {\n\tlet infoFormName: string;\n\tswitch (page ?? Environment.modalUI.page()) {\n\t\tcase 'info': {\n\t\t\tinfoFormName = '#pp-info-form';\n\t\t\tbreak;\n\t\t}\n\n\t\tcase 'shipping': {\n\t\t\tinfoFormName = '#pp-different-shipping-details';\n\t\t\tbreak;\n\t\t}\n\n\t\tdefault: {\n\t\t\treturn;\n\t\t}\n\t}\n\n\tObject.keys(customer.form_fields).forEach((key: string) => {\n\t\tif (customer.form_fields[key] !== undefined) {\n\t\t\t$qsAll<HTMLElement>(`${infoFormName} .${key}-field [name=\"${key}\"]`, element => {\n\t\t\t\tswitch (element.tagName) {\n\t\t\t\t\tcase 'INPUT': {\n\t\t\t\t\t\tconst input = element as HTMLInputElement;\n\t\t\t\t\t\tif (input.type === 'radio') {\n\t\t\t\t\t\t\tinput.checked = input.value === customer.form_fields[key];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tinput.value = customer.form_fields[key] ?? '';\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tcase 'SELECT': {\n\t\t\t\t\t\tconst select = element as HTMLSelectElement;\n\t\t\t\t\t\tselect.value = customer.form_fields[key] ?? '';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n}\n\n/**\n * Renders the peachpay address details\n */\nfunction renderCustomerHeader(): void {\n\tlet section = '';\n\tif (PeachPayCustomer.shipToDifferentAddress()) {\n\t\tsection = 'shipping';\n\t} else {\n\t\tsection = 'billing';\n\t}\n\n\tconst shortAddress = getShortAddress();\n\tconst fullAddress = getFullAddress(section);\n\n\t$qsAll('.pp-address', $element => {\n\t\t$element.innerHTML = shortAddress;\n\t});\n\t$qsAll('.pp-address-hidden', $element => {\n\t\t$element.innerHTML = fullAddress;\n\t});\n}\n\nexport function getFullAddress(section: string): string {\n\tlet customerInfoType = PeachPayCustomer.shipping;\n\tif (section === 'billing') {\n\t\tcustomerInfoType = PeachPayCustomer.billing;\n\t}\n\n\t// If country is Japan, then we need to display full state name rather than postal abbreviations\n\tif (customerInfoType.country() === 'JP') {\n\t\tconst fullState = GLOBAL.phpData?.wc_location_info?.allowed_states_or_provinces?.['JP']?.[customerInfoType.state()];\n\n\t\treturn [\n\t\t\tcustomerInfoType.postal(),\n\t\t\t[\n\t\t\t\tfullState ?? customerInfoType.state(),\n\t\t\t\tcustomerInfoType.city(),\n\t\t\t].filter(element => (element !== '')).join(' '),\n\t\t\tcustomerInfoType.address1(),\n\t\t\tcustomerInfoType.address2(),\n\t\t].filter(element => (element !== '')).join(', ');\n\t}\n\n\treturn [\n\t\t[\n\t\t\tcustomerInfoType.address1(),\n\t\t\tcustomerInfoType.address2(),\n\t\t].filter(element => (element !== '')).join(' '),\n\t\tcustomerInfoType.city(),\n\t\t[\n\t\t\tcustomerInfoType.state(),\n\t\t\tcustomerInfoType.postal(),\n\t\t].filter(element => (element !== '')).join(' '),\n\t\tcustomerInfoType.country(),\n\t].filter(element => (element !== '')).join(', ');\n}\n\nexport function getFullName(section: string): string {\n\tconst customerInfoType = section === 'billing' ? PeachPayCustomer.billing : PeachPayCustomer.shipping;\n\n\tlet fullName = '';\n\tif (customerInfoType.firstName()) {\n\t\tfullName += customerInfoType.firstName();\n\t}\n\n\tif (customerInfoType.firstName() && customerInfoType.lastName()) {\n\t\tfullName += ' ';\n\t}\n\n\tif (customerInfoType.lastName()) {\n\t\tfullName += customerInfoType.lastName();\n\t}\n\n\treturn fullName;\n}\n\nexport function getShortAddress(): string {\n\tif (PeachPayCustomer.shipping.country() === 'JP') {\n\t\t// Since Japan has a different address do Postal then address instead.\n\t\treturn [\n\t\t\tPeachPayCustomer.shipping.postal(),\n\t\t\tPeachPayCustomer.shipping.address1(),\n\t\t\tPeachPayCustomer.shipping.address2(),\n\t\t].filter(element => (element !== '')).join(', ');\n\t}\n\n\treturn [\n\t\t[\n\t\t\tPeachPayCustomer.shipping.address1(),\n\t\t\tPeachPayCustomer.shipping.address2(),\n\t\t].filter(element => (element !== '')).join(' '),\n\t\tPeachPayCustomer.shipping.postal(),\n\t].filter(element => (element !== '')).join(', ');\n}\n\nexport function getCustomerEmail(): string {\n\treturn PeachPayCustomer.billing.email();\n}\n","import {GLOBAL} from '../deprecated/global';\nimport {store} from '../store';\nimport {$qs} from '../../../@shared/ts/dom';\nimport {renderOrderNotice} from '../payment/order';\n\nexport function initDeliveryDate() {\n\t$qs('#delivery-date')?.addEventListener('change', checkDeliveryDateIsValid);\n\n\t/**\n\t * Keep order delivery up to date.\n\t */\n\tstore.subscribe(() => {\n\t\trenderDeliveryDate(); // Farmtofork\n\t});\n}\n\nexport function collectDeliveryDate(): string {\n\treturn $qs<HTMLInputElement>('#delivery-date')?.value ?? '';\n}\n\n/**\n * Display delivery Date input for farm2fork website\n */\nfunction renderDeliveryDate(): void {\n\tif (!GLOBAL.phpData) {\n\t\treturn;\n\t}\n\n\tif (!GLOBAL.phpData.plugin_woocommerce_order_delivery_active) {\n\t\treturn;\n\t}\n\n\t$qs('#checkout-delivery-date')?.classList.remove('hide');\n\tconst todayDate = new Date();\n\tconst maxDate = new Date();\n\tmaxDate.setDate(todayDate.getDate() + (GLOBAL.phpData.plugin_woocommerce_order_delivery_options?.wc_od_max_delivery_days ?? 0));\n\n\tconst $shippingDate = $qs<HTMLInputElement>('#delivery-date');\n\n\tif (!$shippingDate) {\n\t\treturn;\n\t}\n\n\t$shippingDate.required = true;\n\t$shippingDate.min = todayDate.toISOString().slice(0, 10);\n\t$shippingDate.max = maxDate.toISOString().slice(0, 10);\n}\n\nfunction checkDeliveryDateIsValid(event: Event): void {\n\tif (!event.target) {\n\t\treturn;\n\t}\n\n\tif (!validateDateIsAvailable((event.target as HTMLInputElement).value)) {\n\t\t(event.target as HTMLInputElement).value = '';\n\t\trenderOrderNotice('Please select another delivery date.');\n\t}\n}\n\nfunction validateDateIsAvailable(dateString: string): boolean {\n\tif (!GLOBAL.phpData) {\n\t\treturn false;\n\t}\n\n\tconst day = (new Date(dateString + 'T00:00:00')).getDay();\n\treturn !(GLOBAL.phpData.plugin_woocommerce_order_delivery_options?.delivery_unchecked_day?.includes(String(day)));\n}\n","import {checkRequiredFields} from './additionalFields';\nimport {type WCCartItem} from '../../../@type/woocommerce/cart-item';\nimport {store} from '../store';\nimport {Carts, DefaultCart, updateCartPackageShippingMethod} from '../reducers/cartReducer';\nimport {Environment, Feature, updateEnvironment} from '../reducers/environmentReducer';\nimport {MerchantConfiguration, updateMerchantGeneralConfig, updateMerchantShippingConfig} from '../reducers/merchantConfigurationReducer';\nimport {startModalLoading, stopModalLoading} from '../reducers/environmentReducer';\nimport {PeachPayOrder, setOrderError, updateCustomerAddressValidation} from '../reducers/peachPayOrderReducer';\nimport {type ICartCalculationRecord, type ICartMetaData, type IShippingMethod, type IShippingPackage} from '../../../@type/woocommerce/cart-calculation';\nimport {formatCurrencyString} from '../util/currency';\nimport {cartIsVirtual} from '../util/cart';\nimport {requestCartCalculation} from '../payment/order';\nimport {buildSubscriptionPriceMetaData} from '../util/subscription';\nimport {syncCustomerFieldChanges} from './customer';\nimport {getLocaleText} from '../util/translation';\nimport {collectCustomerFieldData, getFullAddress, getFullName} from './customer';\nimport {$qs, $qsAll} from '../../../@shared/ts/dom';\nimport {type InitMessage} from '../../../@type/window-messages';\nimport {FeatureFlag} from '../../../@type/features';\nimport {captureSentryException} from '../../../@shared/ts/sentry';\nimport {maybeFetch} from '../../../@shared/ts/maybe';\n\nexport function initShipping(message: InitMessage) {\n\tinitShippingEvents();\n\tstore.dispatch(updateMerchantGeneralConfig({\n\t\t...store.getState().merchantConfiguration.general,\n\t\twcLocationInfoData: message.phpData.wc_location_info,\n\t}));\n\n\tstore.dispatch(updateMerchantShippingConfig({\n\t\tshippingZones: Number.parseInt(message.phpData.num_shipping_zones),\n\t}));\n}\n\nfunction initShippingEvents() {\n\tstore.subscribe(renderShipping);\n\n\t$qs('#pp-shipping-options')?.addEventListener('change', handleShippingSelectionEvent);\n\n\t$qs('#pp-refresh-shipping-options')?.addEventListener('click', async () => {\n\t\tstore.dispatch(startModalLoading());\n\t\tlet isValidAddress = true;\n\t\tif (!Carts.virtual() || !Feature.enabled(FeatureFlag.VIRTUAL_PRODUCT_FIELDS)) {\n\t\t\tisValidAddress = await validateAddress();\n\t\t}\n\n\t\tawait requestCartCalculation();\n\t\tstore.dispatch(updateCustomerAddressValidation(isValidAddress));\n\t\tstore.dispatch(stopModalLoading());\n\t\tif (isValidAddress) {\n\t\t\t$qs('#pp-refresh-shipping-options', $element => {\n\t\t\t\t$element.style.display = 'none';\n\t\t\t});\n\t\t\t$qs<HTMLInputElement>(\n\t\t\t\t'#pp-continue-to-payment',\n\t\t\t\t$element => {\n\t\t\t\t\t$element.disabled = false;\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\t});\n\n\t$qs('#pp-info-form')?.addEventListener('submit', async (event: Event) => {\n\t\tevent.preventDefault();\n\t\tstore.dispatch(startModalLoading());\n\t\tstore.dispatch(setOrderError(''));\n\t\tsetTimeout(() => {\n\t\t\tsyncCustomerFieldChanges('#pp-info-form');\n\t\t});\n\t\tlet isValidAddress = true;\n\t\tif (!Carts.virtual() || !Feature.enabled(FeatureFlag.VIRTUAL_PRODUCT_FIELDS)) {\n\t\t\tisValidAddress = await validateAddress();\n\t\t}\n\n\t\tawait requestCartCalculation();\n\t\tstore.dispatch(updateCustomerAddressValidation(isValidAddress));\n\t\tif (isValidAddress && !PeachPayOrder.errorMessage() && checkRequiredFields()) {\n\t\t\tstore.dispatch(updateEnvironment({\n\t\t\t\tmodalPageType: Environment.modalUI.requestedPage(),\n\t\t\t\trequestedPage: undefined,\n\t\t\t}));\n\t\t} else {\n\t\t\tstore.dispatch(updateEnvironment({\n\t\t\t\trequestedPage: undefined,\n\t\t\t}));\n\t\t}\n\n\t\tstore.dispatch(stopModalLoading());\n\t});\n}\n\n/**\n * Window fetch for validating the billing address.\n */\nexport async function validateAddress(): Promise<boolean> {\n\tconst validateURL = Feature.metadata<string>(FeatureFlag.EXPRESS_CHECKOUT, 'validate_url');\n\tif (!validateURL) {\n\t\tthrow new Error('Validate URL is not set');\n\t}\n\n\tconst wcBillingFields = [\n\t\t'billing_first_name',\n\t\t'billing_last_name',\n\t\t'billing_company',\n\t\t'billing_email',\n\t\t'billing_phone',\n\t\t'billing_country',\n\t\t'billing_address_1',\n\t\t'billing_address_2',\n\t\t'billing_city',\n\t\t'billing_state',\n\t\t'billing_postcode',\n\t];\n\n\tconst formData = new FormData();\n\tObject.entries(collectCustomerFieldData('#pp-info-form', wcBillingFields) ?? {}).forEach(([key, value]) => {\n\t\tformData.append(key, value);\n\t});\n\tformData.append('ship_to_different_address', 'false');\n\n\tconst {error, result} = await maybeFetch<{success: boolean; error_messages: string[]}>(validateURL, {\n\t\tmethod: 'POST',\n\t\tbody: formData,\n\t});\n\n\tif (error || !result) {\n\t\tcaptureSentryException(error instanceof Error ? error : new Error('Unknown error while validating billing address'));\n\t\treturn false;\n\t}\n\n\tif (!result.success) {\n\t\t// eslint-disable-next-line no-alert\n\t\talert(result.error_messages.join('\\n').replace(/(<([^>]+)>)/gi, ''));\n\t\treturn false;\n\t}\n\n\treturn true;\n}\n\nasync function handleShippingSelectionEvent(event: Event) {\n\tconst $target = event.target as HTMLInputElement;\n\tconst $targetContainer = $target.closest<HTMLElement>('[data-cart-key]');\n\n\tconst shippingMethodId = $target.value ?? '';\n\tconst cartKey = $targetContainer?.dataset?.['cartKey'] ?? '';\n\tconst packageKey = $targetContainer?.dataset?.['packageKey'] ?? '';\n\n\tstore.dispatch(updateCartPackageShippingMethod({\n\t\tcartKey,\n\t\tshippingPackageKey: packageKey,\n\t\tpackageMethodId: shippingMethodId,\n\t}));\n\n\t// Update the tax and other values that may change with different shipping cost.\n\tstore.dispatch(startModalLoading());\n\n\tawait requestCartCalculation();\n\n\tstore.dispatch(stopModalLoading());\n}\n\n/**\n * Called whenever shipping rendering needs to be updated.\n */\nfunction renderShipping() {\n\trenderOrderHeader(DefaultCart.contents());\n\n\t// Render shipping options\n\tif (cartIsVirtual(DefaultCart.contents())) {\n\t\t$qs('#pp-checkout-status-middle-text+span')?.classList.add('hide');\n\t\t$qs('#pp-checkout-status-middle-text+span+span')?.classList.remove('hide');\n\t} else {\n\t\t$qs('#pp-checkout-status-middle-text+span')?.classList.remove('hide');\n\t\t$qs('#pp-checkout-status-middle-text+span+span')?.classList.add('hide');\n\t\trenderCartShippingOptions(store.getState().calculatedCarts);\n\t}\n}\n\n/**\n * Sets up the modal based on if the cart is completely virtual or not\n */\nfunction renderOrderHeader(cart: WCCartItem[]) {\n\tif (cartIsVirtual(cart)) {\n\t\t$qs('.shipping-address-header')?.classList.add('hide');\n\t\t$qs('.billing-address-header')?.classList.remove('hide');\n\n\t\tfor (const $element of $qsAll('.hide-for-virtual-carts')) {\n\t\t\t$element.classList.add('hide');\n\t\t}\n\n\t\tfor (const $element of $qsAll('.show-for-virtual-carts')) {\n\t\t\tif (getFullName('shipping') === '' && getFullAddress('shipping').replace(/\\s/g, '') === '') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t$element.classList.remove('hide');\n\t\t}\n\t} else {\n\t\t$qs('.shipping-address-header')?.classList.remove('hide');\n\t\t$qs('.billing-address-header')?.classList.add('hide');\n\n\t\tfor (const $element of $qsAll('.hide-for-virtual-carts')) {\n\t\t\t$element.classList.remove('hide');\n\t\t}\n\n\t\tfor (const $element of $qsAll('.show-for-virtual-carts')) {\n\t\t\t$element.classList.add('hide');\n\t\t}\n\t}\n}\n\n/**\n * Renders all possible shipping options based on all calculated carts\n */\nfunction renderCartShippingOptions(calculatedCarts: ICartCalculationRecord) {\n\tlet shippingOptionsHTML = '';\n\tfor (const [cartKey, cartCalculation] of Object.entries(calculatedCarts)) {\n\t\tif (!cartCalculation) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tfor (const [shippingPackageKey, shippingPackage] of Object.entries(cartCalculation.package_record)) {\n\t\t\tif (!shippingPackage) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tshippingOptionsHTML += renderShippingPackageOptions(cartKey, shippingPackageKey, shippingPackage, cartCalculation.cart_meta, Object.entries(calculatedCarts).length > 1);\n\t\t}\n\t}\n\n\t// New customer\n\t$qs('#pp-shipping-options', $element => {\n\t\t$element.innerHTML = shippingOptionsHTML;\n\t});\n}\n\n/**\n * Builds the HTML needed for a single package shipping options.\n */\n// eslint-disable-next-line max-params\nfunction renderShippingPackageOptions(cartKey: string, shippingPackageKey: string, shippingPackage: IShippingPackage, cartMeta: ICartMetaData, shouldShowPackageName: boolean): string {\n\tconst methodOptionBuilder = (methodKey: string, method: IShippingMethod, selected: boolean) => `\n<div class=\"pp-disabled-loading pp-radio-line pp-shipping-option-row${selected ? ' fill' : ''}\" for=\"shipping_method_${shippingPackageKey}_${methodKey.replace(/:/g, '')}\">\n\t<div class=\"pp-shipping-option-bg\"></div>\n\t<input class=\"pp-disabled-loading\" id=\"shipping_method_${shippingPackageKey}_${methodKey.replace(/:/g, '')}\" name=\"shipping_method[${shippingPackageKey}]\" value=\"${methodKey}\" type=\"radio\" ${\n\tselected ? 'checked' : ''\n} required>\n\t${\n\tmethod.description\n\t\t? `<div class=\"flex col w-100\">\n\t\t\t\t<label for=\"shipping_method_${shippingPackageKey}_${methodKey.replace(/:/g, '')}\">\n\t\t\t\t\t<span>${method.title}</span>\n\t\t\t\t\t<span class=\"shipping-price pp-currency-blur\">\n\t\t\t\t\t\t${formatCurrencyString(method.total)}\n\t\t\t\t\t\t<span class=\"muted\">${buildSubscriptionPriceMetaData(cartMeta)}</span>\n\t\t\t\t\t</span>\n\t\t\t\t</label>\n\t\t\t<div>${method.description}</div>\n\t\t</div>`\n\t\t: `<label style=\"width: 100%;\" for=\"shipping_method_${shippingPackageKey}_${methodKey.replace(/:/g, '')}\">\n\t\t\t\t<span>${method.title}</span> <span class=\"shipping-price pp-currency-blur\">${formatCurrencyString(method.total)}\n\t\t\t\t<span class=\"muted\">${buildSubscriptionPriceMetaData(cartMeta)}</span></span>\n\t\t\t\t</label>`\n}\n</div>`;\n\n\t/**\n\t * Since the package name string is being displayed in the modal but coming from Woocommerce, we need to hardcode these strings' values\n\t * so they can be captured by the gettext parser and be given translations.\n\t */\n\tconst packageNameTranslations: Record<string, string> = {\n\t\tShipping: getLocaleText('Shipping'),\n\t\t'Initial Shipment': getLocaleText('Initial Shipment'),\n\t\t'Recurring Shipment': getLocaleText('Recurring Shipment'),\n\t};\n\tconst packageName = packageNameTranslations[shippingPackage.package_name] ?? shippingPackage.package_name;\n\tconst packageNameHTML = `<div class=\"pp-title\">${packageName}</div>`;\n\n\tconst packageMethodOptionsHTML: string = Object.entries(shippingPackage.methods).map(([shippingMethodKey, shippingMethod]) =>\n\t\tshippingMethod ? methodOptionBuilder(shippingMethodKey, shippingMethod, shippingPackage.selected_method === shippingMethodKey) : '',\n\t).join('');\n\n\treturn `${shouldShowPackageName ? packageNameHTML : ''}\n\t<div class=\"pp-shipping-options-container\" data-cart-key=\"${cartKey}\" data-package-key=\"${shippingPackageKey}\">\n\t${packageMethodOptionsHTML}\n\t</div>`;\n}\n\n/**\n * Determines if the shipping which may be validated is in a zone that is able to be shipped to.\n */\nexport function shippingIsValid(): boolean {\n\t// If cart is virtual then it does not require shipping.\n\tif (cartIsVirtual(DefaultCart.contents())) {\n\t\treturn true;\n\t}\n\n\t// If no shipping zones then it means shipping can be anywhere\n\tif (MerchantConfiguration.shipping.shippingZones() === 0) {\n\t\treturn true;\n\t}\n\n\t// If no options are available then the address will not work.\n\tif (!Carts.anyShippingMethodsAvailable()) {\n\t\treturn false;\n\t}\n\n\treturn true;\n}\n","// Simple enum that determines the sorting method for payment methods in Express checkout.\n// The higher the number (or eligibility), the further towards the beginning of the method display\n//  that method will be shown. Currently this is only used based on eligibility (as per the naming).\nenum GatewayEligibility {\n\tNotEligible = 0,\n\tEligible = 1,\n\tEligibleWithChange = 2,\n\tEligibleButErrored = 3,\n}\n\ninterface IPaymentConfiguration {\n\tselectedGateway: string;\n\tavailableGateways: string[];\n\tgatewayAvailabilityDetails: Record<string, GatewayEligibilityDetails>;\n\n\tgatewayConfigurations: Record<string, GatewayConfiguration>;\n}\n\ninterface GatewayConfiguration {\n\t/**\n\t * Name to display for Payment Method\n\t * @example \"Klarna\"\n\t */\n\tname: string;\n\t/**\n\t * Optional short description on how the payment method works.\n\t * @example \"After selecting pay you will be redirected to complete your payment.\"\n\t */\n\tdescription: string;\n\n\t/**\n\t * The WC gateway to use. All peachpay custom gateways are prefixed with 'peachpay_'.\n\t */\n\tgatewayId: string;\n\t/**\n\t * Branding assets to display with the option.\n\t */\n\tassets: {\n\t\ttitle?: ImageOptions;\n\t\tbadge: ImageOptions;\n\t};\n\n\t/**\n     * A boolean to dynamically indicate if they payment method is supported by the browser. If undefined the method is considered supported by default.\n     */\n\tbrowser?: boolean;\n\n\t/**\n\t * A boolean to dynamically indicate if the payment method successfully initialized.\n     *\n     * If `undefined`(default) or `true` the method is considered initialized.\n     * If `false` then the payment method is considered errored.\n\t */\n\tinitialized?: boolean;\n\n\t/**\n\t * Does this gateway use a custom place order button?\n\t */\n\thasCustomButton?: boolean;\n}\n\ntype ImageOptions = {\n\tsrc: string;\n\tscale?: number;\n\ttranslateX?: number;\n};\n\ntype EligibilityDetail = {\n\texplanation: string;\n};\n\n/**\n * Details why a gateway is not eligible. Properties are only defined if something is wrong.\n */\ntype GatewayEligibilityDetails = {\n\t/**\n     * Defined by the backend.\n     */\n\n\tenabled?: EligibilityDetail;\n\tsetup?: EligibilityDetail;\n\tuser?: EligibilityDetail;\n\tlocation?: EligibilityDetail;\n\tminimum?: EligibilityDetail & {minimum: number};\n\tmaximum?: EligibilityDetail & {maximum: number};\n\tcountry?: EligibilityDetail & {available_options?: string[]};\n\tcurrency?: EligibilityDetail & {available_options?: string[]; fallback_option?: string};\n\n\t/**\n     * Defined by the frontend.\n     */\n\n\tbrowser?: EligibilityDetail;\n\tinitialized?: EligibilityDetail;\n};\n\nexport {\n\ttype IPaymentConfiguration,\n\ttype EligibilityDetail,\n\ttype GatewayEligibilityDetails,\n\ttype GatewayConfiguration,\n\n\tGatewayEligibility,\n};\n","\nimport {collectDeliveryDate} from '../features/orderDelivery';\nimport {Environment, Feature} from '../reducers/environmentReducer';\nimport {Carts, DefaultCart, updateCartCalculation} from '../reducers/cartReducer';\nimport {PeachPayCustomer, updateCustomerFields} from '../reducers/peachPayCustomerReducer';\nimport {PeachPayOrder, setOrderError} from '../reducers/peachPayOrderReducer';\nimport {store} from '../store';\nimport {getBaseURL} from '../util/environment';\nimport {MerchantConfiguration} from '../reducers/merchantConfigurationReducer';\nimport {type ICartCalculationResponse} from '../../../@type/woocommerce/cart-calculation';\nimport {getLocaleText} from '../util/translation';\nimport {shippingIsValid} from '../features/shipping';\nimport {PaymentConfiguration, setSelectedPaymentGateway, updateAvailableGateways, updateGatewayDetails} from '../reducers/paymentConfigurationReducer';\nimport {type IResponse} from '../../../@type/response';\nimport {stripHtml, $qsAll, $qs} from '../../../@shared/ts/dom';\nimport {type WCOrder} from '../../../@type/woocommerce/order';\nimport {captureSentryException} from '../../../@shared/ts/sentry';\nimport {getCaptchaToken} from '../features/botProtection';\nimport {type Maybe, maybeFetch} from '../../../@shared/ts/maybe';\nimport {getErrorString} from '../../../@shared/ts/error';\nimport {FeatureFlag} from '../../../@type/features';\n\nexport interface OrderService {\n\tplaceOrder: (transaction: Transaction, extraFormData?: Record<string, string>) => Promise<Maybe<WCOrder>>;\n\tstartTransaction: (paymentGateway: string) => Promise<Maybe<Transaction>>;\n}\n\nexport interface Transaction {\n\tgetId: () => string;\n\tupdate: (options: TransactionUpdate) => void;\n\tcomplete: (options?: TransactionUpdate) => Promise<boolean>;\n}\n\nexport function getOrderService(): OrderService {\n\treturn {\n\t\tplaceOrder,\n\t\tasync startTransaction(gatewayId: string): Promise<Maybe<Transaction>> {\n\t\t\tconst transactionId = await createPaymentTransaction(gatewayId);\n\t\t\tlet complete = false;\n\t\t\tif (!transactionId) {\n\t\t\t\treturn {error: new Error('Failed to create a transaction. Please refresh the page and try again.')};\n\t\t\t}\n\n\t\t\tconst transactionUpdates: TransactionUpdate[] = [];\n\n\t\t\treturn {\n\t\t\t\tresult: {\n\t\t\t\t\tgetId() {\n\t\t\t\t\t\treturn transactionId;\n\t\t\t\t\t},\n\t\t\t\t\tupdate(options: TransactionUpdate) {\n\t\t\t\t\t\ttransactionUpdates.push(options);\n\t\t\t\t\t},\n\t\t\t\t\tasync complete(options?: TransactionUpdate) {\n\t\t\t\t\t\tif (complete) {\n\t\t\t\t\t\t\tconsole.error('Developer error: Transaction already completed.');\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcomplete = true;\n\n\t\t\t\t\t\tif (options) {\n\t\t\t\t\t\t\ttransactionUpdates.push(options);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (transactionUpdates.length === 0) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst update = transactionUpdates.reduce((pt, ct) => ({...pt, ...ct}), {});\n\t\t\t\t\t\treturn updatePaymentTransaction(transactionId, update);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t};\n}\n\nexport interface TransactionUpdate {\n\tpaymentStatus?: string;\n\torderStatus?: string;\n\t/**\n     * @deprecated in favor of reporting from PHP side\n     */\n\torder?: WCOrder | null;\n\tpaypal?: {'transaction_id'?: string};\n\tstripe?: {'charge_id'?: string; 'customer_id'?: string};\n\tamazonpay?: {'session_id'?: string};\n\tsquare?: {'payment_id'?: string};\n\tpurchaseOrder?: {'purchase_order_number'?: string};\n\tnote?: string;\n}\n\nasync function placeOrder(transaction: Transaction, extraFormData: Record<string, string> = {}): Promise<Maybe<WCOrder>> {\n\tconst checkoutURL = Feature.metadata<string>(FeatureFlag.EXPRESS_CHECKOUT, 'checkout_url');\n\tconst checkoutNonce = Feature.dynamicMetadata<string>(FeatureFlag.EXPRESS_CHECKOUT, 'checkout_nonce');\n\n\tif (!checkoutURL || !checkoutNonce) {\n\t\treturn {error: new Error('Invalid checkout URL or nonce')};\n\t}\n\n\tconst formData = new FormData();\n\tformData.append('woocommerce-process-checkout-nonce', checkoutNonce);\n\n\tconst gatewayId = PaymentConfiguration.selectedGateway();\n\tif (gatewayId !== 'peachpay_free') {\n\t\tformData.append('payment_method', gatewayId);\n\t}\n\n\tformData.append('peachpay_session_id', PeachPayOrder.sessionId());\n\tformData.append('peachpay_transaction_id', transaction.getId());\n\tformData.append('peachpay_captcha_token', await getCaptchaToken());\n\n\tformData.append('terms', '1');\n\tformData.append('european_gdpr', '1');\n\n\tformData.append('ct-ultimate-gdpr-consent-field', 'on');\n\tformData.append('ct-ultimate-gdpr-consent-field-additional', '1');\n\tformData.append('ct-ultimate-gdpr-consent-field-additional', '1');\n\tformData.append('ct-ultimate-gdpr-consent-field-label-text', '1');\n\tformData.append('delivery_date', collectDeliveryDate());\n\n\tfor (const [key, value] of Object.entries(PeachPayOrder.orderFormRecord())) {\n\t\tformData.append(key, value);\n\t}\n\n\tfor (const [key, value] of Object.entries(extraFormData)) {\n\t\tformData.append(key, value);\n\t}\n\n\tconst {error: orderError, result: orderResult} = await maybeFetch<WCOrder>(checkoutURL + '&pp-express-checkout', {\n\t\tmethod: 'POST',\n\t\tcredentials: 'same-origin',\n\t\tbody: formData,\n\t});\n\n\tif (orderError || !orderResult || orderResult.result !== 'success') {\n\t\tif (orderError) {\n\t\t\tif (orderError instanceof Error) {\n\t\t\t\tcaptureSentryException(orderError);\n\t\t\t} else {\n\t\t\t\tcaptureSentryException(new Error(getErrorString(orderError)));\n\t\t\t}\n\n\t\t\tconst errorMessage = getErrorString(orderError);\n\t\t\tdisplayPaymentErrorMessage(errorMessage);\n\n\t\t\tawait transaction.complete({\n\t\t\t\tnote: errorMessage,\n\t\t\t});\n\n\t\t\treturn {error: orderError, result: orderResult};\n\t\t}\n\n\t\tif (orderResult?.result === 'failure') {\n\t\t\tconst errorMessage = stripHtml(orderResult.messages, null).trim() || getLocaleText('Unknown error occured while placing order. Please refresh the page and try again.');\n\t\t\tdisplayPaymentErrorMessage(errorMessage);\n\n\t\t\tawait transaction.complete({\n\t\t\t\tnote: errorMessage,\n\t\t\t});\n\n\t\t\t// In the scenario the order fails but a customer was registered all the existing nonces are\n\t\t\t// now invalid. We need to refresh the checkout to get new ones.\n\t\t\tif (orderResult.refresh || orderResult.reload) {\n\t\t\t\tawait requestCartCalculation();\n\t\t\t}\n\n\t\t\treturn {error: orderError, result: orderResult};\n\t\t}\n\n\t\tconst errorMessage = getLocaleText('Unknown error occured while placing order. Please refresh the page and try again.');\n\t\tdisplayPaymentErrorMessage(errorMessage);\n\n\t\tawait transaction.complete({\n\t\t\tnote: errorMessage,\n\t\t});\n\n\t\t// Any failure after an order risks invalid nonces in the case of a user being logged in. To prevent\n\t\t// possible problems we will get a new cart calculation.\n\t\tawait requestCartCalculation();\n\t}\n\n\treturn {error: orderError, result: orderResult};\n}\n\n/**\n * Calls a endpoint in the PeachPay Plugin to recalculate all the summary cost\n */\nexport async function requestCartCalculation(sync = false): Promise<void> {\n\tconst cartUrl = Feature.metadata<string>(FeatureFlag.EXPRESS_CHECKOUT, 'calculation_url');\n\tif (!cartUrl) {\n\t\tthrow new Error('Invalid cart calculation URL');\n\t}\n\n\tconst formData = new FormData();\n\tif (!sync) {\n\t\tformData.append('billing_email', PeachPayCustomer.billing.email());\n\t\tformData.append('billing_first_name', PeachPayCustomer.billing.firstName());\n\t\tformData.append('billing_last_name', PeachPayCustomer.billing.lastName());\n\t\tformData.append('billing_phone', PeachPayCustomer.billing.phone());\n\t\tformData.append('billing_company', PeachPayCustomer.billing.company());\n\t\tformData.append('billing_address_1', PeachPayCustomer.billing.address1());\n\t\tformData.append('billing_address_2', PeachPayCustomer.billing.address2());\n\t\tformData.append('billing_city', PeachPayCustomer.billing.city());\n\t\tformData.append('billing_state', PeachPayCustomer.billing.state());\n\t\tformData.append('billing_country', PeachPayCustomer.billing.country());\n\t\tformData.append('billing_postcode', PeachPayCustomer.billing.postal());\n\n\t\tif (PeachPayCustomer.shipToDifferentAddress()) {\n\t\t\tformData.append('ship_to_different_address', '1');\n\t\t\tformData.append('shipping_first_name', PeachPayCustomer.shipping.firstName());\n\t\t\tformData.append('shipping_last_name', PeachPayCustomer.shipping.lastName());\n\t\t\tformData.append('shipping_phone', PeachPayCustomer.shipping.phone());\n\t\t\tformData.append('shipping_company', PeachPayCustomer.shipping.company());\n\t\t\tformData.append('shipping_address_1', PeachPayCustomer.shipping.address1());\n\t\t\tformData.append('shipping_address_2', PeachPayCustomer.shipping.address2());\n\t\t\tformData.append('shipping_city', PeachPayCustomer.shipping.city());\n\t\t\tformData.append('shipping_state', PeachPayCustomer.shipping.state());\n\t\t\tformData.append('shipping_country', PeachPayCustomer.shipping.country());\n\t\t\tformData.append('shipping_postcode', PeachPayCustomer.shipping.postal());\n\t\t}\n\n\t\tfor (const [packageKey, methodKey] of Object.entries(PeachPayOrder.collectSelectedShipping())) {\n\t\t\tformData.append(`shipping_method[${packageKey}]`, methodKey);\n\t\t}\n\n\t\tconst gatewayId = PaymentConfiguration.selectedGateway();\n\t\tif (gatewayId !== 'peachpay_free') {\n\t\t\tformData.append('payment_method', gatewayId);\n\t\t}\n\t}\n\n\tconst {error: calculationError, result: calculationResult} = await maybeFetch<ICartCalculationResponse>(cartUrl, {\n\t\tmethod: 'POST',\n\t\tcredentials: 'same-origin',\n\t\tbody: formData,\n\t});\n\n\tif (calculationError || !calculationResult || !calculationResult.success) {\n\t\tif (calculationError) {\n\t\t\tif (calculationError instanceof Error) {\n\t\t\t\tcaptureSentryException(calculationError);\n\t\t\t} else {\n\t\t\t\tcaptureSentryException(new Error(getErrorString(calculationError)));\n\t\t\t}\n\t\t} else if (calculationResult && !calculationResult.success && calculationResult.message) {\n\t\t\tcaptureSentryException(new Error(calculationResult.message), {\n\t\t\t\tnotices: calculationResult.notices,\n\t\t\t});\n\t\t} else {\n\t\t\tcaptureSentryException(new Error('Unknown error occured while recalculating cart.'));\n\t\t}\n\n\t\treturn;\n\t}\n\n\tconsumeCartCalculationResponse(calculationResult);\n}\n\nexport function consumeCartCalculationResponse(response: ICartCalculationResponse) {\n\tif (response.notices) {\n\t\tif (response.notices.error) {\n\t\t\tlet cartErrors = '';\n\t\t\tfor (const errorNotice of response.notices.error) {\n\t\t\t\trenderOrderNotice(errorNotice.notice);\n\t\t\t\tcartErrors += errorNotice.notice;\n\t\t\t}\n\n\t\t\tstore.dispatch(setOrderError(cartErrors));\n\t\t}\n\n\t\tif (response.notices.success) {\n\t\t\tfor (const successNotice of response.notices.success) {\n\t\t\t\trenderOrderNotice(successNotice.notice);\n\t\t\t}\n\t\t}\n\n\t\tif (response.notices.notice) {\n\t\t\tfor (const notice of response.notices.notice) {\n\t\t\t\trenderOrderNotice(notice.notice);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (response.data) {\n\t\tstore.dispatch(setOrderError(''));\n\t\tconst existingCustomerData = PeachPayCustomer.data().form_fields;\n\t\t// On express checkout opening we always want the shipping section collapsed. We remove it from\n\t\t// the existing data to accomplish that. If it is not a fresh opening of the checkout then the\n\t\t// cart calculation will not include the 'ship_to_different_address' resulting in the section being\n\t\t// collapsed.\n\t\t// eslint-disable-next-line @typescript-eslint/no-dynamic-delete\n\t\tdelete existingCustomerData['ship_to_different_address'];\n\t\tstore.dispatch(updateCustomerFields({\n\t\t\t...existingCustomerData,\n\t\t\t...response.data.customer,\n\t\t}));\n\t\tstore.dispatch(updateCartCalculation(response.data.cart_calculation_record));\n\t\tstore.dispatch(updateGatewayDetails(response.data.gateway_availability_details));\n\n\t\tif (DefaultCart.contents().length >= 1 && Carts.total() === 0) {\n\t\t\tstore.dispatch(updateAvailableGateways(['peachpay_free']));\n\t\t} else {\n\t\t\tstore.dispatch(updateAvailableGateways(response.data.available_gateway_ids));\n\t\t}\n\n\t\tif (DefaultCart.contents().length === 0) {\n\t\t\tstore.dispatch(setOrderError(`<span>${getLocaleText('Cart is empty')}</span>`));\n\t\t} else if (!shippingIsValid() && Environment.modalUI.page() !== 'info') {\n\t\t\tif (PeachPayCustomer.shipping.country() === '' || PeachPayCustomer.shipping.city() === '' || PeachPayCustomer.shipping.postal() === '') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tstore.dispatch(setOrderError(`<span>${getLocaleText('There are no shipping methods available')}</span>`));\n\t\t}\n\n\t\tconst gatewayId = PaymentConfiguration.checkEligibleOrFindAlternate(PaymentConfiguration.selectedGateway());\n\t\tif (gatewayId) {\n\t\t\tstore.dispatch(setSelectedPaymentGateway(gatewayId));\n\t\t} else {\n\t\t\tstore.dispatch(setSelectedPaymentGateway(''));\n\t\t\tstore.dispatch(setOrderError(`<span>${getLocaleText('There are no payment methods available')}</span>`));\n\t\t}\n\t}\n}\n\nexport function renderOrderNotice(data: string) {\n\tconst message = stripHtml(data);\n\n\tconst noticeHTML = `<div class=\"pp-notice\">${message}</div>`;\n\n\t$qsAll('.pp-notice-container').forEach(element => {\n\t\telement.classList.remove('hide');\n\t\tif (window.innerWidth > 900 && element.id === 'pp-notice-container-mobile') {\n\t\t\telement.classList.add('hide');\n\t\t}\n\n\t\tsetTimeout(() => {\n\t\t\telement.classList.add('hide');\n\t\t}, 10050);\n\t});\n\n\t$qs('#pp-notice-container-new')?.insertAdjacentHTML('afterbegin', noticeHTML);\n\tif (Environment.customer.mobile() || window.innerWidth <= 900) {\n\t\t$qs('#pp-notice-container-mobile')?.insertAdjacentHTML('afterbegin', noticeHTML);\n\t}\n\n\t// Remove any 'pp-notice' elements currently in DOM after 10 seconds.\n\t$qsAll<HTMLElement>('.pp-notice', $el =>\n\t\tsetTimeout(() => {\n\t\t\t$el?.remove();\n\t\t}, 10000));\n}\n\nasync function createPaymentTransaction(paymentGateway: string): Promise<string | null> {\n\ttry {\n\t\tconst response = await fetch(getBaseURL(MerchantConfiguration.hostName(), Environment.testMode()) + 'api/v1/transaction/create', {\n\t\t\tmethod: 'POST',\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/json',\n\t\t\t},\n\t\t\tbody: JSON.stringify({\n\t\t\t\tsession: {\n\t\t\t\t\tid: PeachPayOrder.sessionId(),\n\t\t\t\t\tmerchant_id: MerchantConfiguration.id(),\n\t\t\t\t\tmerchant_name: MerchantConfiguration.name(),\n\t\t\t\t\tmerchant_url: MerchantConfiguration.hostName(),\n\t\t\t\t\tplugin_version: Environment.plugin.version(),\n\t\t\t\t},\n\t\t\t\ttransaction: {\n\t\t\t\t\tpayment_method: paymentGateway,\n\t\t\t\t\tpayment_method_variation: null,\n\t\t\t\t},\n\t\t\t}),\n\t\t});\n\n\t\tconst body = await response.json() as IResponse<{transaction_id: string}>;\n\n\t\tif (!response.ok || !body.success) {\n\t\t\tcaptureSentryException(new Error('Failed to create a new payment transaction'));\n\t\t\treturn null;\n\t\t}\n\n\t\treturn body.data.transaction_id;\n\t} catch (error) {\n\t\tif (error instanceof Error) {\n\t\t\tcaptureSentryException(new Error(`Unknown error while attempting to create a new payment transaction :: ${error.toString()}`));\n\t\t}\n\n\t\treturn null;\n\t}\n}\n\nasync function updatePaymentTransaction(transactionId: string, options: TransactionUpdate): Promise<boolean> {\n\ttry {\n\t\tconst requestURL = getBaseURL(MerchantConfiguration.hostName(), Environment.testMode()) + 'api/v1/transaction/update';\n\t\tconst requestBody = JSON.stringify({\n\t\t\tsession: {\n\t\t\t\tid: PeachPayOrder.sessionId(),\n\t\t\t\tmerchant_id: MerchantConfiguration.id(),\n\t\t\t\tmerchant_name: MerchantConfiguration.name(),\n\t\t\t\tmerchant_url: MerchantConfiguration.hostName(),\n\t\t\t\tplugin_version: Environment.plugin.version(),\n\t\t\t},\n\t\t\ttransaction: {\n\t\t\t\tid: transactionId,\n\t\t\t\tpaypal: options.paypal,\n\t\t\t\tstripe: options.stripe,\n\t\t\t\tsquare: options.square,\n\t\t\t\tpurchase_order: options.purchaseOrder,\n\t\t\t\tnote: options.note,\n\t\t\t},\n\t\t\torder: {\n\t\t\t\tpayment_status: options.paymentStatus,\n\t\t\t\torder_status: options.orderStatus,\n\t\t\t\tdata: options.order,\n\t\t\t},\n\t\t});\n\n\t\tconst response = await fetch(requestURL, {\n\t\t\tmethod: 'POST',\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/json',\n\t\t\t},\n\t\t\tbody: requestBody,\n\t\t});\n\n\t\tconst responseBody = await response.json() as IResponse<{transaction_id: string}>;\n\n\t\tif (!response.ok || !responseBody.success) {\n\t\t\tcaptureSentryException(new Error('Failed to update an existing payment transaction'), {\n\t\t\t\ttransaction_id: transactionId,\n\t\t\t});\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t} catch (error) {\n\t\tif (error instanceof Error) {\n\t\t\tcaptureSentryException(new Error(`Unknown error while attempting to update a existing payment transaction :: ${error.toString()}`), {\n\t\t\t\ttransaction_id: transactionId,\n\t\t\t});\n\t\t}\n\n\t\treturn false;\n\t}\n}\n\nexport function displayPaymentErrorMessage(error?: string): void {\n\t$qsAll('.pp-pm-error-text', $el => {\n\t\t$el.remove();\n\t});\n\n\tif (!error) {\n\t\treturn;\n\t}\n\n\tconst gatewayId = PaymentConfiguration.selectedGateway();\n\tconst $container = $qsAll(`div.pp-pm-saved-option[data-gateway=\"${gatewayId}\"]`);\n\n\t$container.forEach($el => {\n\t\t$el.insertAdjacentHTML('beforebegin', /* html */ `<div class=\"pp-pm-error-text\"><span>${error}</span></div>`);\n\t});\n}\n","import {uuidv4} from '../../../@shared/ts/uuid';\nimport {setSessionId} from '../reducers/peachPayOrderReducer';\nimport {store} from '../store';\n\ninterface IPeachPaySession {\n\t'key': string;\n\t'metadata'?: Record<string, any>;\n\t'created_on': string;\n}\n\nconst PEACHPAY_SESSION_KEY = 'PP_SESSION_KEY';\n\nfunction createSession(): IPeachPaySession {\n\t// Creating the peachpay session on the client now because it changes on every\n\t// page load anyways and the server should be stateless. Session ID can be used as a\n\t// tracer though the logs.\n\tconst key = `session_${uuidv4()}`;\n\n\treturn {\n\t\tkey,\n\t\tcreated_on: new Date().toJSON(),\n\t};\n}\n\nfunction getSession(): IPeachPaySession {\n\tconst getData = () => {\n\t\ttry {\n\t\t\treturn sessionStorage.getItem(PEACHPAY_SESSION_KEY);\n\t\t} catch {\n\t\t\treturn null;\n\t\t}\n\t};\n\n\tconst sessionData = getData();\n\n\tconst parseSession = (data: string | null) => {\n\t\tif (!data) {\n\t\t\treturn createSession();\n\t\t}\n\n\t\tconst session = JSON.parse(data) as IPeachPaySession;\n\n\t\tconst currentDate = new Date();\n\t\tconst sessionDate = new Date(session.created_on);\n\t\t// If session is older then 5 days create a new one.\n\t\tif ((currentDate.getMilliseconds() - sessionDate.getMilliseconds()) > 432_000_000) {\n\t\t\treturn createSession();\n\t\t}\n\n\t\treturn session;\n\t};\n\n\treturn parseSession(sessionData);\n}\n\nfunction saveSession(session: IPeachPaySession): boolean {\n\ttry {\n\t\tsessionStorage.setItem(PEACHPAY_SESSION_KEY, JSON.stringify(session));\n\t\treturn true;\n\t} catch {\n\t\treturn false;\n\t}\n}\n\n/**\n * Loads an exisiting session or creates a new one if one does not exist or is expired.\n */\nfunction loadSession() {\n\tconst session = getSession();\n\n\tstore.dispatch(setSessionId(session.key));\n\n\tsaveSession(session);\n}\n\n/**\n * Clears the local session only from the sessionStorage.\n */\nfunction clearLocalSession(): void {\n\ttry {\n\t\tsessionStorage.removeItem(PEACHPAY_SESSION_KEY);\n\t} catch {\n\t\t// Do no harm\n\t}\n}\n\nexport {clearLocalSession, loadSession};\n","/**\n *  Uuidv4 compliant function.\n * https://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid\n */\nexport function uuidv4() {\n\tlet d = new Date().getTime();\n\tlet d2 = (performance?.now && (performance.now() * 1000)) || 0;\n\n\treturn 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c => {\n\t\tlet r = Math.random() * 16;\n\t\tif (d > 0) {\n\t\t\tr = (d + r) % 16 | 0;\n\t\t\td = Math.floor(d / 16);\n\t\t} else {\n\t\t\tr = (d2 + r) % 16 | 0;\n\t\t\td2 = Math.floor(d2 / 16);\n\t\t}\n\n\t\treturn (c === 'x' ? r : ((r & 0x7) | 0x8)).toString(16);\n\t});\n}\n","import {type ICartCalculation, type ICartCalculationRecord, type ICartMetaData, type IShippingMethod} from '../../../@type/woocommerce/cart-calculation';\nimport {type DispatchAction, store} from '../store';\nimport {DispatchActionType} from '../models/DispatchActionType';\nimport {type WCCartItem} from '../../../@type/woocommerce/cart-item';\nimport {type KeyValue} from '../../../@type/dictionary';\nimport {getLocaleText} from '../util/translation';\nimport {MerchantConfiguration} from './merchantConfigurationReducer';\nimport {createDispatchUpdate} from './initialState';\n\n/**\n * Reducer for handling cart calculation state changes.\n * @param state\n * @param action\n */\nexport function cartReducer(state: ICartCalculationRecord, action: DispatchAction<unknown>): ICartCalculationRecord {\n\tswitch (action.type) {\n\t\tcase DispatchActionType.DEFAULT_CART_CONTENTS:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\t0: {\n\t\t\t\t\t...state['0'],\n\t\t\t\t\tcart: (action as DispatchAction<WCCartItem[]>).payload,\n\t\t\t\t},\n\t\t\t};\n\t\tcase DispatchActionType.DEFAULT_CART_CALCULATION:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\t0: {\n\t\t\t\t\t...(action as DispatchAction<ICartCalculation>).payload,\n\t\t\t\t},\n\t\t\t};\n\t\tcase DispatchActionType.CART_CALCULATION:\n\t\t\treturn {\n\t\t\t\t...(action as DispatchAction<ICartCalculationRecord>).payload,\n\t\t\t};\n\t\tcase DispatchActionType.CART_SHIPPING_SELECTION: {\n\t\t\tconst {payload} = action as DispatchAction<ICartShippingSelection>;\n\t\t\tconst newState = {...state};\n\n\t\t\tif (!newState?.[payload.cartKey]?.package_record) {\n\t\t\t\treturn newState;\n\t\t\t}\n\n\t\t\tconst packageRecord = (newState[payload.cartKey]!).package_record;\n\t\t\tif (!packageRecord[payload.shippingPackageKey]) {\n\t\t\t\treturn newState;\n\t\t\t}\n\n\t\t\t(packageRecord[payload.shippingPackageKey]!).selected_method = payload.packageMethodId;\n\t\t\treturn newState;\n\t\t}\n\n\t\tdefault:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t};\n\t}\n}\n\n// ========================== Action Creators =======================\n\nexport const updateCartCalculation = createDispatchUpdate<ICartCalculationRecord>(DispatchActionType.CART_CALCULATION);\nexport const updateDefaultCartContents = createDispatchUpdate<WCCartItem[]>(DispatchActionType.DEFAULT_CART_CONTENTS);\nexport const updateCartPackageShippingMethod = createDispatchUpdate<ICartShippingSelection>(DispatchActionType.CART_SHIPPING_SELECTION);\n\ninterface ICartShippingSelection {\n\tcartKey: string;\n\tshippingPackageKey: string;\n\tpackageMethodId: string;\n}\n\n// ========================== Store Selectors =======================\n\nexport function createCartSelectors(cartKey = '0') {\n\treturn {\n\t\tselectedShippingMethod: (packageKey = '0') => store.getState().calculatedCarts[cartKey]?.package_record?.[packageKey]?.selected_method ?? '',\n\t\tselectedShippingMethodDetails: (packageKey = '0') => store.getState().calculatedCarts[cartKey]?.package_record?.[packageKey] ?? null,\n\t\tcontents: () => store.getState().calculatedCarts[cartKey]?.cart ?? [],\n\t\tsubtotal: () => store.getState().calculatedCarts[cartKey]?.summary.subtotal ?? 0,\n\t\tfeeTotal: (fee: string) => store.getState().calculatedCarts[cartKey]?.summary.fees_record[fee] ?? 0,\n\t\ttotalAppliedFees: () => Object.entries(store.getState().calculatedCarts[cartKey]?.summary.fees_record ?? {}).reduce((previousValue, [_, value]) => previousValue + (value ?? 0), 0),\n\t\tcouponTotal: (coupon: string) => store.getState().calculatedCarts[cartKey]?.summary.coupons_record[coupon] ?? 0,\n\t\ttotalAppliedCoupons: () => Object.entries(store.getState().calculatedCarts[cartKey]?.summary.coupons_record ?? {}).reduce((previousValue, [_, value]) => previousValue + (value ?? 0), 0),\n\t\tcouponRecord: () => store.getState().calculatedCarts[cartKey]?.summary.coupons_record ?? {},\n\t\tgiftCardTotal: (giftCard: string) => store.getState().calculatedCarts[cartKey]?.summary.gift_card_record?.[giftCard] ?? 0,\n\t\ttotalAppliedGiftCards: () => Object.entries(store.getState().calculatedCarts[cartKey]?.summary.gift_card_record ?? {}).reduce((previousValue, [_, value]) => previousValue + (value ?? 0), 0),\n\t\ttotalShipping: () => store.getState().calculatedCarts[cartKey]?.summary.total_shipping ?? 0,\n\t\ttotalTax: () => store.getState().calculatedCarts[cartKey]?.summary.total_tax ?? 0,\n\t\ttotal: () => store.getState().calculatedCarts[cartKey]?.summary.total ?? 0,\n\t\tshippingMethods(packageKey = '0') {\n\t\t\tconst methods = store.getState().calculatedCarts[cartKey]?.package_record?.[packageKey]?.methods ?? {} as Record<string, IShippingMethod | undefined>;\n\n\t\t\treturn Object.entries(methods).map(([id, method]) => {\n\t\t\t\t(method!).id = id;\n\t\t\t\treturn method!;\n\t\t\t});\n\t\t},\n\t};\n}\n\nexport const DefaultCart = createCartSelectors('0');\n\nexport const Carts = {\n\tanyShippingMethodsAvailable() {\n\t\tfor (const cartKey of Object.keys(store.getState().calculatedCarts)) {\n\t\t\tconst calculatedCart = store.getState().calculatedCarts[cartKey];\n\t\t\tif (!calculatedCart) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tfor (const packageKey of Object.keys(calculatedCart.package_record)) {\n\t\t\t\tconst shippingPackage = calculatedCart.package_record[packageKey];\n\t\t\t\tif (!shippingPackage || Object.entries(shippingPackage.methods).length === 0) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t},\n\tvirtual() {\n\t\tfor (const cartKey of Object.keys(store.getState().calculatedCarts)) {\n\t\t\tconst calculatedCart = store.getState().calculatedCarts[cartKey];\n\t\t\tif (!calculatedCart) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (!calculatedCart.cart_meta.is_virtual) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t},\n\tanyVirtual() {\n\t\tconst carts = store.getState().calculatedCarts;\n\t\tfor (const [_, cart] of Object.entries(carts)) {\n\t\t\tif (!cart) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tfor (const [__, item] of Object.entries(cart)) {\n\t\t\t\tif (item.virtual) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t},\n\tcollectSelectedShipping() {\n\t\tconst carts = store.getState().calculatedCarts;\n\t\tconst selectedShippingMethods: Array<{\n\t\t\tmethodKey: string;\n\t\t\tselectedShipping: string;\n\t\t}> = [];\n\n\t\tfor (const cart of Object.values(carts)) {\n\t\t\tif (!cart) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tfor (const [packageKey, packageRecord] of Object.entries(cart.package_record ?? {})) {\n\t\t\t\tif (!packageRecord) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tselectedShippingMethods.push({\n\t\t\t\t\tmethodKey: `${packageKey}`,\n\n\t\t\t\t\t// PackageKey: `${packageKey}`,\n\t\t\t\t\tselectedShipping: packageRecord.selected_method,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\treturn selectedShippingMethods;\n\t},\n\tsubscriptionPresent() {\n\t\tfor (const cartKey of Object.keys(store.getState().calculatedCarts)) {\n\t\t\tconst calculatedCart = store.getState().calculatedCarts[cartKey];\n\t\t\tif (!calculatedCart) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (calculatedCart.cart_meta.subscription) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t},\n\ttotal() {\n\t\tlet total = 0;\n\n\t\tfor (const cartKey of Object.keys(store.getState().calculatedCarts)) {\n\t\t\tconst calculatedCart = store.getState().calculatedCarts[cartKey];\n\t\t\tif (!calculatedCart) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\ttotal += calculatedCart.summary.total;\n\t\t}\n\n\t\treturn total;\n\t},\n};\n\n/**\n * Selects and reorganizes cart data for the default cart into something that is more useful for rendering.\n */\nexport const selectDefaultCartViewData = cartSummaryViewData('0');\n\ntype CartSummaryViewData = {\n\tcartSummary: Array<KeyValue<string, number>>;\n\tcartMeta: ICartMetaData;\n};\n\nexport function cartSummaryViewData(cartKey: string): () => CartSummaryViewData {\n\treturn () => {\n\t\tconst calculatedCart = store.getState().calculatedCarts[cartKey];\n\t\tif (!calculatedCart) {\n\t\t\treturn {\n\t\t\t\tcartSummary: new Array<KeyValue<string, number>>(),\n\t\t\t\tcartMeta: {\n\t\t\t\t\tis_virtual: false,\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\n\t\tconst cartSummary: Array<KeyValue<string, number>> = [];\n\t\tconst cartMeta = calculatedCart.cart_meta;\n\n\t\t// Subtotal\n\t\tcartSummary.push({\n\t\t\tkey: getLocaleText('Subtotal'),\n\t\t\tvalue: calculatedCart.summary.subtotal,\n\t\t});\n\n\t\tif (calculatedCart.cart.length > 0) {\n\t\t\t// Coupons\n\t\t\tfor (const [coupon, amount] of Object.entries(calculatedCart.summary.coupons_record)) {\n\t\t\t\tif (!amount) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tcartSummary.push({\n\t\t\t\t\tkey: `${getLocaleText('Coupon')} - (${coupon}) <button class=\"pp-coupon-remove-button\" data-coupon=\"${coupon}\" type=\"button\" tabindex=\"0\">[&times;]</button>`,\n\t\t\t\t\tvalue: -amount,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t// Fees\n\t\tfor (const [fee, amount] of Object.entries(calculatedCart.summary.fees_record)) {\n\t\t\tif (!amount) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tcartSummary.push({\n\t\t\t\tkey: `Fee - (${fee})`,\n\t\t\t\tvalue: amount,\n\t\t\t});\n\t\t}\n\n\t\t// Shipping\n\t\tif (!calculatedCart.cart_meta.is_virtual) {\n\t\t\tcartSummary.push({\n\t\t\t\tkey: getLocaleText('Shipping'),\n\t\t\t\tvalue: calculatedCart.summary.total_shipping,\n\t\t\t});\n\t\t}\n\n\t\t// Tax\n\t\tif (MerchantConfiguration.tax.displayMode() === 'excludeTax' && calculatedCart.summary.total_tax !== 0) {\n\t\t\tif (calculatedCart.summary.tax_lines?.length) {\n\t\t\t\tcalculatedCart.summary.tax_lines.forEach(tax_line => {\n\t\t\t\t\tcartSummary.push({\n\t\t\t\t\t\tkey: tax_line['label'] === 'Tax' ? getLocaleText('Tax') : tax_line['label'],\n\t\t\t\t\t\tvalue: parseFloat(tax_line['amount']),\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tcartSummary.push({\n\t\t\t\t\tkey: getLocaleText('Tax'),\n\t\t\t\t\tvalue: calculatedCart.summary.total_tax,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (calculatedCart.cart.length > 0) {\n\t\t\t// Gift cards\n\t\t\tfor (const [giftCard, amount] of Object.entries(calculatedCart.summary.gift_card_record)) {\n\t\t\t\tif (!amount) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tcartSummary.push({\n\t\t\t\t\tkey: `Gift card - (${giftCard})`,\n\t\t\t\t\tvalue: -amount,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t// Total\n\t\tcartSummary.push({\n\t\t\tkey: getLocaleText('Total'),\n\t\t\tvalue: calculatedCart.summary.total,\n\t\t});\n\n\t\treturn {cartSummary, cartMeta};\n\t};\n}\n","import {type IDictionary} from '../../../@type/dictionary';\nimport {type FeatureFlag} from '../../../@type/features';\nimport {type IFeatureSupport} from '../../../@type/woocommerce/php-data';\nimport {DispatchActionType} from '../models/DispatchActionType';\nimport {type IEnvironment, type LoadingMode, type ModalPage} from '../models/IEnvironment';\nimport {type DispatchAction, store} from '../store';\nimport {getBaseURL, isDevEnvironment} from '../util/environment';\nimport {createDispatchUpdate} from './initialState';\nimport {MerchantConfiguration} from './merchantConfigurationReducer';\n\nexport function environmentReducer(state: IEnvironment, action: DispatchAction<unknown>): IEnvironment {\n\tswitch (action.type) {\n\t\tcase DispatchActionType.ENVIRONMENT:\n\t\t\treturn {\n\t\t\t\t...(action as DispatchAction<IEnvironment>).payload,\n\t\t\t\tcustomer: {...(action as DispatchAction<IEnvironment>).payload.customer},\n\t\t\t\tplugin: {...(action as DispatchAction<IEnvironment>).payload.plugin},\n\t\t\t\tmodalUI: {...(action as DispatchAction<IEnvironment>).payload.modalUI},\n\t\t\t};\n\t\tcase DispatchActionType.ENVIRONMENT_LANGUAGE:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tlanguage: (action as DispatchAction<string>).payload,\n\t\t\t};\n\t\tcase DispatchActionType.ENVIRONMENT_TRANSLATED_MODAL_TERMS:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\ttranslated_modal_terms: (action as DispatchAction<IDictionary>).payload,\n\t\t\t};\n\t\tcase DispatchActionType.ENVIRONMENT_SET_FEATURES:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tplugin: {\n\t\t\t\t\t...state.plugin,\n\t\t\t\t\tfeatureSupport: (action as DispatchAction<Record<string, IFeatureSupport | undefined>>).payload,\n\t\t\t\t},\n\t\t\t};\n\t\tdefault:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tmodalUI: {...state.modalUI},\n\t\t\t};\n\t}\n}\n\n// ======================= Action Creators =============================\n\nexport function updateEnvironment(options: {\n\tlanguage?: string;\n\ttranslated_modal_terms?: IDictionary;\n\tcustomerIsMobile?: boolean;\n\tcustomerSaveToBrowserSelected?: boolean;\n\tpluginPageType?: 'product' | 'cart' | 'checkout' | 'shop';\n\tpluginIsTestMode?: boolean;\n\tpluginVersion?: string;\n\tpluginButtonColor?: string;\n\tmodalButtonShadow?: boolean;\n\tmodalIsOpen?: boolean;\n\tmodalPageType?: ModalPage;\n\tmodalLoading?: LoadingMode;\n\trequestedPage?: ModalPage | undefined;\n}): DispatchAction<IEnvironment> {\n\treturn {\n\t\ttype: DispatchActionType.ENVIRONMENT,\n\t\tpayload: {\n\t\t\tlanguage: options.language ?? Environment.language(),\n\t\t\ttranslated_modal_terms: options.translated_modal_terms ?? Environment.translated_modal_terms(),\n\t\t\tcustomer: {\n\t\t\t\tmobile: options.customerIsMobile ?? Environment.customer.mobile(),\n\t\t\t\tsaveToBrowserSelected: options.customerSaveToBrowserSelected ?? Environment.customer.saveToBrowserSelected(),\n\t\t\t},\n\t\t\tplugin: {\n\t\t\t\tversion: options.pluginVersion ?? Environment.plugin.version(),\n\t\t\t\tmode: (typeof options.pluginIsTestMode === 'boolean') ? (options.pluginIsTestMode ? 'test' : 'live') : Environment.plugin.mode(),\n\t\t\t\tbuttonColor: options.pluginButtonColor ?? Environment.plugin.buttonColor(),\n\t\t\t\tpageType: options.pluginPageType ?? Environment.plugin.pageType(),\n\t\t\t\tfeatureSupport: store.getState().environment.plugin.featureSupport,\n\t\t\t},\n\t\t\tmodalUI: {\n\t\t\t\topen: options.modalIsOpen ?? Environment.modalUI.open(),\n\t\t\t\tpage: (options.modalPageType) ?? Environment.modalUI.page(),\n\t\t\t\tloadingMode: options.modalLoading ?? Environment.modalUI.loadingMode(),\n\t\t\t\trequestedPage: options.requestedPage ?? Environment.modalUI.requestedPage(),\n\t\t\t},\n\t\t},\n\t};\n}\n\nexport function setFeatureSupport(features: Record<string, IFeatureSupport | undefined> = {}): DispatchAction<Record<string, IFeatureSupport | undefined>> {\n\treturn {\n\t\ttype: DispatchActionType.ENVIRONMENT_SET_FEATURES,\n\t\tpayload: features,\n\t};\n}\n\nexport const updateLanguage = createDispatchUpdate<string>(DispatchActionType.ENVIRONMENT_LANGUAGE);\nexport const updateTranslatedModalTerms = createDispatchUpdate<IDictionary>(DispatchActionType.ENVIRONMENT_TRANSLATED_MODAL_TERMS);\nexport const startModalLoading = () => updateEnvironment({modalLoading: 'loading'});\nexport const startModalProcessing = () => updateEnvironment({modalLoading: 'processing'});\nexport const stopModalLoading = () => updateEnvironment({modalLoading: 'finished'});\n\n// ======================= Store Selectors =============================\n\nexport const Environment = {\n\tenvironment: () => store.getState().environment,\n\tlanguage: () => store.getState().environment.language,\n\ttranslated_modal_terms: () => store.getState().environment.translated_modal_terms,\n\ttestMode: () => store.getState().environment.plugin.mode === 'test',\n\tapiURL: () => getBaseURL(MerchantConfiguration.hostName(), Environment.testMode()),\n\tisTestOrDevSite: () => isDevEnvironment(getBaseURL(MerchantConfiguration.hostName(), Environment.testMode())),\n\tcustomer: {\n\t\tmobile: () => store.getState().environment.customer.mobile,\n\t\tsaveToBrowserSelected: () => store.getState().environment.customer.saveToBrowserSelected,\n\t},\n\tplugin: {\n\t\tversion: () => store.getState().environment.plugin.version,\n\t\tmode: () => store.getState().environment.plugin.mode,\n\t\tbuttonColor: () => store.getState().environment.plugin.buttonColor,\n\t\tpageType: () => store.getState().environment.plugin.pageType,\n\t},\n\tmodalUI: {\n\t\topen: () => store.getState().environment.modalUI.open,\n\t\tpage: () => store.getState().environment.modalUI.page,\n\t\tloadingMode: () => store.getState().environment.modalUI.loadingMode,\n\t\trequestedPage: () => store.getState().environment.modalUI.requestedPage,\n\t},\n};\n\nexport const Feature = {\n\tenabled: (flag: FeatureFlag) => store.getState().environment.plugin.featureSupport[flag]?.enabled ?? false,\n\t// Version 0 means plugin does not supply a feature flag but was added for backwards compatibility\n\tversion: (flag: FeatureFlag) => store.getState().environment.plugin.featureSupport[flag]?.version ?? 0,\n\tmetadata: <T>(flag: FeatureFlag, key: string) => (store.getState().environment.plugin.featureSupport[flag]?.metadata?.[key] ?? null) as T | null,\n\tdynamicMetadata: <T>(flag: FeatureFlag, key: string, cartKey = '0') => (store.getState().calculatedCarts[cartKey]?.feature_metadata?.[flag]?.[key] ?? null) as T | null,\n};\n","import {type DispatchActionType} from '../models/DispatchActionType';\nimport {type IState} from '../models/IState';\nimport {type DispatchAction} from '../store';\n\n// Default state data. Required for reducers to work correctly right away.\nexport const initialState: IState = {\n\tenvironment: {\n\t\tlanguage: 'en-US',\n\t\ttranslated_modal_terms: {},\n\t\tplugin: {\n\t\t\tversion: '',\n\t\t\tmode: 'live',\n\t\t\tpageType: 'cart',\n\t\t\tbuttonColor: '#21105d',\n\t\t\tfeatureSupport: {},\n\t\t},\n\t\tcustomer: {\n\t\t\tmobile: false,\n\t\t\tsaveToBrowserSelected: true,\n\t\t},\n\t\tmodalUI: {\n\t\t\topen: false,\n\t\t\tpage: 'info',\n\t\t\tloadingMode: 'finished',\n\t\t\trequestedPage: undefined,\n\t\t},\n\t},\n\tpeachPayOrder: {\n\t\tsessionId: '',\n\t\tcustomerAddressValidated: false,\n\t\tadditionalFields: {},\n\t\terrorMessage: '',\n\t},\n\tpeachPayCustomer: {\n\t\tversion: 2,\n\t\tform_fields: {\n\t\t\tshipping_company: '',\n\t\t\tshipping_email: '',\n\t\t\tshipping_first_name: '',\n\t\t\tshipping_last_name: '',\n\t\t\tshipping_address_1: '',\n\t\t\tshipping_address_2: '',\n\t\t\tshipping_city: '',\n\t\t\tshipping_state: '',\n\t\t\tshipping_country: '',\n\t\t\tshipping_postcode: '',\n\t\t\tshipping_phone: '',\n\t\t\tbilling_company: '',\n\t\t\tbilling_email: '',\n\t\t\tbilling_first_name: '',\n\t\t\tbilling_last_name: '',\n\t\t\tbilling_address_1: '',\n\t\t\tbilling_address_2: '',\n\t\t\tbilling_city: '',\n\t\t\tbilling_state: '',\n\t\t\tbilling_country: '',\n\t\t\tbilling_postcode: '',\n\t\t\tbilling_phone: '',\n\t\t},\n\t},\n\tmerchantConfiguration: {\n\t\tid: '',\n\t\tname: '',\n\t\thostName: '',\n\t\tgeneral: {\n\t\t\tcurrency: {\n\t\t\t\tname: 'United States Dollar',\n\t\t\t\tcode: 'USD',\n\t\t\t\tsymbol: '$',\n\t\t\t\tposition: 'left',\n\t\t\t\tthousands_separator: ',',\n\t\t\t\tdecimal_separator: '.',\n\t\t\t\trounding: 'disabled',\n\t\t\t\tnumber_of_decimals: 2,\n\t\t\t\thidden: false,\n\t\t\t},\n\t\t},\n\t\tshipping: {\n\t\t\tshippingZones: 0,\n\t\t},\n\t\ttax: {\n\t\t\tdisplayPricesInCartAndCheckout: 'excludeTax',\n\t\t},\n\t},\n\tcalculatedCarts: {\n\t\t// Standard/Default cart is always the key \"0\"\n\t\t0: {\n\t\t\tpackage_record: {},\n\t\t\tcart: [],\n\t\t\tsummary: {\n\t\t\t\tfees_record: {},\n\t\t\t\tcoupons_record: {},\n\t\t\t\tgift_card_record: {},\n\t\t\t\tsubtotal: 0,\n\t\t\t\ttotal_shipping: 0,\n\t\t\t\ttax_lines: [],\n\t\t\t\ttotal_tax: 0,\n\t\t\t\ttotal: 0,\n\t\t\t},\n\t\t\tcart_meta: {\n\t\t\t\tis_virtual: false,\n\t\t\t},\n\t\t},\n\t},\n\tpaymentConfiguration: {\n\t\tselectedGateway: '',\n\t\tavailableGateways: [],\n\t\tgatewayAvailabilityDetails: {},\n\n\t\tgatewayConfigurations: {},\n\t},\n};\n\nexport function createStaticDispatchUpdate<T>(type: DispatchActionType, payload: T): () => DispatchAction<T> {\n\treturn () => ({\n\t\ttype,\n\t\tpayload,\n\t});\n}\n\n/**\n * Returns a action creator to return a specific type of Dispatch Action without processing.\n */\nexport function createDispatchUpdate<T>(type: DispatchActionType): (payload: T) => DispatchAction<T> {\n\treturn (payload: T) => ({\n\t\ttype,\n\t\tpayload,\n\t});\n}\n\n/**\n * Returns a action creator to return a specific type of dispatch action with some processing of the inputed\n */\nexport function createCustomDispatchUpdate<I, T>(type: DispatchActionType, transformer: (input: I) => T): (payload: I) => DispatchAction<T> {\n\treturn (input: I) => {\n\t\tconst payload = transformer(input);\n\t\treturn {\n\t\t\ttype,\n\t\t\tpayload,\n\t\t};\n\t};\n}\n","import {type ICurrencyConfiguration} from '../../../@type/woocommerce/currency-configuration';\nimport {type IMerchantConfiguration} from '../models/IMerchantConfiguration';\nimport {type DispatchAction, store} from '../store';\nimport {DispatchActionType} from '../models/DispatchActionType';\nimport {createDispatchUpdate} from './initialState';\n\n/**\n * Merchant settings reducer.\n */\nexport function merchantConfigurationReducer(state: IMerchantConfiguration, action: DispatchAction<unknown>): IMerchantConfiguration {\n\tswitch (action.type) {\n\t\tcase DispatchActionType.MERCHANT_GENERAL_CURRENCY:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tgeneral: {\n\t\t\t\t\t...state.general,\n\t\t\t\t\tcurrency: {\n\t\t\t\t\t\t...(action as DispatchAction<ICurrencyConfiguration>).payload,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t};\n\t\tcase DispatchActionType.MERCHANT_GENERAL:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tgeneral: {\n\t\t\t\t\t...(action as DispatchAction<IMerchantConfiguration['general']>).payload,\n\t\t\t\t},\n\t\t\t};\n\t\tcase DispatchActionType.MERCHANT_TAX:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\ttax: {\n\t\t\t\t\t...(action as DispatchAction<IMerchantConfiguration['tax']>).payload,\n\t\t\t\t},\n\t\t\t};\n\t\tcase DispatchActionType.MERCHANT_SHIPPING:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tshipping: {\n\t\t\t\t\t...(action as DispatchAction<IMerchantConfiguration['shipping']>).payload,\n\t\t\t\t},\n\t\t\t};\n\t\tcase DispatchActionType.MERCHANT_HOSTNAME:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\thostName: (action as DispatchAction<string>).payload,\n\t\t\t};\n\t\tcase DispatchActionType.MERCHANT_NAME:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tname: (action as DispatchAction<string>).payload,\n\t\t\t};\n\t\tcase DispatchActionType.MERCHANT_ID:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tid: (action as DispatchAction<string>).payload,\n\t\t\t};\n\t\tdefault:\n\t\t\treturn {...state};\n\t}\n}\n\n// ======================== Action Creators ==============================\n\nexport const updateMerchantCurrencyConfig = createDispatchUpdate<ICurrencyConfiguration>(DispatchActionType.MERCHANT_GENERAL_CURRENCY);\nexport const updateMerchantTaxConfig = createDispatchUpdate<IMerchantConfiguration['tax']>(DispatchActionType.MERCHANT_TAX);\nexport const updateMerchantGeneralConfig = createDispatchUpdate<IMerchantConfiguration['general']>(DispatchActionType.MERCHANT_GENERAL);\nexport const updateMerchantShippingConfig = createDispatchUpdate<IMerchantConfiguration['shipping']>(DispatchActionType.MERCHANT_SHIPPING);\nexport const updateMerchantHostName = createDispatchUpdate<string>(DispatchActionType.MERCHANT_HOSTNAME);\nexport const updateMerchantName = createDispatchUpdate<string>(DispatchActionType.MERCHANT_NAME);\nexport const updateMerchantId = createDispatchUpdate<string>(DispatchActionType.MERCHANT_ID);\n\n// ========================= Store Selectors ===========================\n\nexport const MerchantConfiguration = {\n\tid: () => store.getState().merchantConfiguration.id,\n\tname: () => store.getState().merchantConfiguration.name,\n\thostName: () => store.getState().merchantConfiguration.hostName,\n\tgeneral: {\n\t\twcLocationInfoData: () => store.getState().merchantConfiguration.general.wcLocationInfoData,\n\t},\n\tcurrency: {\n\t\tconfiguration: () => store.getState().merchantConfiguration.general.currency,\n\t\tcode: () => store.getState().merchantConfiguration.general.currency.code,\n\t\tsymbol: () => store.getState().merchantConfiguration.general.currency.symbol,\n\t},\n\ttax: {\n\t\tdisplayMode: () => store.getState().merchantConfiguration.tax.displayPricesInCartAndCheckout,\n\t},\n\tshipping: {\n\t\tshippingZones: () => store.getState().merchantConfiguration.shipping.shippingZones,\n\t},\n};\n","import {DispatchActionType} from '../models/DispatchActionType';\nimport {GatewayEligibility, type IPaymentConfiguration, type GatewayConfiguration, type GatewayEligibilityDetails} from '../models/GatewayConfiguration';\nimport {type DispatchAction, store} from '../store';\nimport {getLocaleText} from '../util/translation';\nimport {createDispatchUpdate} from './initialState';\n\nfunction paymentConfigurationReducer(state: IPaymentConfiguration, action: DispatchAction<unknown>): IPaymentConfiguration {\n\tswitch (action.type) {\n\t\tcase DispatchActionType.PAYMENT_REGISTER_GATEWAY_BATCH: {\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tgatewayConfigurations: {\n\t\t\t\t\t...state.gatewayConfigurations,\n\t\t\t\t\t...(action as DispatchAction<Record<string, GatewayConfiguration>>).payload,\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\n\t\tcase DispatchActionType.PAYMENT_UPDATE_AVAILABLE_GATEWAYS: {\n\t\t\tconst {payload} = action as DispatchAction<IPaymentConfiguration['availableGateways']>;\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tavailableGateways: payload,\n\t\t\t};\n\t\t}\n\n\t\tcase DispatchActionType.PAYMENT_UPDATE_GATEWAY_AVAILABILITY_DETAILS: {\n\t\t\tconst {payload} = action as DispatchAction<IPaymentConfiguration['gatewayAvailabilityDetails']>;\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tgatewayAvailabilityDetails: payload,\n\t\t\t};\n\t\t}\n\n\t\tcase DispatchActionType.PAYMENT_SET_SELECTED_GATEWAY: {\n\t\t\tconst {payload} = action as DispatchAction<string>;\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tselectedGateway: payload,\n\t\t\t};\n\t\t}\n\n\t\tdefault:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t};\n\t}\n}\n\n// ======================= Dispatch Helpers =============================\nconst registerGatewayBatch = createDispatchUpdate<Record<string, GatewayConfiguration>>(DispatchActionType.PAYMENT_REGISTER_GATEWAY_BATCH);\nconst setSelectedPaymentGateway = createDispatchUpdate<string>(DispatchActionType.PAYMENT_SET_SELECTED_GATEWAY);\nconst updateAvailableGateways = createDispatchUpdate<string[]>(DispatchActionType.PAYMENT_UPDATE_AVAILABLE_GATEWAYS);\nconst updateGatewayDetails = createDispatchUpdate<Record<string, GatewayEligibilityDetails>>(DispatchActionType.PAYMENT_UPDATE_GATEWAY_AVAILABILITY_DETAILS);\n\n// ======================= Store Selectors =============================\n\ntype GatewayEligibilityContext = {eligibility: GatewayEligibility; config: GatewayConfiguration; displayIndex?: number};\n\nconst PaymentConfiguration = {\n\tdata: () => (store.getState().paymentConfiguration),\n\tselectedGateway: () => store.getState().paymentConfiguration.selectedGateway,\n\tgatewayConfig: (gatewayId: string) => store.getState().paymentConfiguration.gatewayConfigurations[gatewayId] ?? null,\n\teligibleGatewayDetails(gatewayId: string): GatewayEligibilityDetails | null {\n\t\tconst config = store.getState().paymentConfiguration.gatewayConfigurations[gatewayId];\n\t\tif (!config) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst details = store.getState().paymentConfiguration.gatewayAvailabilityDetails[gatewayId] ?? {};\n\n\t\tif (config.browser === false) {\n\t\t\tdetails.browser = {\n\t\t\t\texplanation: getLocaleText('This payment method is not supported by your browser. Please try a different option.'),\n\t\t\t};\n\t\t}\n\n\t\tif (config.initialized === false) {\n\t\t\tdetails.initialized = {\n\t\t\t\texplanation: getLocaleText('Something went wrong initializing this payment method. Please try a different option or try again later.'),\n\t\t\t};\n\t\t}\n\n\t\treturn details;\n\t},\n\tsortGatewaysByEligibility(): GatewayEligibilityContext[] {\n\t\tlet displayIndex = 0;\n\t\tconst sortedEligibility = Object.values(store.getState().paymentConfiguration.gatewayConfigurations)\n\t\t\t.map<GatewayEligibilityContext>(config => ({config, eligibility: PaymentConfiguration.eligibleGateway(config.gatewayId)}))\n\t\t\t// Second we sort on the available gateways array so the methods are displayed in the same order as\n\t\t\t// configured by WC. If the method is ineligible the existing ordering should not be touched.\n\t\t\t.sort((a, b) => {\n\t\t\t\tconst indexA = store.getState().paymentConfiguration.availableGateways.indexOf(a.config.gatewayId);\n\t\t\t\tconst indexB = store.getState().paymentConfiguration.availableGateways.indexOf(b.config.gatewayId);\n\n\t\t\t\treturn indexA - indexB;\n\t\t\t})\n\t\t\t// First sorting on just eligibility. This puts all the in eligible gateways at the end of the array.\n\t\t\t.sort((a, b) => a.eligibility - b.eligibility)\n\t\t\t.map(context => {\n\t\t\t\tif (context.eligibility) {\n\t\t\t\t\tcontext.displayIndex = displayIndex;\n\t\t\t\t\tdisplayIndex++;\n\t\t\t\t}\n\n\t\t\t\treturn context;\n\t\t\t});\n\n\t\tconst selectedContextIndex = sortedEligibility.findIndex(context => context.config.gatewayId === PaymentConfiguration.selectedGateway());\n\t\tconst selectedContext = sortedEligibility[selectedContextIndex];\n\n\t\tif (selectedContext?.displayIndex && selectedContext.displayIndex > 2) {\n\t\t\t// Remove the selected context from the array.\n\t\t\tsortedEligibility.splice(selectedContextIndex, 1);\n\n\t\t\t// Get the index to place the selected context at.\n\t\t\tconst spliceIndex = sortedEligibility.findIndex(context => context.displayIndex === 2);\n\n\t\t\t// Splice the selected context into the array at the correct index.\n\t\t\tsortedEligibility.splice(spliceIndex, 0, selectedContext);\n\n\t\t\t// We have to remap the display index again after changing the order so the UI is rendered correctly.\n\t\t\tlet updatedDisplayIndex = 0;\n\t\t\treturn sortedEligibility.map(context => {\n\t\t\t\tcontext.displayIndex = undefined;\n\t\t\t\tif (context.eligibility) {\n\t\t\t\t\tcontext.displayIndex = updatedDisplayIndex;\n\t\t\t\t\tupdatedDisplayIndex++;\n\t\t\t\t}\n\n\t\t\t\treturn context;\n\t\t\t});\n\t\t}\n\n\t\treturn sortedEligibility;\n\t},\n\teligibleGateway(gatewayId: string): GatewayEligibility {\n\t\tconst config = store.getState().paymentConfiguration.gatewayConfigurations[gatewayId];\n\t\tif (!config) {\n\t\t\treturn GatewayEligibility.NotEligible;\n\t\t}\n\n\t\tif (!store.getState().paymentConfiguration.availableGateways.includes(config.gatewayId)) {\n\t\t\treturn GatewayEligibility.NotEligible;\n\t\t}\n\n\t\tconst availabilityDetails = PaymentConfiguration.eligibleGatewayDetails(gatewayId);\n\t\t// Lack of availability details means the gateway is eligible if it is also part of the availableGateways array.\n\t\tif (!availabilityDetails || Object.keys(availabilityDetails).length === 0) {\n\t\t\treturn GatewayEligibility.Eligible;\n\t\t}\n\n\t\tif (availabilityDetails.minimum) {\n\t\t\treturn GatewayEligibility.EligibleWithChange;\n\t\t}\n\n\t\tif (availabilityDetails.maximum) {\n\t\t\treturn GatewayEligibility.EligibleWithChange;\n\t\t}\n\n\t\tif (availabilityDetails.currency) {\n\t\t\tif (availabilityDetails.currency.available_options?.length) {\n\t\t\t\treturn GatewayEligibility.EligibleWithChange;\n\t\t\t}\n\n\t\t\treturn GatewayEligibility.NotEligible;\n\t\t}\n\n\t\tif (availabilityDetails.country?.available_options?.length) {\n\t\t\tif (availabilityDetails.country.available_options?.length) {\n\t\t\t\treturn GatewayEligibility.EligibleWithChange;\n\t\t\t}\n\n\t\t\treturn GatewayEligibility.NotEligible;\n\t\t}\n\n\t\tif (config.browser === false) {\n\t\t\treturn GatewayEligibility.NotEligible;\n\t\t}\n\n\t\tif (config.initialized === false) {\n\t\t\treturn GatewayEligibility.EligibleButErrored;\n\t\t}\n\n\t\treturn GatewayEligibility.Eligible;\n\t},\n\teligibleGatewayCount() {\n\t\tlet count = 0;\n\t\tconst data = PaymentConfiguration.data();\n\n\t\tfor (const [gatewayId] of Object.entries(data.gatewayConfigurations)) {\n\t\t\tif (PaymentConfiguration.eligibleGateway(gatewayId)) {\n\t\t\t\tcount++;\n\t\t\t}\n\t\t}\n\n\t\treturn count;\n\t},\n\tcheckEligibleOrFindAlternate(gatewayId: string): string | null {\n\t\tif (PaymentConfiguration.eligibleGateway(gatewayId)) {\n\t\t\treturn gatewayId;\n\t\t}\n\n\t\treturn PaymentConfiguration.firstEligibleMethod();\n\t},\n\tfirstEligibleMethod(): string | null {\n\t\tconst gatewayContexts = PaymentConfiguration.sortGatewaysByEligibility();\n\n\t\tfor (const context of gatewayContexts) {\n\t\t\tif (context.eligibility !== GatewayEligibility.NotEligible) {\n\t\t\t\treturn context.config.gatewayId;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t},\n};\n\nexport {\n\ttype GatewayEligibilityContext,\n\tPaymentConfiguration,\n\tpaymentConfigurationReducer,\n\tregisterGatewayBatch,\n\tupdateAvailableGateways,\n\tupdateGatewayDetails,\n\tsetSelectedPaymentGateway,\n};\n","import {type PaymentMethodCreateParams} from '@stripe/stripe-js';\nimport {type WCShippingAddress, type WCBillingAddress} from '../../../@type/woocommerce/order';\nimport {DispatchActionType} from '../models/DispatchActionType';\nimport {type IPeachPayCustomer} from '../../../@type/peachpay/customer';\nimport {type DispatchAction, store} from '../store';\nimport {createDispatchUpdate} from './initialState';\n\nexport function peachPayCustomerReducer(state: IPeachPayCustomer, action: DispatchAction<unknown>): IPeachPayCustomer {\n\tswitch (action.type) {\n\t\tcase DispatchActionType.PEACHPAY_CUSTOMER:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\t...(action as DispatchAction<IPeachPayCustomer>).payload,\n\t\t\t};\n\t\tcase DispatchActionType.PEACHPAY_CUSTOMER_FIELDS:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tform_fields: {\n\t\t\t\t\t...(action as DispatchAction<IPeachPayCustomer['form_fields']>).payload,\n\t\t\t\t},\n\t\t\t};\n\t\tcase DispatchActionType.PEACHPAY_CUSTOMER_STRIPE_ID:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tstripe_customer_id: (action as DispatchAction<string>).payload,\n\t\t\t};\n\t\tcase DispatchActionType.PEACHPAY_CUSTOMER_SET_PREFERRED_PAYMENT_METHOD: {\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tpreferred_payment_method: (action as DispatchAction<string>).payload,\n\t\t\t};\n\t\t}\n\n\t\tcase DispatchActionType.PEACHPAY_CUSTOMER_SHIPPING: {\n\t\t\tif (state.form_fields['ship_to_different_address'] === '1') {\n\t\t\t\treturn {\n\t\t\t\t\t...state,\n\t\t\t\t\tform_fields: {\n\t\t\t\t\t\t...state.form_fields,\n\t\t\t\t\t\tshipping_country: (action as DispatchAction<IShortAddress>).payload.country,\n\t\t\t\t\t\tshipping_state: (action as DispatchAction<IShortAddress>).payload.state,\n\t\t\t\t\t\tshipping_city: (action as DispatchAction<IShortAddress>).payload.city,\n\t\t\t\t\t\tshipping_postcode: (action as DispatchAction<IShortAddress>).payload.postcode,\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tform_fields: {\n\t\t\t\t\t...state.form_fields,\n\t\t\t\t\tbilling_country: (action as DispatchAction<IShortAddress>).payload.country,\n\t\t\t\t\tbilling_state: (action as DispatchAction<IShortAddress>).payload.state,\n\t\t\t\t\tbilling_city: (action as DispatchAction<IShortAddress>).payload.city,\n\t\t\t\t\tbilling_postcode: (action as DispatchAction<IShortAddress>).payload.postcode,\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\n\t\tdefault:\n\t\t\t// This is required to prevent a compile error with TSC and webpack.\n\t\t\treturn {...state};\n\t}\n}\n\n// =========================== Action Creators =========================\n\nexport const updateCustomerStripeId = createDispatchUpdate<string>(DispatchActionType.PEACHPAY_CUSTOMER_STRIPE_ID);\nexport const updateCustomerFields = createDispatchUpdate<IPeachPayCustomer['form_fields']>(DispatchActionType.PEACHPAY_CUSTOMER_FIELDS);\nexport const updateCustomer = createDispatchUpdate<IPeachPayCustomer>(DispatchActionType.PEACHPAY_CUSTOMER);\n\nexport const updateCustomerShippingShortAddress = createDispatchUpdate<IShortAddress>(DispatchActionType.PEACHPAY_CUSTOMER_SHIPPING);\n\nexport const updateCustomerPreferredGateway = createDispatchUpdate<string>(DispatchActionType.PEACHPAY_CUSTOMER_SET_PREFERRED_PAYMENT_METHOD);\n\n// =========================== Store Selectors =========================\nfunction getShippingField(field: string) {\n\tconst openShippingDetails = store.getState().peachPayCustomer.form_fields?.['ship_to_different_address'];\n\n\treturn store.getState().peachPayCustomer.form_fields?.[`${(openShippingDetails === '1' ? 'shipping' : 'billing')}_${field}`] ?? '';\n}\n\n/**\n * Always returns the most up to date customer state\n */\nexport const PeachPayCustomer = {\n\tdata: () => store.getState().peachPayCustomer,\n\tbilling: {\n\t\temail: () => store.getState().peachPayCustomer.form_fields['billing_email'] ?? '',\n\t\tfullName: () => (store.getState().peachPayCustomer.form_fields['billing_first_name'] ?? '') + ' ' + (store.getState().peachPayCustomer.form_fields['billing_last_name'] ?? ''),\n\t\tfirstName: () => store.getState().peachPayCustomer.form_fields['billing_first_name'] ?? '',\n\t\tlastName: () => store.getState().peachPayCustomer.form_fields['billing_last_name'] ?? '',\n\t\tphone: () => store.getState().peachPayCustomer.form_fields['billing_phone'] ?? '',\n\t\tcompany: () => store.getState().peachPayCustomer.form_fields['billing_company'] ?? '',\n\t\taddress1: () => store.getState().peachPayCustomer.form_fields['billing_address_1'] ?? '',\n\t\taddress2: () => store.getState().peachPayCustomer.form_fields['billing_address_2'] ?? '',\n\t\tcity: () => store.getState().peachPayCustomer.form_fields['billing_city'] ?? '',\n\t\tstate: () => store.getState().peachPayCustomer.form_fields['billing_state'] ?? '',\n\t\tcountry() {\n\t\t\tconst location_data = store.getState().merchantConfiguration.general.wcLocationInfoData;\n\t\t\t// Because empty strings should be ignored as well\n\t\t\t// eslint-disable-next-line @typescript-eslint/prefer-nullish-coalescing\n\t\t\treturn store.getState().peachPayCustomer.form_fields['billing_country'] || location_data?.customer_default_country || location_data?.store_country || '';\n\t\t},\n\t\tpostal: () => store.getState().peachPayCustomer.form_fields['billing_postcode'] ?? '',\n\t},\n\tshipping: {\n\t\temail: () => getShippingField('email'),\n\t\tfullName: () => getShippingField('first_name') + ' ' + getShippingField('first_name'),\n\t\tfirstName: () => getShippingField('first_name'),\n\t\tlastName: () => getShippingField('last_name'),\n\t\tphone: () => getShippingField('phone'),\n\t\tcompany: () => getShippingField('company'),\n\t\taddress1: () => getShippingField('address_1'),\n\t\taddress2: () => getShippingField('address_2'),\n\t\tcity: () => getShippingField('city'),\n\t\tstate: () => getShippingField('state'),\n\t\tcountry: () => getShippingField('country'),\n\t\tpostal: () => getShippingField('postcode'),\n\t},\n\tshipToDifferentAddress: () => store.getState().peachPayCustomer.form_fields['ship_to_different_address'] === '1',\n\tstripeId: () => store.getState().peachPayCustomer.stripe_customer_id ?? '',\n\tstripeBillingDetails() {\n\t\tconst details = {\n\t\t\tname: PeachPayCustomer.billing.firstName() + ' ' + PeachPayCustomer.billing.lastName(),\n\t\t\temail: PeachPayCustomer.billing.email(),\n\t\t\tphone: PeachPayCustomer.billing.phone(),\n\t\t\taddress: {\n\t\t\t\tcity: PeachPayCustomer.billing.city(),\n\t\t\t\tcountry: PeachPayCustomer.billing.country(),\n\t\t\t\tline1: PeachPayCustomer.billing.address1(),\n\t\t\t\tline2: PeachPayCustomer.billing.address2(),\n\t\t\t\tpostal_code: PeachPayCustomer.billing.postal(),\n\t\t\t\tstate: PeachPayCustomer.billing.state(),\n\t\t\t},\n\t\t} as PaymentMethodCreateParams.BillingDetails;\n\n\t\tif (details.name === ' ') {\n\t\t\tdelete details.name;\n\t\t}\n\n\t\tif (details.email === '') {\n\t\t\tdelete details.email;\n\t\t}\n\n\t\tif (details.phone === '') {\n\t\t\tdelete details.phone;\n\t\t}\n\n\t\tif (details.address?.city === '') {\n\t\t\tdelete details.address.city;\n\t\t}\n\n\t\tif (details.address?.country === '') {\n\t\t\tdelete details.address.country;\n\t\t}\n\n\t\tif (details.address?.line1 === '') {\n\t\t\tdelete details.address.line1;\n\t\t}\n\n\t\tif (details.address?.line2 === '') {\n\t\t\tdelete details.address.line2;\n\t\t}\n\n\t\tif (details.address?.postal_code === '') {\n\t\t\tdelete details.address.postal_code;\n\t\t}\n\n\t\tif (details.address?.state === '') {\n\t\t\tdelete details.address.state;\n\t\t}\n\n\t\tif (Object.keys(details.address ?? {}).length === 0) {\n\t\t\tdelete details.address;\n\t\t}\n\n\t\treturn details;\n\t},\n\tstripeShippingDetails: () => ({\n\t\tname: PeachPayCustomer.shipping.firstName() + ' ' + PeachPayCustomer.shipping.lastName(),\n\t\tphone: PeachPayCustomer.shipping.phone(),\n\t\taddress: {\n\t\t\tcity: PeachPayCustomer.shipping.city(),\n\t\t\tcountry: PeachPayCustomer.shipping.country(),\n\t\t\tline1: PeachPayCustomer.shipping.address1(),\n\t\t\tline2: PeachPayCustomer.shipping.address2(),\n\t\t\tpostal_code: PeachPayCustomer.shipping.postal(),\n\t\t\tstate: PeachPayCustomer.shipping.state(),\n\t\t},\n\t}),\n\tshippingShortAddress: () => ({\n\t\tcountry: PeachPayCustomer.shipping.country(),\n\t\tstate: PeachPayCustomer.shipping.state(),\n\t\tcity: PeachPayCustomer.shipping.city(),\n\t\tpostcode: PeachPayCustomer.shipping.postal(),\n\t} as IShortAddress),\n\twcShippingAddress: () => ({\n\t\tshipping_email: getShippingField('email'),\n\t\tshipping_first_name: getShippingField('first_name'),\n\t\tshipping_last_name: getShippingField('last_name'),\n\t\tshipping_company: getShippingField('company'),\n\t\tshipping_country: getShippingField('country'),\n\t\tshipping_address_1: getShippingField('address_1'),\n\t\tshipping_address_2: getShippingField('address_2'),\n\t\tshipping_city: getShippingField('city'),\n\t\tshipping_state: getShippingField('state'),\n\t\tshipping_postcode: getShippingField('postcode'),\n\t\tshipping_phone: getShippingField('phone'),\n\t} as WCShippingAddress),\n\twcBillingAddress: () => ({\n\t\tbilling_first_name: PeachPayCustomer.billing.firstName(),\n\t\tbilling_last_name: PeachPayCustomer.billing.lastName(),\n\t\tbilling_company: PeachPayCustomer.billing.company(),\n\t\tbilling_email: PeachPayCustomer.billing.email(),\n\t\tbilling_phone: PeachPayCustomer.billing.phone(),\n\t\tbilling_country: PeachPayCustomer.billing.country(),\n\t\tbilling_address_1: PeachPayCustomer.billing.address1(),\n\t\tbilling_address_2: PeachPayCustomer.billing.address2(),\n\t\tbilling_city: PeachPayCustomer.billing.city(),\n\t\tbilling_state: PeachPayCustomer.billing.state(),\n\t\tbilling_postcode: PeachPayCustomer.billing.postal(),\n\t} as WCBillingAddress),\n\tpreferredPaymentMethod: () => store.getState().peachPayCustomer.preferred_payment_method ?? null as string | null,\n};\n\nexport interface IShortAddress {\n\tcountry: string;\n\tstate: string;\n\tcity: string;\n\tpostcode: string;\n}\n","import {GLOBAL} from '../deprecated/global';\nimport {addOrderNotesToAdditionalFields, collectAdditionalFieldData} from '../features/additionalFields';\nimport {DispatchActionType} from '../models/DispatchActionType';\nimport {type IPeachPayOrder} from '../models/IPeachPayOrder';\nimport {type DispatchAction, store} from '../store';\nimport {cleanFormFields} from '../util/form';\nimport {createDispatchUpdate} from './initialState';\nimport {PeachPayCustomer} from './peachPayCustomerReducer';\n\nexport function peachPayOrderReducer(state: IPeachPayOrder, action: DispatchAction<unknown>): IPeachPayOrder {\n\tswitch (action.type) {\n\t\tcase DispatchActionType.ORDER_SESSION_ID:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tsessionId: (action as DispatchAction<string>).payload,\n\t\t\t};\n\t\tcase DispatchActionType.ORDER_ADDRESS_VALIDATED:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tcustomerAddressValidated: (action as DispatchAction<boolean>).payload,\n\t\t\t};\n\t\tcase DispatchActionType.ORDER_SET_EXTRA_FIELDS:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tadditionalFields: {\n\t\t\t\t\t...(action as DispatchAction<Record<string, string>>).payload,\n\t\t\t\t},\n\t\t\t};\n\t\tcase DispatchActionType.ORDER_SET_ERROR_MESSAGE:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\terrorMessage: (action as DispatchAction<string>).payload,\n\t\t\t};\n\t\tdefault:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t};\n\t}\n}\n\n// ============================== Action Creators =================================\n\nexport const setSessionId = createDispatchUpdate<string>(DispatchActionType.ORDER_SESSION_ID);\nexport const updateCustomerAddressValidation = createDispatchUpdate<boolean>(DispatchActionType.ORDER_ADDRESS_VALIDATED);\nexport const setExtraFields = createDispatchUpdate<Record<string, string>>(DispatchActionType.ORDER_SET_EXTRA_FIELDS);\nexport const setOrderError = createDispatchUpdate<string>(DispatchActionType.ORDER_SET_ERROR_MESSAGE);\n\n// ============================== Store Selectors =================================\nexport const PeachPayOrder = {\n\tsessionId: () => store.getState().peachPayOrder.sessionId,\n\tcontents: () => store.getState().calculatedCarts[0].cart,\n\terrorMessage: () => store.getState().peachPayOrder.errorMessage,\n\tcollectSelectedShipping() {\n\t\tconst carts = store.getState().calculatedCarts;\n\t\tconst selectedShippingMethodsRecord: Record<string, string> = {};\n\n\t\tfor (const cartKey of Object.keys(carts)) {\n\t\t\tconst cart = carts[cartKey];\n\n\t\t\tif (!cart) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tfor (const packageKey of Object.keys(cart.package_record ?? {})) {\n\t\t\t\tconst packageRecord = cart.package_record[packageKey];\n\n\t\t\t\tif (!packageRecord) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tselectedShippingMethodsRecord[packageKey] = packageRecord.selected_method;\n\t\t\t}\n\t\t}\n\n\t\treturn selectedShippingMethodsRecord;\n\t},\n\torderFormRecord() {\n\t\tconst {fieldData, fieldOrder} = GLOBAL.phpData ? addOrderNotesToAdditionalFields(GLOBAL.phpData) : {fieldData: [], fieldOrder: []};\n\t\tconst formInfoRecord: Record<string, string> = {\n\t\t\t...PeachPayCustomer.data().form_fields,\n\t\t\t...PeachPayCustomer.wcBillingAddress(),\n\t\t\t...PeachPayCustomer.wcShippingAddress(),\n\t\t\t...collectAdditionalFieldData(fieldData, fieldOrder),\n\t\t} as Record<string, string>;\n\t\tcleanFormFields(formInfoRecord);\n\t\tformInfoRecord['ship_to_different_address'] = PeachPayCustomer.shipToDifferentAddress() ? '1' : '0';\n\t\tfor (const [packageKey, selectedOption] of Object.entries(PeachPayOrder.collectSelectedShipping())) {\n\t\t\tformInfoRecord[`shipping_method[${packageKey}]`] = selectedOption;\n\t\t}\n\n\t\treturn formInfoRecord;\n\t},\n\tcustomerAddressValidated: () => store.getState().peachPayOrder.customerAddressValidated,\n\textraFieldsRecord: () => store.getState().peachPayOrder.additionalFields,\n};\n","import {type IState} from '../models/IState';\nimport {type DispatchAction} from '../store';\n\nimport {cartReducer} from './cartReducer';\nimport {merchantConfigurationReducer} from './merchantConfigurationReducer';\nimport {peachPayCustomerReducer} from './peachPayCustomerReducer';\nimport {environmentReducer} from './environmentReducer';\nimport {peachPayOrderReducer} from './peachPayOrderReducer';\n\nimport {createDispatchUpdate, initialState} from './initialState';\nimport {paymentConfigurationReducer} from './paymentConfigurationReducer';\nimport {DispatchActionType} from '../models/DispatchActionType';\n\n// eslint-disable-next-line @typescript-eslint/default-param-last\nexport function rootReducer(state: IState = initialState, action: DispatchAction<unknown>): IState {\n\treturn {\n\t\t// All existing data.\n\t\t...state,\n\n\t\t// Let sub reducers handle nested reducing and handling related actions.\n\t\tpeachPayOrder: peachPayOrderReducer(state.peachPayOrder, action),\n\t\tenvironment: environmentReducer(state.environment, action),\n\t\tpeachPayCustomer: peachPayCustomerReducer(state.peachPayCustomer, action),\n\t\tmerchantConfiguration: merchantConfigurationReducer(state.merchantConfiguration, action),\n\t\tcalculatedCarts: cartReducer(state.calculatedCarts, action),\n\t\tpaymentConfiguration: paymentConfigurationReducer(state.paymentConfiguration, action),\n\t};\n}\n\n/**\n * Dispatch action that changes zero state. Used to force a rerender when something outside of the redux store may have changed.\n */\nexport const render = createDispatchUpdate<void>(DispatchActionType.INIT);\n","import {initialState} from './reducers/initialState';\nimport {type IState} from './models/IState';\nimport {rootReducer} from './reducers/rootReducer';\n\nexport interface DispatchAction<T> {\n\ttype: string;\n\tpayload: T;\n}\ninterface Store<S> {\n\t/**\n\t * Used to update the state of the application.\n\t * @param action A plain object representing the change in state.\n\t */\n\tdispatch<T>(action: DispatchAction<T>): void;\n\n\t/**\n\t * A readonly object of the current state of the application. This should not be mutated.\n\t */\n\tgetState(): Readonly<S>;\n\n\t/**\n\t * Used to listen for updates to the state. Ex: Rerendering UI when data changes.\n\t * @param listener The callback for when the state changes.\n\t * @returns A void function to cancel the listeners from further updates.\n\t */\n\tsubscribe(listener: () => void): () => void;\n}\n\n/**\n * Should be treated as the single source of truth for the modal state.\n */\nexport const store = createStore<IState>(rootReducer, initialState);\n\n/**\n * Creates a simplified redux store.\n * Simplified version of: https://github.com/reduxjs/redux/blob/master/src/createStore.ts\n */\nfunction createStore<S>(reducer: <T>(state: S, action: DispatchAction<T>) => S, preloadedState: S): Store<S> {\n\tlet isDispatching = false;\n\tconst currentReducer = reducer;\n\tlet currentState: S = preloadedState;\n\n\tlet currentListeners: Array<() => void> | null = [];\n\tlet nextListeners = currentListeners;\n\n\tconst dispatch = <T>(action: DispatchAction<T>) => {\n\t\tif (typeof action !== 'object') {\n\t\t\tthrow new TypeError('You may only dispatch plain objects. Received: ' + typeof action);\n\t\t}\n\n\t\tif (typeof action.type === 'undefined') {\n\t\t\tthrow new TypeError('You may not have an undefined \"type\" property.');\n\t\t}\n\n\t\tif (isDispatching) {\n\t\t\tthrow new Error('Reducers may not dispatch actions.');\n\t\t}\n\n\t\ttry {\n\t\t\tisDispatching = true;\n\t\t\tcurrentState = currentReducer(currentState, action);\n\t\t} finally {\n\t\t\tisDispatching = false;\n\t\t}\n\n\t\t// eslint-disable-next-line no-multi-assign\n\t\tconst listeners = (currentListeners = nextListeners);\n\t\tfor (let i = 0; i < listeners?.length; i++) {\n\t\t\tconst listener = listeners[i];\n\t\t\tlistener?.();\n\t\t}\n\n\t\treturn action;\n\t};\n\n\tconst getState = () => {\n\t\tif (isDispatching) {\n\t\t\tthrow new Error('You may not call getState from within a reducer.');\n\t\t}\n\n\t\treturn currentState;\n\t};\n\n\tconst subscribe = (listener: () => void) => {\n\t\tif (typeof listener !== 'function') {\n\t\t\tthrow new TypeError('Expected a listener to be a function. Instead received: ' + typeof listener);\n\t\t}\n\n\t\tif (isDispatching) {\n\t\t\tthrow new Error('You may not add a subscriber from a subscription function.');\n\t\t}\n\n\t\tlet isSubscribed = true;\n\t\tif (nextListeners === currentListeners) {\n\t\t\tnextListeners = currentListeners?.slice() ?? null;\n\t\t}\n\n\t\tnextListeners?.push(listener);\n\n\t\treturn () => {\n\t\t\tif (!isSubscribed) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (isDispatching) {\n\t\t\t\tthrow new Error('You may not remove a subscriber while reducing or inside a subscription function.');\n\t\t\t}\n\n\t\t\tisSubscribed = false;\n\n\t\t\tif (nextListeners === currentListeners) {\n\t\t\t\tnextListeners = currentListeners?.slice() ?? null;\n\t\t\t}\n\n\t\t\tconst index = nextListeners?.indexOf(listener) ?? 0;\n\t\t\tnextListeners.slice(index, 1);\n\t\t\tcurrentListeners = null;\n\t\t};\n\t};\n\n\tdispatch({type: 'init'} as DispatchAction<unknown>);\n\n\tconst store: Store<S> = {\n\t\tdispatch,\n\t\tgetState,\n\t\tsubscribe,\n\t};\n\n\treturn store;\n}\n\n/**\n * Allows the possibility of running dispatch actions within a subscribe\n * callback without causing a recursive infinte loop. This callback can capture\n * surrounding scope but it should not be expected to execute synchronously.\n * It should be thought of like setting an event for the next time the stack\n * returns.\n */\nexport function safeDispatch(callback: () => void) {\n\t// SetTimeout only fires after the delay and when the stack is completly returned. Meaning this\n\t// will never be fired within a store.subscribe callback.\n\tsetTimeout(callback, 0);\n}\n","/**\n * Capitalizes the first letter in a string.\n */\nexport function capitalizeFirstLetter(string: string) {\n\tconst stringToUpper = String(string);\n\treturn stringToUpper.charAt(0).toUpperCase() + stringToUpper.slice(1);\n}\n","import {FeatureFlag} from '../../../@type/features';\nimport {type WCCartItem} from '../../../@type/woocommerce/cart-item';\nimport {DefaultCart} from '../reducers/cartReducer';\nimport {Feature} from '../reducers/environmentReducer';\nimport {MerchantConfiguration} from '../reducers/merchantConfigurationReducer';\nimport {formatCostString, formatCurrencyString} from './currency';\nimport {capitalizeFirstLetter} from './string';\nimport {getLocaleText} from './translation';\n\n/**\n * Indicates if the cart is completely virtual\n */\nexport function cartIsVirtual(cart?: WCCartItem[]): boolean {\n\tif (cart?.length === 0) {\n\t\treturn true;\n\t}\n\n\treturn cart?.every(v => v.virtual) ?? true;\n}\n\nexport function itemsInCart(cart?: WCCartItem[]) {\n\treturn cart?.length ?? 0;\n}\n\n/**\n * Returns true or false if a cart item is virtual. Returns true if the item is undefined/null\n */\nexport function cartItemIsVirtual(item: WCCartItem | null): boolean {\n\treturn item?.virtual ?? true;\n}\n\n/**\n * Gets the quantity from the cart item\n */\nexport function cartItemQuantity(cartItem: WCCartItem | null): number {\n\treturn typeof cartItem?.quantity === 'string' ? Number.parseInt(cartItem.quantity) : (cartItem?.quantity ?? 0);\n}\n\nexport function bundleQuantityLabel(item: WCCartItem) {\n\tlet bundleItemQuantity = '';\n\tif (item.is_part_of_bundle) {\n\t\tconst bundle = DefaultCart.contents().find(cartItem => cartItem.item_key === item.bundled_by);\n\t\tif (bundle && !isNaN(parseInt(bundle.quantity))) {\n\t\t\tbundleItemQuantity = ` × ${cartItemQuantity(item) / parseInt(bundle.quantity)}`;\n\t\t}\n\t}\n\n\treturn bundleItemQuantity;\n}\n\nexport function cartItemLabel(item: WCCartItem) {\n\tlet {name} = item;\n\t// The store ugoprobaseball.com has an extra options plugin configured\n\t// in a non-standard way, which is why we need to include the variation\n\t// in name as it does not come back in the formatted item data.\n\tif (MerchantConfiguration.hostName() === 'ugoprobaseball.com' && item.formatted_item_data && item.name_with_variation) {\n\t\tname = item.name_with_variation;\n\t}\n\n\tif (!item.is_part_of_bundle) {\n\t\tname = '<span>' + name + '</span>';\n\t}\n\n\tconst variationTitle = !item.attributes && item.variation_title ? ` - ${item.variation_title}` : '';\n\n\tconst label = `${name}${variationTitle}`;\n\n\treturn label;\n}\n\nexport function cartItemDisplayAmount(item: WCCartItem): string {\n\tif (item.is_subscription) {\n\t\tconst stringAmount = item.subscription_price_string?.indexOf(String(item.display_price ?? item.price)) ? formatCostString(Number.parseFloat(item.display_price ?? item.price)) : '';\n\t\treturn `${MerchantConfiguration.currency.symbol()}${stringAmount}${item.subscription_price_string ?? ''}`;\n\t}\n\n\tif (item.is_bundle) {\n\t\tconst bundlePrice: number = Number.parseFloat(item.display_price ?? item.price);\n\t\tlet bundleTotal = bundlePrice * Number.parseFloat(item.quantity);\n\t\tconst subItems = DefaultCart.contents().filter(cartItem => cartItem.bundled_by === item.item_key);\n\t\tsubItems.forEach((subItem: WCCartItem) => {\n\t\t\tif (bundlePrice > 0) {\n\t\t\t\tconst subItemPrice: number = Number.parseFloat(subItem.display_price ?? subItem.price);\n\t\t\t\tbundleTotal += subItemPrice * Number.parseFloat(subItem.quantity);\n\t\t\t}\n\t\t});\n\t\treturn `${formatCurrencyString(bundleTotal)}`;\n\t}\n\n\tif (item.is_part_of_bundle) {\n\t\treturn `${formatCurrencyString(Number.parseFloat(item.display_price ?? item.price))}/${getLocaleText('each')}`;\n\t}\n\n\treturn `${formatCurrencyString(Number.parseFloat(item.display_price ?? item.price) * cartItemQuantity(item))}`;\n}\n\nexport function cartItemVariationHTML(item: WCCartItem) {\n\tif (item.formatted_item_data) {\n\t\treturn `${metaDataRowsHTML(item)}${formattedItemDataHTMLTemplate(item)}`;\n\t}\n\n\tlet variationRowHTML = '';\n\n\tif (!item.attributes) {\n\t\treturn variationRowHTML;\n\t}\n\n\tconst keys = Object.keys(item.attributes);\n\tfor (const key of keys) {\n\t\tconst formattedKey = capitalizeFirstLetter(\n\t\t\tkey\n\t\t\t\t.replace('attribute_', '')\n\t\t\t\t.replace('pa_', '')\n\t\t\t\t.replace(/-/g, ' '),\n\t\t);\n\t\tconst formattedValue = String(item.attributes[key]).toUpperCase();\n\t\tvariationRowHTML += `<dt>${formattedKey}: </dt><dd>${formattedValue}</dd>`;\n\t}\n\n\treturn `${metaDataRowsHTML(item)}<dl>${variationRowHTML}</dl>`;\n}\n\nfunction metaDataRowsHTML(item: WCCartItem) {\n\tif (!item.meta_data || Object.entries(item.meta_data).length === 0) {\n\t\treturn '';\n\t}\n\n\tlet html = '';\n\tfor (const meta of item.meta_data) {\n\t\tconst keyText = capitalizeFirstLetter(meta.key.replace(/_/g, ' '));\n\t\thtml += `<dt>${keyText}: </dt><dd>${meta.value || '(none)'}</dd>`;\n\t}\n\n\treturn `<dl>${html}</dl>`;\n}\n\nfunction formattedItemDataHTMLTemplate(item: WCCartItem) {\n\tif (!item.formatted_item_data) {\n\t\treturn '';\n\t}\n\n\treturn item.formatted_item_data.replace(/&nbsp;/g, '');\n}\n\ntype AddToCartOptions = {\n\tvariationId?: number;\n\tvariationAttributes?: Array<[name: string, value: string]>;\n};\nasync function addProductToCart(productId: number, quantity = 1, options?: AddToCartOptions): Promise<boolean> {\n\tconst addToCartURL = Feature.metadata<string>(FeatureFlag.EXPRESS_CHECKOUT, 'add_to_cart_url');\n\n\tif (!addToCartURL) {\n\t\treturn false;\n\t}\n\n\tconst formData = new FormData();\n\tformData.set('add-to-cart', String(productId));\n\tformData.set('quantity', String(quantity));\n\n\tif (options?.variationAttributes) {\n\t\tformData.set('product_id', String(productId));\n\t\tformData.set('variation_id', String(options?.variationId ?? productId));\n\n\t\tfor (const [name, value] of options.variationAttributes) {\n\t\t\tformData.set(`${name}`, value);\n\t\t}\n\t}\n\n\tconst response = await fetch(addToCartURL, {\n\t\tmethod: 'POST',\n\t\theaders: {Accept: 'application/json'},\n\t\tbody: formData,\n\t});\n\n\tif (!response.ok) {\n\t\treturn false;\n\t}\n\n\treturn true;\n}\n\nexport {\n\taddProductToCart,\n};\n","import {getLocaleText} from './translation';\n\ntype IPeachPayCountries = Record<string, {name: string}>;\n\nexport function getCountryName(countryCode: string): string {\n\tif (!peachpayCountries[countryCode]) {\n\t\treturn 'Unknown Country Code: ' + countryCode;\n\t}\n\n\treturn peachpayCountries?.[countryCode]?.name ?? 'Unknown Country Code: ' + countryCode;\n}\n\n/**\n * Gets the translated text for the default select list option or placeholder message based on the country\n */\nexport function stateProvinceOrCounty(countryCode: string): [string, string | null] {\n\tswitch (countryCode) {\n\t\tcase 'US':\n\t\tcase 'MY':\n\t\tcase 'AU':\n\t\t\treturn [getLocaleText('Select a state'), getLocaleText('State')];\n\t\tcase 'GB':\n\t\t\treturn [getLocaleText('County'), null];\n\t\tdefault:\n\t\t\treturn [getLocaleText('Select a province'), getLocaleText('Province')];\n\t}\n}\n\n/**\n * Checks if the country is part of the European Union\n */\nexport function isEUCountry(countryCode: string): boolean {\n\tconst EUCountries: string[] = ['AT', 'BE', 'BG', 'CY', 'CZ', 'DK', 'EE', 'FI', 'FR', 'DE', 'GR', 'HU', 'IE', 'IT', 'LV', 'LT', 'LU', 'MT', 'NL', 'PL', 'PT', 'RO', 'SK', 'SI', 'ES', 'SE'];\n\n\tif (EUCountries.includes(countryCode)) {\n\t\treturn true;\n\t}\n\n\treturn false;\n}\n\nconst peachpayCountries: IPeachPayCountries = {\n\tAF: {name: 'Afghanistan'},\n\tAX: {name: 'Åland Islands'},\n\tAL: {name: 'Albania'},\n\tDZ: {name: 'Algeria'},\n\tAS: {name: 'American Samoa'},\n\tAD: {name: 'Andorra'},\n\tAO: {name: 'Angola'},\n\tAI: {name: 'Anguilla'},\n\tAQ: {name: 'Antarctica'},\n\tAG: {name: 'Antigua and Barbuda'},\n\tAR: {name: 'Argentina'},\n\tAM: {name: 'Armenia'},\n\tAW: {name: 'Aruba'},\n\tAU: {name: 'Australia'},\n\tAT: {name: 'Austria'},\n\tAZ: {name: 'Azerbaijan'},\n\tBS: {name: 'Bahamas'},\n\tBH: {name: 'Bahrain'},\n\tBD: {name: 'Bangladesh'},\n\tBB: {name: 'Barbados'},\n\tBY: {name: 'Belarus'},\n\tBE: {name: 'Belgium'},\n\tBZ: {name: 'Belize'},\n\tBJ: {name: 'Benin'},\n\tBM: {name: 'Bermuda'},\n\tBT: {name: 'Bhutan'},\n\tBO: {name: 'Bolivia, Plurinational State of'},\n\tBQ: {name: 'Bonaire, Sint Eustatius and Saba'},\n\tBA: {name: 'Bosnia and Herzegovina'},\n\tBW: {name: 'Botswana'},\n\tBV: {name: 'Bouvet Island'},\n\tBR: {name: 'Brazil'},\n\tIO: {name: 'British Indian Ocean Territory'},\n\tBN: {name: 'Brunei Darussalam'},\n\tBG: {name: 'Bulgaria'},\n\tBF: {name: 'Burkina Faso'},\n\tBI: {name: 'Burundi'},\n\tKH: {name: 'Cambodia'},\n\tCM: {name: 'Cameroon'},\n\tCA: {name: 'Canada'},\n\tCV: {name: 'Cape Verde'},\n\tKY: {name: 'Cayman Islands'},\n\tCF: {name: 'Central African Republic'},\n\tTD: {name: 'Chad'},\n\tCL: {name: 'Chile'},\n\tCN: {name: 'China'},\n\tCX: {name: 'Christmas Island'},\n\tCC: {name: 'Cocos (Keeling) Islands'},\n\tCO: {name: 'Colombia'},\n\tKM: {name: 'Comoros'},\n\tCG: {name: 'Congo'},\n\tCD: {name: 'Congo, the Democratic Republic of the'},\n\tCK: {name: 'Cook Islands'},\n\tCR: {name: 'Costa Rica'},\n\tCI: {name: 'Côte d\\'Ivoire'},\n\tHR: {name: 'Croatia'},\n\tCU: {name: 'Cuba'},\n\tCW: {name: 'Curaçao'},\n\tCY: {name: 'Cyprus'},\n\tCZ: {name: 'Czech Republic'},\n\tDK: {name: 'Denmark'},\n\tDJ: {name: 'Djibouti'},\n\tDM: {name: 'Dominica'},\n\tDO: {name: 'Dominican Republic'},\n\tEC: {name: 'Ecuador'},\n\tEG: {name: 'Egypt'},\n\tSV: {name: 'El Salvador'},\n\tGQ: {name: 'Equatorial Guinea'},\n\tER: {name: 'Eritrea'},\n\tEE: {name: 'Estonia'},\n\tET: {name: 'Ethiopia'},\n\tFK: {name: 'Falkland Islands (Malvinas)'},\n\tFO: {name: 'Faroe Islands'},\n\tFJ: {name: 'Fiji'},\n\tFI: {name: 'Finland'},\n\tFR: {name: 'France'},\n\tGF: {name: 'French Guiana'},\n\tPF: {name: 'French Polynesia'},\n\tTF: {name: 'French Southern Territories'},\n\tGA: {name: 'Gabon'},\n\tGM: {name: 'Gambia'},\n\tGE: {name: 'Georgia'},\n\tDE: {name: 'Germany'},\n\tGH: {name: 'Ghana'},\n\tGI: {name: 'Gibraltar'},\n\tGR: {name: 'Greece'},\n\tGL: {name: 'Greenland'},\n\tGD: {name: 'Grenada'},\n\tGP: {name: 'Guadeloupe'},\n\tGU: {name: 'Guam'},\n\tGT: {name: 'Guatemala'},\n\tGG: {name: 'Guernsey'},\n\tGN: {name: 'Guinea'},\n\tGW: {name: 'Guinea-Bissau'},\n\tGY: {name: 'Guyana'},\n\tHT: {name: 'Haiti'},\n\tHM: {name: 'Heard Island and McDonald Islands'},\n\tVA: {name: 'Holy See (Vatican City State)'},\n\tHN: {name: 'Honduras'},\n\tHK: {name: 'Hong Kong'},\n\tHU: {name: 'Hungary'},\n\tIS: {name: 'Iceland'},\n\tIN: {name: 'India'},\n\tID: {name: 'Indonesia'},\n\tIR: {name: 'Iran, Islamic Republic of'},\n\tIQ: {name: 'Iraq'},\n\tIE: {name: 'Ireland'},\n\tIM: {name: 'Isle of Man'},\n\tIL: {name: 'Israel'},\n\tIT: {name: 'Italy'},\n\tJM: {name: 'Jamaica'},\n\tJP: {name: 'Japan'},\n\tJE: {name: 'Jersey'},\n\tJO: {name: 'Jordan'},\n\tKZ: {name: 'Kazakhstan'},\n\tKE: {name: 'Kenya'},\n\tKI: {name: 'Kiribati'},\n\tKP: {name: 'Korea Democratic People\\'s Republic of'},\n\tKR: {name: 'Korea Republic of'},\n\tKW: {name: 'Kuwait'},\n\tKG: {name: 'Kyrgyzstan'},\n\tLA: {name: 'Lao People\\'s Democratic Republic'},\n\tLV: {name: 'Latvia'},\n\tLB: {name: 'Lebanon'},\n\tLS: {name: 'Lesotho'},\n\tLR: {name: 'Liberia'},\n\tLY: {name: 'Libya'},\n\tLI: {name: 'Liechtenstein'},\n\tLT: {name: 'Lithuania'},\n\tLU: {name: 'Luxembourg'},\n\tMO: {name: 'Macao'},\n\tMK: {name: 'Macedonia, the former Yugoslav Republic of'},\n\tMG: {name: 'Madagascar'},\n\tMW: {name: 'Malawi'},\n\tMY: {name: 'Malaysia'},\n\tMV: {name: 'Maldives'},\n\tML: {name: 'Mali'},\n\tMT: {name: 'Malta'},\n\tMH: {name: 'Marshall Islands'},\n\tMQ: {name: 'Martinique'},\n\tMR: {name: 'Mauritania'},\n\tMU: {name: 'Mauritius'},\n\tYT: {name: 'Mayotte'},\n\tMX: {name: 'Mexico'},\n\tFM: {name: 'Micronesia, Federated States of'},\n\tMD: {name: 'Moldova, Republic of'},\n\tMC: {name: 'Monaco'},\n\tMN: {name: 'Mongolia'},\n\tME: {name: 'Montenegro'},\n\tMS: {name: 'Montserrat'},\n\tMA: {name: 'Morocco'},\n\tMZ: {name: 'Mozambique'},\n\tMM: {name: 'Myanmar'},\n\tNA: {name: 'Namibia'},\n\tNR: {name: 'Nauru'},\n\tNP: {name: 'Nepal'},\n\tNL: {name: 'Netherlands'},\n\tNC: {name: 'New Caledonia'},\n\tNZ: {name: 'New Zealand'},\n\tNI: {name: 'Nicaragua'},\n\tNE: {name: 'Niger'},\n\tNG: {name: 'Nigeria'},\n\tNU: {name: 'Niue'},\n\tNF: {name: 'Norfolk Island'},\n\tMP: {name: 'Northern Mariana Islands'},\n\tNO: {name: 'Norway'},\n\tOM: {name: 'Oman'},\n\tPK: {name: 'Pakistan'},\n\tPW: {name: 'Palau'},\n\tPS: {name: 'Palestinian Territory'},\n\tPA: {name: 'Panama'},\n\tPG: {name: 'Papua New Guinea'},\n\tPY: {name: 'Paraguay'},\n\tPE: {name: 'Peru'},\n\tPH: {name: 'Philippines'},\n\tPN: {name: 'Pitcairn'},\n\tPL: {name: 'Poland'},\n\tPT: {name: 'Portugal'},\n\tPR: {name: 'Puerto Rico'},\n\tQA: {name: 'Qatar'},\n\tRE: {name: 'Réunion'},\n\tRO: {name: 'Romania'},\n\tRU: {name: 'Russian Federation'},\n\tRW: {name: 'Rwanda'},\n\tBL: {name: 'Saint Barthélemy'},\n\tSH: {name: 'Saint Helena, Ascension and Tristan da Cunha'},\n\tKN: {name: 'Saint Kitts and Nevis'},\n\tLC: {name: 'Saint Lucia'},\n\tMF: {name: 'Saint Martin (French part)'},\n\tPM: {name: 'Saint Pierre and Miquelon'},\n\tVC: {name: 'Saint Vincent and the Grenadines'},\n\tWS: {name: 'Samoa'},\n\tSM: {name: 'San Marino'},\n\tST: {name: 'Sao Tome and Principe'},\n\tSA: {name: 'Saudi Arabia'},\n\tSN: {name: 'Senegal'},\n\tRS: {name: 'Serbia'},\n\tSC: {name: 'Seychelles'},\n\tSL: {name: 'Sierra Leone'},\n\tSG: {name: 'Singapore'},\n\tSX: {name: 'Sint Maarten (Dutch part)'},\n\tSK: {name: 'Slovakia'},\n\tSI: {name: 'Slovenia'},\n\tSB: {name: 'Solomon Islands'},\n\tSO: {name: 'Somalia'},\n\tZA: {name: 'South Africa'},\n\tGS: {name: 'South Georgia and the South Sandwich Islands'},\n\tSS: {name: 'South Sudan'},\n\tES: {name: 'Spain'},\n\tLK: {name: 'Sri Lanka'},\n\tSD: {name: 'Sudan'},\n\tSR: {name: 'Suriname'},\n\tSJ: {name: 'Svalbard and Jan Mayen'},\n\tSZ: {name: 'Swaziland'},\n\tSE: {name: 'Sweden'},\n\tCH: {name: 'Switzerland'},\n\tSY: {name: 'Syrian Arab Republic'},\n\tTW: {name: 'Taiwan'},\n\tTJ: {name: 'Tajikistan'},\n\tTZ: {name: 'Tanzania United Republic of'},\n\tTH: {name: 'Thailand'},\n\tTL: {name: 'Timor-Leste'},\n\tTG: {name: 'Togo'},\n\tTK: {name: 'Tokelau'},\n\tTO: {name: 'Tonga'},\n\tTT: {name: 'Trinidad and Tobago'},\n\tTN: {name: 'Tunisia'},\n\tTR: {name: 'Turkey'},\n\tTM: {name: 'Turkmenistan'},\n\tTC: {name: 'Turks and Caicos Islands'},\n\tTV: {name: 'Tuvalu'},\n\tUG: {name: 'Uganda'},\n\tUA: {name: 'Ukraine'},\n\tAE: {name: 'United Arab Emirates'},\n\tGB: {name: 'United Kingdom'},\n\tUS: {name: 'United States'},\n\tUM: {name: 'United States Minor Outlying Islands'},\n\tUY: {name: 'Uruguay'},\n\tUZ: {name: 'Uzbekistan'},\n\tVU: {name: 'Vanuatu'},\n\tVE: {name: 'Venezuela, Bolivarian Republic of'},\n\tVN: {name: 'Vietnam'},\n\tVG: {name: 'Virgin Islands'},\n\tVI: {name: 'Virgin Islands, U.S'},\n\tWF: {name: 'Wallis and Futuna'},\n\tEH: {name: 'Western Sahara'},\n\tYE: {name: 'Yemen'},\n\tZM: {name: 'Zambia'},\n\tZW: {name: 'Zimbabwe'},\n};\n","import {MerchantConfiguration} from '../reducers/merchantConfigurationReducer';\n\n/**\n * Creates a formatted string that includes the beginning and end\n * currency symbols along with any needed decimal and thousands\n * separator symbols.\n *\n * @example // Example assuming USD currency context:\n *  formatCurrencyString(\"5\")   // returns \"$5.00\"\n *  formatCurrencyString(\"3.7\") // returns \"$3.70\"\n */\nexport function formatCurrencyString(cost: number) {\n\tconst {symbol, position} = MerchantConfiguration.currency.configuration();\n\n\tif (typeof cost !== 'number') {\n\t\tcost = 0;\n\t}\n\n\tlet formattedCurrency = '';\n\tif (position === 'left' || position === 'left_space') {\n\t\tlet negSymbol = '';\n\t\tlet formattedCost = formatCostString(cost);\n\t\tif (cost < 0) {\n\t\t\tnegSymbol = '−';\n\t\t\tformattedCost = formatCostString(Math.abs(cost));\n\t\t}\n\n\t\tformattedCurrency = `${negSymbol}${symbol}${position === 'left_space' ? ' ' : ''}${formattedCost}`;\n\t} else {\n\t\tformattedCurrency = `${formatCostString(cost)}${position === 'right_space' ? ' ' : ''}${symbol}`;\n\t}\n\n\treturn formattedCurrency;\n}\n/**\n * Creates a formatted string that includes the decimal and\n * thousands separator symbols to fixed decimal length.\n *\n * @example // Example assuming USD currency context:\n *  formatCostString(\"5\")   // returns \"5.00\"\n *  formatCostString(\"3.7\") // returns \"3.70\"\n */\n\n// eslint-disable-next-line complexity\nexport function formatCostString(cost: number): string {\n\tconst {code, thousands_separator: thousandsSeparator, decimal_separator: decimalSeparator, rounding, number_of_decimals: decimals} = MerchantConfiguration.currency.configuration();\n\n\tif (typeof cost !== 'number') {\n\t\tcost = 0;\n\t}\n\n\tif (code === 'JPY' || code === 'HUF') {\n\t\treturn cost.toString();\n\t}\n\n\t// We would prefer to always default to 2 decimal points event if the store sets decimal point to 0\n\tconst numberOfDecimals = decimals || 2;\n\n\tswitch (rounding) {\n\t\tcase 'up':\n\t\t\tswitch (numberOfDecimals) {\n\t\t\t\tcase 0:\n\t\t\t\t\tcost = Math.ceil(cost);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 1:\n\t\t\t\t\tcost = Math.ceil(cost * 10) / 10;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 2:\n\t\t\t\t\tcost = Math.ceil(cost * 100) / 100;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 3:\n\t\t\t\t\tcost = Math.ceil(cost * 1000) / 1000;\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tcost = Math.ceil(cost);\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tbreak;\n\t\tcase 'down':\n\t\t\tswitch (numberOfDecimals) {\n\t\t\t\tcase 0:\n\t\t\t\t\tcost = Math.floor(cost);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 1:\n\t\t\t\t\tcost = Math.floor(cost * 10) / 10;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 2:\n\t\t\t\t\tcost = Math.floor(cost * 100) / 100;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 3:\n\t\t\t\t\tcost = Math.floor(cost * 1000) / 1000;\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tcost = Math.floor(cost);\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tbreak;\n\t\tcase 'nearest':\n\t\t\t// In the future support may need added for rounding to a specific 0.50, 0.10 type situation. That would go here.\n\t\t\tswitch (numberOfDecimals) {\n\t\t\t\tcase 0:\n\t\t\t\t\tcost = Math.round(cost);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 1:\n\t\t\t\t\tcost = Math.round(cost * 10) / 10;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 2:\n\t\t\t\t\tcost = Math.round(cost * 100) / 100;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 3:\n\t\t\t\t\tcost = Math.round(cost * 1000) / 1000;\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tcost = Math.round(cost);\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\n\t// This is to make sure if rounding is disabled and decimals are set to zero that the decimals are cut off because when\n\t// decimal length is zero we actually render 3 decimal points.\n\tcost = Number.parseFloat(cost.toFixed(decimals));\n\n\tlet formattedPrice = '';\n\ttry {\n\t\tconst currencySplit = cost.toFixed(numberOfDecimals).split('.');\n\t\tlet dollarAmount = currencySplit[0];\n\t\tconst centsAmount = currencySplit[1] ?? '';\n\n\t\t// We reverse the string because we want to chunk numbers from back of  the string and not front. Eases the operation of chunking.\n\t\tconst rev = currencySplit?.[0]?.split('').reverse().join('') ?? '';\n\t\tconst revFormat = rev.match(/.{1,3}/g)?.join(thousandsSeparator) ?? '';\n\t\tdollarAmount = revFormat.split('').reverse().join('');\n\t\tformattedPrice += dollarAmount;\n\t\tif (centsAmount !== '') {\n\t\t\tformattedPrice += decimalSeparator + centsAmount;\n\t\t}\n\n\t\treturn formattedPrice;\n\t} catch {\n\t\treturn cost.toFixed(decimals);\n\t}\n}\n","/**\n * Indicates the environment that checkout window is in.\n */\nexport function isDevEnvironment(baseUrl: string): boolean {\n\treturn baseUrl === 'https://dev.peachpay.app/'\n\t\t|| baseUrl === 'https://dev.peachpay.local/'\n\t\t|| baseUrl === 'https://prod.peachpay.local/';\n}\n\n/**\n * Gets the base url for the PeachPay API server.\n */\n\nexport function getBaseURL(merchantHostname: string, isTestMode: boolean): string {\n\tconst address = new URL('https://' + merchantHostname);\n\tmerchantHostname = address.host + (address.pathname === '/' ? '' : address.pathname);\n\tif (isTestMode) {\n\t\tswitch (merchantHostname) {\n\t\t\tcase 'store.local':\n\t\t\tcase 'woo.store.local':\n\t\t\t\treturn 'https://dev.peachpay.local/';\n\t\t\tdefault:\n\t\t\t\treturn 'https://dev.peachpay.app/';\n\t\t}\n\t}\n\n\tswitch (merchantHostname) {\n\t\tcase 'localhost':\n\t\tcase '127.0.0.1':\n\t\tcase 'woo.peachpay.app':\n\t\tcase 'theme1.peachpay.app':\n\t\tcase 'theme2.peachpay.app':\n\t\tcase 'theme3.peachpay.app':\n\t\tcase 'theme4.peachpay.app':\n\t\tcase 'theme5.peachpay.app':\n\t\tcase 'qa.peachpay.app':\n\t\tcase 'demo.peachpay.app':\n\t\tcase 'ui-test.peachpay.app':\n\t\t\treturn 'https://dev.peachpay.app/';\n\t\tcase 'store.local':\n\t\tcase 'woo.store.local':\n\t\t\treturn 'https://prod.peachpay.local/';\n\t\tdefault:\n\t\t\treturn 'https://prod.peachpay.app/';\n\t}\n}\n\nexport function getOneClickURL(merchantHostname: string, isTestMode: boolean): string {\n\tif (isTestMode) {\n\t\tswitch (merchantHostname) {\n\t\t\tcase 'store.local':\n\t\t\tcase 'woo.store.local':\n\t\t\t\treturn 'https://dev-connect.peachpay.local/';\n\t\t\tdefault:\n\t\t\t\treturn 'https://dev-connect-v2.peachpaycheckout.com/';\n\t\t}\n\t}\n\n\tswitch (merchantHostname) {\n\t\tcase 'localhost':\n\t\tcase '127.0.0.1':\n\t\tcase 'woo.peachpay.app':\n\t\tcase 'theme1.peachpay.app':\n\t\tcase 'theme2.peachpay.app':\n\t\tcase 'theme3.peachpay.app':\n\t\tcase 'theme4.peachpay.app':\n\t\tcase 'theme5.peachpay.app':\n\t\tcase 'qa.peachpay.app':\n\t\tcase 'demo.peachpay.app':\n\t\tcase 'ui-test.peachpay.app':\n\t\t\treturn 'https://dev-connect-v2.peachpaycheckout.com/';\n\t\tcase 'store.local':\n\t\tcase 'woo.store.local':\n\t\t\treturn 'https://connect.peachpay.local/';\n\t\tdefault:\n\t\t\treturn 'https://connect-v2.peachpaycheckout.com/';\n\t}\n}\n\nexport function determinePageType(isCartPage: boolean, isCheckoutPage: boolean, isShopPage: boolean): 'product' | 'cart' | 'checkout' | 'shop' {\n\tif (isCartPage) {\n\t\treturn 'cart';\n\t}\n\n\tif (isCheckoutPage) {\n\t\treturn 'checkout';\n\t}\n\n\tif (isShopPage) {\n\t\treturn 'shop';\n\t}\n\n\treturn 'product';\n}\n","import {GLOBAL} from '../deprecated/global';\nimport {type WCFieldsData} from '../../../@type/woocommerce/field-data';\nimport {type WCFieldInfo} from '../../../@type/woocommerce/location-info';\nimport {PeachPayCustomer} from '../reducers/peachPayCustomerReducer';\n\n/**\n * This is a helper function because it is a pain with typescript to\n * deal with the \"FormDataEntryValue\" type\n */\nexport function formEntry<T extends string>(formData: FormData, key: string): T | string {\n\tif (formData.get(key) === null) {\n\t\treturn '';\n\t}\n\n\treturn formData.get(key) as unknown as T ?? '';\n}\n\nexport function cleanFormFields(formInfoRecord: Record<string, string>): void {\n\t// eslint-disable-next-line guard-for-in\n\tfor (const field in formInfoRecord) {\n\t\tconst additionalFields = Object.entries(GLOBAL.phpData?.additional_fields ?? {}).map(([_, value]) => value);\n\t\tif (additionalFields.find(f => f.field_name === field) && formInfoRecord[field]) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tconst billingFields = Object.entries(GLOBAL.phpData?.billing_fields ?? {}).map(([_, value]) => value);\n\t\tif (billingFields.find(f => f.field_name === field) && formInfoRecord[field]) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tconst shippingFields = Object.entries(GLOBAL.phpData?.shipping_fields ?? {}).map(([_, value]) => value);\n\t\tif (shippingFields.find(f => f.field_name === field) && formInfoRecord[field]) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (isDefaultField(field, 'shipping') || isDefaultField(field, 'billing')) {\n\t\t\tformInfoRecord[field] = '';\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (formInfoRecord[field]) {\n\t\t\tcontinue;\n\t\t} else {\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-dynamic-delete\n\t\t\tdelete formInfoRecord[field];\n\t\t}\n\t}\n}\n\nexport function isDefaultField(name: string, section: string): boolean {\n\tconst defaultFieldNames: string[] = [\n\t\tsection + '_email',\n\t\tsection + '_phone',\n\t\tsection + '_first_name',\n\t\tsection + '_last_name',\n\t\tsection + '_company',\n\t\tsection + '_address_1',\n\t\tsection + '_address_2',\n\t\tsection + '_postcode',\n\t\tsection + '_city',\n\t\tsection + '_state',\n\t\tsection + '_country',\n\t];\n\treturn defaultFieldNames.includes(name);\n}\n\n/**\n * A helper method that returns the target field required requirements.\n * @param name field name target\n * @param fieldData The peachpay field data that contians all of the field data.\n * @param fieldInfo The field info rules that is from woocommerce.\n * @returns True if the target field is required, false otherwise.\n */\nexport function isRequiredField(name: string, fieldData: WCFieldsData[], fieldInfo?: WCFieldInfo): boolean {\n\tlet fieldDataInfo = false;\n\t// eslint-disable-next-line @typescript-eslint/no-for-in-array\n\tfor (const orderNumber in fieldData) {\n\t\tif (name === fieldData[orderNumber]?.field_name) {\n\t\t\tfieldDataInfo = Boolean(fieldData[orderNumber]?.field_required);\n\t\t}\n\t}\n\n\tlet countryLocaleRule = true;\n\tif (fieldInfo) {\n\t\tif (fieldInfo.required === undefined) {\n\t\t\tcountryLocaleRule = true;\n\t\t} else {\n\t\t\tcountryLocaleRule = fieldInfo?.required;\n\t\t}\n\t}\n\n\t/**\n\t * Field editor data || WC country locale rule.\n\t * \t\ttrue\t\t\tfalse\t\t\t= false\n\t * \t\ttrue \t\t\ttrue\t\t\t= true\n\t * \t\tfalse\t\t\ttrue \t\t\t= false\n\t * \t\tfalse\t\t\tfalse\t\t\t= false\n\t */\n\treturn fieldDataInfo && countryLocaleRule;\n}\n\n/**\n * A helper method that returns the target field required requirements.\n * @param name field name target\n * @param fieldData The peachpay field data that contians all of the field data.\n * @param fieldInfo The field info rules that is from woocommerce.\n * @returns True if the target field is enable, false otherwise.\n */\nexport function isEnabledField(name: string, fieldData: WCFieldsData[], fieldInfo?: WCFieldInfo): boolean {\n\tlet fieldDataInfo = false;\n\t// eslint-disable-next-line @typescript-eslint/no-for-in-array\n\tfor (const orderNumber in fieldData) {\n\t\tif (name === fieldData[orderNumber]?.field_name) {\n\t\t\tfieldDataInfo = Boolean(fieldData[orderNumber]?.field_enable);\n\t\t}\n\t}\n\n\tlet countryLocaleRuleNotHidden = true;\n\tif (fieldInfo) {\n\t\tif (fieldInfo.hidden === undefined) {\n\t\t\tcountryLocaleRuleNotHidden = true;\n\t\t} else {\n\t\t\tcountryLocaleRuleNotHidden = !fieldInfo?.hidden;\n\t\t}\n\t}\n\n\t/**\n\t * Field editor data && WC country locale hidden rule.\n\t * \t\ttrue \t\t\ttrue\t\t\t= false\n\t * \t\ttrue\t\t\tfalse\t\t\t= true\n\t * \t\tfalse\t\t\ttrue \t\t\t= false\n\t * \t\tfalse\t\t\tfalse\t\t\t= false\n\t */\n\treturn fieldDataInfo && countryLocaleRuleNotHidden;\n}\n\n// eslint-disable-next-line complexity\nexport function isShortAddressEmpty(section: string): boolean {\n\tconst defaultShortAddress: string[] = [\n\t\tsection + '_postcode',\n\t\tsection + '_city',\n\t\tsection + '_state',\n\t\tsection + '_country',\n\t];\n\n\tconst info = (section === 'billing') ? PeachPayCustomer.billing : PeachPayCustomer.shipping;\n\tconst fields = (section === 'billing') ? GLOBAL.phpData?.billing_fields : GLOBAL.phpData?.shipping_fields;\n\tconst fieldPostalCodeInfo = GLOBAL.phpData?.wc_location_info?.country_locale_data[info.country()]?.['postcode'];\n\tconst fieldCityInfo = GLOBAL.phpData?.wc_location_info?.country_locale_data[info.country()]?.['city'];\n\tconst fieldStateInfo = GLOBAL.phpData?.wc_location_info?.country_locale_data[info.country()]?.['state'];\n\n\tconst shippingPostalCode = PeachPayCustomer.shipping.postal();\n\tconst shippingCity = PeachPayCustomer.shipping.city();\n\tconst shippingState = PeachPayCustomer.shipping.state();\n\tconst shippingCountry = PeachPayCustomer.shipping.country();\n\n\tif (defaultShortAddress[0] && shippingPostalCode === '' && isEnabledField(defaultShortAddress[0], fields ?? [], fieldPostalCodeInfo) && isRequiredField(defaultShortAddress[0], fields ?? [], fieldPostalCodeInfo)) {\n\t\treturn true;\n\t}\n\n\tif (defaultShortAddress[1] && shippingCity === '' && isEnabledField(defaultShortAddress[1], fields ?? [], fieldCityInfo) && isRequiredField(defaultShortAddress[1], fields ?? [], fieldCityInfo)) {\n\t\treturn true;\n\t}\n\n\tif (defaultShortAddress[2] && shippingState === '' && isEnabledField(defaultShortAddress[2], fields ?? [], fieldStateInfo) && isRequiredField(defaultShortAddress[2], fields ?? [], fieldStateInfo)) {\n\t\treturn true;\n\t}\n\n\tif (defaultShortAddress[3] && shippingCountry === '' && isEnabledField(defaultShortAddress[3], fields ?? []) && isRequiredField(defaultShortAddress[3], fields ?? [])) {\n\t\treturn true;\n\t}\n\n\treturn false;\n}\n","import {type ICartMetaData} from '../../../@type/woocommerce/cart-calculation';\nimport {Environment} from '../reducers/environmentReducer';\nimport {getLocaleText} from '../util/translation';\n\n/**\n * Builds a renewing price string If a cart meta data includes subscription information.\n */\nexport function buildSubscriptionPriceMetaData(meta: ICartMetaData, short = false) {\n\tif (!meta.subscription) {\n\t\treturn '';\n\t}\n\n\t/**\n\t * Since the subscription period strings are being displayed in the modal but coming from third party plugin, we need to hardcode these strings' values\n\t * so they can be captured by the gettext parser and be given translations.\n\t */\n\tconst subscriptionPeriodStrings: Record<string, string> = {\n\t\tday: getLocaleText('day'),\n\t\tweek: getLocaleText('week'),\n\t\tmonth: getLocaleText('month'),\n\t\tyear: getLocaleText('year'),\n\t};\n\n\tconst subscriptionPeriod = subscriptionPeriodStrings[meta.subscription.period] ?? meta.subscription.period;\n\n\tif (Number.parseInt(String(meta.subscription.period_interval)) === 1) {\n\t\treturn ` / ${subscriptionPeriod}`;\n\t}\n\n\tif (short) {\n\t\treturn ` every ${meta.subscription.period_interval} ${subscriptionPeriod}s`;\n\t}\n\n\treturn ` every ${meta.subscription.period_interval} ${subscriptionPeriod}s for ${meta.subscription.length} ${subscriptionPeriod}s`;\n}\n\n/**\n * Formats a date string into a subscription first renewal string.\n */\nexport function buildSubscriptionFirstRenewalString(meta: ICartMetaData) {\n\tif (!meta.subscription?.first_renewal) {\n\t\treturn '';\n\t}\n\n\tconst date = new Date(meta.subscription.first_renewal);\n\tconst options: Intl.DateTimeFormatOptions = {\n\t\tyear: 'numeric', // Ex: 2021\n\t\tmonth: 'long', // Ex: July\n\t\tday: 'numeric', // Ex: 12\n\t};\n\n\treturn `${getLocaleText('First renewal')}: ${date.toLocaleString(Environment.language(), options)}`;\n}\n","import {Environment} from '../reducers/environmentReducer';\n\n/**\n * If the environment language is English or the key is not found,\n * the key is returned. Otherwise, the key's translation\n * in the environment language is returned.\n */\nexport function getLocaleText(key: string): string {\n\tconst translatedModalTerms = Environment.translated_modal_terms();\n\n\t// eslint-disable-next-line @typescript-eslint/prefer-nullish-coalescing\n\treturn translatedModalTerms?.[key] || key;\n}\n","import {$qsAll, $qs} from '../../../@shared/ts/dom';\nimport {type IDictionary} from '../../../@type/dictionary';\n\n/**\n * Clears a input of a given query selector\n */\nexport function clearInput(selector: string): void {\n\tfor (const $element of $qsAll<HTMLInputElement>(selector)) {\n\t\t$element.value = '';\n\t}\n}\n\n/**\n * Generates a dropdown html select list from an array of strings as the select data\n */\nexport function renderDropDownList(data: IDictionary, defaultOption = ''): string {\n\tif (!data) {\n\t\tdata = {};\n\t}\n\n\tconst list = Object.entries(data).map(([key, value]) => `<option value=\"${key}\"> ${value} </option>`);\n\n\tif (defaultOption) {\n\t\treturn `<option hidden disabled selected value=\"\">${defaultOption}</option>${list.join('')}`;\n\t}\n\n\treturn list.join('');\n}\n\n/**\n * Generates a dropdown html select list for currencies since the default should not be the printed value it should be the selected value\n */\nexport function renderCurrencyList(data: IDictionary, defaultOption = ''): string {\n\tif (!data) {\n\t\tdata = {};\n\t}\n\n\tconst list = Object.entries(data).map(([key, value]) => `<option value=\"${key}\" ${(key === defaultOption) ? 'selected' : ''}> ${value} </option>`);\n\n\treturn list.join('');\n}\n\n/**\n * Selects a HTML select list value or if the value does not exist defaults to the default option.\n */\nexport function selectDropdown($select: HTMLSelectElement | null, value: string): void {\n\tif (!$select) {\n\t\treturn;\n\t}\n\n\t$select.value = value;\n}\n\n/**\n * Scrolls the linked products list to the right when user press the next button\n */\nexport function scrollRight(related: string) {\n\t$qs('.pp-prev-btn' + related)?.classList.remove('scroll-end');\n\t$qs('#pp-products-list' + related, $element => {\n\t\t$element.scrollLeft += parseInt(`${related.length === 0 ? '260' : '168'}`, 10);\n\t});\n}\n\n/**\n * Scrolls the linked products list to the left when user press the previous button\n */\nexport function scrollLeft(related: string) {\n\t$qs('.pp-next-btn' + related)?.classList.remove('scroll-end');\n\t$qs('#pp-products-list' + related, $element => {\n\t\t$element.scrollLeft -= parseInt(`${related.length === 0 ? '260' : '168'}`, 10);\n\t});\n}\n\n/**\n * Applies css selector (scroll-end) to the two buttons when user uses the scrollbar to scroll through the linked product list\n */\nexport function scrollAdjuster(related: string) {\n\tconst scrollEnd = $qs('#pp-products-list' + related)?.scrollLeft ? $qs('#pp-products-list' + related)?.scrollLeft : 1;\n\tconst offset = $qs('#pp-products-list' + related)?.offsetWidth;\n\tconst scrollWidth = $qs('#pp-products-list' + related)?.scrollWidth;\n\n\tif ($qs('#pp-products-list' + related)?.scrollLeft === 0) {\n\t\t$qs('.pp-prev-btn' + related)?.classList.add('scroll-end');\n\t\t$qs('.pp-next-btn' + related)?.classList.remove('scroll-end');\n\t} else if ((scrollEnd && scrollWidth && offset) && (scrollEnd + 1 >= (scrollWidth - offset))) {\n\t\t$qs('.pp-next-btn' + related)?.classList.add('scroll-end');\n\t\t$qs('.pp-prev-btn' + related)?.classList.remove('scroll-end');\n\t} else {\n\t\t$qs('.pp-next-btn' + related)?.classList.remove('scroll-end');\n\t\t$qs('.pp-prev-btn' + related)?.classList.remove('scroll-end');\n\t}\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.f = {};\n// This file contains only the entry chunk.\n// The chunk loading function for additional chunks\n__webpack_require__.e = (chunkId) => {\n\treturn Promise.all(Object.keys(__webpack_require__.f).reduce((promises, key) => {\n\t\t__webpack_require__.f[key](chunkId, promises);\n\t\treturn promises;\n\t}, []));\n};","// This function allow to reference async chunks\n__webpack_require__.u = (chunkId) => {\n\t// return url for filenames based on template\n\treturn \"\" + chunkId + \"-\" + {\"26\":\"b055000a73243f11e611\",\"272\":\"53f779b624216fbf4f22\",\"475\":\"6eaca1f4508c94bc0476\",\"477\":\"49b7840d59d54b88aebe\",\"856\":\"7022fc88fdcdac4be264\",\"938\":\"66d3be74e31b2be18880\"}[chunkId] + \".js\";\n};","// This function allow to reference async chunks\n__webpack_require__.miniCssF = (chunkId) => {\n\t// return url for filenames based on template\n\treturn undefined;\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","__webpack_require__.p = \"\";","// no baseURI\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t574: 0\n};\n\n__webpack_require__.f.j = (chunkId, promises) => {\n\t\t// JSONP chunk loading for javascript\n\t\tvar installedChunkData = __webpack_require__.o(installedChunks, chunkId) ? installedChunks[chunkId] : undefined;\n\t\tif(installedChunkData !== 0) { // 0 means \"already installed\".\n\n\t\t\t// a Promise means \"currently loading\".\n\t\t\tif(installedChunkData) {\n\t\t\t\tpromises.push(installedChunkData[2]);\n\t\t\t} else {\n\t\t\t\tif(true) { // all chunks have JS\n\t\t\t\t\t// setup Promise in chunk cache\n\t\t\t\t\tvar promise = new Promise((resolve, reject) => (installedChunkData = installedChunks[chunkId] = [resolve, reject]));\n\t\t\t\t\tpromises.push(installedChunkData[2] = promise);\n\n\t\t\t\t\t// start chunk loading\n\t\t\t\t\tvar url = __webpack_require__.p + __webpack_require__.u(chunkId);\n\t\t\t\t\t// create error before stack unwound to get useful stacktrace later\n\t\t\t\t\tvar error = new Error();\n\t\t\t\t\tvar loadingEnded = (event) => {\n\t\t\t\t\t\tif(__webpack_require__.o(installedChunks, chunkId)) {\n\t\t\t\t\t\t\tinstalledChunkData = installedChunks[chunkId];\n\t\t\t\t\t\t\tif(installedChunkData !== 0) installedChunks[chunkId] = undefined;\n\t\t\t\t\t\t\tif(installedChunkData) {\n\t\t\t\t\t\t\t\tvar errorType = event && (event.type === 'load' ? 'missing' : event.type);\n\t\t\t\t\t\t\t\tvar realSrc = event && event.target && event.target.src;\n\t\t\t\t\t\t\t\terror.message = 'Loading chunk ' + chunkId + ' failed.\\n(' + errorType + ': ' + realSrc + ')';\n\t\t\t\t\t\t\t\terror.name = 'ChunkLoadError';\n\t\t\t\t\t\t\t\terror.type = errorType;\n\t\t\t\t\t\t\t\terror.request = realSrc;\n\t\t\t\t\t\t\t\tinstalledChunkData[1](error);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\t__webpack_require__.l(url, loadingEnded, \"chunk-\" + chunkId, chunkId);\n\t\t\t\t} else installedChunks[chunkId] = 0;\n\t\t\t}\n\t\t}\n};\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n// no on chunks loaded\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = (parentChunkLoadingFunction, data) => {\n\tvar [chunkIds, moreModules, runtime] = data;\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tif(chunkIds.some((id) => (installedChunks[id] !== 0))) {\n\t\tfor(moduleId in moreModules) {\n\t\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t\t}\n\t\t}\n\t\tif(runtime) var result = runtime(__webpack_require__);\n\t}\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\n}\n\nvar chunkLoadingGlobal = self[\"webpackChunkpeachpay_for_woocommerce\"] = self[\"webpackChunkpeachpay_for_woocommerce\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","var global =\n  (typeof globalThis !== 'undefined' && globalThis) ||\n  (typeof self !== 'undefined' && self) ||\n  (typeof global !== 'undefined' && global)\n\nvar support = {\n  searchParams: 'URLSearchParams' in global,\n  iterable: 'Symbol' in global && 'iterator' in Symbol,\n  blob:\n    'FileReader' in global &&\n    'Blob' in global &&\n    (function() {\n      try {\n        new Blob()\n        return true\n      } catch (e) {\n        return false\n      }\n    })(),\n  formData: 'FormData' in global,\n  arrayBuffer: 'ArrayBuffer' in global\n}\n\nfunction isDataView(obj) {\n  return obj && DataView.prototype.isPrototypeOf(obj)\n}\n\nif (support.arrayBuffer) {\n  var viewClasses = [\n    '[object Int8Array]',\n    '[object Uint8Array]',\n    '[object Uint8ClampedArray]',\n    '[object Int16Array]',\n    '[object Uint16Array]',\n    '[object Int32Array]',\n    '[object Uint32Array]',\n    '[object Float32Array]',\n    '[object Float64Array]'\n  ]\n\n  var isArrayBufferView =\n    ArrayBuffer.isView ||\n    function(obj) {\n      return obj && viewClasses.indexOf(Object.prototype.toString.call(obj)) > -1\n    }\n}\n\nfunction normalizeName(name) {\n  if (typeof name !== 'string') {\n    name = String(name)\n  }\n  if (/[^a-z0-9\\-#$%&'*+.^_`|~!]/i.test(name) || name === '') {\n    throw new TypeError('Invalid character in header field name: \"' + name + '\"')\n  }\n  return name.toLowerCase()\n}\n\nfunction normalizeValue(value) {\n  if (typeof value !== 'string') {\n    value = String(value)\n  }\n  return value\n}\n\n// Build a destructive iterator for the value list\nfunction iteratorFor(items) {\n  var iterator = {\n    next: function() {\n      var value = items.shift()\n      return {done: value === undefined, value: value}\n    }\n  }\n\n  if (support.iterable) {\n    iterator[Symbol.iterator] = function() {\n      return iterator\n    }\n  }\n\n  return iterator\n}\n\nexport function Headers(headers) {\n  this.map = {}\n\n  if (headers instanceof Headers) {\n    headers.forEach(function(value, name) {\n      this.append(name, value)\n    }, this)\n  } else if (Array.isArray(headers)) {\n    headers.forEach(function(header) {\n      this.append(header[0], header[1])\n    }, this)\n  } else if (headers) {\n    Object.getOwnPropertyNames(headers).forEach(function(name) {\n      this.append(name, headers[name])\n    }, this)\n  }\n}\n\nHeaders.prototype.append = function(name, value) {\n  name = normalizeName(name)\n  value = normalizeValue(value)\n  var oldValue = this.map[name]\n  this.map[name] = oldValue ? oldValue + ', ' + value : value\n}\n\nHeaders.prototype['delete'] = function(name) {\n  delete this.map[normalizeName(name)]\n}\n\nHeaders.prototype.get = function(name) {\n  name = normalizeName(name)\n  return this.has(name) ? this.map[name] : null\n}\n\nHeaders.prototype.has = function(name) {\n  return this.map.hasOwnProperty(normalizeName(name))\n}\n\nHeaders.prototype.set = function(name, value) {\n  this.map[normalizeName(name)] = normalizeValue(value)\n}\n\nHeaders.prototype.forEach = function(callback, thisArg) {\n  for (var name in this.map) {\n    if (this.map.hasOwnProperty(name)) {\n      callback.call(thisArg, this.map[name], name, this)\n    }\n  }\n}\n\nHeaders.prototype.keys = function() {\n  var items = []\n  this.forEach(function(value, name) {\n    items.push(name)\n  })\n  return iteratorFor(items)\n}\n\nHeaders.prototype.values = function() {\n  var items = []\n  this.forEach(function(value) {\n    items.push(value)\n  })\n  return iteratorFor(items)\n}\n\nHeaders.prototype.entries = function() {\n  var items = []\n  this.forEach(function(value, name) {\n    items.push([name, value])\n  })\n  return iteratorFor(items)\n}\n\nif (support.iterable) {\n  Headers.prototype[Symbol.iterator] = Headers.prototype.entries\n}\n\nfunction consumed(body) {\n  if (body.bodyUsed) {\n    return Promise.reject(new TypeError('Already read'))\n  }\n  body.bodyUsed = true\n}\n\nfunction fileReaderReady(reader) {\n  return new Promise(function(resolve, reject) {\n    reader.onload = function() {\n      resolve(reader.result)\n    }\n    reader.onerror = function() {\n      reject(reader.error)\n    }\n  })\n}\n\nfunction readBlobAsArrayBuffer(blob) {\n  var reader = new FileReader()\n  var promise = fileReaderReady(reader)\n  reader.readAsArrayBuffer(blob)\n  return promise\n}\n\nfunction readBlobAsText(blob) {\n  var reader = new FileReader()\n  var promise = fileReaderReady(reader)\n  reader.readAsText(blob)\n  return promise\n}\n\nfunction readArrayBufferAsText(buf) {\n  var view = new Uint8Array(buf)\n  var chars = new Array(view.length)\n\n  for (var i = 0; i < view.length; i++) {\n    chars[i] = String.fromCharCode(view[i])\n  }\n  return chars.join('')\n}\n\nfunction bufferClone(buf) {\n  if (buf.slice) {\n    return buf.slice(0)\n  } else {\n    var view = new Uint8Array(buf.byteLength)\n    view.set(new Uint8Array(buf))\n    return view.buffer\n  }\n}\n\nfunction Body() {\n  this.bodyUsed = false\n\n  this._initBody = function(body) {\n    /*\n      fetch-mock wraps the Response object in an ES6 Proxy to\n      provide useful test harness features such as flush. However, on\n      ES5 browsers without fetch or Proxy support pollyfills must be used;\n      the proxy-pollyfill is unable to proxy an attribute unless it exists\n      on the object before the Proxy is created. This change ensures\n      Response.bodyUsed exists on the instance, while maintaining the\n      semantic of setting Request.bodyUsed in the constructor before\n      _initBody is called.\n    */\n    this.bodyUsed = this.bodyUsed\n    this._bodyInit = body\n    if (!body) {\n      this._bodyText = ''\n    } else if (typeof body === 'string') {\n      this._bodyText = body\n    } else if (support.blob && Blob.prototype.isPrototypeOf(body)) {\n      this._bodyBlob = body\n    } else if (support.formData && FormData.prototype.isPrototypeOf(body)) {\n      this._bodyFormData = body\n    } else if (support.searchParams && URLSearchParams.prototype.isPrototypeOf(body)) {\n      this._bodyText = body.toString()\n    } else if (support.arrayBuffer && support.blob && isDataView(body)) {\n      this._bodyArrayBuffer = bufferClone(body.buffer)\n      // IE 10-11 can't handle a DataView body.\n      this._bodyInit = new Blob([this._bodyArrayBuffer])\n    } else if (support.arrayBuffer && (ArrayBuffer.prototype.isPrototypeOf(body) || isArrayBufferView(body))) {\n      this._bodyArrayBuffer = bufferClone(body)\n    } else {\n      this._bodyText = body = Object.prototype.toString.call(body)\n    }\n\n    if (!this.headers.get('content-type')) {\n      if (typeof body === 'string') {\n        this.headers.set('content-type', 'text/plain;charset=UTF-8')\n      } else if (this._bodyBlob && this._bodyBlob.type) {\n        this.headers.set('content-type', this._bodyBlob.type)\n      } else if (support.searchParams && URLSearchParams.prototype.isPrototypeOf(body)) {\n        this.headers.set('content-type', 'application/x-www-form-urlencoded;charset=UTF-8')\n      }\n    }\n  }\n\n  if (support.blob) {\n    this.blob = function() {\n      var rejected = consumed(this)\n      if (rejected) {\n        return rejected\n      }\n\n      if (this._bodyBlob) {\n        return Promise.resolve(this._bodyBlob)\n      } else if (this._bodyArrayBuffer) {\n        return Promise.resolve(new Blob([this._bodyArrayBuffer]))\n      } else if (this._bodyFormData) {\n        throw new Error('could not read FormData body as blob')\n      } else {\n        return Promise.resolve(new Blob([this._bodyText]))\n      }\n    }\n\n    this.arrayBuffer = function() {\n      if (this._bodyArrayBuffer) {\n        var isConsumed = consumed(this)\n        if (isConsumed) {\n          return isConsumed\n        }\n        if (ArrayBuffer.isView(this._bodyArrayBuffer)) {\n          return Promise.resolve(\n            this._bodyArrayBuffer.buffer.slice(\n              this._bodyArrayBuffer.byteOffset,\n              this._bodyArrayBuffer.byteOffset + this._bodyArrayBuffer.byteLength\n            )\n          )\n        } else {\n          return Promise.resolve(this._bodyArrayBuffer)\n        }\n      } else {\n        return this.blob().then(readBlobAsArrayBuffer)\n      }\n    }\n  }\n\n  this.text = function() {\n    var rejected = consumed(this)\n    if (rejected) {\n      return rejected\n    }\n\n    if (this._bodyBlob) {\n      return readBlobAsText(this._bodyBlob)\n    } else if (this._bodyArrayBuffer) {\n      return Promise.resolve(readArrayBufferAsText(this._bodyArrayBuffer))\n    } else if (this._bodyFormData) {\n      throw new Error('could not read FormData body as text')\n    } else {\n      return Promise.resolve(this._bodyText)\n    }\n  }\n\n  if (support.formData) {\n    this.formData = function() {\n      return this.text().then(decode)\n    }\n  }\n\n  this.json = function() {\n    return this.text().then(JSON.parse)\n  }\n\n  return this\n}\n\n// HTTP methods whose capitalization should be normalized\nvar methods = ['DELETE', 'GET', 'HEAD', 'OPTIONS', 'POST', 'PUT']\n\nfunction normalizeMethod(method) {\n  var upcased = method.toUpperCase()\n  return methods.indexOf(upcased) > -1 ? upcased : method\n}\n\nexport function Request(input, options) {\n  if (!(this instanceof Request)) {\n    throw new TypeError('Please use the \"new\" operator, this DOM object constructor cannot be called as a function.')\n  }\n\n  options = options || {}\n  var body = options.body\n\n  if (input instanceof Request) {\n    if (input.bodyUsed) {\n      throw new TypeError('Already read')\n    }\n    this.url = input.url\n    this.credentials = input.credentials\n    if (!options.headers) {\n      this.headers = new Headers(input.headers)\n    }\n    this.method = input.method\n    this.mode = input.mode\n    this.signal = input.signal\n    if (!body && input._bodyInit != null) {\n      body = input._bodyInit\n      input.bodyUsed = true\n    }\n  } else {\n    this.url = String(input)\n  }\n\n  this.credentials = options.credentials || this.credentials || 'same-origin'\n  if (options.headers || !this.headers) {\n    this.headers = new Headers(options.headers)\n  }\n  this.method = normalizeMethod(options.method || this.method || 'GET')\n  this.mode = options.mode || this.mode || null\n  this.signal = options.signal || this.signal\n  this.referrer = null\n\n  if ((this.method === 'GET' || this.method === 'HEAD') && body) {\n    throw new TypeError('Body not allowed for GET or HEAD requests')\n  }\n  this._initBody(body)\n\n  if (this.method === 'GET' || this.method === 'HEAD') {\n    if (options.cache === 'no-store' || options.cache === 'no-cache') {\n      // Search for a '_' parameter in the query string\n      var reParamSearch = /([?&])_=[^&]*/\n      if (reParamSearch.test(this.url)) {\n        // If it already exists then set the value with the current time\n        this.url = this.url.replace(reParamSearch, '$1_=' + new Date().getTime())\n      } else {\n        // Otherwise add a new '_' parameter to the end with the current time\n        var reQueryString = /\\?/\n        this.url += (reQueryString.test(this.url) ? '&' : '?') + '_=' + new Date().getTime()\n      }\n    }\n  }\n}\n\nRequest.prototype.clone = function() {\n  return new Request(this, {body: this._bodyInit})\n}\n\nfunction decode(body) {\n  var form = new FormData()\n  body\n    .trim()\n    .split('&')\n    .forEach(function(bytes) {\n      if (bytes) {\n        var split = bytes.split('=')\n        var name = split.shift().replace(/\\+/g, ' ')\n        var value = split.join('=').replace(/\\+/g, ' ')\n        form.append(decodeURIComponent(name), decodeURIComponent(value))\n      }\n    })\n  return form\n}\n\nfunction parseHeaders(rawHeaders) {\n  var headers = new Headers()\n  // Replace instances of \\r\\n and \\n followed by at least one space or horizontal tab with a space\n  // https://tools.ietf.org/html/rfc7230#section-3.2\n  var preProcessedHeaders = rawHeaders.replace(/\\r?\\n[\\t ]+/g, ' ')\n  // Avoiding split via regex to work around a common IE11 bug with the core-js 3.6.0 regex polyfill\n  // https://github.com/github/fetch/issues/748\n  // https://github.com/zloirock/core-js/issues/751\n  preProcessedHeaders\n    .split('\\r')\n    .map(function(header) {\n      return header.indexOf('\\n') === 0 ? header.substr(1, header.length) : header\n    })\n    .forEach(function(line) {\n      var parts = line.split(':')\n      var key = parts.shift().trim()\n      if (key) {\n        var value = parts.join(':').trim()\n        headers.append(key, value)\n      }\n    })\n  return headers\n}\n\nBody.call(Request.prototype)\n\nexport function Response(bodyInit, options) {\n  if (!(this instanceof Response)) {\n    throw new TypeError('Please use the \"new\" operator, this DOM object constructor cannot be called as a function.')\n  }\n  if (!options) {\n    options = {}\n  }\n\n  this.type = 'default'\n  this.status = options.status === undefined ? 200 : options.status\n  this.ok = this.status >= 200 && this.status < 300\n  this.statusText = options.statusText === undefined ? '' : '' + options.statusText\n  this.headers = new Headers(options.headers)\n  this.url = options.url || ''\n  this._initBody(bodyInit)\n}\n\nBody.call(Response.prototype)\n\nResponse.prototype.clone = function() {\n  return new Response(this._bodyInit, {\n    status: this.status,\n    statusText: this.statusText,\n    headers: new Headers(this.headers),\n    url: this.url\n  })\n}\n\nResponse.error = function() {\n  var response = new Response(null, {status: 0, statusText: ''})\n  response.type = 'error'\n  return response\n}\n\nvar redirectStatuses = [301, 302, 303, 307, 308]\n\nResponse.redirect = function(url, status) {\n  if (redirectStatuses.indexOf(status) === -1) {\n    throw new RangeError('Invalid status code')\n  }\n\n  return new Response(null, {status: status, headers: {location: url}})\n}\n\nexport var DOMException = global.DOMException\ntry {\n  new DOMException()\n} catch (err) {\n  DOMException = function(message, name) {\n    this.message = message\n    this.name = name\n    var error = Error(message)\n    this.stack = error.stack\n  }\n  DOMException.prototype = Object.create(Error.prototype)\n  DOMException.prototype.constructor = DOMException\n}\n\nexport function fetch(input, init) {\n  return new Promise(function(resolve, reject) {\n    var request = new Request(input, init)\n\n    if (request.signal && request.signal.aborted) {\n      return reject(new DOMException('Aborted', 'AbortError'))\n    }\n\n    var xhr = new XMLHttpRequest()\n\n    function abortXhr() {\n      xhr.abort()\n    }\n\n    xhr.onload = function() {\n      var options = {\n        status: xhr.status,\n        statusText: xhr.statusText,\n        headers: parseHeaders(xhr.getAllResponseHeaders() || '')\n      }\n      options.url = 'responseURL' in xhr ? xhr.responseURL : options.headers.get('X-Request-URL')\n      var body = 'response' in xhr ? xhr.response : xhr.responseText\n      setTimeout(function() {\n        resolve(new Response(body, options))\n      }, 0)\n    }\n\n    xhr.onerror = function() {\n      setTimeout(function() {\n        reject(new TypeError('Network request failed'))\n      }, 0)\n    }\n\n    xhr.ontimeout = function() {\n      setTimeout(function() {\n        reject(new TypeError('Network request failed'))\n      }, 0)\n    }\n\n    xhr.onabort = function() {\n      setTimeout(function() {\n        reject(new DOMException('Aborted', 'AbortError'))\n      }, 0)\n    }\n\n    function fixUrl(url) {\n      try {\n        return url === '' && global.location.href ? global.location.href : url\n      } catch (e) {\n        return url\n      }\n    }\n\n    xhr.open(request.method, fixUrl(request.url), true)\n\n    if (request.credentials === 'include') {\n      xhr.withCredentials = true\n    } else if (request.credentials === 'omit') {\n      xhr.withCredentials = false\n    }\n\n    if ('responseType' in xhr) {\n      if (support.blob) {\n        xhr.responseType = 'blob'\n      } else if (\n        support.arrayBuffer &&\n        request.headers.get('Content-Type') &&\n        request.headers.get('Content-Type').indexOf('application/octet-stream') !== -1\n      ) {\n        xhr.responseType = 'arraybuffer'\n      }\n    }\n\n    if (init && typeof init.headers === 'object' && !(init.headers instanceof Headers)) {\n      Object.getOwnPropertyNames(init.headers).forEach(function(name) {\n        xhr.setRequestHeader(name, normalizeValue(init.headers[name]))\n      })\n    } else {\n      request.headers.forEach(function(value, name) {\n        xhr.setRequestHeader(name, value)\n      })\n    }\n\n    if (request.signal) {\n      request.signal.addEventListener('abort', abortXhr)\n\n      xhr.onreadystatechange = function() {\n        // DONE (success or failure)\n        if (xhr.readyState === 4) {\n          request.signal.removeEventListener('abort', abortXhr)\n        }\n      }\n    }\n\n    xhr.send(typeof request._bodyInit === 'undefined' ? null : request._bodyInit)\n  })\n}\n\nfetch.polyfill = true\n\nif (!global.fetch) {\n  global.fetch = fetch\n  global.Headers = Headers\n  global.Request = Request\n  global.Response = Response\n}\n","// IOS Safari/Desktop Safari browsers < 10.3\nimport 'url-search-params-polyfill';\nimport 'whatwg-fetch';\n\nPromise.allSettled = Promise.allSettled || async function (promises: Array<Promise<unknown>>) {\n\tconst mappedPromises = promises.map(async p => p\n\t\t.then(value => ({\n\t\t\tstatus: 'fulfilled',\n\t\t\tvalue,\n\t\t}))\n\t\t.catch((reason: unknown) => ({\n\t\t\tstatus: 'rejected',\n\t\t\treason,\n\t\t})));\n\treturn Promise.all(mappedPromises);\n};\n","import {getLocaleText} from '../../ts/util/translation';\nimport {type InitMessage} from '../../../@type/window-messages';\nimport chevronImageURL from '../../../../public/img/chevron-down-solid.svg';\nimport {maybeFetch} from '../../../@shared/ts/maybe';\nimport {FeatureFlag} from '../../../@type/features';\nimport {Feature, startModalLoading, stopModalLoading} from '../reducers/environmentReducer';\nimport {getErrorString} from '../../../@shared/ts/error';\nimport {store} from '../store';\nimport {requestCartCalculation} from '../payment/order';\nimport {$qs} from '../../../@shared/ts/dom';\nimport {type WCPHPData} from '../../../@type/woocommerce/php-data';\nimport {Carts} from '../reducers/cartReducer';\n\nexport function initMerchantAccount(message: InitMessage) {\n\tconst accountDetails = message.phpData.merchant_customer_account;\n\n\t// If the user is logged in then we don't need to do anything\n\tif (accountDetails.logged_in) {\n\t\treturn;\n\t}\n\n\tif (accountDetails.checkout_login_enabled) {\n\t\tmountLoginHTML();\n\t\tsetupLoginEvents();\n\t}\n\n\tif (accountDetails.checkout_registration_enabled || accountDetails.checkout_registration_with_subscription_enabled) {\n\t\tmountRegistrationHTML(accountDetails);\n\t\tsetupRegistrationEvents();\n\t}\n\n\tlet previousCartContainsSubscription = false;\n\tconst unsubscribe = store.subscribe(() => {\n\t\t// A user might get logged in after placing the order but then encountering an error with the\n\t\t// payment. In this case we need to remove the login/registration forms.\n\t\tconst isLoggedIn = Feature.dynamicMetadata<boolean>(FeatureFlag.EXPRESS_CHECKOUT, 'logged_in') ?? false;\n\t\tif (isLoggedIn) {\n\t\t\tdocument.querySelector('#login-container')?.remove();\n\t\t\tdocument.querySelector('#register-container')?.remove();\n\n\t\t\tunsubscribe();\n\t\t}\n\n\t\tconst currentCartContainsSubscription = Carts.subscriptionPresent();\n\t\tif (previousCartContainsSubscription === currentCartContainsSubscription) {\n\t\t\treturn;\n\t\t}\n\n\t\tpreviousCartContainsSubscription = currentCartContainsSubscription;\n\n\t\t// At this point we can assume:\n\t\t// 1. The user is not logged in\n\t\t// 2. The user has the option to register an account\n\n\t\t// At this point we cannot assume:\n\t\t// 1. The user may or may not have the option to login\n\t\t// 2. The user may or may not have a subscription in their cart\n\n\t\ttoggleRegistrationDisplay(shouldShowRegistration(accountDetails, Carts.subscriptionPresent()));\n\t\ttoggleRegistrationCheckboxDisplay(shouldShowRegistrationCheckbox(accountDetails, Carts.subscriptionPresent()));\n\t\ttoggleRegistrationCredentialsDisplay(shouldShowRegistrationCredentials(accountDetails, Carts.subscriptionPresent()));\n\t});\n}\n\nfunction mountLoginHTML() {\n\tconst lostPasswordURL = Feature.metadata<string>(FeatureFlag.EXPRESS_CHECKOUT, 'lost_password_url') ?? '';\n\n\tconst html = `\n\t<div id=\"login-container\">\n\t\t<style>\n\t\t\t#login-container details {\n\t\t\t\tborder-radius: 8px;\n\t\t\t\tborder: 1px solid #e0e0e0;\n\t\t\t\tmargin-bottom: 12px;\n\t\t\t\toverflow: hidden;\n\t\t\t}\n\t\t\t#login-container summary {\n\t\t\t\tpadding: 8px;\n\t\t\t\tborder-radius: 8px;\n\t\t\t\tcursor: pointer;\n\t\t\t\tdisplay: flex;\n\t\t\t\tflex-direction: row;\n\t\t\t\talign-items: center;\n\t\t\t\tbackground-color: var(--peachpay-theme-color-light);\n\n\t\t\t}\n\t\t\t#login-container details[open] summary {\n\t\t\t\tborder-bottom-left-radius: 0;\n\t\t\t\tborder-bottom-right-radius: 0;\n\t\t\t\tborder-bottom: 1px solid #e0e0e0;\n\t\t\t}\n\t\t\t#login-container details[open] summary > img {\n\t\t\t\ttransform: rotate(180deg);\n\t\t\t}\n\t\t\t#login-container form {\n\t\t\t\tpadding: 8px;\n\t\t\t}\n\t\t\tdetails > summary {\n\t\t\t\tlist-style: none;\n\t\t\t}\n\t\t\tdetails > summary::-webkit-details-marker {\n\t\t\t\tdisplay: none;\n\t\t\t}\n\n\t\t\t.forgot-password{\n\t\t\t\tborder-radius: 8px;\n\t\t\t\tpadding: 8px;\n\t\t\t\tcolor: var(--peachpay-theme-color);\n\t\t\t}\n\n\t\t\t.forgot-password:hover{\n\t\t\t\tbackground-color: var(--peachpay-theme-color-light);\n\t\t\t}\n\t\t</style>\n\t\t<details>\n\t\t\t<summary>\n\t\t\t\t<span style=\"flex: 1;\">${getLocaleText('Have an account?')}</span>\n\t\t\t\t<img src=\"${chevronImageURL}\" class=\"pp-accordion-arrow\" style=\"scale: 1.2; margin-right: 12px\">\n\t\t\t</summary>\n\t\t\t<form id=\"login-user\" class=\"pp-info-form\">\n\t\t\t\t<span>\n\t\t\t\t\t${getLocaleText('If you have shopped with us before, please enter your login details below. If you are a new customer, please proceed to the next section.')}\n\t\t\t\t</span>\n\t\t\t\t<br/>\n\t\t\t\t<div class=\"flex col pp-form-rows-container\" style=\"margin-top: 8px;\">\n\t\t\t\t\t<div class=\"flex pp-form-row\">\n\t\t\t\t\t\t<div class=\"pp-fw-50 flex\">\n\t\t\t\t\t\t\t<input name=\"username\" type=\"text\" class=\"pp-fw-100 text-input\" placeholder=\" \" required/>\n\t\t\t\t\t\t\t<label class=\"pp-form-label\" for=\"username\">${getLocaleText('Username or email')}</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"pp-fw-50 flex\">\n\t\t\t\t\t\t\t<input name=\"password\" type=\"password\" class=\"pp-fw-100 text-input\" placeholder=\" \" required/>\n\t\t\t\t\t\t\t<label class=\"pp-form-label\" for=\"password\">${getLocaleText('Password')}</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<span id=\"login-error\" class=\"error hide\"></span>\n\t\t\t\t\t<div class=\"flex pp-form-row\">\n\t\t\t\t\t\t<div class=\"pp-fw-100 flex\">\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<input name=\"remember\" type=\"checkbox\" value=\"forever\"/>\n\t\t\t\t\t\t\t\t<span>${getLocaleText('Remember me')}</span>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<button type=\"submit\" class=\"btn\" style=\"padding: 8px; min-width: 7rem; width: auto; margin-top: 8px; margin-right: 8px;\">${getLocaleText('Login')}</button>\n\t\t\t\t<a class=\"forgot-password\" href=\"${lostPasswordURL}\" onclick=\"window.top.location.href = this.href; return false;\">${getLocaleText('Lost your password?')}</a>\n\t\t\t</form>\n\t\t</details>\n\t</div>`;\n\n\tdocument.querySelector('#pp-info')?.insertAdjacentHTML('afterbegin', html);\n}\n\nfunction setupLoginEvents() {\n\tdocument.querySelector('#login-user')?.addEventListener('submit', async event => {\n\t\tevent.preventDefault();\n\n\t\tconst $form = event.target as HTMLFormElement;\n\t\tconst ajaxURL = Feature.metadata<string>(FeatureFlag.EXPRESS_CHECKOUT, 'admin_ajax_url');\n\t\tconst loginNonce = Feature.dynamicMetadata<string>(FeatureFlag.EXPRESS_CHECKOUT, 'login_nonce');\n\n\t\t$qs('#login-error')?.classList.add('hide');\n\n\t\tif (!$form || !ajaxURL || !loginNonce) {\n\t\t\t$qs('#login-error', $el => {\n\t\t\t\t$el.innerHTML = getLocaleText('An unknown error occurred while logging in. Please refresh the page and try again.');\n\t\t\t\t$el.classList.remove('hide');\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\tstore.dispatch(startModalLoading());\n\n\t\tconst formData = new FormData($form);\n\t\tformData.append('security', loginNonce);\n\t\tformData.append('action', 'peachpay_ajax_login');\n\n\t\tconst {error: loginError, result: loginResult} = await maybeFetch<{success: boolean; message: string}>(ajaxURL, {\n\t\t\tmethod: 'POST',\n\t\t\tbody: formData,\n\t\t});\n\n\t\tif (loginError || !loginResult || !loginResult.success) {\n\t\t\tconst errorMessage = loginError ? getErrorString(loginError) : loginResult?.message ?? 'An unknown error occurred while logging in. Please try again later.';\n\t\t\tconst cleanHTML = (htmlString: string) => {\n\t\t\t\tconst temporalDivElement = document.createElement('div');\n\t\t\t\ttemporalDivElement.innerHTML = htmlString;\n\t\t\t\ttemporalDivElement.querySelectorAll('a,script').forEach($el => {\n\t\t\t\t\t$el.remove();\n\t\t\t\t});\n\t\t\t\treturn temporalDivElement.innerHTML;\n\t\t\t};\n\n\t\t\t$qs('#login-error', $el => {\n\t\t\t\t$el.innerHTML = cleanHTML(errorMessage);\n\t\t\t\t$el.classList.remove('hide');\n\t\t\t});\n\t\t\tstore.dispatch(stopModalLoading());\n\t\t\treturn;\n\t\t}\n\n\t\t// Remove the login/registration forms from the checkout. They are no longer needed.\n\t\tdocument.querySelector('#login-container')?.remove();\n\t\tdocument.querySelector('#register-container')?.remove();\n\n\t\tawait requestCartCalculation(true);\n\t\tstore.dispatch(stopModalLoading());\n\t});\n}\n\nfunction mountRegistrationHTML(accountDetails: WCPHPData['merchant_customer_account']) {\n\tconst usernameHTML = (displayed: boolean) => `\n\t\t<div id=\"register-username\" class=\"${accountDetails.auto_generate_password ? 'pp-fw-100' : 'pp-fw-50'} flex\">\n\t\t\t<input name=\"account_username\" type=\"text\" class=\"pp-fw-100 text-input\" placeholder=\" \" required ${displayed ? '' : 'disabled'}/>\n\t\t\t<label class=\"pp-form-label\" for=\"account_username\">${getLocaleText('Account username')}</label>\n\t\t</div>`;\n\n\tconst passwordHTML = (displayed: boolean) => `\n\t\t<div id=\"register-password\" class=\"${accountDetails.auto_generate_username ? 'pp-fw-100' : 'pp-fw-50'} flex\">\n\t\t\t<input name=\"account_password\" type=\"password\" class=\"pp-fw-100 text-input\" placeholder=\" \" required ${displayed ? '' : 'disabled'}/>\n\t\t\t<label class=\"pp-form-label\" for=\"account_password\">${getLocaleText('Create account password')}</label>\n\t\t</div>`;\n\n\tconst showRegistration = shouldShowRegistration(accountDetails, false);\n\tconst showRegistrationCheckbox = shouldShowRegistrationCheckbox(accountDetails, false);\n\tconst showRegistrationCredentials = shouldShowRegistrationCredentials(accountDetails, false);\n\n\tconst containerHTML = `\n\t<div id=\"register-container\" class=\"flex col pp-form-rows-container ${showRegistration ? '' : 'hide'}\">\n\t\t<div id=\"register-account\" class=\"flex pp-form-row ${showRegistrationCheckbox ? '' : 'hide'}\">\n\t\t\t<div class=\"pp-fw-100 flex\">\n\t\t\t\t<label>\n\t\t\t\t\t<input id=\"createaccount\" type=\"checkbox\" name=\"createaccount\" value=\"1\"/>\n\t\t\t\t\t${getLocaleText('Create an account?')}\n\t\t\t\t</label>\n\t\t\t</div>\n\t\t</div>\n\t\t<div id=\"register-credentials\" class=\"flex pp-form-row ${showRegistrationCredentials ? '' : 'hide'}\">\n\t\t\t${accountDetails.auto_generate_username ? '' : usernameHTML(showRegistrationCredentials)}\n\t\t\t${accountDetails.auto_generate_password ? '' : passwordHTML(showRegistrationCredentials)}\n\t\t</div>\n\t</div>`;\n\n\tdocument.querySelector('#pp-info-form')?.insertAdjacentHTML('beforeend', containerHTML);\n}\n\nfunction setupRegistrationEvents() {\n\tdocument.querySelector('#createaccount')?.addEventListener('click', async event => {\n\t\tconst $target = event.target as HTMLInputElement;\n\n\t\ttoggleRegistrationCredentialsDisplay($target.checked);\n\t});\n}\n\nfunction shouldShowRegistrationCheckbox(accountDetails: WCPHPData['merchant_customer_account'], subscriptionPresent: boolean) {\n\tif (subscriptionPresent) {\n\t\treturn false;\n\t}\n\n\treturn accountDetails.allow_guest_checkout;\n}\n\nfunction toggleRegistrationCheckboxDisplay(show: boolean) {\n\tdocument.querySelector('#register-account')?.classList.toggle('hide', !show);\n}\n\nfunction shouldShowRegistrationCredentials(accountDetails: WCPHPData['merchant_customer_account'], subscriptionPresent: boolean) {\n\treturn subscriptionPresent || !accountDetails.allow_guest_checkout;\n}\n\nfunction toggleRegistrationCredentialsDisplay(show: boolean) {\n\tif (show) {\n\t\t$qs('#register-credentials')?.classList.remove('hide');\n\t\t$qs('#register-username input')?.removeAttribute('disabled');\n\t\t$qs('#register-password input')?.removeAttribute('disabled');\n\t} else {\n\t\t$qs('#register-credentials')?.classList.add('hide');\n\t\t// Add disabled so form validation doesn't complain when fields are not displayed\n\t\t$qs('#register-username input')?.setAttribute('disabled', '');\n\t\t$qs('#register-password input')?.setAttribute('disabled', '');\n\t}\n}\n\nfunction shouldShowRegistration(accountDetails: WCPHPData['merchant_customer_account'], subscriptionPresent: boolean): boolean {\n\t// Registration is shown if:\n\t//     Checkout registration is enabled\n\t//   or:\n\t//     A subscription is present and registration with a subscription is enabled\n\treturn accountDetails.checkout_registration_enabled || (subscriptionPresent && accountDetails.checkout_registration_with_subscription_enabled);\n}\n\nfunction toggleRegistrationDisplay(show: boolean) {\n\t$qs('#register-container')?.classList.toggle('hide', !show);\n}\n","import {Feature} from '../reducers/environmentReducer';\nimport {type ModalPage} from '../models/IEnvironment';\nimport {renderCorrectProvinceField, syncCustomerFieldChanges, wcCountryLocaleRuleRender} from './customer';\nimport {loadScript, $qs, $qsAll} from '../../../@shared/ts/dom';\nimport {type WCPHPData} from '../../../@type/woocommerce/php-data';\nimport {type InitMessage} from '../../../@type/window-messages';\nimport {FeatureFlag} from '../../../@type/features';\n\ndeclare const google: any;\n\nlet shippingAutocomplete: google.maps.places.Autocomplete | undefined;\nlet newCustomerBillingAutocomplete: google.maps.places.Autocomplete | undefined;\n\nfunction shouldEnableAddressAutocomplete() {\n\tif (Feature.enabled(FeatureFlag.ADDRESS_AUTOCOMPLETE)) {\n\t\tconst activeLocations = Feature.metadata(FeatureFlag.ADDRESS_AUTOCOMPLETE, 'active_locations');\n\n\t\tif (activeLocations === 'default' || activeLocations === 'express_checkout_only') {\n\t\t\treturn true;\n\t\t}\n\t}\n\n\treturn false;\n}\n\nexport function initAddressAutocomplete(message: InitMessage) {\n\tif (!shouldEnableAddressAutocomplete()) {\n\t\treturn;\n\t}\n\n\tloadScript('https://maps.googleapis.com/maps/api/js?key=AIzaSyAL_j0UvKJacQhZ3OedCj_bkcTbuO63MVU&libraries=places', 'google', () => {\n\t\tconst shippingInput = $qs<HTMLInputElement>('#pp-different-shipping-details [name=\"shipping_address_1\"]');\n\t\tconst newBillingInput = $qs<HTMLInputElement>('#pp-info-form [name=\"billing_address_1\"]');\n\t\tconst shippingOptions = {\n\t\t\t/**\n\t\t\t * Currently using both address_components and formatted_address to cover the most street addresses with least conditional logic\n\t\t\t * Including more fields costs more, so if enough country specific logic is written to allow the removal of formatted_address, it should be removed\n\t\t\t */\n\t\t\tfields: ['address_components', 'formatted_address'],\n\t\t\ttypes: ['address'],\n\t\t};\n\t\tconst billingOptions = {\n\t\t\t/**\n\t\t\t * Currently using both address_components and formatted_address to cover the most street addresses with least conditional logic\n\t\t\t * Including more fields costs more, so if enough country specific logic is written to allow the removal of formatted_address, it should be removed\n\t\t\t */\n\t\t\tfields: ['address_components', 'formatted_address'],\n\t\t\ttypes: ['address'],\n\t\t};\n\n\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-assignment, @typescript-eslint/no-unsafe-call\n\t\tshippingAutocomplete = new google.maps.places.Autocomplete(shippingInput, shippingOptions);\n\t\tshippingAutocomplete?.addListener('place_changed', () => {\n\t\t\tfillInAddress('shipping', 'shipping', message.phpData);\n\t\t});\n\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-assignment, @typescript-eslint/no-unsafe-call\n\t\tnewCustomerBillingAutocomplete = new google.maps.places.Autocomplete(newBillingInput, billingOptions);\n\t\tnewCustomerBillingAutocomplete?.addListener('place_changed', () => {\n\t\t\tfillInAddress('billing', 'info', message.phpData);\n\t\t});\n\n\t\t// Prevent submitting the form when ENTER key is pressed on the input.\n\t\t$qsAll('#pp-info-form, #pp-different-shipping-details', $form => {\n\t\t\t$form.addEventListener('keypress', preventSubmitListener);\n\t\t});\n\t}).catch(() => {/**/});\n}\n\nfunction preventSubmitListener(event: Event) {\n\tconst key = (event as KeyboardEvent).key || 0;\n\tif (key === 'Enter') {\n\t\tevent.preventDefault();\n\t}\n}\n\n/**\n * Fills in address fields as best possible\n * Implemented mostly to handle US and common European countries. Will need to be tweaked for new countries as merchants ask.\n * Known issues (not resolved due to extreme scope)\n * - For many countries, state/province does not correctly fill due to either inconsistent shortcodes between Google & WooCommerce or different address component name (other than administrative_area_1)\n */\n// eslint-disable-next-line complexity\nfunction fillInAddress(section: string, modalPage: string, phpData: WCPHPData) {\n\tconst formIdentifier = modalPage === 'info' ? '#pp-info-form' : '#pp-different-shipping-details';\n\n\tconst address1Field = $qs<HTMLInputElement>(`${formIdentifier} [name=\"${section}_address_1\"]:not(.hide)`);\n\tconst address2Field = $qs<HTMLInputElement>(`${formIdentifier} [name=\"${section}_address_2\"]:not(.hide)`);\n\tconst postalField = $qs<HTMLInputElement>(`${formIdentifier} [name=\"${section}_postcode\"]:not(.hide)`);\n\tconst cityField = $qs<HTMLInputElement>(`${formIdentifier} [name=\"${section}_city\"]:not(.hide)`);\n\tconst stateField = $qs<HTMLInputElement | HTMLSelectElement>(`${formIdentifier} [name=\"${section}_state\"]:not(.hide)`);\n\tconst provinceField = $qs<HTMLInputElement | HTMLSelectElement>(`${formIdentifier} [name=\"${section}_province\"]:not(.hide)`);\n\n\t// Clear all fields, to make it clear to the user what wasn't updated\n\tif (address1Field) {\n\t\taddress1Field.value = '';\n\t}\n\n\tif (address2Field) {\n\t\taddress2Field.value = '';\n\t}\n\n\tif (postalField) {\n\t\tpostalField.value = '';\n\t}\n\n\tif (cityField) {\n\t\tcityField.value = '';\n\t}\n\n\tif (stateField) {\n\t\tstateField.value = '';\n\t}\n\n\tif (provinceField) {\n\t\tprovinceField.value = '';\n\t}\n\n\tlet place: google.maps.places.PlaceResult | undefined;\n\t// Get the place details from the autocomplete object.\n\tif (modalPage === 'info') {\n\t\tplace = newCustomerBillingAutocomplete?.getPlace();\n\t}\n\n\tif (modalPage === 'shipping') {\n\t\tplace = shippingAutocomplete?.getPlace();\n\t}\n\n\tif (!place) {\n\t\treturn;\n\t}\n\n\t// Set country field first so province/state field can update accordingly.\n\tconst country = place.address_components?.find((component: google.maps.GeocoderAddressComponent) => component.types[0] === 'country');\n\tconst countryField = document.querySelector<HTMLSelectElement>(`${formIdentifier} [name=\"${section}_country\"]`);\n\tif (countryField && country) {\n\t\tconst previousCountryFieldValue = countryField.value;\n\t\tcountryField.value = country.short_name;\n\t\tif (previousCountryFieldValue !== country.short_name) {\n\t\t\trenderCorrectProvinceField(phpData, modalPage as ModalPage);\n\t\t\tif (Feature.enabled(FeatureFlag.USE_WC_COUNTRY_LOCALE)) {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\twcCountryLocaleRuleRender(modalPage);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tsetTimeout(() => {\n\t\t\tsyncCustomerFieldChanges(formIdentifier);\n\t\t}, 200);\n\t}\n\n\tlet postcode = '';\n\n\tif (!place.address_components) {\n\t\treturn;\n\t}\n\n\t// Get each component of the address from the place details,\n\t// and then fill-in the corresponding field on the form.\n\t// place.address_components are google.maps.GeocoderAddressComponent objects\n\t// which are documented at http://goo.gle/3l5i5Mr\n\tfor (const component of place.address_components) {\n\t\tconst componentType = component.types[0];\n\n\t\tswitch (componentType) {\n\t\t\tcase 'postal_code': {\n\t\t\t\tpostcode = `${component.long_name}${postcode}`;\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase 'locality':\n\t\t\tcase 'postal_town': {\n\t\t\t\tif (cityField) {\n\t\t\t\t\tcityField.value = component.long_name;\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t// Only autofill state/province value if it isn't hidden by wc rule and if the autofill data is valid.\n\n\t\t\tcase 'administrative_area_level_1': {\n\t\t\t\tconst allowedStatesOrProvinces = phpData.wc_location_info?.allowed_states_or_provinces[country?.short_name ?? ''] ?? {};\n\t\t\t\tconst isInputField = [stateField?.tagName, provinceField?.tagName].includes('INPUT');\n\t\t\t\t// Break if failed to get allowed states/provinces info from short_name\n\t\t\t\tif (!Object.keys(allowedStatesOrProvinces).length) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\t// Break if field type is input and long_name is invalid\n\t\t\t\tif (isInputField && allowedStatesOrProvinces[component.short_name] !== component.long_name) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tconst stateValue = isInputField\n\t\t\t\t\t? component.long_name\n\t\t\t\t\t: Object.keys(allowedStatesOrProvinces).includes(component.short_name)\n\t\t\t\t\t\t? component.short_name\n\t\t\t\t\t\t: findStateKeyByValue(component.long_name, allowedStatesOrProvinces);\n\t\t\t\tif (stateValue === undefined) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\t// Fill in both fields, since both will likely be found by the querySelector\n\t\t\t\tif (stateField) {\n\t\t\t\t\tstateField.value = stateValue;\n\t\t\t\t}\n\n\t\t\t\tif (provinceField) {\n\t\t\t\t\tprovinceField.value = stateValue;\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase 'country':\n\t\t\t\t// Should have been set before for loop\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t}\n\t}\n\n\tif (address1Field && place.formatted_address) {\n\t\taddress1Field.value = getFormattedStreetAddress(place.formatted_address);\n\t}\n\n\tif (postalField) {\n\t\tpostalField.value = postcode;\n\t}\n\n\tsetTimeout(() => {\n\t\tsyncCustomerFieldChanges(formIdentifier);\n\t}, 200);\n\n\t// After filling the form with address components from the Autocomplete\n\t// prediction, set cursor focus on the second address line to encourage\n\t// entry of subpremise information such as apartment, unit, or floor number.\n\tif (address2Field) {\n\t\taddress2Field.focus();\n\t}\n}\n\n/**\n * Should return the properly formatted address for a majority of countries\n * @param formattedAddress Complete formatted address string\n * @returns Formatted street address string\n */\nexport function getFormattedStreetAddress(formattedAddress: string): string {\n\tconst addressChunks = formattedAddress.split(', ');\n\n\t// Edge-case for UAE, as they use hyphens to separate. Will require better logic if other non-comma cases are found.\n\tif (addressChunks.length === 1) {\n\t\treturn formattedAddress.split(' - ')[0] ?? '';\n\t}\n\n\t// Regex ensures there's a digit in the string.\n\t// Originally excluded cases like '2nd', but returned to just digits due to cases like street number '17A' (Australia)\n\tconst regexContainsHouseNumber = /\\d+/g;\n\n\t// In observed cases, if street number isn't in the first section, it might be in the next section\n\tif (addressChunks[0] && addressChunks[1] && !regexContainsHouseNumber.test(addressChunks[0]) && regexContainsHouseNumber.test(addressChunks[1])) {\n\t\treturn `${addressChunks[0]}, ${addressChunks[1]}`;\n\t}\n\n\t// Otherwise, first section is most likely correct\n\treturn addressChunks[0] ?? '';\n}\n\nfunction findStateKeyByValue(value: string, allowedStatesOrProvinces: any) {\n\treturn Object.keys(allowedStatesOrProvinces).find(key => allowedStatesOrProvinces[key] === value);\n}\n","/**\n * This function filters click and keypress events for those we should consider \"positive\".\n * Click, Space, and Enter events return true. This allows for keyboard accessibility to\n * events using non-standard HTML elements.\n */\nexport function eventClick(event: MouseEvent | KeyboardEvent) {\n\tif (event.type === 'click') {\n\t\treturn true;\n\t}\n\n\tif (event.type === 'keypress') {\n\t\tconst {key} = event as KeyboardEvent;\n\t\tif ((key === 'Enter') || (key === ' ')) {\n\t\t\treturn true;\n\t\t}\n\t}\n\n\treturn false;\n}\n","import {type ICartCalculationResponse} from '../../../@type/woocommerce/cart-calculation';\nimport {consumeCartCalculationResponse} from '../payment/order';\nimport {Feature, startModalLoading, stopModalLoading} from '../reducers/environmentReducer';\nimport {store} from '../store';\nimport {eventClick} from '../util/dom';\nimport {$qsAll} from '../../../@shared/ts/dom';\nimport {FeatureFlag} from '../../../@type/features';\nimport {captureSentryException} from '../../../@shared/ts/sentry';\nimport {maybeFetch} from '../../../@shared/ts/maybe';\nimport {getErrorString} from '../../../@shared/ts/error';\n\nexport function initQuantityChangerEvent() {\n\tif (!Feature.enabled(FeatureFlag.QUANTITY_CHANGER)) {\n\t\t$qsAll('#pp-summary-body, #pp-summary-body-mobile', $removeButtons => {\n\t\t\t$removeButtons.addEventListener('click', async (event: Event) => {\n\t\t\t\tconst $target = event.target as HTMLElement;\n\n\t\t\t\tif ($target.closest('.pp-item-remover-btn')) {\n\t\t\t\t\tconst cartItemKey = $target.closest<HTMLElement>('.pp-item-remover-btn')?.dataset['qid'];\n\t\t\t\t\tawait changeQuantity(cartItemKey, 0, true);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t\treturn;\n\t}\n\n\t// Targeting root of each cart list to simplify event listener and only ever set the listeners once.\n\t$qsAll('#pp-summary-body, #pp-summary-body-mobile, .pp-related-product-body', $cartContainer => {\n\t\t$cartContainer.addEventListener('click', handleCartContainerEvent);\n\t\t$cartContainer.addEventListener('keypress', handleCartContainerEvent);\n\t});\n}\n\nasync function handleCartContainerEvent(event: MouseEvent | KeyboardEvent) {\n\tconst $target = event.target as HTMLElement;\n\t// Item qty updates on Enter, Space, blur, or 3/4 second after being updated.\n\tif ($target.closest('.qty-fs') && event.type === 'keypress') { // Ignore clicks, we need those to select qty-fs.\n\t\tconst $inputTarget = event.target as HTMLInputElement;\n\t\tconst cartItemKey = $target.closest<HTMLElement>('.qty-fs')?.dataset['qid'];\n\t\tif ($inputTarget.value && $inputTarget.checkValidity()) {\n\t\t\tif (eventClick(event)) { // Update value immediately on Enter or Space.\n\t\t\t\tawait changeQuantity(cartItemKey, Number.parseInt($inputTarget.value), true);\n\t\t\t} else if (event.type === 'keypress') { // Else if the qty was updated, set a blur event listener and the timer.\n\t\t\t\t$target.addEventListener('blur', async () => {\n\t\t\t\t\tawait changeQuantity(cartItemKey, Number.parseInt($inputTarget.value), true);\n\t\t\t\t}, {once: true});\n\t\t\t\tawait new Promise(r => {\n\t\t\t\t\tsetTimeout(r, 750);\n\t\t\t\t});\n\t\t\t\tif (!document.activeElement!.classList.contains('qty-fs')) {\n\t\t\t\t\t// Do nothing if we've already blurred.\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t$target.blur();\n\t\t\t}\n\t\t}\n\n\t\treturn;\n\t}\n\n\t// The rest of the events are eventClick events.\n\tif (!eventClick(event)) {\n\t\treturn;\n\t}\n\n\tif (!$target.closest('.qty-btn') && !$target.closest('.qty-fs') && !$target.closest('.pp-item-remover-btn')) {\n\t\treturn; // What was clicked was not a quantity button.\n\t}\n\n\tif ($target.closest('.qty-btn')) {\n\t\tconst $button = $target.closest<HTMLElement>('.qty-btn');\n\t\tconst cartItemKey = $button?.dataset['qid'];\n\n\t\tif ($button?.classList.contains('decrease-qty')) {\n\t\t\tawait changeQuantity(cartItemKey, -1, false);\n\t\t} else if ($button?.classList.contains('increase-qty')) {\n\t\t\tawait changeQuantity(cartItemKey, 1, false);\n\t\t}\n\t} else if ($target.closest('.pp-item-remover-btn')) {\n\t\tconst cartItemKey = $target.closest<HTMLElement>('.pp-item-remover-btn')!.dataset['qid'];\n\t\tawait changeQuantity(cartItemKey, 0, true);\n\t}\n}\n\nasync function changeQuantity(cartItemKey: string | undefined, amount = 1, set = false) {\n\tconst quantityChangeURL = Feature.metadata<string>(FeatureFlag.QUANTITY_CHANGER, 'quantity_changed_url');\n\tif (!quantityChangeURL || !cartItemKey) {\n\t\treturn;\n\t}\n\n\tstore.dispatch(startModalLoading());\n\n\tconst formData = new FormData();\n\tformData.append('cart_item_key', cartItemKey);\n\tformData.append('quantity', String(amount));\n\tformData.append('absolute', String(set));\n\n\tconst {error, result} = await maybeFetch<ICartCalculationResponse>(quantityChangeURL, {\n\t\tmethod: 'POST',\n\t\tbody: formData,\n\t});\n\n\tif (error || !result) {\n\t\tcaptureSentryException(error instanceof Error ? error : new Error(getErrorString(error)));\n\t\tstore.dispatch(stopModalLoading());\n\n\t\treturn;\n\t}\n\n\tconsumeCartCalculationResponse(result);\n\n\tstore.dispatch(stopModalLoading());\n}\n","import {type WCCartItem} from '../../../@type/woocommerce/cart-item';\nimport {bundleQuantityLabel, cartItemDisplayAmount, cartItemLabel, cartItemQuantity, cartItemVariationHTML} from '../util/cart';\nimport {store} from '../store';\nimport {MerchantConfiguration} from '../reducers/merchantConfigurationReducer';\nimport {DefaultCart} from '../reducers/cartReducer';\nimport {Environment, Feature} from '../reducers/environmentReducer';\nimport {initQuantityChangerEvent} from './quantityChanger';\nimport {getLocaleText} from '../util/translation';\nimport {$qs, $qsAll} from '../../../@shared/ts/dom';\nimport {FeatureFlag} from '../../../@type/features';\nimport trashcanURL from '../../img/trashcan.svg';\nimport trashcanRedURL from '../../img/trashcan-red.svg';\nimport qtyMinusImageURL from '../../img/qty-minus.svg';\nimport qtyPlusImageURL from '../../img/qty-plus.svg';\n\nexport function initCart() {\n\tinitCartEvents();\n\tinitQuantityChangerEvent();\n}\n\nfunction initCartEvents() {\n\t/**\n\t * Handle cart rerendering\n\t * Uses a captured variable for culling unneeded rendering\n\t */\n\tlet previousCartData = '';\n\tlet previousCurrencyData = '';\n\tstore.subscribe(() => {\n\t\t// To avoid noticeable cart rerendering from images reloading after any state changes we check if the current cart has\n\t\t// changed by stringifying the cart data and comparing strings.\n\t\t// For plain objects it is the fastest method and incredibly simple: https://stackoverflow.com/questions/1068834/object-comparison-in-javascript\n\t\t// This also now extends to price totals if the total is not the same we will re render the cart\n\t\tif (Environment.modalUI.open()) {\n\t\t\tconst cartData = JSON.stringify(DefaultCart.contents());\n\t\t\tconst currencyData = JSON.stringify(MerchantConfiguration.currency.configuration());\n\t\t\tif (cartData !== previousCartData || currencyData !== previousCurrencyData) {\n\t\t\t\tpreviousCartData = cartData;\n\t\t\t\tpreviousCurrencyData = currencyData;\n\t\t\t\trenderOrderSummaryItems(DefaultCart.contents());\n\t\t\t}\n\t\t}\n\t});\n}\n\nfunction renderOrderSummaryItems(cart: WCCartItem[]): void {\n\tconst $tbody = $qs('#pp-summary-body');\n\tconst $tbodyMobile = $qs('#pp-summary-body-mobile');\n\n\tif (!$tbody || !$tbodyMobile) {\n\t\treturn;\n\t}\n\n\tclearOrderSummary();\n\n\tif (DefaultCart.contents().length === 0) {\n\t\tconst $message = `<div class=\"pp-order-summary-item\"><p>${getLocaleText('Cart is empty')}</p></div>`;\n\n\t\t$tbody.innerHTML = $message;\n\t\t$tbodyMobile.innerHTML = $message;\n\t\treturn;\n\t}\n\n\tfor (let i = 0; i < cart.length; i++) {\n\t\tconst item = cart[i];\n\t\t// If an item has no quantity, there is no need to show it.\n\t\tif (!item || cartItemQuantity(item) === 0) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tlet $cartRow;\n\t\tif (item.is_part_of_bundle) {\n\t\t\tcontinue;\n\t\t} else {\n\t\t\tconst itemBundle: WCCartItem[] = [];\n\t\t\titemBundle.push(item);\n\t\t\t// In the case of bundles, render the item's bundle items with it\n\t\t\tfor (let j = i + 1; j < cart.length; j++) {\n\t\t\t\tconst nextItem = cart[j];\n\t\t\t\tif (nextItem?.is_part_of_bundle) {\n\t\t\t\t\titemBundle.push(nextItem);\n\t\t\t\t} else {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t$cartRow = renderCartItem(itemBundle);\n\t\t}\n\n\t\tif (!$cartRow) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Add a separator border if wanted here\n\t\tif (i !== 0) {\n\t\t\t$cartRow.classList.add('pp-order-summary-item-border');\n\t\t}\n\n\t\t$tbody.append($cartRow);\n\t\t$tbodyMobile.append($cartRow.cloneNode(true));\n\t}\n}\n\nfunction renderBundleItem(item: WCCartItem) {\n\tconst $imgDiv = getImgQtyDiv(item);\n\n\tconst $labelDiv = document.createElement('div');\n\t$labelDiv.className = 'pp-bundle-label';\n\t$labelDiv.innerHTML = `${cartItemLabel(item)}${bundleQuantityLabel(item)}`;\n\n\tconst $bundleItemTopRow = document.createElement('div');\n\t$bundleItemTopRow.className = 'pp-cart-item-info';\n\t$bundleItemTopRow.appendChild($labelDiv);\n\n\tconst $amountDiv = document.createElement('div');\n\t$amountDiv.className = 'pp-item-amount';\n\tconst $amountP = document.createElement('p');\n\t$amountP.classList.add('pp-recalculate-blur'); // Connected to price-update-on-blur behavior\n\tconst $amount = cartItemDisplayAmount(item);\n\tif (parseFloat($amount.replace(/^.*;/, '')) > 0) {\n\t\t$amountP.innerHTML = $amount;\n\t} else {\n\t\t$amountP.innerHTML = '--';\n\t}\n\n\t$amountDiv.appendChild($amountP);\n\t$bundleItemTopRow.appendChild($amountDiv);\n\n\tconst $bundleItemSecondRow = document.createElement('div');\n\t$bundleItemSecondRow.className = 'pp-cart-item-info';\n\t$bundleItemSecondRow.innerHTML = cartItemVariationHTML(item);\n\n\tconst $bundleItemInfoDiv = document.createElement('div');\n\t$bundleItemInfoDiv.className = 'pp-cart-item-info-container';\n\t$bundleItemInfoDiv.appendChild($bundleItemTopRow);\n\t$bundleItemInfoDiv.appendChild($bundleItemSecondRow);\n\n\tconst $bundleItem = document.createElement('div');\n\t$bundleItem.className = 'pp-bundle-summary-item';\n\t$bundleItem.appendChild($imgDiv);\n\t$bundleItem.appendChild($bundleItemInfoDiv);\n\treturn $bundleItem;\n}\n\nfunction renderCartItem(itemBundle: WCCartItem[]): HTMLDivElement | null {\n\tconst item = itemBundle[0];\n\tconst $cartRow = document.createElement('div');\n\n\tif (!item) {\n\t\treturn null;\n\t}\n\n\tconst imageSrc = item.image?.[0] ?? '';\n\tconst showImage = Feature.enabled(FeatureFlag.PRODUCT_IMAGES) && imageSrc && imageSrc !== 'unknown' && imageSrc !== '(unknown)';\n\t$cartRow.className = 'pp-order-summary-item';\n\n\tif (!showImage) {\n\t\t$cartRow.style.gap = '16px';\n\t}\n\n\t// $imgQtyDiv and $itemInfoContainer are the 2 members of the outer flex container ($cartRow)\n\tconst $imgQtyDiv = getImgQtyDiv(item);\n\t// $itemInfoContainer is a vertical flex box that contains $itemInfo, $variationInfo, and each $bundleItem as its flex items\n\tconst $itemInfoContainer = document.createElement('div');\n\t$itemInfoContainer.className = 'pp-cart-item-info-container';\n\t// $itemInfo is a horizontal flexbox that contains all the current item's info\n\tconst $itemInfo = document.createElement('div');\n\t$itemInfo.className = 'pp-cart-item-info';\n\n\tconst $labelDiv = document.createElement('div');\n\t$labelDiv.className = 'pp-item-label';\n\t$labelDiv.innerHTML = cartItemLabel(item);\n\t$itemInfo.appendChild($labelDiv);\n\n\tconst $amountDiv = document.createElement('div');\n\t$amountDiv.className = 'pp-item-amount';\n\tconst $amountP = document.createElement('p');\n\t$amountP.classList.add('pp-recalculate-blur'); // Connected to price-update-on-blur behavior\n\t$amountP.innerHTML = cartItemDisplayAmount(item);\n\t$amountDiv.appendChild($amountP);\n\t$itemInfo.appendChild($amountDiv);\n\n\tconst $removerDiv = document.createElement('div');\n\t$removerDiv.className = 'pp-item-remover';\n\t$removerDiv.innerHTML = `<button class=\"pp-item-remover-btn\" data-qid=\"${item.item_key ?? ''}\">\n\t<img src=\"${trashcanURL}\" class=\"pp-item-remover-img\"/>\n\t<img src=\"${trashcanRedURL}\" class=\"pp-item-remover-hover-img\"/>\n\t</button>`;\n\t$itemInfo.appendChild($removerDiv);\n\n\t$itemInfoContainer.appendChild($itemInfo);\n\n\t// Render variation info\n\tconst $variationInfo = document.createElement('div');\n\t$variationInfo.className = 'pp-cart-item-info';\n\t$variationInfo.innerHTML = cartItemVariationHTML(item);\n\t$itemInfoContainer.appendChild($variationInfo);\n\n\t// Render bundle items\n\tfor (let i = 1; i < itemBundle.length; i++) {\n\t\tconst bundleItem = itemBundle[i];\n\t\tif (!bundleItem) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tconst $bundleItem = renderBundleItem(bundleItem);\n\t\t$itemInfoContainer.appendChild($bundleItem);\n\t}\n\n\tif ($imgQtyDiv.innerHTML !== '') {\n\t\t$cartRow.appendChild($imgQtyDiv);\n\t}\n\n\t$cartRow.appendChild($itemInfoContainer);\n\treturn $cartRow;\n}\n\nfunction clearOrderSummary(): void {\n\tfor (const $item of $qsAll('.pp-order-summary-item')) {\n\t\t$item.remove();\n\t}\n}\n\nfunction getImgQtyDiv(item: WCCartItem) {\n\tconst imageSrc = item.image?.[0] ?? '';\n\tconst showImage = Feature.enabled(FeatureFlag.PRODUCT_IMAGES) && imageSrc && imageSrc !== 'unknown' && imageSrc !== '(unknown)';\n\tconst showQuantityChanger = Feature.enabled(FeatureFlag.QUANTITY_CHANGER) && !item.is_part_of_bundle;\n\n\tconst $div = document.createElement('div');\n\t$div.className = 'pp-cart-img-qty';\n\n\tif (!showImage && !showQuantityChanger) {\n\t\tif (item.is_part_of_bundle) {\n\t\t\t$div.className = 'pp-cart-img';\n\t\t\treturn $div;\n\t\t}\n\n\t\t$div.className = 'pp-cart-img-qty-empty';\n\t\t$div.innerHTML += buildQuantityChanger(showImage, item);\n\t\treturn $div;\n\t}\n\n\tif (showImage) {\n\t\tif (item.is_part_of_bundle) {\n\t\t\t$div.className = 'pp-cart-img';\n\t\t\t$div.innerHTML = `<div class=\"product-img-td-b0\"><img class=\"pp-bundle-img-size\" src=\"${item.image?.[0] ?? ''}\"/></div>`;\n\t\t\treturn $div;\n\t\t}\n\n\t\t$div.innerHTML = `<div class=\"product-img-td-b0\"><img class=\"pp-product-img-size\" src=\"${item.image?.[0] ?? ''}\"/></div>`;\n\n\t\t$div.innerHTML += buildQuantityChanger(showImage, item);\n\t} else {\n\t\tconst $qtyContainer = document.createElement('div');\n\t\t$qtyContainer.className = 'pp-cart-img-qty-empty';\n\t\t$qtyContainer.innerHTML = buildQuantityChanger(showImage, item);\n\t\t$div.append($qtyContainer);\n\t}\n\n\treturn $div;\n}\n\nfunction buildQuantityChanger(showImage: boolean | string, item: WCCartItem) {\n\tconst width = `${cartItemQuantity(item)}`.length;\n\tconst showQuantityChanger = Feature.enabled(FeatureFlag.QUANTITY_CHANGER) && !item.is_part_of_bundle;\n\tconst quantityNumber = `<div class=\"pp-qty-changer-disabled ${showImage ? 'pp-qty-changer-with-img' : ''}\">${cartItemQuantity(item)}</div>`;\n\tconst quantityChanger = `\n\t<div class=\"quantity-changer ${showImage ? 'pp-qty-changer-with-img' : ''}\">\n\t\t<button type=\"button\" class=\"flex-center qty-btn decrease-qty ${cartItemQuantity(item) <= 1 ? 'pp-qty-scroll-end' : 'pp-qty-btn-hide'}\" data-qid=\"${item.item_key ?? ''}\">\n\t\t\t<img class=\"pp-qty-symbol\" src=\"${qtyMinusImageURL}\">\n\t\t</button>\n\t\t<input type=\"number\" min=\"0\" max=\"${item.stock_qty ? item.stock_qty : ''}\" class=\"qty-fs\" value=\"${cartItemQuantity(item)}\" data-qid=\"${item.item_key ?? ''}\" required style=\"width: ${width}ch;\" role=\"presentation\"/>\n\t\t<button type=\"button\" class=\"flex-center qty-btn increase-qty ${(item.stock_qty && cartItemQuantity(item) >= item.stock_qty) ? 'pp-qty-scroll-end' : 'pp-qty-btn-hide'}\" data-qid=\"${item\n\t.item_key ?? ''}\">\n\t\t\t<img class=\"pp-qty-symbol\" src=\"${qtyPlusImageURL}\">\n\t\t</button>\n\t</div>`;\n\treturn showQuantityChanger ? quantityChanger : quantityNumber;\n}\n","import {clearInput} from '../util/ui';\nimport {renderOrderNotice, requestCartCalculation} from '../payment/order';\nimport {store} from '../store';\nimport {Feature, startModalLoading, stopModalLoading} from '../reducers/environmentReducer';\nimport {eventClick} from '../util/dom';\nimport {$qsAll, $qs} from '../../../@shared/ts/dom';\nimport {type InitMessage} from '../../../@type/window-messages';\nimport {FeatureFlag} from '../../../@type/features';\nimport {type Maybe} from '../../../@shared/ts/maybe';\nimport {getLocaleText} from '../util/translation';\nimport {getErrorString} from '../../../@shared/ts/error';\n\nexport function initCouponInput(_message: InitMessage) {\n\tif (!Feature.enabled(FeatureFlag.COUPON_INPUT)) {\n\t\treturn;\n\t}\n\n\tdisplayCouponFeature();\n\n\thandleCouponInputEvents();\n\thandleCouponRemoval();\n}\n\n/**\n * Shows the coupon inputs. By default the coupon feature is not displayed.\n */\nfunction displayCouponFeature() {\n\tfor (const $form of $qsAll('.coupon-code-option')) {\n\t\t$form.classList.remove('hide');\n\t}\n\n\t$qs('#coupon-code-section')?.classList.remove('hide');\n}\n\nfunction handleCouponInputEvents() {\n\t// For submitting coupon input\n\tfor (const $form of $qsAll<HTMLFormElement>('form.wc-coupon-code')) {\n\t\t$form.addEventListener('submit', async event => {\n\t\t\tevent.preventDefault();\n\n\t\t\tconst data = new FormData((event.target as HTMLFormElement) ?? undefined);\n\t\t\tconst code = (data.get('coupon_code') as string)?.trim() ?? '';\n\n\t\t\tstartCouponLoading();\n\n\t\t\tawait applyCoupon(code);\n\t\t\tawait requestCartCalculation();\n\n\t\t\tstopCouponLoading();\n\t\t});\n\t}\n\n\t// For opening coupon input\n\tfor (const $openCoupon of $qsAll('.coupon-code-option')) {\n\t\t$openCoupon.addEventListener('click', showCouponInput);\n\t\t$openCoupon.addEventListener('keypress', showCouponInput);\n\t}\n}\n\nfunction handleCouponRemoval() {\n\t$qsAll('#pp-summary-lines-body, #pp-summary-lines-body-mobile', $removeButtons => {\n\t\t$removeButtons.addEventListener('click', async (event: Event) => {\n\t\t\tconst $target = event.target as HTMLElement;\n\t\t\tif (!$target) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst $removeButton = $target.closest<HTMLButtonElement>('.pp-coupon-remove-button[data-coupon]');\n\t\t\tif (!$removeButton) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst {coupon} = $removeButton.dataset;\n\t\t\tif (!coupon) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tstore.dispatch(startModalLoading());\n\n\t\t\tawait removeCoupon(coupon);\n\t\t\tawait requestCartCalculation();\n\n\t\t\tstore.dispatch(stopModalLoading());\n\t\t});\n\t});\n}\n\nasync function applyCoupon(code: string): Promise<void> {\n\tconst applyCouponURL = Feature.metadata<string>(FeatureFlag.COUPON_INPUT, 'apply_coupon_url');\n\tconst applyCouponNonce = Feature.dynamicMetadata<string>(FeatureFlag.COUPON_INPUT, 'apply_coupon_nonce');\n\n\tif (!applyCouponURL || !applyCouponNonce) {\n\t\trenderOrderNotice(getLocaleText('Something went wrong. Please try again.'));\n\t\treturn;\n\t}\n\n\tconst formData = new FormData();\n\tformData.append('security', applyCouponNonce);\n\tformData.append('coupon_code', code);\n\n\tconst {error, result} = await fetch(applyCouponURL, {\n\t\tmethod: 'POST',\n\t\tcredentials: 'include',\n\t\tbody: formData,\n\t})\n\t\t.then(async response => response.text())\n\t\t.then(data => ({result: data}))\n\t\t.catch((error: unknown) => ({error})) as Maybe<string>;\n\n\tif (error || !result) {\n\t\tconst errorMessage = getErrorString(error) || getLocaleText('Something went wrong. Please try again.');\n\t\trenderOrderNotice(errorMessage);\n\t\treturn;\n\t}\n\n\tif (result.includes('woocommerce-error')) {\n\t\trenderOrderNotice(result);\n\t\treturn;\n\t}\n\n\trenderOrderNotice(result);\n\thideCouponInput();\n}\n\nasync function removeCoupon(code: string): Promise<boolean> {\n\tconst removeCouponURL = Feature.metadata<string>(FeatureFlag.COUPON_INPUT, 'remove_coupon_url');\n\tconst removeCouponNonce = Feature.dynamicMetadata<string>(FeatureFlag.COUPON_INPUT, 'remove_coupon_nonce');\n\n\tif (!removeCouponNonce || !removeCouponURL) {\n\t\trenderOrderNotice(getLocaleText('Something went wrong. Please try again.'));\n\t\treturn false;\n\t}\n\n\tconst formData = new FormData();\n\tformData.append('security', removeCouponNonce);\n\tformData.append('coupon', code);\n\n\tconst {error, result} = await fetch(removeCouponURL, {\n\t\tmethod: 'POST',\n\t\tcredentials: 'include',\n\t\tbody: formData,\n\t})\n\t\t.then(async response => response.text())\n\t\t.then(data => ({result: data}))\n\t\t.catch((error: unknown) => ({error})) as Maybe<string>;\n\n\tif (error || !result) {\n\t\tconst errorMessage = getErrorString(error) || getLocaleText('Something went wrong. Please try again.');\n\t\trenderOrderNotice(errorMessage);\n\t\treturn false;\n\t}\n\n\tif (result.includes('woocommerce-error')) {\n\t\trenderOrderNotice(result);\n\t\treturn false;\n\t}\n\n\trenderOrderNotice(result);\n\treturn true;\n}\n\nfunction startCouponLoading() {\n\tstore.dispatch(startModalLoading());\n\n\t$qsAll('form.wc-coupon-code input[type=\"submit\"]', (element: HTMLInputElement) => {\n\t\telement.disabled = true;\n\t});\n\n\tfor (const $spinner of $qsAll('.wc-coupon-spinner')) {\n\t\t$spinner.classList.remove('hide');\n\t}\n\n\t// Replace right border of wc-coupon-code-input with spinner\n\tfor (const $border of $qsAll('.wc-coupon-code-input')) {\n\t\t$border.classList.add('remove-right-border');\n\t}\n\n\tfor (const $applyButton of $qsAll<HTMLInputElement>('.wc-coupon-code-apply')) {\n\t\t$applyButton.disabled = true;\n\t}\n}\n\nfunction stopCouponLoading() {\n\tstore.dispatch(stopModalLoading());\n\n\t$qsAll('form.wc-coupon-code input[type=\"submit\"]', (element: HTMLInputElement) => {\n\t\telement.disabled = false;\n\t});\n\n\tfor (const $spinner of $qsAll('.wc-coupon-spinner')) {\n\t\t$spinner.classList.add('hide');\n\t}\n\n\tfor (const $border of $qsAll('.wc-coupon-code-input')) {\n\t\t$border.classList.remove('remove-right-border');\n\t}\n\n\tfor (const $applyButton of $qsAll<HTMLInputElement>('.wc-coupon-code-apply')) {\n\t\t$applyButton.disabled = false;\n\t}\n}\n\nfunction showCouponInput(event: MouseEvent | KeyboardEvent) {\n\tif (!eventClick(event)) {\n\t\treturn;\n\t}\n\n\tfor (const $coupon of $qsAll('form.wc-coupon-code')) {\n\t\t$coupon.classList.remove('hide');\n\t}\n\n\tfor (const $option of $qsAll('.coupon-code-option')) {\n\t\t$option.classList.add('hide');\n\t}\n\n\t$qsAll('.pp-dropdown', ($dd: HTMLElement) => {\n\t\t$dd?.classList.add('shorten');\n\t});\n\n\t$qs('#pp-modal-content')?.addEventListener('mousedown', detectExitTap);\n}\n\nfunction hideCouponInput() {\n\tfor (const $coupon of $qsAll('form.wc-coupon-code')) {\n\t\t$coupon.classList.add('hide');\n\t}\n\n\tfor (const $option of $qsAll('.coupon-code-option')) {\n\t\t$option.classList.remove('hide');\n\t}\n\n\tfor (const $invalid of $qsAll('.wc-invalid-coupon')) {\n\t\t$invalid.classList.add('hide');\n\t}\n\n\t$qsAll('.pp-dropdown', ($dd: HTMLElement) => {\n\t\t$dd?.classList.remove('shorten');\n\t});\n\n\t$qs('#pp-modal-content')?.removeEventListener('mousedown', detectExitTap);\n\tclearInput('.wc-coupon-code-input');\n}\n\nfunction detectExitTap(e: Event) {\n\tfor (const $el of $qsAll('form.wc-coupon-code')) {\n\t\tif ($el.contains(e.target as HTMLElement)) {\n\t\t\treturn;\n\t\t}\n\t}\n\n\thideCouponInput();\n}\n","import {$qsAll} from '../../../@shared/ts/dom';\nimport {type InitMessage} from '../../../@type/window-messages';\nimport {MerchantConfiguration, updateMerchantCurrencyConfig} from '../reducers/merchantConfigurationReducer';\nimport {store} from '../store';\n\nexport function initCurrency(message: InitMessage) {\n\tinitCurrencyEvents();\n\n\tstore.dispatch(updateMerchantCurrencyConfig({\n\t\tname: message.phpData.currency_info?.name ?? 'United States Dollar',\n\t\tcode: message.phpData.currency_info?.code ?? 'USD',\n\t\tsymbol: message.phpData?.currency_info?.symbol ?? '$',\n\t\tthousands_separator: message.phpData.currency_info?.thousands_separator ?? ',',\n\t\tdecimal_separator: message.phpData.currency_info?.decimal_separator ?? '.',\n\t\tnumber_of_decimals: message.phpData.currency_info?.number_of_decimals ?? 2,\n\t\tposition: message.phpData.currency_info?.position ?? 'left',\n\t\trounding: message.phpData.currency_info?.rounding ?? 'disabled',\n\t\thidden: message.phpData.currency_info?.hidden ?? false,\n\t}));\n}\n\nfunction initCurrencyEvents() {\n\t// Set currency symbols whenever the modal currency state changes.\n\tstore.subscribe(() => {\n\t\trenderCurrencySymbols();\n\t});\n}\n\n/**\n * Renders the text content of all elements with the class\n * \".currency-symbol,.currency-symbol-after\" with the\n * current currency values.\n */\nfunction renderCurrencySymbols() {\n\tconst {position, symbol} = MerchantConfiguration.currency.configuration();\n\n\tconst right = position === 'right' || position === 'right_space';\n\tfor (const $element of $qsAll(`.currency-symbol${right ? '-after' : ''}`)) {\n\t\t$element.innerHTML = symbol;\n\t}\n}\n","function peachpayUpdateCurrencyCookie(newCurrency: string) {\n\tdocument.cookie = `pp_active_currency=${newCurrency};path=/`;\n}\n\nexport {peachpayUpdateCurrencyCookie};\n","import {onWindowMessage, $qsAll} from '../../../@shared/ts/dom';\nimport {type InitMessage, type PageLanguageChangeMessage} from '../../../@type/window-messages';\nimport {type IDictionary} from '../../../@type/dictionary';\nimport {Environment, updateLanguage, updateTranslatedModalTerms} from '../reducers/environmentReducer';\nimport {store} from '../store';\nimport {getLocaleText} from '../util/translation';\nimport {Feature} from '../reducers/environmentReducer';\nimport {FeatureFlag} from '../../../@type/features';\n\nlet TRANSLATED_MODAL_TERMS_ALL_LANGUAGES: Record<string, IDictionary>;\n\nexport function initLanguage(message: InitMessage) {\n\tinitLanguageEvents();\n\n\tconst language = message.phpData.language === 'detect-from-page' ? message.pageLanguage : message.phpData.language;\n\n\tstore.dispatch(updateLanguage(language));\n\n\tconst translatedModalTermsAllLanguages = Feature.metadata<Record<string, IDictionary>>(FeatureFlag.TRANSLATED_MODAL_TERMS, 'all_languages');\n\tif (translatedModalTermsAllLanguages) {\n\t\tTRANSLATED_MODAL_TERMS_ALL_LANGUAGES = translatedModalTermsAllLanguages;\n\n\t\tstore.dispatch(updateTranslatedModalTerms(TRANSLATED_MODAL_TERMS_ALL_LANGUAGES?.[language] ?? {}));\n\t} else {\n\t\tconst translatedModalTerms = Feature.metadata<IDictionary>(FeatureFlag.TRANSLATED_MODAL_TERMS, 'selected_language');\n\t\tstore.dispatch(updateTranslatedModalTerms(translatedModalTerms ?? {}));\n\t}\n}\n\nfunction initLanguageEvents() {\n\tonWindowMessage<PageLanguageChangeMessage>('pageLanguageChange', message => {\n\t\tstore.dispatch(updateLanguage(message.language));\n\n\t\tstore.dispatch(updateTranslatedModalTerms(TRANSLATED_MODAL_TERMS_ALL_LANGUAGES?.[message.language] ?? {}));\n\t});\n\n\tstore.subscribe(() => {\n\t\trenderLocaleText();\n\t});\n}\n\nfunction renderLocaleText() {\n\tfor (const $element of $qsAll('[data-i18n]')) {\n\t\tif ($element.nodeName === 'INPUT' && ($element as HTMLInputElement).type === 'submit') {\n\t\t\t($element as HTMLInputElement).value = getLocaleText($element?.dataset['i18n'] ?? '');\n\t\t} else if ($element.nodeName === 'INPUT') {\n\t\t\t($element as HTMLInputElement).placeholder = getLocaleText($element?.dataset?.['i18n'] ?? '');\n\t\t} else if ($element?.dataset['i18n'] === 'Back' && Environment.language() !== 'en-US') {\n\t\t\t($element.textContent) = getLocaleText('Return');\n\t\t} else {\n\t\t\t$element.textContent = getLocaleText($element?.dataset['i18n'] ?? '');\n\t\t}\n\t}\n\n\t// A Romanian merchant says that even after changing Chrome's language, the\n\t// required input validity message shows up in English. The device should take\n\t// care of this, so I'm not sure what's going on over at the merchant's end.\n\t// This is the most convenient way to fix the issue for now.\n\tif (Environment.language() === 'ro-RO') {\n\t\tsetCustomValidityMessage();\n\t}\n}\n\nfunction setCustomValidityMessage(): void {\n\t// Only used for one specific merchant who insists that his device doesn't\n\t// do the translation\n\tfor (const $input of $qsAll<HTMLInputElement>('form input')) {\n\t\t$input.addEventListener('invalid', () => {\n\t\t\t$input.setCustomValidity('Te rugăm sa completezi acest câmp.');\n\t\t});\n\n\t\t$input.addEventListener('input', () => {\n\t\t\t$input.setCustomValidity('');\n\t\t});\n\t}\n}\n","import {$qs, onWindowMessage} from '../../../@shared/ts/dom';\nimport {type ButtonClickedMessage} from '../../../@type/window-messages';\nimport {Environment} from '../reducers/environmentReducer';\nimport {MerchantConfiguration} from '../reducers/merchantConfigurationReducer';\n\nexport function initMetrics() {\n\t// Pay button metrics\n\t$qs('#pp-pay')?.addEventListener('click', () => {\n\t\trecordNonPPButtonClick('pp-pay');\n\t});\n\t$qs('#pp-pay-mobile')?.addEventListener('click', () => {\n\t\trecordNonPPButtonClick('pp-pay-mobile');\n\t});\n\n\t// Continue button metrics\n\t$qs('#pp-continue-to-shipping')?.addEventListener('click', () => {\n\t\trecordNonPPButtonClick('pp-continue-to-shipping');\n\t});\n\t$qs('#pp-continue-to-shipping-mobile')?.addEventListener('click', () => {\n\t\trecordNonPPButtonClick('pp-continue-to-shipping-mobile');\n\t});\n\n\t// Plugin button metrics\n\tonWindowMessage<ButtonClickedMessage>('buttonClicked', message => {\n\t\t// Button Metrics Lambda API trigger with a buttonClicked Event Type\n\t\trecordButtonClick(buttonTypeValidation(message.buttonID), getPPButtonLocation(message));\n\t});\n}\n\nexport function buttonTypeValidation(buttonType: string | undefined): string {\n\treturn buttonType ?? 'unknown';\n}\n\n// Used to record clicks that aren't pp-button / pp-button-mini\nexport function recordNonPPButtonClick(buttonType: string) {\n\trecordButtonClick(buttonType, PPButtonLocation.NotApplicable);\n}\n\nexport function recordButtonClick(buttonType: string, ppButtonLocation: PPButtonLocation) {\n\tpostButtonMetrics({\n\t\tdomain: MerchantConfiguration.hostName(),\n\t\tbuttonType,\n\t\tppButtonLocation,\n\t\tisMobile: Environment.customer.mobile(),\n\t\tisTestMode: Environment.testMode(),\n\t});\n}\n\nexport enum PPButtonLocation {\n\tProduct = 'product',\n\tCheckout = 'checkout',\n\tMiniCart = 'mini-cart',\n\tCart = 'cart',\n\tNotApplicable = 'not-applicable',\n}\n\nexport function getPPButtonLocation(message: ButtonClickedMessage): PPButtonLocation {\n\tif (message.isMiniCart) {\n\t\treturn PPButtonLocation.MiniCart;\n\t}\n\n\tswitch (Environment.plugin.pageType()) {\n\t\tcase ('cart'):\n\t\t\treturn PPButtonLocation.Cart;\n\t\tcase ('checkout'):\n\t\t\treturn PPButtonLocation.Checkout;\n\t\tcase ('product'):\n\t\t\treturn PPButtonLocation.Product;\n\t\tdefault:\n\t\t\treturn PPButtonLocation.NotApplicable;\n\t}\n}\n\nexport type ButtonMetricOptions = {\n\tdomain: string;\n\tbuttonType: string;\n\tppButtonLocation: PPButtonLocation;\n\tisMobile: boolean;\n\tisTestMode: boolean;\n};\n\nexport function postButtonMetrics(options: ButtonMetricOptions) {\n\tif (!options.isTestMode) {\n\t\t// Promise .then/.catch used to prevent any potential blocking.\n\t\tfetch(\n\t\t\t`https://2fad6w3exg.execute-api.us-east-1.amazonaws.com/v1/buttonstats?domain=${options.domain}&buttonType=${options.buttonType}&ppButtonLocation=${String(options.ppButtonLocation)}&isMobile=${\n\t\t\t\tString(options.isMobile)\n\t\t\t}&isProductionData=${String(isProductionDomain(options.domain))}`,\n\t\t).then(() => {\n\t\t\t// It worked!\n\t\t}).catch(() => {\n\t\t\t// Do no harm.\n\t\t});\n\t}\n}\n\nexport function isProductionDomain(domain: string): boolean {\n\tswitch (domain) {\n\t\tcase ('localhost'):\n\t\tcase ('127.0.0.1'):\n\t\tcase ('store.local'):\n\t\tcase ('woo.store.local'):\n\t\tcase ('woo.peachpay.app'):\n\t\tcase ('theme1.peachpay.app'):\n\t\tcase ('theme2.peachpay.app'):\n\t\tcase ('theme3.peachpay.app'):\n\t\tcase ('theme4.peachpay.app'):\n\t\tcase ('theme5.peachpay.app'):\n\t\tcase ('qa.peachpay.app'):\n\t\tcase ('demo.peachpay.app'):\n\t\tcase ('ui-test.peachpay.app'):\n\t\t\treturn false;\n\t\tdefault:\n\t\t\treturn true;\n\t}\n}\n","import {selectDropdown} from '../util/ui';\nimport {type ICurrencyConfiguration} from '../../../@type/woocommerce/currency-configuration';\nimport {type IDictionary} from '../../../@type/dictionary';\nimport {Feature, setFeatureSupport, startModalLoading, stopModalLoading} from '../reducers/environmentReducer';\nimport {store} from '../store';\nimport {MerchantConfiguration, updateMerchantCurrencyConfig} from '../reducers/merchantConfigurationReducer';\nimport {requestCartCalculation} from '../payment/order';\nimport {getLocaleText} from '../util/translation';\nimport {PeachPayCustomer} from '../reducers/peachPayCustomerReducer';\nimport {type CurrencyDefaultsTo, type ICurrencySwitcherFeatureConfig} from '../models/ICurrencySwitcherFeatureConfig';\nimport {$qsAll, $qs, fetchHostWindowData} from '../../../@shared/ts/dom';\nimport {FeatureFlag} from '../../../@type/features';\nimport {peachpayUpdateCurrencyCookie} from '../../../@shared/ts/currency';\nimport {setSelectedPaymentGateway} from '../reducers/paymentConfigurationReducer';\n\n/**\n * Initializes the currency switch function for peachpay\n */\nexport function initCurrencySwitcher() {\n\tif (!Feature.enabled(FeatureFlag.CURRENCY_SWITCHER_INPUT)) {\n\t\treturn;\n\t}\n\n\twindow.addEventListener('pp-update-currency-switcher-feature', updateCurrencySwitcherFeature);\n\trenderCurrencySelector();\n}\n\n/**\n * Renders the currency selector in the modal with all it's options\n */\nfunction renderCurrencySelector(): void {\n\t// Make sure any previous versions of the dropdown are deleted on render\n\t$qsAll('#pp_currency_select, #pp_currency_select_div', $removeSelector => {\n\t\t$removeSelector.remove();\n\t});\n\n\t// Insertion locations\n\tconst $insertionLocationNew = $qs('#pp-summary-body')?.parentElement;\n\tconst $insertionLocationMobile = $qs('#pp-pms-new-container');\n\n\t// Required globals\n\tconst currencyInfo = Feature.metadata<Record<string, ICurrencyConfiguration>>(FeatureFlag.CURRENCY_SWITCHER_INPUT, 'currency_info');\n\tif (!currencyInfo || Object.keys(currencyInfo).length < 2) {\n\t\treturn;\n\t}\n\n\t$insertionLocationNew?.insertAdjacentElement('afterend', buildCurrencySelectDiv(currencyInfo));\n\t$insertionLocationMobile?.insertAdjacentElement('afterend', buildCurrencySelectDiv(currencyInfo, 'pp-currency-mobile'));\n}\n\nfunction buildCurrencySelectDiv(data: Record<string, ICurrencyConfiguration>, customClasses = ''): Element {\n\tconst $options = renderCurrencyList(getCurrencyDropDownInfo(data), MerchantConfiguration.currency.code());\n\n\t// Selector div and title creation\n\tconst currencyContainer = document.createElement('div');\n\tconst $currencySelectTitle = document.createElement('span');\n\t$currencySelectTitle.innerHTML = getLocaleText('Currency');\n\t$currencySelectTitle.setAttribute('class', 'pp-title');\n\tcurrencyContainer.id = 'pp_currency_select_div';\n\tcurrencyContainer.setAttribute('class', 'pp-section-mb ' + customClasses);\n\tcurrencyContainer.append($currencySelectTitle);\n\n\tconst $currencySelect = document.createElement('select');\n\t$currencySelect.innerHTML = $options;\n\t$currencySelect.classList.add('pp-currency-selector');\n\tselectDropdown($currencySelect, MerchantConfiguration.currency.code());\n\tconst selectContainer = document.createElement('div');\n\tselectContainer.classList.add('pp-currency-selector-container');\n\tselectContainer.append($currencySelect);\n\tcurrencyContainer.append(selectContainer);\n\n\t// Event listeners for the dropdowns\n\t$currencySelect.addEventListener('change', currencyEventListener);\n\n\treturn currencyContainer as Element;\n}\n\nfunction getCurrencyDropDownInfo(currencyInfo: Record<string, ICurrencyConfiguration>): Record<string, string> {\n\t// Dropdown list data\n\tconst mappedCurrencies = {} as Record<string, string>;\n\tfor (const [key, currency] of Object.entries(currencyInfo)) {\n\t\tif (currency?.hidden) {\n\t\t\tmappedCurrencies[key + ' disabled'] = `(${currency.symbol}) - ${currency.name}`;\n\t\t} else {\n\t\t\tmappedCurrencies[key] = `(${currency.symbol}) - ${currency.name}`;\n\t\t}\n\t}\n\n\treturn mappedCurrencies;\n}\n\n/**\n * This function fires off a new Type of peachpay event called the currency Switch Event\n * This event will update the cookie on the woocommerce side allowing recalculation of Cart totals and order values to be correctly\n * Displayed\n * @param currency (the currency we will past to the window)\n */\nfunction sendCurrencySwitchMessage(currency: string): void {\n\tpeachpayUpdateCurrencyCookie(currency);\n\t// TODO folloup pr: alert the button code a page reload should occur if the express checkout is closed\n}\n\nasync function currencyEventListener(event: Event) {\n\tevent.preventDefault();\n\n\tconst currencyInfo = Feature.metadata<Record<string, ICurrencyConfiguration>>(FeatureFlag.CURRENCY_SWITCHER_INPUT, 'currency_info');\n\tconst $target = event.target as HTMLSelectElement;\n\t$target.blur();\n\tif (currencyInfo?.[$target.value] && $target.value !== MerchantConfiguration.currency.code()) {\n\t\tstore.dispatch(startModalLoading());\n\n\t\tstore.dispatch(updateMerchantCurrencyConfig({\n\t\t\t...MerchantConfiguration.currency.configuration(),\n\t\t\tcode: (currencyInfo?.[$target.value]?.code ?? MerchantConfiguration.currency.code()),\n\t\t}));\n\n\t\t// This event is to update the currency on the php side so we get the right currency in the modal\n\t\tsendCurrencySwitchMessage($target.value);\n\n\t\tawait requestCartCalculation();\n\n\t\tconst config = currencyInfo?.[$target.value];\n\t\tif (config) {\n\t\t\tstore.dispatch(updateMerchantCurrencyConfig(config));\n\t\t}\n\n\t\tstore.dispatch(stopModalLoading());\n\t}\n}\n\n/**\n * Generates a dropdown html select list for currencies since the default should not be the printed value it should be the selected value\n */\nfunction renderCurrencyList(data: IDictionary, defaultOption = ''): string {\n\tif (!data) {\n\t\tdata = {};\n\t}\n\n\tconst list = Object.entries(data).map(([key, value]) => `<option value=${key} ${(key === defaultOption) ? 'selected' : ''}> ${value} </option>`);\n\n\treturn list.join('');\n}\n\n/**\n * Syncs merchant currency config info with currency cookie if cookie changed\n * since last time site reloaded.\n */\nfunction refreshCurrencySelected() {\n\tconst currency = MerchantConfiguration.currency.code();\n\tconst currencyInfo = Feature.metadata<Record<string, ICurrencyConfiguration>>(FeatureFlag.CURRENCY_SWITCHER_INPUT, 'currency_info');\n\n\tif (!currency || currencyInfo === null || !(currency in currencyInfo)) {\n\t\treturn;\n\t}\n\n\tsendCurrencySwitchMessage(currency);\n}\n\n/**\n * Returns false if feature enabled, otherwise returns CurrencyDefaultsTo\n */\nfunction getCurrencyDefaultTo(): CurrencyDefaultsTo | null {\n\treturn Feature.metadata<CurrencyDefaultsTo>(FeatureFlag.CURRENCY_SWITCHER_INPUT, 'how_currency_defaults');\n}\n\n/**\n * Retrieves and updates selected currency and currency switcher to new modal data for a given country\n * @param country Country code string\n */\nexport async function updateCurrencySwitcherForCountry(country: string) {\n\tconst countryCSinput: ICurrencySwitcherFeatureConfig = await fetchHostWindowData('pp-get-modal-currency-data', {\n\t\tcountry,\n\t});\n\n\tif (!countryCSinput) {\n\t\treturn;\n\t}\n\n\tconst switcherEnabledForCountry = countryCSinput.enabled;\n\tconst curFeatureState = store.getState().environment.plugin.featureSupport;\n\n\tcurFeatureState['currency_switcher_input'] = countryCSinput;\n\tstore.dispatch(setFeatureSupport(curFeatureState));\n\n\tif (!switcherEnabledForCountry && countryCSinput.metadata.active_currency) {\n\t\tsendCurrencySwitchMessage(countryCSinput.metadata.active_currency.code);\n\t\tstore.dispatch(updateMerchantCurrencyConfig(countryCSinput.metadata.active_currency));\n\t} else if (switcherEnabledForCountry && !(MerchantConfiguration.currency.code() in countryCSinput.metadata.currency_info)) {\n\t\tsendCurrencySwitchMessage(countryCSinput.metadata.set_cur);\n\t\tconst config = countryCSinput.metadata.currency_info?.[countryCSinput.metadata.set_cur];\n\t\tif (config) {\n\t\t\tstore.dispatch(updateMerchantCurrencyConfig(config));\n\t\t}\n\t} else {\n\t\tsendCurrencySwitchMessage(MerchantConfiguration.currency.code());\n\t}\n}\n\n/**\n * Handles the pp-update-currency-switcher-feature event. Refreshes currency switcher data\n * as needed.\n */\nasync function updateCurrencySwitcherFeature() {\n\tstore.dispatch(startModalLoading());\n\n\tif (getCurrencyDefaultTo() === 'billing_country' && PeachPayCustomer.billing.country() && PeachPayCustomer.billing.country() !== '') {\n\t\tpeachpayUpdateCurrencyCookie(PeachPayCustomer.billing.country());\n\n\t\tawait updateCurrencySwitcherForCountry(PeachPayCustomer.billing.country());\n\t}\n\n\tawait requestCartCalculation();\n\trenderCurrencySelector();\n\n\trefreshCurrencySelected();\n\tstore.dispatch(stopModalLoading());\n}\n\nfunction setupCurrencyFallbackEvents() {\n\t$qs('body')?.addEventListener('click', async event => {\n\t\tconst $target = event.target as HTMLElement;\n\t\tconst $button = $target?.closest<HTMLElement>('.currency-fallback-button');\n\t\tif (!$button) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst gatewayId = $button.dataset['gateway'] ?? '';\n\t\tconst defaultCurrency = $button.dataset['currency'] ?? '';\n\n\t\tconst currencyInfo = Feature.metadata<Record<string, ICurrencyConfiguration>>(FeatureFlag.CURRENCY_SWITCHER_INPUT, 'currency_info');\n\t\tconst config = currencyInfo?.[defaultCurrency];\n\t\tif (!config) {\n\t\t\treturn;\n\t\t}\n\n\t\tstore.dispatch(startModalLoading());\n\t\tstore.dispatch(updateMerchantCurrencyConfig(config));\n\t\tpeachpayUpdateCurrencyCookie(defaultCurrency);\n\n\t\tstore.dispatch(setSelectedPaymentGateway(gatewayId));\n\n\t\tawait requestCartCalculation();\n\n\t\t$qsAll<HTMLSelectElement>('.pp-currency-selector', $el => {\n\t\t\tselectDropdown($el, defaultCurrency);\n\t\t});\n\n\t\tstore.dispatch(stopModalLoading());\n\t});\n}\n\nexport {\n\tsetupCurrencyFallbackEvents,\n};\n","import {$qsAll} from '../../../@shared/ts/dom';\nimport {FeatureFlag} from '../../../@type/features';\nimport {Feature} from '../reducers/environmentReducer';\nimport {store} from '../store';\n\nexport function initCustomOrderMessaging() {\n\tif (Feature.enabled(FeatureFlag.STORE_SUPPORT_MESSAGE)) {\n\t\tstore.subscribe(() => {\n\t\t\trenderCustomOrderMessaging();\n\t\t});\n\t}\n}\n\nfunction renderCustomOrderMessaging() {\n\tconst text = Feature.metadata<string>(FeatureFlag.STORE_SUPPORT_MESSAGE, 'text');\n\tconst type = Feature.metadata<string>(FeatureFlag.STORE_SUPPORT_MESSAGE, 'type');\n\n\tif (text && type) {\n\t\tif (type === 'inline') {\n\t\t\t$qsAll('.pp-custom-order-message-inline').forEach(($el: HTMLElement) => {\n\t\t\t\t$el.classList.remove('hide');\n\t\t\t});\n\t\t} else {\n\t\t\t$qsAll('#pp-custom-order-message-hover', ($el: HTMLElement) => {\n\t\t\t\t$el.classList.remove('hide');\n\t\t\t});\n\t\t}\n\n\t\tconst $temp = document.createElement('div');\n\t\t$temp.innerHTML = text;\n\t\t// Links in the modal can break stuff so always target a new tab.\n\t\t$temp.querySelectorAll('a').forEach($a => {\n\t\t\t$a.setAttribute('target', '_blank');\n\t\t});\n\n\t\t/**\n         * Removes all elements that are not allowed in the custom order message. Mutates the element passed in.\n         */\n\t\tconst cleanSupportMessageHTML = (element: HTMLElement) => {\n\t\t\tconst childrenElements = Array.from(element.children);\n\t\t\tfor (const child of childrenElements) {\n\t\t\t\tif (!['A', 'BR', 'H1', 'H2', 'H3', 'H4', 'H5', 'H6', 'P', 'DIV', 'LI', 'UL', 'OL', 'SPAN', 'IMG'].includes(child.tagName)) {\n\t\t\t\t\tchild.remove();\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (child.children.length > 0) {\n\t\t\t\t\tcleanSupportMessageHTML(child as HTMLElement);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tcleanSupportMessageHTML($temp);\n\n\t\t$qsAll('.pp-custom-order-message', ($el: HTMLElement) => {\n\t\t\t$el.innerHTML = $temp.innerHTML;\n\t\t});\n\t} else {\n\t\t$qsAll('.pp-custom-order-message-inline').forEach(($el: HTMLElement) => {\n\t\t\t$el.classList.add('hide');\n\t\t});\n\t\t$qsAll('#pp-custom-order-message-hover', ($el: HTMLElement) => {\n\t\t\t$el.classList.add('hide');\n\t\t});\n\t}\n}\n","import {clearInput} from '../util/ui';\nimport {renderOrderNotice, requestCartCalculation} from '../payment/order';\nimport {store} from '../store';\nimport {Feature, startModalLoading, stopModalLoading} from '../reducers/environmentReducer';\nimport {$qsAll, $qs} from '../../../@shared/ts/dom';\nimport {FeatureFlag} from '../../../@type/features';\nimport {maybeFetch} from '../../../@shared/ts/maybe';\nimport {getErrorString} from '../../../@shared/ts/error';\nimport {getLocaleText} from '../util/translation';\nimport {eventClick} from '../util/dom';\n\nexport function initGiftCardInput() {\n\tif (!Feature.enabled(FeatureFlag.GIFTCARD_INPUT)) {\n\t\treturn;\n\t}\n\n\tdisplayGiftCardFeature();\n\n\thandleGiftcardInputEvents();\n}\n\nfunction displayGiftCardFeature() {\n\tfor (const $form of $qsAll('.gift-card-option')) {\n\t\t$form.classList.remove('hide');\n\t}\n\n\t$qs('#gift-card-section')?.classList.remove('hide');\n}\n\nasync function applyGiftCard(giftCardNumber: string): Promise<void> {\n\tconst ajaxURL = Feature.metadata<string>(FeatureFlag.EXPRESS_CHECKOUT, 'admin_ajax_url');\n\tconst applyGiftcardNonce = Feature.dynamicMetadata<string>(FeatureFlag.GIFTCARD_INPUT, 'pw_gift_cards_apply_nonce');\n\tif (!ajaxURL || !applyGiftcardNonce) {\n\t\trenderOrderNotice(getLocaleText('Something went wrong. Please try again.'));\n\t\treturn;\n\t}\n\n\tconst formData = new FormData();\n\tformData.append('action', 'pw-gift-cards-redeem');\n\tformData.append('card_number', giftCardNumber);\n\tformData.append('security', applyGiftcardNonce);\n\n\tconst {error, result} = await maybeFetch<{success: boolean; data?: {message: string}}>(ajaxURL, {\n\t\tmethod: 'POST',\n\t\tbody: formData,\n\t});\n\n\tconst defaultErrorMessage = getLocaleText('Something went wrong. Please try again.');\n\tif (error || !result) {\n\t\tconst errorMessage = getErrorString(error) || defaultErrorMessage;\n\t\trenderOrderNotice(errorMessage);\n\t\treturn;\n\t}\n\n\tif (!result.success) {\n\t\trenderOrderNotice(result.data?.message ? result.data.message : defaultErrorMessage);\n\t\treturn;\n\t}\n\n\tif (result.data?.message) {\n\t\trenderOrderNotice(result.data.message);\n\t}\n\n\thideGiftCardInput();\n}\n\nfunction handleGiftcardInputEvents() {\n\t// For submitting gift card input\n\tfor (const $form of $qsAll<HTMLFormElement>('form.pw-wc-gift-card')) {\n\t\t$form.addEventListener('submit', async event => {\n\t\t\tevent.preventDefault();\n\n\t\t\tif (!$form.checkValidity()) {\n\t\t\t\t$form.reportValidity();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tshowGiftCardLoadingState();\n\n\t\t\tconst data = new FormData(event.target as HTMLFormElement);\n\t\t\tconst giftCardNumber = (data.get('card_number') as string)?.trim() ?? '';\n\n\t\t\tawait applyGiftCard(giftCardNumber);\n\t\t\tawait requestCartCalculation();\n\n\t\t\thideGiftCardLoadingState();\n\t\t});\n\t}\n\n\t// For opening gift card input\n\tfor (const $giftCard of $qsAll('.gift-card-option')) {\n\t\t$giftCard.addEventListener('click', showGiftCardInput);\n\t\t$giftCard.addEventListener('keypress', showGiftCardInput);\n\t}\n}\n\nfunction showGiftCardInput(event: MouseEvent | KeyboardEvent) {\n\tif (!eventClick(event)) {\n\t\treturn;\n\t}\n\n\tfor (const $coupon of $qsAll('form.pw-wc-gift-card')) {\n\t\t$coupon.classList.remove('hide');\n\t}\n\n\tfor (const $option of $qsAll('.gift-card-option')) {\n\t\t$option.classList.add('hide');\n\t}\n\n\t$qsAll('.pp-dropdown', ($dd: HTMLElement) => {\n\t\t$dd?.classList.add('shorten');\n\t});\n\n\t$qs('#pp-modal-content')?.addEventListener('mousedown', detectExitTap);\n}\n\nfunction hideGiftCardInput() {\n\tfor (const $giftCard of $qsAll('form.pw-wc-gift-card')) {\n\t\t$giftCard.classList.add('hide');\n\t}\n\n\tfor (const $option of $qsAll('.gift-card-option')) {\n\t\t$option.classList.remove('hide');\n\t}\n\n\t$qsAll('.pp-dropdown', ($dd: HTMLElement) => {\n\t\t$dd?.classList.remove('shorten');\n\t});\n\n\t$qs('#pp-modal-content')?.removeEventListener('mousedown', detectExitTap);\n\tclearInput('.wc-gift-card-input');\n}\n\nfunction detectExitTap(e: Event) {\n\tfor (const $el of $qsAll('form.pw-wc-gift-card')) {\n\t\tif ($el.contains(e.target as HTMLElement)) {\n\t\t\treturn;\n\t\t}\n\t}\n\n\thideGiftCardInput();\n}\n\nfunction hideGiftCardLoadingState() {\n\tstore.dispatch(stopModalLoading());\n\n\tfor (const $spinner of $qsAll('.wc-coupon-spinner')) {\n\t\t$spinner.classList.add('hide');\n\t}\n\n\tfor (const $border of $qsAll('.wc-gift-card-input')) {\n\t\t$border.classList.remove('remove-right-border');\n\t}\n\n\tfor (const $applyButton of $qsAll<HTMLInputElement>('.gift-card-apply')) {\n\t\t$applyButton.disabled = false;\n\t}\n}\n\nfunction showGiftCardLoadingState() {\n\tstore.dispatch(startModalLoading());\n\n\tfor (const $spinner of $qsAll('.wc-coupon-spinner')) {\n\t\t$spinner.classList.remove('hide');\n\t}\n\n\t// Replace right border of gift-card-input with spinner\n\tfor (const $border of $qsAll('.wc-gift-card-input')) {\n\t\t$border.classList.add('remove-right-border');\n\t}\n\n\tfor (const $applyButton of $qsAll<HTMLInputElement>('.gift-card-apply')) {\n\t\t$applyButton.disabled = true;\n\t}\n}\n","import {store} from '../store';\nimport {renderCustomerFields} from './customer';\nimport {Environment, startModalLoading, stopModalLoading} from '../reducers/environmentReducer';\nimport {PeachPayCustomer} from '../reducers/peachPayCustomerReducer';\nimport {$qs} from '../../../@shared/ts/dom';\n\n/* Makes sure the modal responds to window resize and scrolling WHILE the mobile slide-up view is open. */\nfunction handleResponsiveness() {\n\tconst ppModalContent = $qs('#pp-modal-content');\n\tif (ppModalContent) {\n\t\tlet location;\n\t\tlet mobileWidth;\n\t\tif (ppModalContent.classList.contains('pp-content-mobile')) {\n\t\t\tlocation = 'mobile';\n\t\t\tmobileWidth = '666px';\n\t\t} else {\n\t\t\tlocation = 'new';\n\t\t\tmobileWidth = '900px';\n\t\t}\n\n\t\tif (window.matchMedia(`(max-width: ${mobileWidth})`).matches) {\n\t\t\t$qs(`#pp-${location}-customer-checkout`)?.classList.add('pp-dark-blur');\n\t\t\t$qs('.pp-close')?.classList.add('pp-dark-blur');\n\t\t\tppModalContent.style.height = '100vh';\n\t\t\tppModalContent.style.overflow = 'hidden';\n\t\t} else {\n\t\t\t$qs(`#pp-${location}-customer-checkout`)?.classList.remove('pp-dark-blur');\n\t\t\t$qs('.pp-close')?.classList.remove('pp-dark-blur');\n\t\t\tppModalContent?.style.removeProperty('height');\n\t\t\tppModalContent?.style.removeProperty('overflow');\n\t\t}\n\t}\n}\n\n/* Opens the slide-up view of the id #pp-slide-up-<modaName>-mobile. */\nexport function openSlideUpView(modalName: string) {\n\tconst backgroundElement = $qs(`#pp-slide-up-${modalName}-mobile .pp-slide-up-view-bg`);\n\tconst backarrow = $qs(`#pp-slide-up-${modalName}-mobile .pp-slide-up-header`);\n\n\t$qs(`#pp-slide-up-${modalName}-mobile`)?.classList.add('expanded');\n\t$qs('.pp-close')?.scrollIntoView();\n\twindow.addEventListener('resize', handleResponsiveness);\n\tsetTimeout(() => {\n\t\thandleResponsiveness();\n\t}, 100);\n\tif (modalName === 'cart') {\n\t\t$qs('#pp-dropdown-new')?.setAttribute('aria-expanded', 'true');\n\t}\n\n\t/* Closes the slide-up view. */\n\tconst tapToClose = (e: Event) => {\n\t\te.stopImmediatePropagation();\n\t\tcloseSlideUpView(modalName);\n\t\tbackgroundElement?.removeEventListener('click', tapToClose);\n\t\tbackarrow?.removeEventListener('click', tapToClose);\n\t\twindow.removeEventListener('resize', handleResponsiveness);\n\t\tif (modalName === 'cart') {\n\t\t\tconst dropDown = $qs('#pp-dropdown-new');\n\t\t\tdropDown?.removeEventListener('click', tapToClose);\n\t\t\tdropDown?.removeEventListener('keypress', closeCartWithKeyPress);\n\t\t\tdropDown?.addEventListener('keypress', openCartWithKeyPress);\n\t\t\tdropDown?.addEventListener('click', openCart);\n\t\t} else {\n\t\t\t$qs(`#pp-${modalName}-cancel`)?.removeEventListener('click', tapToClose);\n\t\t}\n\t};\n\n\t/* Closes the slide-up view only after asking whether the unsaved changes don't need to be saved\n\tand the customer confirms. */\n\tconst cancelAndClose = (e: Event) => {\n\t\te.stopImmediatePropagation();\n\t\tconst modalPage = Environment.modalUI.page();\n\t\tconst formID = modalPage === 'info' ? '#pp-info-form' : '#pp-different-shipping-details';\n\t\tconst infoFormValidity = $qs<HTMLFormElement>(`${formID}`)?.checkValidity() ?? false;\n\t\tif ($qs(`#pp-${modalName}-mobile-save`)?.hasAttribute('disabled')) {\n\t\t\tif (!infoFormValidity) {\n\t\t\t\topenSlideUpView('ship-to');\n\t\t\t\t$qs<HTMLFormElement>(`${formID}`)?.reportValidity();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcloseSlideUpView(modalName);\n\t\t\tbackgroundElement?.removeEventListener('click', cancelAndClose);\n\t\t\tbackarrow?.removeEventListener('click', cancelAndClose);\n\t\t\twindow.removeEventListener('resize', handleResponsiveness);\n\t\t\t$qs(`#pp-${modalName}-cancel .exit-back-btn`)?.removeEventListener('click', cancelAndClose);\n\t\t} else {\n\t\t\tif (!infoFormValidity) {\n\t\t\t\topenSlideUpView('ship-to');\n\t\t\t\t$qs<HTMLFormElement>(`${formID}`)?.reportValidity();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// eslint-disable-next-line no-alert\n\t\t\tif (confirm('Close without saving changes?')) {\n\t\t\t\tstore.dispatch(startModalLoading());\n\t\t\t\tcloseSlideUpView(modalName);\n\t\t\t\tbackgroundElement?.removeEventListener('click', cancelAndClose);\n\t\t\t\tbackarrow?.removeEventListener('click', cancelAndClose);\n\t\t\t\twindow.removeEventListener('resize', handleResponsiveness);\n\t\t\t\t$qs(`#pp-${modalName}-cancel .exit-back-btn`)?.removeEventListener('click', cancelAndClose);\n\t\t\t\trenderCustomerFields(PeachPayCustomer.data());\n\t\t\t\t$qs(`#pp-${modalName}-mobile-save`)?.setAttribute('disabled', '');\n\t\t\t\tstore.dispatch(stopModalLoading());\n\t\t\t}\n\t\t}\n\t};\n\n\t/* Wraps around the tapToClose function to check the key. */\n\tconst closeCartWithKeyPress = (event: KeyboardEvent) => {\n\t\tevent.preventDefault();\n\t\tevent.stopImmediatePropagation();\n\t\tif (event.key === 'Enter' || event.key === ' ') {\n\t\t\ttapToClose(event);\n\t\t}\n\t};\n\n\t/* Adding more event-listeners */\n\tif (modalName === 'ship-to') {\n\t\tbackgroundElement?.addEventListener('click', cancelAndClose);\n\t\tbackarrow?.addEventListener('click', cancelAndClose);\n\t\t$qs(`#pp-${modalName}-cancel .exit-back-btn`)?.addEventListener('click', cancelAndClose);\n\t} else {\n\t\tbackgroundElement?.addEventListener('click', tapToClose);\n\t\tbackarrow?.addEventListener('click', tapToClose);\n\t\tif (modalName !== 'cart') {\n\t\t\t$qs(`#pp-${modalName}-cancel`)?.addEventListener('click', tapToClose);\n\t\t}\n\t}\n\n\tif (modalName === 'cart') {\n\t\tconst dropDown = $qs('#pp-dropdown-new');\n\t\tdropDown?.addEventListener('click', tapToClose);\n\t\tdropDown?.addEventListener('keypress', closeCartWithKeyPress);\n\t\tdropDown?.removeEventListener('click', openCart);\n\t\tdropDown?.removeEventListener('keypress', openCartWithKeyPress);\n\t}\n}\n\n/* Closes the slide-up view and cleans up the modal UI. */\nexport function closeSlideUpView(modalName: string) {\n\tconst ppModalContent = $qs('#pp-modal-content');\n\tif (ppModalContent) {\n\t\tppModalContent.style.removeProperty('height');\n\t\tppModalContent.style.removeProperty('overflow');\n\t}\n\n\tconst location = ppModalContent?.classList.contains('pp-content-mobile') ? 'mobile' : 'new';\n\t$qs(`#pp-slide-up-${modalName}-mobile`)?.classList.remove('expanded');\n\t$qs(`#pp-${location}-customer-checkout`)?.classList.remove('pp-dark-blur');\n\t$qs('.pp-close')?.classList.remove('pp-dark-blur');\n\tif (modalName === 'cart') {\n\t\t$qs('#pp-dropdown-new')?.setAttribute('aria-expanded', 'false');\n\t}\n}\n\nfunction openCart() {\n\topenSlideUpView('cart');\n}\n\n/* Checks the key value before opening the cart. */\nfunction openCartWithKeyPress(event: KeyboardEvent) {\n\tevent.preventDefault();\n\tevent.stopImmediatePropagation();\n\tif (event.key === 'Enter' || event.key === ' ') {\n\t\topenSlideUpView('cart');\n\t}\n}\n\nexport {\n\topenCart,\n\topenCartWithKeyPress,\n};\n","import {type ModalPage} from '../models/IEnvironment';\nimport {Feature} from '../reducers/environmentReducer';\nimport {$qs, $qsAll} from '../../../@shared/ts/dom';\nimport {FeatureFlag} from '../../../@type/features';\nimport {openCart, openCartWithKeyPress} from './slideUpView';\n\nexport function renderModalPage(modalPage: ModalPage) {\n\trenderInfoPageDisplay(modalPage);\n\trenderShippingPageDisplay(modalPage);\n\trenderPaymentPageDisplay(modalPage);\n\trenderModalButtonShadow();\n\n\t$qs('#pp-dropdown-new')?.addEventListener('click', openCart);\n\t$qs('#pp-dropdown-new')?.addEventListener('keypress', openCartWithKeyPress);\n}\n\n/**\n * Renders or shows the info page elements\n */\nfunction renderInfoPageDisplay(modalPage: ModalPage): void {\n\tif (modalPage === 'info') {\n\t\t$qs('#pp-info')?.classList.remove('hide');\n\t} else {\n\t\t// Hide info page\n\t\t$qs('#pp-info')?.classList.add('hide');\n\t}\n}\n\n/* Updates the UI for the case: modalUI === 'shipping'  */\nfunction renderShippingPageDisplay(\n\tmodalPage: ModalPage,\n): void {\n\tif (modalPage === 'shipping') {\n\t\t$qs('#pp-shipping')?.classList.remove('hide');\n\t} else {\n\t\t// Hide shipping page\n\t\t$qs('#pp-shipping')?.classList.add('hide');\n\t}\n}\n\n/**\n * Handles changing the modal to the payment page\n */\nfunction renderPaymentPageDisplay(\n\tmodalPage: ModalPage,\n): void {\n\tif (modalPage === 'payment') {\n\t\t// Show payment page\n\t\t$qs('#pp-payment')?.classList.remove('hide');\n\t\t$qs('#extra-fields-section')?.classList.remove('hide');\n\t} else {\n\t\t// Hide payment page\n\t\t$qs('#pp-payment')?.classList.add('hide');\n\t}\n}\n\n/**\n * Updates the modals colors to match the merchants button color.\n */\nfunction renderModalButtonShadow(): void {\n\tconst buttonShadowClass = 'btn-shadow';\n\n\tif (Feature.enabled(FeatureFlag.BUTTON_SHADOW)) {\n\t\t$qsAll('.btn', $element => {\n\t\t\t$element.classList.add(buttonShadowClass);\n\t\t});\n\t} else {\n\t\t$qsAll('.btn', $element => {\n\t\t\t$element.classList.remove(buttonShadowClass);\n\t\t});\n\t}\n}\n","import {type ModalPage} from '../models/IEnvironment';\nimport {store} from '../store';\nimport {startModalLoading, stopModalLoading, updateEnvironment} from '../reducers/environmentReducer';\nimport {checkRequiredFields} from './additionalFields';\nimport {PeachPayCustomer, updateCustomerFields} from '../reducers/peachPayCustomerReducer';\nimport {updateCustomerAddressValidation} from '../reducers/peachPayOrderReducer';\nimport {requestCartCalculation} from '../payment/order';\nimport {$qs} from '../../../@shared/ts/dom';\nimport {renderCustomerFields} from './customer';\n\nexport function renderModalNavigation(modalPage: ModalPage) {\n\tif (modalPage === 'info') {\n\t\t$qs('#pp-exit-mobile')?.classList.remove('hide');\n\t\t$qs('#pp-back-to-info-mobile')?.classList.add('hide');\n\t\t$qs('#pp-back-to-shipping-mobile')?.classList.add('hide');\n\t} else if (modalPage === 'shipping') {\n\t\t$qs('#pp-exit-mobile')?.classList.add('hide');\n\t\t$qs('#pp-back-to-info-mobile')?.classList.remove('hide');\n\t\t$qs('#pp-back-to-shipping-mobile')?.classList.add('hide');\n\t} else if (modalPage === 'payment') {\n\t\t$qs('#pp-exit-mobile')?.classList.add('hide');\n\t\t$qs('#pp-back-to-info-mobile')?.classList.add('hide');\n\t\t$qs('#pp-back-to-shipping-mobile')?.classList.remove('hide');\n\t}\n}\n\nexport function renderModalPageIndicator(\n\tmodalPage: ModalPage,\n): void {\n\t// Show/hide info page indicator\n\tif (modalPage === 'info') {\n\t\t$qs('#pp-checkout-status-left')?.classList.add('current');\n\t\t$qs('#pp-checkout-status-left-text')?.classList.add('hide');\n\t\t$qs('#pp-checkout-status-middle')?.classList.remove('current');\n\t\t$qs('#pp-checkout-status-middle')?.classList.add('no-fill');\n\t\t$qs('#pp-checkout-status-middle')?.removeEventListener('click', backToShipping);\n\t\t$qs('#pp-checkout-status-middle-text')?.classList.add('hide');\n\t\t$qs('#pp-checkout-status-right')?.classList.remove('current');\n\t\t$qs('#pp-checkout-status-right')?.classList.add('no-fill');\n\t\t$qs('#pp-checkout-status-right')?.removeEventListener('click', shippingToPayment);\n\t} else if (modalPage === 'shipping') {\n\t\t$qs('#pp-checkout-status-left')?.classList.remove('current');\n\t\t$qs('#pp-checkout-status-left-text')?.classList.remove('hide');\n\t\t$qs('#pp-checkout-status-middle')?.classList.remove('no-fill');\n\t\t$qs('#pp-checkout-status-middle')?.classList.add('current');\n\t\t$qs('#pp-checkout-status-middle')?.removeEventListener('click', backToShipping);\n\t\t$qs('#pp-checkout-status-middle-text')?.classList.add('hide');\n\t\t$qs('#pp-checkout-status-right')?.classList.remove('current');\n\t\t$qs('#pp-checkout-status-right')?.classList.add('no-fill');\n\t\t// This prevents the #pp-info-form from getting submitted\n\t\t$qs('#pp-checkout-status-right')?.addEventListener('click', shippingToPayment);\n\t} else if (modalPage === 'payment') {\n\t\t$qs('#pp-checkout-status-left')?.classList.remove('current');\n\t\t$qs('#pp-checkout-status-left-text')?.classList.remove('hide');\n\t\t$qs('#pp-checkout-status-middle')?.classList.remove('current');\n\t\t$qs('#pp-checkout-status-middle')?.classList.remove('no-fill');\n\t\t// This prevents the #pp-info-form from getting submitted\n\t\t$qs('#pp-checkout-status-middle')?.addEventListener('click', backToShipping);\n\t\t$qs('#pp-checkout-status-middle-text')?.classList.remove('hide');\n\t\t$qs('#pp-checkout-status-right')?.classList.add('current');\n\t\t$qs('#pp-checkout-status-right')?.classList.remove('no-fill');\n\t\t$qs('#pp-checkout-status-right')?.removeEventListener('click', shippingToPayment);\n\t}\n\n\t$qs('#pp-checkout-status-left')?.addEventListener('click', backToInfo);\n}\n\nfunction shippingToPayment(event: Event): void {\n\tdispatchRequestedPage('payment');\n\tevent.preventDefault();\n\tif (checkRequiredFields()) {\n\t\tstore.dispatch(updateEnvironment({\n\t\t\tmodalPageType: 'payment',\n\t\t\trequestedPage: undefined,\n\t\t}));\n\t}\n\n\t$qs('.pp-close')?.scrollIntoView();\n}\n\nexport function continueToPayment(): void {\n\tdispatchRequestedPage('payment');\n\tif (checkRequiredFields()) {\n\t\tstore.dispatch(updateEnvironment({\n\t\t\tmodalPageType: 'payment',\n\t\t\trequestedPage: undefined,\n\t\t}));\n\t}\n\n\t$qs('.pp-close')?.scrollIntoView();\n}\n\nexport function backToInfo(): void {\n\tstore.dispatch(updateEnvironment({\n\t\tmodalPageType: 'info',\n\t}));\n\tstore.dispatch(updateCustomerAddressValidation(false));\n\t$qs('.pp-close')?.scrollIntoView();\n}\n\nexport async function backToShipping(event: Event, shipToDifferentAddress = false): Promise<void> {\n\tevent.preventDefault();\n\tstore.dispatch(updateCustomerAddressValidation(false));\n\tif (shipToDifferentAddress) {\n\t\trenderCustomerFields(PeachPayCustomer.data(), 'info');\n\n\t\tconst formFields = PeachPayCustomer.data().form_fields;\n\t\tformFields['ship_to_different_address'] = '1';\n\t\tstore.dispatch(updateCustomerFields(formFields));\n\t\t$qs<HTMLInputElement>(\n\t\t\t'#pp-continue-to-payment',\n\t\t\t$element => {\n\t\t\t\t$element.disabled = true;\n\t\t\t},\n\t\t);\n\t\t$qs('#pp-refresh-shipping-options', $element => {\n\t\t\t$element.style.display = 'block';\n\t\t});\n\t\tstore.dispatch(startModalLoading());\n\t\tawait requestCartCalculation();\n\t\tstore.dispatch(stopModalLoading());\n\t}\n\n\tstore.dispatch(updateEnvironment({\n\t\tmodalPageType: 'shipping',\n\t}));\n\t$qs('.pp-close')?.scrollIntoView();\n}\n\nexport function dispatchRequestedPage(page: ModalPage) {\n\tstore.dispatch(updateEnvironment({\n\t\trequestedPage: page,\n\t}));\n}\n","import {store} from '../store';\nimport {Environment, startModalLoading, stopModalLoading, updateEnvironment} from '../reducers/environmentReducer';\nimport {PeachPayOrder} from '../reducers/peachPayOrderReducer';\nimport {requestCartCalculation} from '../payment/order';\nimport {type LoadingMode, type ModalPage} from '../models/IEnvironment';\nimport {MerchantConfiguration} from '../reducers/merchantConfigurationReducer';\nimport {cartIsVirtual} from '../util/cart';\nimport {Carts, DefaultCart} from '../reducers/cartReducer';\nimport {getLocaleText} from '../util/translation';\nimport {PeachPayCustomer} from '../reducers/peachPayCustomerReducer';\nimport {renderModalPage} from './modalPage';\nimport {backToInfo, backToShipping, continueToPayment, dispatchRequestedPage, renderModalNavigation, renderModalPageIndicator} from './navigation';\nimport {eventClick} from '../util/dom';\nimport {type ButtonClickedMessage, type InitMessage} from '../../../@type/window-messages';\nimport {$qs, onWindowMessage, $qsAll} from '../../../@shared/ts/dom';\nimport {PaymentConfiguration} from '../reducers/paymentConfigurationReducer';\n\nexport function initModal(message: InitMessage) {\n\tinitPageSwitch();\n\tinsertCustomCheckoutCSS(message);\n\t// Keep modal state rendering up to date\n\tlet prevCurrencyCode = '';\n\tstore.subscribe(() => {\n\t\tif (Environment.modalUI.open()) {\n\t\t\t$qs('#pp-modal-content', $element => {\n\t\t\t\t$element.style.display = 'flex';\n\t\t\t});\n\t\t} else if (!Environment.modalUI.open()) {\n\t\t\t$qs('#pp-modal-content', $element => {\n\t\t\t\t$element.style.display = 'none';\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\trenderButtonColorTheme(Environment.plugin.buttonColor());\n\t\trenderTestModeBannerDisplay(Environment.testMode());\n\t\trenderModalPageIndicator(Environment.modalUI.page());\n\t\trenderModalNavigation(Environment.modalUI.page());\n\t\trenderContinueButtonDisplay(Environment.modalUI.page());\n\t\trenderContinueError(\n\t\t\tEnvironment.modalUI.page(),\n\t\t\tPeachPayOrder.errorMessage(),\n\t\t);\n\t\trenderContinueButtonLoading(Environment.modalUI.loadingMode());\n\t\tppDisableLoadingMode(Environment.modalUI.loadingMode());\n\t\tppBlurOnRecalculate(\n\t\t\tEnvironment.modalUI.loadingMode(),\n\t\t\tprevCurrencyCode !== MerchantConfiguration.currency.code(),\n\t\t);\n\t\tprevCurrencyCode = MerchantConfiguration.currency.code();\n\n\t\trenderModalPage(Environment.modalUI.page());\n\t\trenderOneClickCheckbox(\n\t\t\tEnvironment.modalUI.page(),\n\t\t);\n\t\trenderTermsAndCondition(\n\t\t\tEnvironment.modalUI.page(),\n\t\t\tmessage.phpData?.wc_terms_conditions ?? '',\n\t\t);\n\t\tskipShippingPage();\n\t\trenderHideOnMobile(Environment.customer.mobile());\n\n\t\trenderFreeOrderDisplay(DefaultCart.contents().length, Carts.total());\n\t\tdisplayErrorMessage(PeachPayOrder.errorMessage(), DefaultCart.contents().length, Carts.total());\n\t\trenderSummaryBorder();\n\t});\n\n\tonWindowMessage('UI::modalOpened', _ => {\n\t\tstore.dispatch(updateEnvironment({\n\t\t\tmodalIsOpen: true,\n\t\t}));\n\t});\n\n\tonWindowMessage('UI::modalClosed', _ => {\n\t\tstore.dispatch(updateEnvironment({\n\t\t\tmodalIsOpen: false,\n\t\t}));\n\n\t\tstore.dispatch(stopModalLoading());\n\t});\n\n\t// Event when the peachpay button is clicked\n\tonWindowMessage<ButtonClickedMessage>('buttonClicked', async () => {\n\t\topenCheckoutModal();\n\n\t\tstore.dispatch(startModalLoading());\n\t\tawait requestCartCalculation(true);\n\t\tstore.dispatch(stopModalLoading());\n\t});\n\n\t$qsAll('.pp-exit', (element: HTMLElement) => {\n\t\telement.addEventListener('click', requestCloseModal);\n\t});\n\t$qs('.pp-close')?.addEventListener('click', requestCloseModal); // Default click behavior.\n\t$qs('.pp-close')?.addEventListener('keypress', requestCloseModal); // Keypress for accessibility.\n\n\t$qs('#edit-info', ($element: HTMLElement) => {\n\t\t$element.addEventListener('click', async event => {\n\t\t\tawait backToShipping(event, true);\n\t\t});\n\t});\n\t$qsAll('.pp-back-to-info', (element: HTMLElement) => {\n\t\telement.addEventListener('click', backToInfo);\n\t});\n\t$qsAll('.pp-back-to-shipping', (element: HTMLElement) => {\n\t\telement.addEventListener('click', backToShipping);\n\t});\n\n\t$qs('#pp-continue-to-payment')?.addEventListener('click', continueToPayment);\n\t$qs('#pp-continue-to-payment-mobile')?.addEventListener('click', continueToPayment);\n}\n\n/**\n * Hides the prices by bluring them until we can show the real amount they will be\n *\n * @param loadingMode The current loading state of the modal\n */\nfunction ppBlurOnRecalculate(\n\tloadingMode: LoadingMode,\n\tcurrencyChanged: boolean,\n) {\n\tif (loadingMode === 'loading') {\n\t\t$qsAll('.pp-recalculate-blur', element => {\n\t\t\telement.classList.add('pp-blur');\n\t\t});\n\t\t// Currently this does not visibily work but requires shipping.ts refactor\n\t\tif (currencyChanged) {\n\t\t\t$qsAll('.pp-currency-blur', element => {\n\t\t\t\telement.classList.add('pp-blur');\n\t\t\t});\n\t\t}\n\t} else {\n\t\t$qsAll('.pp-recalculate-blur', element => {\n\t\t\telement.classList.remove('pp-blur');\n\t\t});\n\t\t$qsAll('.pp-currency-blur', element => {\n\t\t\telement.classList.remove('pp-blur');\n\t\t});\n\t}\n}\n\nfunction renderFreeOrderDisplay(cartCount: number, allCartsTotal: number) {\n\tif (cartCount > 0 && allCartsTotal === 0) {\n\t\t$qsAll('.pp-hide-on-free-order', $el => {\n\t\t\t$el.classList.add('hide');\n\t\t});\n\t} else {\n\t\t$qsAll('.pp-hide-on-free-order', $el => {\n\t\t\t$el.classList.remove('hide');\n\t\t});\n\t}\n}\n\nfunction displayErrorMessage(errorMessage: string, cartCount: number, allCartsTotal: number) {\n\tif (errorMessage === '') {\n\t\tif (cartCount <= 0 && allCartsTotal !== 0) {\n\t\t\t$qs('#pp-pms-new-container')?.classList.remove('hide');\n\t\t}\n\n\t\tfor (const $element of $qsAll('.hide-when-invalid')) {\n\t\t\t$element.classList.remove('hide');\n\t\t}\n\n\t\t$qs('#invalid-order-message')?.classList.add('hide');\n\t} else {\n\t\tif (PaymentConfiguration.eligibleGatewayCount() === 0 || cartCount === 0) {\n\t\t\t$qs('#pp-pms-new-container')?.classList.add('hide');\n\t\t}\n\n\t\tfor (const $element of $qsAll('.hide-when-invalid')) {\n\t\t\t$element.classList.add('hide');\n\t\t}\n\n\t\t$qs('#invalid-order-message')?.classList.remove('hide');\n\n\t\t$qs('#invalid-order-message', $element => {\n\t\t\t$element.innerHTML = errorMessage;\n\t\t});\n\t}\n}\n\nfunction openCheckoutModal(): void {\n\twindow.top?.postMessage('openModal', location.origin);\n}\n\n/**\n * Request the plugin javascript to close the modal.\n */\nfunction requestCloseModal(event: MouseEvent | KeyboardEvent): void {\n\tif (!eventClick(event)) {\n\t\treturn;\n\t}\n\n\t// This tells the parent to hide the overlay\n\twindow.top?.postMessage('closeModal', location.origin);\n\t// Hide cart notices so it doesn't reappear when checkout modal reopens.\n\t$qsAll('.pp-notice-container', $el => {\n\t\t$el.classList.add('hide');\n\t});\n}\n\nfunction renderContinueButtonDisplay(modalPage: ModalPage) {\n\tif (modalPage === 'info') {\n\t\t$qs('#pp-continue-to-shipping-mobile')?.classList.remove('hide');\n\t\t$qs('#pp-continue-to-payment-mobile')?.classList.add('hide');\n\t\t$qs('.pay-button-container-mobile')?.classList.add('hide');\n\t} else if (modalPage === 'shipping') {\n\t\t$qs('#pp-continue-to-shipping-mobile')?.classList.add('hide');\n\t\t$qs('#pp-continue-to-payment-mobile')?.classList.remove('hide');\n\t\t$qs('.pay-button-container-mobile')?.classList.add('hide');\n\t} else if (modalPage === 'payment') {\n\t\t$qs('#pp-continue-to-shipping-mobile')?.classList.add('hide');\n\t\t$qs('#pp-continue-to-payment-mobile')?.classList.add('hide');\n\t\t$qs('.pay-button-container-mobile')?.classList.remove('hide');\n\t}\n}\n\n/**\n * If we come across a error on the information page screen we don't want customers to have the ability to continue as normal as it might upset them we let the continue only to have them\n * not able to pay this way we can ensure that they can't continue to the pay screen by rendering order errors instead of the continue button.\n * @param modalPage current modal page\n * @param errorMessage The error message to display\n */\nfunction renderContinueError(modalPage: ModalPage, errorMessage: string) {\n\t$qsAll('.pp-continue-order-error', element => {\n\t\telement.innerHTML = '';\n\t\telement.classList.remove('pp-error');\n\t});\n\tif ((modalPage === 'info' || modalPage === 'shipping') && errorMessage !== '') {\n\t\t$qsAll('.pp-continue-order-error', element => {\n\t\t\telement.innerHTML = errorMessage;\n\t\t\telement.classList.add('pp-error');\n\t\t});\n\t}\n}\n\nfunction renderContinueButtonLoading(loadingMode: LoadingMode) {\n\tif (loadingMode === 'loading') {\n\t\t$qs<HTMLInputElement>('#pp-continue-to-shipping', $element => {\n\t\t\t$element.disabled = true;\n\t\t});\n\t\t$qs<HTMLInputElement>('#pp-continue-to-payment', $element => {\n\t\t\t$element.disabled = true;\n\t\t});\n\t\t$qs<HTMLInputElement>('#pp-continue-to-shipping-mobile', $element => {\n\t\t\t$element.disabled = true;\n\t\t},\n\t\t);\n\n\t\t$qs('#continue-spinner-shipping')?.classList.remove('hide');\n\t\t$qs('#continue-spinner-payment')?.classList.remove('hide');\n\t\t$qs('#continue-spinner-shipping-mobile')?.classList.remove('hide');\n\t\t$qs('#continue-spinner-payment-mobile')?.classList.remove('hide');\n\t\t$qsAll('.modal-lock-icon', $element => {\n\t\t\t$element.classList.add('hide');\n\t\t});\n\t} else {\n\t\t$qs<HTMLInputElement>('#pp-continue-to-shipping', $element => {\n\t\t\t$element.disabled = false;\n\t\t});\n\n\t\tif (!PeachPayCustomer.shipToDifferentAddress() || Carts.anyShippingMethodsAvailable()) {\n\t\t\t$qs<HTMLInputElement>(\n\t\t\t\t'#pp-continue-to-payment',\n\t\t\t\t$element => {\n\t\t\t\t\t$element.disabled = false;\n\t\t\t\t},\n\t\t\t);\n\t\t} else if (!Carts.anyShippingMethodsAvailable()) {\n\t\t\trenderContinueError('shipping', getLocaleText('There are no shipping methods available'));\n\t\t}\n\n\t\t$qs<HTMLInputElement>(\n\t\t\t'#pp-continue-to-shipping-mobile',\n\t\t\t$element => {\n\t\t\t\t$element.disabled = false;\n\t\t\t},\n\t\t);\n\t\t$qs('#continue-spinner-shipping')?.classList.add('hide');\n\t\t$qs('#continue-spinner-payment')?.classList.add('hide');\n\t\t$qs('#continue-spinner-shipping-mobile')?.classList.add('hide');\n\t\t$qs('#continue-spinner-payment-mobile')?.classList.add('hide');\n\t\t$qsAll('.modal-lock-icon', $element => {\n\t\t\t$element.classList.remove('hide');\n\t\t});\n\t}\n}\n\nfunction ppDisableLoadingMode(loadingMode: LoadingMode) {\n\tif (loadingMode === 'loading') {\n\t\t$qsAll<HTMLInputElement>('.pp-disabled-loading', $element => {\n\t\t\t$element.classList.add('pp-disabled');\n\t\t\t$element.classList.add('pp-mode-loading');\n\t\t});\n\t} else if (loadingMode === 'processing') {\n\t\t$qsAll<HTMLInputElement>('.pp-disabled-processing', $element => {\n\t\t\t$element.classList.add('pp-disabled');\n\t\t});\n\t} else {\n\t\t$qsAll<HTMLInputElement>('.pp-disabled-processing,.pp-disabled-loading', $element => {\n\t\t\t$element.classList.remove('pp-disabled');\n\t\t\t$element.classList.remove('pp-mode-loading');\n\t\t});\n\t}\n}\n\n/**\n * Renders the test mode banner around the modal.\n */\nfunction renderTestModeBannerDisplay(testMode: boolean): void {\n\tif (testMode) {\n\t\t$qs('.pp-container')?.classList.add('pp-test-mode');\n\t}\n}\n\n/**\n * Updates the modals colors to match the merchants button color.\n */\nfunction renderButtonColorTheme(color = '#21105d'): void {\n\t// Changes a css variable which is used in css classes.\n\tdocument.documentElement.style.setProperty('--peachpay-theme-color', color);\n\t// ~50% alpha\n\tdocument.documentElement.style.setProperty(\n\t\t'--peachpay-theme-color-opaque',\n\t\tcolor + '80',\n\t);\n\t// ~12% alpha\n\tdocument.documentElement.style.setProperty(\n\t\t'--peachpay-theme-color-light',\n\t\tcolor + '20',\n\t);\n}\n\n/* Event handler for the Continue button on billing page. */\nfunction dispatchPayment() {\n\tdispatchRequestedPage('payment');\n}\n\n/* If the cart is virtual and there are no additional fields or related products, skip the shipping page. */\nfunction skipShippingPage(): void {\n\tconst shouldSkipShippingPage = cartIsVirtual(DefaultCart.contents()) && $qs('#additional-fields-new')?.classList.contains('hide');\n\tif (shouldSkipShippingPage) {\n\t\t$qs('#pp-checkout-status-middle')?.classList.add('hide');\n\t\t$qsAll('#pp-continue-to-shipping, #pp-continue-to-shipping-mobile').forEach(($el: HTMLElement) => {\n\t\t\t$el.addEventListener('click', dispatchPayment);\n\t\t});\n\t\t$qsAll('.pp-back-to-shipping', (element: HTMLElement) => {\n\t\t\telement.addEventListener('click', backToInfo);\n\t\t});\n\n\t\tif (Environment.modalUI.page() === 'shipping') {\n\t\t\tbackToInfo();\n\t\t}\n\t} else {\n\t\t$qs('#pp-checkout-status-middle')?.classList.remove('hide');\n\t\t$qsAll('#pp-continue-to-shipping, #pp-continue-to-shipping-mobile').forEach(($el: HTMLElement) => {\n\t\t\t$el.removeEventListener('click', dispatchPayment);\n\t\t});\n\t\t$qsAll('.pp-back-to-shipping', (element: HTMLElement) => {\n\t\t\telement.removeEventListener('click', backToInfo);\n\t\t});\n\t}\n}\n\nfunction renderHideOnMobile(isMobile: boolean) {\n\tif (isMobile) {\n\t\t$qsAll('.pp-hide-on-mobile', $el => {\n\t\t\t$el.classList.add('hide');\n\t\t});\n\t} else {\n\t\t$qsAll('.pp-hide-on-mobile', $el => {\n\t\t\t$el.classList.remove('hide');\n\t\t});\n\t}\n}\n\n/**\n * Renders the Terms and Conditions section above the pay button.\n */\nfunction renderTermsAndCondition(page: ModalPage, terms?: string) {\n\tif (page === 'payment') {\n\t\t// eslint-disable-next-line\n\t\tconst merchantTermsConditions = terms ? `${getLocaleText(\"the store's\")} <a href='${terms}' target='_blank'>${getLocaleText('terms and conditions')}</a> ${getLocaleText('and')}` : '';\n\t\t$qsAll('.pp-tc-section', $el => {\n\t\t\t$el.innerHTML = '';\n\n\t\t\t$el.innerHTML += `<label class='pp-tc-contents'>${getLocaleText('By clicking the button above, you agree to')} ${merchantTermsConditions} ${getLocaleText('the')} PeachPay <a href='https://peachpay.app/terms' target='_blank'>${getLocaleText('terms')}</a> ${getLocaleText('and')} <a href='https://peachpay.app/privacy' target='_blank'>${getLocaleText('privacy policy')}</a>.</label>`;\n\t\t\t$el.classList.remove('hide');\n\t\t});\n\t} else {\n\t\t$qsAll('.pp-tc-section', $el => {\n\t\t\t$el.classList.add('hide');\n\t\t});\n\t}\n}\n\n/**\n * Renders the save payment info checkbox.\n */\nfunction renderOneClickCheckbox(page: ModalPage) {\n\tif (page === 'payment') {\n\t\t$qsAll('.pp-save-payment-info-section', $el => {\n\t\t\t$el.classList.remove('hide');\n\t\t});\n\t} else {\n\t\t$qsAll('.pp-save-payment-info-section', $el => {\n\t\t\t$el.classList.add('hide');\n\t\t});\n\t}\n}\n\nfunction insertCustomCheckoutCSS(message: InitMessage) {\n\tconst $body = document.querySelector('body');\n\tif ($body) {\n\t\tconst $style = document.createElement('style');\n\t\t$style.id = 'pp-custom-checkout-css';\n\t\t$style.appendChild(\n\t\t\tdocument.createTextNode(\n\t\t\t\tmessage.phpData.custom_checkout_css?.trim() ?? '',\n\t\t\t),\n\t\t);\n\n\t\t$body.insertAdjacentElement('beforeend', $style);\n\t}\n}\n\nfunction initPageSwitch() {\n\t$qs('#pp-continue-to-shipping')?.addEventListener('click', () => {\n\t\tdispatchRequestedPage('shipping');\n\t\t$qs('.pp-close')?.scrollIntoView();\n\t});\n\t$qs('#pp-continue-to-shipping-mobile')?.addEventListener('click', () => {\n\t\tdispatchRequestedPage('shipping');\n\t\t$qs('.pp-close')?.scrollIntoView();\n\t});\n\t$qs('#pp-checkout-status-middle')?.addEventListener('click', () => {\n\t\tdispatchRequestedPage('shipping');\n\t\t$qs('.pp-close')?.scrollIntoView();\n\t});\n\t$qs('#pp-checkout-status-right')?.addEventListener('click', () => {\n\t\tdispatchRequestedPage('payment');\n\t\t$qs('.pp-close')?.scrollIntoView();\n\t});\n}\n\nfunction renderSummaryBorder() {\n\tlet itemsHeight = 0;\n\t$qs('#pp-summary-body', $parent => {\n\t\tconst $children = $parent?.querySelectorAll('.pp-order-summary-item');\n\t\tif (!$children) {\n\t\t\treturn;\n\t\t}\n\n\t\tfor (const $child of Array.from($children)) {\n\t\t\titemsHeight += $child?.clientHeight ?? 0;\n\t\t}\n\n\t\tif ($parent?.clientHeight < itemsHeight) {\n\t\t\t$parent.classList.add('pp-review-border');\n\t\t} else {\n\t\t\t$parent.classList.remove('pp-review-border');\n\t\t}\n\t});\n}\n","import {store} from '../store';\nimport {Feature, startModalLoading, stopModalLoading} from '../reducers/environmentReducer';\nimport {type IOneClickUpsellProducts} from '../models/IOneClickUpsellProducts';\nimport {$qs, $qsAll} from '../../../@shared/ts/dom';\nimport {FeatureFlag} from '../../../@type/features';\nimport spinnerImageURL from '../../img/spinner.svg';\nimport {addProductToCart} from '../util/cart';\nimport {renderOrderNotice, requestCartCalculation} from '../payment/order';\nimport {getLocaleText} from '../util/translation';\n\nexport function initOneClickUpsell() {\n\tif (!Feature.enabled(FeatureFlag.ONE_CLICK_UPSELL)) {\n\t\treturn;\n\t}\n\n\tconst ocuFlow = Feature.metadata<string>(FeatureFlag.ONE_CLICK_UPSELL, 'pp_ocu_flow');\n\n\tif (ocuFlow === 'pp_button') {\n\t\tstore.subscribe(() => {\n\t\t\tif ($qs('#pp-ocu-container')?.getAttribute('aria-expanded') === 'false') {\n\t\t\t\tdisplayOCUPage();\n\t\t\t}\n\t\t});\n\t} else if (ocuFlow === 'before_payment') {\n\t\t$qsAll('#pp-continue-to-payment, #pp-continue-to-payment-mobile', element => {\n\t\t\telement.addEventListener('click', () => {\n\t\t\t\tstore.subscribe(() => {\n\t\t\t\t\tif ($qs('#pp-ocu-container')?.getAttribute('aria-expanded') === 'false') {\n\t\t\t\t\t\tdisplayOCUPage();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n}\n\n/**\n * UI for displaying the OCU page.\n */\nexport function displayOCUPage() {\n\tconst ocuHeadline = Feature.metadata<string>(FeatureFlag.ONE_CLICK_UPSELL, 'headline_text');\n\tconst ocuSubHeadline = Feature.metadata<string>(FeatureFlag.ONE_CLICK_UPSELL, 'sub_headline_text');\n\tconst acceptBtnText = Feature.metadata<string>(FeatureFlag.ONE_CLICK_UPSELL, 'accept_button_text');\n\tconst declineBtnText = Feature.metadata<string>(FeatureFlag.ONE_CLICK_UPSELL, 'decline_button_text');\n\tconst customDesc = Feature.metadata<string>(FeatureFlag.ONE_CLICK_UPSELL, 'custom_description');\n\tconst ocuProducts = Feature.dynamicMetadata<IOneClickUpsellProducts>(FeatureFlag.ONE_CLICK_UPSELL, 'pp_ocu_products');\n\n\t$qsAll('#pp-modal-content, #pp-related-products-section', $el => {\n\t\t$el.style.zIndex = '-1';\n\t});\n\trenderOCUPage(ocuHeadline, ocuSubHeadline, customDesc, acceptBtnText, declineBtnText, ocuProducts);\n\tinitOCUEvents();\n}\n\n/**\n * For rendering the One-Click-Upsell Page as a separate page from the checkout modal\n * @param ocuHeadline Headline text\n * @param subHeadline Sub-headline text\n * @param acceptBtnText Aceept button text\n * @param declineBtnText Decline button text\n * @param ocuProducts One-Click-Upsell product data\n */\n// eslint-disable-next-line max-params\nexport function renderOCUPage(\n\tocuHeadline: string | null,\n\tsubHeadline: string | null,\n\tcustomDesc: string | null,\n\tacceptBtnText: string | null,\n\tdeclineBtnText: string | null,\n\tocuProducts: IOneClickUpsellProducts | null,\n) {\n\tclearOCUSection();\n\tif (ocuProducts && ocuHeadline && ocuProducts && acceptBtnText && declineBtnText) {\n\t\tconst ocuContainer = $qs('#pp-ocu-container');\n\t\tocuContainer?.classList.remove('hide');\n\t\tocuContainer?.setAttribute('aria-expanded', 'true');\n\t\tconst ocuBody = document.createElement('div');\n\t\tocuBody.className = 'pp-ocu-body';\n\t\tocuBody.innerHTML = `\n                <button class=\"pp-ocu-close\">&times;</button>\n                <span class=\"pp-ocu-headline\">${ocuHeadline}</span>\n                <div class=\"pp-ocu-sub-headline ${subHeadline ? '' : 'hide'}\">\n                    <span>${subHeadline ?? ''}</span>\n                </div>\n                <div class=\"pp-ocu-contents\">\n                    <img class=\"pp-ocu-product-img\" src=${ocuProducts.image as unknown as string}>\n                    <span class=\"pp-ocu-product-name\">${ocuProducts.name}</span>\n                    <span class=\"pp-ocu-product-description ${customDesc ? '' : 'hide'}\">${customDesc ?? ''}</span>\n                    <div class=\"pp-ocu-product-price\">${ocuProducts.price}</div>\n                </div>\n                <button class=\"pp-ocu-accept-button\" data-ocu_id=${ocuProducts.id}>${acceptBtnText}</button>\n                <button class=\"pp-ocu-decline-button\">${declineBtnText}</button>`;\n\t\tocuContainer?.prepend(ocuBody);\n\t}\n}\n\n/**\n * UI for clearing the One-Click-Upsell section after each refresh\n */\nfunction clearOCUSection() {\n\tfor (const ocuProduct of $qsAll('.pp-ocu-body')) {\n\t\tocuProduct.remove();\n\t}\n}\n\n/**\n * For setting up the UI of closing OCU page and adding OCU product to cart.\n */\nfunction initOCUEvents() {\n\tfor (const ocuClose of $qsAll('.pp-ocu-close, .pp-ocu-decline-button')) {\n\t\tocuClose.addEventListener('click', () => {\n\t\t\tcloseOCUPage();\n\t\t});\n\t}\n\n\t$qs('.pp-ocu-accept-button')?.addEventListener('click', async event => {\n\t\tconst $target = event.target as HTMLButtonElement;\n\t\tconst productId = Number($target.dataset['pid']);\n\n\t\tif (!productId || Number.isNaN(productId)) {\n\t\t\trenderOrderNotice(getLocaleText('Something went wrong. Please refresh the page and try again.'));\n\t\t\treturn;\n\t\t}\n\n\t\tstore.dispatch(startModalLoading());\n\n\t\t$target.disabled = true;\n\t\tconst markup = $target.innerHTML;\n\t\t$target.innerHTML = `<img src=\"${spinnerImageURL}\" class=\"ocu-spinner\"/> Updating your order ...`;\n\n\t\tawait addProductToCart(productId);\n\n\t\t$target.disabled = false;\n\t\t$target.innerHTML = markup;\n\n\t\tawait requestCartCalculation();\n\t\tstore.dispatch(stopModalLoading());\n\t});\n}\n\n/**\n * UI for closing the OCU page.\n */\nexport function closeOCUPage() {\n\t$qs('#pp-ocu-container')?.classList.add('pp-blowup-close');\n\tsetTimeout(() => {\n\t\t$qs('#pp-ocu-container', $el => {\n\t\t\t$el.style.backgroundColor = 'unset';\n\t\t});\n\t\t$qsAll('#pp-modal-content, #pp-related-products-section', $el => {\n\t\t\t$el.style.zIndex = '1';\n\t\t});\n\t\t$qs('#pp-ocu-container')?.classList.add('hide');\n\t}, 500);\n}\n","import {type GatewayConfiguration, GatewayEligibility} from '../models/GatewayConfiguration';\nimport {startModalLoading, stopModalLoading} from '../reducers/environmentReducer';\nimport {type GatewayEligibilityContext, PaymentConfiguration, setSelectedPaymentGateway} from '../reducers/paymentConfigurationReducer';\nimport {store} from '../store';\nimport {getLocaleText} from '../util/translation';\nimport {requestCartCalculation} from '../payment/order';\nimport {$qs, $qsAll} from '../../../@shared/ts/dom';\n\nimport ellipsisImageURL from '../../img/dot-dot-dot.svg';\nimport helpImageURL from '../../img/property-help.svg';\nimport {setupCurrencyFallbackEvents} from './currencySwitch';\n\nfunction initPaymentGatewaySelector() {\n\tsetupPrimaryOptionsEvents();\n\tsetupSecondaryOptionsEvents();\n\tsetupCurrencyFallbackEvents();\n\n\tstore.subscribe(() => {\n\t\tconst sortedEligibilityContext = PaymentConfiguration.sortGatewaysByEligibility();\n\t\tconst unmountedElements = (selector: string) => $qsAll<HTMLDivElement>(selector).reduce<Record<string, HTMLDivElement>>((acc, $el) => {\n\t\t\tconst gatewayId = $el.dataset['gateway'] ?? '';\n\t\t\t$el.remove();\n\n\t\t\tacc[gatewayId] = $el;\n\n\t\t\treturn acc;\n\t\t}, {});\n\n\t\t// Render/rerender primary gateway options\n\t\tconst unmountedPrimaryElements = unmountedElements('.pp-pms .primary-option[data-gateway]');\n\t\tfor (const context of sortedEligibilityContext) {\n\t\t\trenderPrimaryOption(context, unmountedPrimaryElements[context.config.gatewayId]);\n\t\t}\n\n\t\t// Render/rerender primary more option\n\t\trenderPrimaryMoreOption();\n\n\t\t// Render/rerender secondary gateway options\n\t\tconst unmountedSecondaryElements = unmountedElements('.pp-pms .secondary-option[data-gateway]');\n\t\tfor (const context of sortedEligibilityContext) {\n\t\t\trenderSecondaryOption(context, unmountedSecondaryElements[context.config.gatewayId]);\n\t\t}\n\n\t\t// Render/rerender gateway descriptions\n\t\tfor (const context of sortedEligibilityContext) {\n\t\t\trenderGatewayDescription(context);\n\t\t}\n\n\t\trenderEligibilityDescription(PaymentConfiguration.gatewayConfig(PaymentConfiguration.selectedGateway()));\n\t});\n}\n\nfunction setupPrimaryOptionsEvents() {\n\t$qs('.pp-pms')?.addEventListener('click', async e => {\n\t\tconst $target = e.target as HTMLElement | null;\n\t\tconst $pmType = $target?.closest<HTMLDivElement>('.pp-pm-type:not(.pp-more-options)');\n\n\t\tif (!$pmType) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst gatewayId = $pmType.dataset['gateway'] ?? '';\n\n\t\tstore.dispatch(startModalLoading());\n\t\tstore.dispatch(setSelectedPaymentGateway(gatewayId));\n\t\tawait requestCartCalculation();\n\t\tstore.dispatch(stopModalLoading());\n\t});\n\n\t$qs('.pp-pms')?.addEventListener('keydown', e => {\n\t\tif (e.key === 'Enter') {\n\t\t\tconst $target = e.target as HTMLDivElement;\n\t\t\t$target.click();\n\t\t}\n\t});\n}\n\nfunction renderPrimaryOption(context: GatewayEligibilityContext, $el: HTMLDivElement | undefined) {\n\tconst {config, eligibility, displayIndex} = context;\n\tconst isSelected = PaymentConfiguration.selectedGateway() === config.gatewayId;\n\tconst isHidden = !eligibility || displayIndex === undefined || displayIndex >= 3;\n\n\tif ($el) {\n\t\t$el.classList.toggle('selected', isSelected);\n\t\t$el.classList.toggle('hide', isHidden);\n\t\t$el.classList.toggle('pp-pm-alert', eligibility !== GatewayEligibility.Eligible);\n\n\t\t// Add element back to the DOM in the new order\n\t\t$qs('.pp-pm-type.pp-more-options')?.insertAdjacentElement('beforebegin', $el);\n\t} else {\n\t\t$qs('.pp-pm-type.pp-more-options')?.insertAdjacentHTML('beforebegin', `\n\t\t\t<div class=\"pp-pm-type primary-option ${isSelected ? 'selected' : ''} ${isHidden ? 'hide' : ''}\" tabindex=\"0\" role=\"button\" data-gateway=\"${config.gatewayId}\" >\n\t\t\t\t<img class=\"pp-pm-full-badge\" src=\"${config.assets.badge.src}\" draggable=\"false\">\n\t\t\t\t<div class=\"pp-pm-type-content\" style=\"display:flex;gap:4px\">\n\t\t\t\t\t<span>${config.name}</span>\n\t\t\t\t</div>\n\t\t\t</div>`,\n\t\t);\n\t}\n}\n\nfunction renderPrimaryMoreOption() {\n\tconst isHidden = PaymentConfiguration.eligibleGatewayCount() <= 3;\n\n\tconst $el = $qs<HTMLElement>('.pp-pm-type.pp-more-options');\n\tif ($el) {\n\t\t$el.classList.toggle('hide', isHidden);\n\t} else {\n\t\t$qs('.pp-pms div.header')?.insertAdjacentHTML('beforeend', `\n\t\t\t<div class=\"pp-pm-type pp-more-options ${isHidden ? 'hide' : ''}\" tabindex=\"0\" role=\"button\">\n\t\t\t\t<img class=\"pp-pm-more-options\" src=\"${ellipsisImageURL}\" draggable=\"false\">\n\t\t\t\t<span class=\"pp-pm-more-container hide\">\n\t\t\t\t\t<ul class=\"pp-pm-more\"></ul>\n\t\t\t\t</span>\n\t\t\t\t<span class=\"pp-question-mark hide\">\n\t\t\t\t\t<img class=\"pp-pm-help-badge\" src=\"${helpImageURL}\">\n\t\t\t\t</span>\n\t\t\t</div>`,\n\t\t);\n\t}\n}\n\nfunction setupSecondaryOptionsEvents() {\n\t// Hide secondary options overlay if clicking anywhere outside of it.\n\t$qs('body')?.addEventListener('click', e => {\n\t\tconst $target = e.target as HTMLElement | null;\n\t\tconst $pmOptionSelector = $target?.closest<HTMLElement>('.pp-pm-more-container');\n\n\t\tif (!$pmOptionSelector) {\n\t\t\t$qsAll('.secondary-option').forEach($el => {\n\t\t\t\t$el.setAttribute('tabindex', '-1');\n\t\t\t});\n\t\t\t$qs('.pp-pm-more-container')?.classList.add('hide');\n\t\t}\n\t});\n\n\t$qs('.pp-pms')?.addEventListener('click', async e => {\n\t\tconst $target = e.target as HTMLElement | null;\n\t\tconst $pmType = $target?.closest<HTMLDivElement>('.pp-pm-type.pp-more-options');\n\t\tif (!$pmType) {\n\t\t\t$qsAll('.secondary-option').forEach($el => {\n\t\t\t\t$el.setAttribute('tabindex', '-1');\n\t\t\t});\n\t\t\t$qs('.pp-pm-more-container')?.classList.add('hide');\n\t\t\treturn;\n\t\t}\n\n\t\t$pmType.querySelector('.pp-pm-more-container')?.classList.toggle('hide');\n\t\tif (!$pmType.querySelector('.pp-pm-more-container')?.classList.contains('hide')) {\n\t\t\t$qsAll('.secondary-option').forEach($el => {\n\t\t\t\t$el.setAttribute('tabindex', '0');\n\t\t\t});\n\t\t}\n\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\n\t\tconst $option = $target?.closest<HTMLLIElement>('li[data-gateway]');\n\t\tif (!$option) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst gatewayId = $option?.dataset['gateway'];\n\n\t\tif (!gatewayId) {\n\t\t\treturn;\n\t\t}\n\n\t\tstore.dispatch(startModalLoading());\n\t\tstore.dispatch(setSelectedPaymentGateway(gatewayId));\n\t\tawait requestCartCalculation();\n\t\tstore.dispatch(stopModalLoading());\n\t});\n}\n\nfunction renderSecondaryOption(context: GatewayEligibilityContext, $el: HTMLDivElement | undefined) {\n\tconst {config, eligibility, displayIndex} = context;\n\tconst isHidden = !eligibility || displayIndex === undefined || displayIndex <= 2;\n\n\tif ($el) {\n\t\t$el.classList.toggle('hide', isHidden);\n\t\t$el.querySelector('img')?.setAttribute('src', config.assets.badge.src);\n\n\t\tconst $span = $el.querySelector('span');\n\t\tif ($span) {\n\t\t\t$span.innerHTML = config.name;\n\t\t}\n\n\t\t// Add element back to the DOM in the new order\n\t\t$qs('.pp-pm-more')?.insertAdjacentElement('beforeend', $el);\n\t} else {\n\t\t$qs('.pp-pm-more')?.insertAdjacentHTML('beforeend', /* html */ `\n\t\t\t<li class=\"secondary-option ${isHidden ? 'hide' : ''}\" data-gateway=\"${config.gatewayId}\" role=\"button\" tabindex=\"-1\">\n\t\t\t\t<img class=\"pp-more-option-badge\" src=\"${config.assets.badge.src}\" draggable=\"false\">\n\t\t\t\t<span>${config.name}</span>\n\t\t\t</li>`,\n\t\t);\n\t}\n}\n\nfunction renderGatewayDescription(context: GatewayEligibilityContext) {\n\tconst isSelected = PaymentConfiguration.selectedGateway() === context.config.gatewayId;\n\tconst isHidden = !isSelected || context.eligibility !== GatewayEligibility.Eligible;\n\n\tconst $el = $qs<HTMLDivElement>(`.pp-pm-saved-option[data-gateway=\"${context.config.gatewayId}\"]`);\n\tif ($el) {\n\t\t$el.classList.toggle('selected', isSelected);\n\t\t$el.parentElement?.classList.toggle('hide', isHidden);\n\t} else {\n\t\t$qs('.pp-pms div.body')?.insertAdjacentHTML('beforeend', `\n\t\t\t<div class=\"${isHidden ? 'hide' : ''}\">\n\t\t\t\t<div class=\"pp-pm-saved-option ${isSelected ? 'selected' : ''}\" data-gateway=\"${context.config.gatewayId}\">\n\t\t\t\t\t${context.config.description}\n\t\t\t\t</div>\n\t\t\t</div>`,\n\t\t);\n\t}\n}\n\nfunction renderEligibilityDescription(config: GatewayConfiguration | null) {\n\tconst $el = $qs<HTMLDivElement>('.currency-fallback-description');\n\n\tif (!config) {\n\t\t$el?.classList.add('hide');\n\t\treturn;\n\t}\n\n\tconst eligibility = PaymentConfiguration.eligibleGateway(config.gatewayId);\n\tconst eligibilityDetails = PaymentConfiguration.eligibleGatewayDetails(config.gatewayId) ?? {};\n\tconst eligibilityExplanations = Object.values(eligibilityDetails).map(detail => detail.explanation).join('<br/>');\n\n\tconst isHidden = eligibility === GatewayEligibility.Eligible;\n\n\tconst defaultCurrency = eligibilityDetails.currency?.fallback_option ?? '';\n\n\tif (isHidden || !eligibilityExplanations) {\n\t\t$el?.classList.add('hide');\n\t\treturn;\n\t}\n\n\tif ($el) {\n\t\t$el.classList.remove('hide');\n\t\t$el.querySelector('img')?.setAttribute('src', config.assets?.title?.src ?? config?.assets.badge.src);\n\t\t$el.querySelectorAll('.name').forEach($span => {\n\t\t\t$span.innerHTML = config.name ?? '';\n\t\t});\n\t\t$el.querySelectorAll('.explanations').forEach($span => {\n\t\t\t$span.innerHTML = eligibilityExplanations ?? '';\n\t\t});\n\n\t\t$el.querySelector('button')?.classList.toggle('hide', !defaultCurrency);\n\t\t$el.querySelector('button')?.setAttribute('data-gateway', config.gatewayId);\n\t\t$el.querySelector('button')?.setAttribute('data-currency', defaultCurrency ?? '');\n\t\t$el.querySelectorAll('button .currency').forEach($span => {\n\t\t\t$span.innerHTML = defaultCurrency ?? '';\n\t\t});\n\t} else {\n\t\t$qs('.pp-pms div.body')?.insertAdjacentHTML('beforeend', `\n\t\t\t<div class=\"pp-pm-saved-option currency-fallback-description\" >\n\t\t\t\t<img style=\"display: block; text-align: left; height: 1.5rem; \" src=\"${config.assets?.title?.src ?? config?.assets.badge.src}\">\n\t\t\t\t<p style=\"text-align: left; margin: 0.5rem 0;\">\n\t\t\t\t\t<span class=\"name\">${config?.name}</span> ${getLocaleText('is not available for checkout.')}\n\t\t\t\t</p>\n\t\t\t\t<hr/>\n\t\t\t\t<p style=\"text-align: left; margin: 0.5rem 0 0;\" class=\"muted explanations\">\n\t\t\t\t\t${eligibilityExplanations}\n\t\t\t\t<p>\n\t\t\t\t<button type=\"button\" class=\"button btn currency-fallback-button ${defaultCurrency ? '' : 'hide'}\" data-gateway=\"${config.gatewayId}\" data-currency=\"${defaultCurrency}\">\n\t\t\t\t\t${getLocaleText('Update currency to')} <span class=\"currency\">${defaultCurrency}</span>\n\t\t\t\t</button>\n\t\t\t</div>`,\n\t\t);\n\t}\n}\n\nexport {initPaymentGatewaySelector};\n","import {store} from '../store';\nimport {Feature, stopModalLoading} from '../reducers/environmentReducer';\nimport {getLocaleText} from '../util/translation';\nimport {startModalLoading} from '../reducers/environmentReducer';\nimport {DefaultCart} from '../reducers/cartReducer';\nimport {MerchantConfiguration} from '../reducers/merchantConfigurationReducer';\nimport {type IRecommendedProduct} from '../models/IRecommendedProducts';\nimport {addProductToCart, cartItemQuantity} from '../util/cart';\nimport {initQuantityChangerEvent} from './quantityChanger';\nimport {$qsAll, $qs} from '../../../@shared/ts/dom';\nimport {FeatureFlag} from '../../../@type/features';\nimport saleImageURL from '../../img/sale.svg';\nimport darkSpinnerImageURL from '../../img/spinner-dark.svg';\nimport plusImageURL from '../../img/plus.svg';\nimport minusImageURL from '../../img/minus.svg';\nimport {renderOrderNotice, requestCartCalculation} from '../payment/order';\n\nexport function initRelatedProducts() {\n\tif (!Feature.enabled(FeatureFlag.RECOMMENDED_PRODUCTS)) {\n\t\treturn;\n\t}\n\n\tlet previousCurrencyData = '';\n\tlet previousCartData = '';\n\n\tstore.subscribe(() => {\n\t\tconst header = Feature.metadata<string>(FeatureFlag.RECOMMENDED_PRODUCTS, 'rp_header')\n\t\t\t? Feature.metadata<string>(FeatureFlag.RECOMMENDED_PRODUCTS, 'rp_header')\n\t\t\t: getLocaleText('Recommended for you');\n\t\tconst recommendedProducts = Feature.dynamicMetadata<IRecommendedProduct[]>(FeatureFlag.RECOMMENDED_PRODUCTS, 'recommended_products');\n\t\tconst cartData = JSON.stringify(DefaultCart.contents());\n\t\tconst currencyData = JSON.stringify(MerchantConfiguration.currency.configuration());\n\n\t\tif (recommendedProducts && recommendedProducts.length > 0 && header) {\n\t\t\tif (cartData !== previousCartData || currencyData !== previousCurrencyData) {\n\t\t\t\tpreviousCartData = cartData;\n\t\t\t\tpreviousCurrencyData = currencyData;\n\t\t\t\trenderRecommendedProductsMiniSlider(recommendedProducts, header);\n\t\t\t}\n\t\t}\n\t});\n\n\t$qsAll('#pp-products-list-related', $el => {\n\t\t$el.addEventListener('scroll', () => {\n\t\t\tconst $elName = $el.id ? '#' + $el.id : '.' + $el.className;\n\t\t\tfadeAdjuster(\n\t\t\t\t$elName,\n\t\t\t\t$el.scrollLeft === 0,\n\t\t\t\tMath.round($el.offsetWidth + $el.scrollLeft) >= $el.scrollWidth,\n\t\t\t);\n\t\t});\n\t});\n}\n\n/**\n * Function for rendering recommended product's mini slider in the checkout window\n * @param relatedProducts Recommended products data\n * @param title Recommended products title\n */\nfunction renderRecommendedProductsMiniSlider(products: IRecommendedProduct[], title: string) {\n\t// For clearing the related product section after each refresh\n\t$qsAll('.pp-related-product-body', $el => {\n\t\t$el.remove();\n\t});\n\t$qs('.pp-rp-spacer')?.remove();\n\t$qs('#pp-related-products-section')?.classList.remove('hide');\n\tfor (const element of $qsAll('.related-products-title')) {\n\t\telement.innerHTML = title;\n\t\telement.classList.remove('hide');\n\t}\n\n\tconst relatedList = $qs('#pp-products-list-related-main');\n\tconst relatedListMobile = $qs('.pp-products-list-related-mobile');\n\tfor (const item of products) {\n\t\tconst isBundleOrVariable = item.bundle || item.variable;\n\t\tconst rpBody = document.createElement('div');\n\t\trpBody.id = String(item.id);\n\t\trpBody.className = 'pp-related-product-body';\n\t\trpBody.innerHTML = `<div class=\"pp-rp-content\">\n\t\t\t\t\t\t\t\t<img class=\"pp-related-product-img ${item.img_src ? '' : 'hide'}\" src=${item.img_src as unknown as string}>\n\t\t\t\t\t\t\t\t<div class=\"flex col\">\n\t\t\t\t\t\t\t\t\t<span class=\"pp-rp-title\">${item.name}</span>\n\t\t\t\t\t\t\t\t\t<div class=\"flex\">\n\t\t\t\t\t\t\t\t\t\t<img src=\"${saleImageURL}\" class=\"${item.sale ? 'pp-rp-sale' : 'hide'}\"></img>\n\t\t\t\t\t\t\t\t\t\t<span class=\"pp-rp-price${(item.sale && !isBundleOrVariable) ? ' pp-rp-price-sale' : (item.sale && isBundleOrVariable) ? ' pp-rp-bv-sale' : ''}\">\n\t\t\t\t\t\t\t\t\t\t\t${isBundleOrVariable ? item.price.replace(' &ndash; ', '<span> - </span>') : item.price}\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>`;\n\n\t\tif (item.variable) {\n\t\t\trpBody.append(renderVariationFields(item));\n\t\t}\n\n\t\tconst qtyChanger = renderQuantityChanger(item.id);\n\n\t\tif (qtyChanger) {\n\t\t\trpBody.append(qtyChanger);\n\t\t} else {\n\t\t\trpBody.innerHTML += `<div>\n            ${item.bundle ? `<a href=\"${item.permalink}\" class=\"pp-lp-btn\" target=\"_parent\">${getLocaleText('View options')}</a>`\n\t\t: `<button class=\"pp-lp-btn ${item.variable ? 'pp-js-display' : 'pp-js-add-btn'}\" data-pid=${item.id}>\n                        ${item.variable ? '' : '<span style=\"pointer-events: none;\">+</span>'}\n                        <span style=\"pointer-events: none;\">${item.variable ? getLocaleText('Customize') : getLocaleText('Add')}</span>\n                    </button>`}\n            </div>`;\n\t\t}\n\n\t\trelatedList?.append(rpBody);\n\t\trelatedListMobile?.append(rpBody.cloneNode(true));\n\t}\n\n\tvariationFieldsUI();\n\n\tinitQuantityChangerEvent();\n\n\tfor (const addBtn of $qsAll('.pp-js-add-btn')) {\n\t\taddBtn.addEventListener('click', async event => {\n\t\t\tconst $target = event.target as HTMLInputElement;\n\t\t\tstore.dispatch(startModalLoading());\n\n\t\t\t$target.disabled = true;\n\t\t\tconst targetMarkup = $target.innerHTML;\n\t\t\t$target.innerHTML = `<img src=\"${darkSpinnerImageURL}\" class=\"linked-product-spinner\"/>`;\n\n\t\t\tconst productId = $target.dataset['pid'];\n\t\t\tif (!productId || Number.isNaN(Number(productId))) {\n\t\t\t\trenderOrderNotice(getLocaleText('Something went wrong. Please refresh the page and try again.'));\n\t\t\t}\n\n\t\t\tawait addProductToCart(Number(productId));\n\n\t\t\t$target.disabled = false;\n\t\t\t$target.innerHTML = targetMarkup;\n\n\t\t\t// Note:  Any adding to cart errors will be reported by the cart calculation request as a notice\n\t\t\tawait requestCartCalculation();\n\t\t\tstore.dispatch(stopModalLoading());\n\t\t});\n\t}\n}\n\nfunction fadeAdjuster(elementName: string, isAtLeftEnd: boolean, isAtRightEnd: boolean) {\n\tif (isAtLeftEnd) {\n\t\t$qs(`${elementName}+.pp-rp-fade-left`)?.classList.add('pp-rp-fade-left-hide');\n\t} else {\n\t\t$qs(`${elementName}+.pp-rp-fade-left`)?.classList.remove('pp-rp-fade-left-hide');\n\t}\n\n\tif (isAtRightEnd) {\n\t\t$qs(`${elementName}+.pp-rp-fade-left+.pp-rp-fade-right`)?.classList.add('pp-rp-fade-right-hide');\n\t} else {\n\t\t$qs(`${elementName}+.pp-rp-fade-left+.pp-rp-fade-right`)?.classList.remove('pp-rp-fade-right-hide');\n\t}\n}\n\n/**\n * Renders variation fields and buttons for variable product.\n * @param linkedItem Recommended product\n * @returns DOM element\n */\nfunction renderVariationFields(item: IRecommendedProduct) {\n\tconst formContainer = document.createElement('div');\n\tformContainer.setAttribute('data-pid', (item.id).toString());\n\tformContainer.classList.add('flex', 'col', 'hide', 'pp-lp-form-container');\n\n\tconst variationForm = document.createElement('form');\n\tvariationForm.setAttribute('data-pid', (item.id).toString());\n\tvariationForm.className = 'pp-variation-form';\n\tfor (const attr of item.attributes) {\n\t\tconst container = document.createElement('div');\n\t\tcontainer.className = 'pp-variation-select-field';\n\t\tconst label = document.createElement('label');\n\t\tlabel.setAttribute('for', attr.name);\n\t\tlabel.innerHTML = attr.label;\n\t\tconst select = document.createElement('select');\n\t\tselect.name = 'attribute_' + attr.name;\n\t\tselect.setAttribute('data-attribute_name', 'attribute_' + attr.name);\n\t\tfor (const option of attr.options) {\n\t\t\tconst opt = document.createElement('option');\n\t\t\topt.value = option;\n\t\t\topt.text = option.charAt(0).toUpperCase() + option.slice(1);\n\t\t\tselect.add(opt, null);\n\t\t}\n\n\t\tcontainer.append(label);\n\t\tcontainer.append(select);\n\t\tvariationForm.append(container);\n\t}\n\n\tconst addToCartButton = document.createElement('button');\n\taddToCartButton.classList.add('pp-lp-btn', 'pp-variable-add-btn');\n\taddToCartButton.setAttribute('data-pid', (item.id).toString());\n\taddToCartButton.innerHTML = `<span style=\"pointer-events: none;\">+</span><span style=\"pointer-events: none;\">${getLocaleText('ADD')}</span>`;\n\n\tconst cancelButton = document.createElement('button');\n\tcancelButton.classList.add('pp-variation-cancel-btn', 'pp-js-cancel-btn');\n\tcancelButton.setAttribute('data-pid', (item.id).toString());\n\tcancelButton.innerText = getLocaleText('Close');\n\n\tformContainer.append(variationForm);\n\tformContainer.append(addToCartButton);\n\tformContainer.append(cancelButton);\n\n\treturn formContainer;\n}\n\n/**\n * Check if linked item is in cart, then render the quantity changer button to replace the add button.\n * @param linkedID Linked product's ID\n * @param cart Cart items\n * @returns DOM element\n */\nfunction renderQuantityChanger(id: number) {\n\tconst cart = DefaultCart.contents();\n\tfor (let i = cart.length - 1; i >= 0; i--) {\n\t\tconst item = cart[i];\n\t\tif (item && id === item.product_id) {\n\t\t\tconst $div = document.createElement('div');\n\t\t\t$div.innerHTML += `\n\t\t\t\t<div class=\"pp-quantity-changer\" style=\"justify-content: center;\">\n\t\t\t\t\t<button type=\"button\" class=\"flex-center decrease-qty qty-btn ${cartItemQuantity(item) <= 1 ? 'scroll-end' : ''}\" data-qid=\"${item\n\t.item_key ?? ''}\"><img src=\"${minusImageURL}\" class=\"qty-btn-inner\"/></button>\n\t\t\t\t\t<input style=\"color: black;\" type=\"number\" min=\"0\" max=\"${item.stock_qty ? item.stock_qty : ''}\" class=\"qty-fs\" value=\"${cartItemQuantity(item)}\" data-qid=\"${item.item_key ?? ''}\" required/>\n\t\t\t\t\t<button type=\"button\" class=\"flex-center increase-qty qty-btn ${(item.stock_qty && cartItemQuantity(item) >= item.stock_qty) ? 'scroll-end' : ''}\" data-qid=\"${item\n\t.item_key ?? ''}\"><img src=\"${plusImageURL}\" class=\"qty-btn-inner\"/></button>\n\t\t\t\t</div>`;\n\t\t\treturn $div;\n\t\t}\n\t}\n\n\treturn '';\n}\n\n/**\n * For handling UI for variable product.\n */\nfunction variationFieldsUI() {\n\t// For opening the variation form\n\tfor (const button of $qsAll('.pp-js-display')) {\n\t\tbutton.addEventListener('click', event => {\n\t\t\tconst id = (event.target as HTMLElement).dataset['pid'];\n\t\t\tconst container = $qsAll('.pp-lp-form-container[data-pid=\\'' + id + '\\']');\n\t\t\tcontainer?.forEach(element => {\n\t\t\t\telement.classList.remove('hide');\n\t\t\t});\n\t\t\t$qsAll('.pp-js-display[data-pid=\\'' + id + '\\']', element => {\n\t\t\t\telement?.classList.add('hide');\n\t\t\t});\n\t\t});\n\t}\n\n\t// For closing the variation form\n\tfor (const button of $qsAll('.pp-js-cancel-btn')) {\n\t\tbutton.addEventListener('click', event => {\n\t\t\tconst id = (event.target as HTMLElement).dataset['pid'];\n\t\t\tconst container = $qsAll('.pp-lp-form-container[data-pid=\\'' + id + '\\']');\n\t\t\tcontainer?.forEach(element => {\n\t\t\t\telement.classList.add('hide');\n\t\t\t});\n\t\t\t$qsAll('.pp-js-display[data-pid=\\'' + id + '\\']', element => {\n\t\t\t\telement?.classList.remove('hide');\n\t\t\t});\n\t\t});\n\t}\n\n\t// For adding variation product to cart\n\tfor (const variationBtn of $qsAll('.pp-variable-add-btn')) {\n\t\tvariationBtn.addEventListener('click', async event => {\n\t\t\tconst $target = event.target as HTMLInputElement;\n\t\t\tconst productId = Number($target.dataset['pid']);\n\t\t\tconst recommendedProducts = Feature.dynamicMetadata<IRecommendedProduct[]>(FeatureFlag.RECOMMENDED_PRODUCTS, 'recommended_products');\n\n\t\t\tif (!productId || Number.isNaN(productId) || !recommendedProducts || recommendedProducts.length === 0) {\n\t\t\t\trenderOrderNotice(getLocaleText('Something went wrong. Please refresh the page and try again.'));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tstore.dispatch(startModalLoading());\n\t\t\t$target.disabled = true;\n\t\t\tconst targetMarkup = $target.innerHTML;\n\t\t\t$target.innerHTML = `<img src=\"${darkSpinnerImageURL}\" class=\"linked-product-spinner\"/>`;\n\n\t\t\tconst variationForm = $qs<HTMLFormElement>('.pp-variation-form[data-pid=\\'' + productId + '\\']');\n\t\t\tconst variationAttributes = Array.from((variationForm?.elements ?? []) as HTMLInputElement[])\n\t\t\t\t.map(input => [input.name, input.value] satisfies [name:string, value:string ]);\n\n\t\t\tconst variationId = recommendedProducts\n\t\t\t\t.find(product => product.id === productId)?.variations\n\t\t\t\t.find(variation => {\n\t\t\t\t\tfor (const [name, value] of variationAttributes) {\n\t\t\t\t\t\tif (variation.attributes[name] !== value) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn true;\n\t\t\t\t})\n\t\t\t\t?.variation_id;\n\n\t\t\tawait addProductToCart(productId, 1, {variationId, variationAttributes});\n\n\t\t\t$target.disabled = false;\n\t\t\t$target.innerHTML = targetMarkup;\n\n\t\t\t// Note:  Any adding to cart errors will be reported by the cart calculation request as a notice\n\t\t\tawait requestCartCalculation();\n\t\t\tstore.dispatch(stopModalLoading());\n\t\t});\n\t}\n}\n","import {store} from '../store';\nimport {formatCurrencyString} from '../util/currency';\nimport {DefaultCart, cartSummaryViewData} from '../reducers/cartReducer';\nimport {updateMerchantTaxConfig} from '../reducers/merchantConfigurationReducer';\nimport {type ICartMetaData} from '../../../@type/woocommerce/cart-calculation';\nimport {buildSubscriptionFirstRenewalString, buildSubscriptionPriceMetaData} from '../util/subscription';\nimport {$qs, $qsAll} from '../../../@shared/ts/dom';\nimport {type InitMessage} from '../../../@type/window-messages';\nimport {getLocaleText} from '../util/translation';\n\nexport function initSummary(message: InitMessage) {\n\tinitSummaryEvents();\n\n\t// Setup tax\n\tstore.dispatch(updateMerchantTaxConfig({\n\t\tdisplayPricesInCartAndCheckout: (message.phpData?.wc_tax_price_display === 'incl') ? 'includeTax' : 'excludeTax',\n\t}));\n}\n\nfunction initSummaryEvents() {\n\t// OrderSummaryDropdown has been combined with the code in slideUpView.ts because it is close in format to the existing slide-up views.\n\n\t// Keep summary related rendering up to date.\n\tstore.subscribe(() => {\n\t\trenderSummaries();\n\t\trenderCartTotals();\n\t});\n}\n\n/**\n * Rerenders the subtotal -> total list.\n */\nfunction renderSummaries() {\n\tclearRenderedSummaries();\n\n\tlet cartSummariesHTML = '';\n\n\tfor (const cartKey of Object.keys(store.getState().calculatedCarts)) {\n\t\tlet summaryHTML = '';\n\t\tconst {cartSummary, cartMeta} = cartSummaryViewData(cartKey)();\n\n\t\tconst summaryTitleHTML = cartKey === '0' ? '' : `\n<li class=\"summary-title\">\n\t<div>${getLocaleText('Recurring totals')}</div>\n\t<div></div>\n</li>`;\n\n\t\tfor (const line of cartSummary) {\n\t\t\t// Insert border before total\n\t\t\tsummaryHTML += line === cartSummary[cartSummary.length - 1] ? '<hr>' : '';\n\t\t\tsummaryHTML += renderSummaryLine(line.key, line.value, cartMeta);\n\t\t}\n\n\t\tcartSummariesHTML += `\n<div class=\"cart-summary\" data-cart-key=\"${cartKey}\">\n\t<ul class=\"cart-summary-list\">\n\t\t<hr>\n\t\t${summaryTitleHTML}\n\t\t${summaryHTML}\n\t</ul>\n\t<p class=\"first-renewal muted\">${buildSubscriptionFirstRenewalString(cartMeta)}</p>\n</div>`;\n\t}\n\n\t// New\n\t$qs('#pp-summary-lines-body')?.insertAdjacentHTML('beforeend', cartSummariesHTML);\n\t// Mobile\n\t$qs('#pp-summary-lines-body-mobile')?.insertAdjacentHTML('beforeend', cartSummariesHTML);\n}\n\n/**\n * Clears all existing summary lines from the html dom before rerendering the summary view.\n */\nfunction clearRenderedSummaries() {\n\tfor (const $summary of $qsAll('.cart-summary')) {\n\t\t$summary.remove();\n\t}\n}\n\n/**\n * Renders a single summary line\n * @param name The name of the summary line.\n * @param amount The value of the summary line.\n * @param options Optional css class customization object.\n */\nfunction renderSummaryLine(name: string, amount: number, cartMeta: ICartMetaData): string {\n\tlet priceMetaHTML = '';\n\tif (cartMeta.subscription) {\n\t\tpriceMetaHTML = `<span class=\"muted\">${buildSubscriptionPriceMetaData(cartMeta)}</span>`;\n\t}\n\n\treturn `\n<li class=\"summary-line\" data-raw-cost=\"${amount}\">\n\t<div>${name}</div>\n\t<div class=\"pp-recalculate-blur\" >${formatCurrencyString(amount)}${priceMetaHTML}</div>\n</li>`;\n}\n\n/**\n * Renders the total on the pay button and some other areas.\n */\nfunction renderCartTotals(): void {\n\t// Clear totals.\n\t$qsAll('.pp-summary-total', $element => {\n\t\t$element.innerHTML = '';\n\t});\n\n\t$qsAll('.pp-summary-total', $element => {\n\t\t$element.innerHTML += `<span>${formatCurrencyString(DefaultCart.total())}</span>`;\n\t});\n\n\tif (Object.keys(store.getState().calculatedCarts).length > 1) {\n\t\t$qsAll('.pp-summary-total', $element => {\n\t\t\t$element.innerHTML += `<span class=\"flex pp-gap-2\"><span class=\"muted\"> + </span><span class=\"muted\">${getLocaleText('Recurring')}</span></span>`;\n\t\t});\n\t}\n}\n","import {$qs} from '../../../@shared/ts/dom';\nimport {type InitMessage} from '../../../@type/window-messages';\nimport {GLOBAL} from '../deprecated/global';\nimport {PeachPayCustomer} from '../reducers/peachPayCustomerReducer';\nimport {isEUCountry} from '../util/country';\nimport {getLocaleText} from '../util/translation';\n\nexport function initVAT(message: InitMessage) {\n\tinitVatEvents();\n\n\t// Check if self verify is required by vat plugin\n\tif (message.phpData.vat_self_verify === '1') {\n\t\trenderVerifyLocation();\n\t}\n\n\tconst vatTypesRequiringID = message.phpData.vat_required === '1' || (message.phpData.vat_required === '2' && isEUCountry(PeachPayCustomer.shipping.country()));\n\n\tif (vatTypesRequiringID) {\n\t\trenderVATIDInput();\n\t}\n}\n\nfunction initVatEvents() {\n\t$qs('#pp-info-form')?.addEventListener('submit', (event: Event) => {\n\t\tevent.preventDefault();\n\t\tconst vatTypesRequiringID = GLOBAL.phpData?.vat_required === '1' || (GLOBAL.phpData?.vat_required === '2' && isEUCountry(PeachPayCustomer.shipping.country()));\n\n\t\tif (vatTypesRequiringID) {\n\t\t\trenderVATIDInput();\n\t\t}\n\t});\n}\n\n/**\n * If vat verification is required this function will render a vat verification textbox in the\n * peachpay modal allowing a deeper integration with EU_Vat\n */\nfunction renderVATIDInput(): void {\n\t// Since we have to place the div depending on the country sometimes remove old div on new cusotmer checkout page\n\tconst $previousDivs = document.querySelector('#newEUVatDiv');\n\t$previousDivs?.remove();\n\n\t// Create Vat input box\n\tconst $EUVatDiv = document.createElement('div');\n\tconst $vatForm = document.createElement('form');\n\tconst $vatNumber = document.createElement('input');\n\t$vatNumber.setAttribute('placeholder', 'required');\n\t$vatNumber.setAttribute('class', 'vat-input');\n\tconst $prompt = document.createElement('span');\n\t$prompt.innerHTML = 'Vat Number';\n\t// Appending all the information to div\n\t$vatForm.append($vatNumber);\n\t$EUVatDiv.append($prompt);\n\t$EUVatDiv.append($vatForm);\n\t$EUVatDiv.setAttribute('id', 'EuVatDiv');\n\t$EUVatDiv.setAttribute('class', 'color-change-text');\n\n\tconst $insertionLocation = document.querySelector('#payment-methods');\n\n\t$vatNumber.setAttribute('id', 'ppVatNumNew');\n\t$EUVatDiv.setAttribute('class', 'x-large');\n\t$EUVatDiv.setAttribute('id', 'newEUVatDiv');\n\t$insertionLocation?.insertAdjacentElement('afterend', $EUVatDiv);\n}\n\n/**\n * Function is placed here because to keep call in main.ts cleaner just get the value of the vat #\n * From here because i know it exists here :)\n */\nexport function getVatNumber(): string {\n\tconst $ppVat = document.querySelector<HTMLInputElement>('#ppVatNumNew');\n\tif (!$ppVat) {\n\t\treturn '';\n\t}\n\n\treturn $ppVat.value ?? '';\n}\n\n/**\n * Renders a checkbox that allows the user to self verify that their location is indeed the one they reside in\n */\nfunction renderVerifyLocation(): void {\n\tconst $verifyDiv = document.createElement('div');\n\tconst $verifyCheckbox = document.createElement('input');\n\tconst $descriptor = document.createElement('label');\n\t$verifyCheckbox.setAttribute('id', 'pp_verify_country');\n\t$verifyCheckbox.setAttribute('type', 'checkbox');\n\t$verifyCheckbox.setAttribute('value', '1');\n\t$descriptor.setAttribute('for', 'pp_verify_country');\n\t$descriptor.innerHTML = getLocaleText('I verify that the country I have entered is the one I reside in');\n\t$verifyDiv.append($verifyCheckbox);\n\t$verifyDiv.append($descriptor);\n\tconst $divClone = ($verifyDiv.cloneNode(true)) as Element;\n\n\tconst $insertLocation2 = $qs('#payment-methods');\n\t$insertLocation2?.insertAdjacentElement('afterend', $divClone);\n}\n\n/**\n * A function to get if the selfVerify checkbox is ticked or not\n * @returns if the checkbox for country was verified as 1 or null\n */\n\nexport function getVerify(): string {\n\tconst $isVerified = document.querySelectorAll('#pp_verify_country');\n\tif (((($isVerified[0] as HTMLInputElement).checked) || (($isVerified[1] as HTMLInputElement).checked))) {\n\t\treturn '1';\n\t}\n\n\treturn '';\n}\n","import {type LoadingMode, type ModalPage} from '../../models/IEnvironment';\nimport {DefaultCart} from '../../reducers/cartReducer';\nimport {Environment} from '../../reducers/environmentReducer';\nimport {store} from '../../store';\nimport {getLocaleText} from '../../util/translation';\nimport {formatCurrencyString} from '../../util/currency';\nimport {PaymentConfiguration} from '../../reducers/paymentConfigurationReducer';\nimport {$qsAll} from '../../../../@shared/ts/dom';\n\n/**\n * This button is reused by several peachpay payment methods.\n */\nexport function setupPeachpayButton() {\n\tstore.subscribe(() => {\n\t\trenderButtonDisplay(\n\t\t\tPaymentConfiguration.selectedGateway(),\n\t\t\tEnvironment.modalUI.page(),\n\t\t\tEnvironment.modalUI.loadingMode(),\n\t\t);\n\n\t\trenderButtonLoading(\n\t\t\tEnvironment.modalUI.loadingMode(),\n\t\t);\n\t});\n}\n\n/**\n * Renders the button display state.\n */\nfunction renderButtonDisplay(gatewayId: string, page: ModalPage, loadingMode: LoadingMode) {\n\t// Show/hide button container\n\tif (['cod', 'bacs', 'cheque', 'peachpay_purchase_order'].includes(gatewayId) && page === 'payment') {\n\t\t$qsAll('.peachpay-integrated-btn-container', $element => {\n\t\t\t$element.classList.remove('hide');\n\t\t});\n\t} else {\n\t\t$qsAll('.peachpay-integrated-btn-container', $element => {\n\t\t\t$element.classList.add('hide');\n\t\t});\n\t}\n\n\t// Hide/Show button\n\tif (loadingMode === 'loading') {\n\t\t$qsAll('.peachpay-integrated-btn', $element => {\n\t\t\t$element.classList.add('hide');\n\t\t});\n\t} else {\n\t\t$qsAll('.peachpay-integrated-btn', $element => {\n\t\t\t$element.classList.remove('hide');\n\t\t});\n\t}\n}\n\n/**\n * Renders the peachpay order button loading state.\n */\nfunction renderButtonLoading(mode: LoadingMode) {\n\t// Show/hide the external spinner\n\tif (mode === 'loading') {\n\t\t$qsAll('.peachpay-integrated-spinner-container', $element => {\n\t\t\t$element.classList.remove('hide');\n\t\t});\n\t} else {\n\t\t$qsAll('.peachpay-integrated-spinner-container', $element => {\n\t\t\t$element.classList.add('hide');\n\t\t});\n\t}\n\n\t// Show/hide the internal spinner\n\tif (mode === 'processing') {\n\t\t$qsAll('.peachpay-integrated-btn-spinner', $element => {\n\t\t\t$element.classList.remove('hide');\n\t\t});\n\t} else {\n\t\t$qsAll('.peachpay-integrated-btn-spinner', $element => {\n\t\t\t$element.classList.add('hide');\n\t\t});\n\t}\n\n\t// Show/hide processing message\n\tif (mode === 'processing') {\n\t\t$qsAll('.peachpay-integrated-btn > .button-text', $element => {\n\t\t\t$element.innerHTML = getLocaleText('Processing');\n\t\t});\n\t} else {\n\t\t$qsAll('.peachpay-integrated-btn > .button-text', $element => {\n\t\t\t$element.innerHTML = `${getLocaleText('Pay')} ${formatCurrencyString(DefaultCart.total())}`;\n\t\t});\n\t}\n\n\t// Enable/disable the button\n\tif (mode === 'finished') {\n\t\t$qsAll<HTMLInputElement>('.peachpay-integrated-btn', $element => {\n\t\t\t$element.disabled = false;\n\t\t});\n\t} else {\n\t\t$qsAll<HTMLInputElement>('.peachpay-integrated-btn', $element => {\n\t\t\t$element.disabled = true;\n\t\t});\n\t}\n}\n","import {displayPaymentErrorMessage, type OrderService} from '../order';\nimport {Feature, stopModalLoading} from '../../reducers/environmentReducer';\nimport {getLocaleText} from '../../util/translation';\nimport {addButtonListener, defaultOrderFlow} from './peachpay';\nimport {$qs} from '../../../../@shared/ts/dom';\nimport {FeatureFlag} from '../../../../@type/features';\nimport purchaseOrderImageURL from '../../../img/marks/purchase-order.svg';\nimport {type GatewayConfiguration} from '../../models/GatewayConfiguration';\nimport {getErrorString} from '../../../../@shared/ts/error';\nimport {store} from '../../store';\n\nexport function initPurchaseOrderSupport(orderService: OrderService) {\n\tif (!Feature.enabled(FeatureFlag.PEACHPAY_PURCHASE_ORDER_GATEWAY)) {\n\t\treturn;\n\t}\n\n\tinjectPurchaseOrderFields();\n\n\taddButtonListener(getPurchaseOrderMethodConfiguration().gatewayId, async event => {\n\t\tconst $form = $qs<HTMLFormElement>('#pp-pms-new form.pp-purchase-order-field');\n\t\tconst $input = $qs<HTMLInputElement>('#pp-pms-new input[name=\"purchase_order_number\"]');\n\n\t\tconst {error: transactionError, result: transaction} = await orderService.startTransaction(getPurchaseOrderMethodConfiguration().gatewayId);\n\t\tif (transactionError || !transaction) {\n\t\t\tconst errorMessage = transactionError ? getErrorString(transactionError) : getLocaleText('An unknown error occured while starting the transaction. Please refresh the page and try again.');\n\t\t\tdisplayPaymentErrorMessage(errorMessage);\n\n\t\t\tstore.dispatch(stopModalLoading());\n\t\t\treturn;\n\t\t}\n\n\t\tif (!$input || !$form) {\n\t\t\tawait transaction.complete({note: 'Failed to find the Purchase Order input and form.'});\n\t\t\treturn;\n\t\t}\n\n\t\tconst purchaseOrderNumber = $input.value;\n\t\tif (!purchaseOrderNumber || !$form.checkValidity()) {\n\t\t\tawait transaction.complete({note: 'Purchase Order number was missing or invalid.'});\n\n\t\t\t$form.reportValidity();\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst $target = event.target as HTMLElement | null;\n\t\tconst $button = $target?.closest<HTMLButtonElement>('button');\n\t\tif (!$button) {\n\t\t\tawait transaction.complete({note: 'Purchase Order button was not found.'});\n\t\t\treturn;\n\t\t}\n\n\t\ttransaction.update({purchaseOrder: {purchase_order_number: purchaseOrderNumber}});\n\n\t\tawait defaultOrderFlow(orderService, transaction, {\n\t\t\tpurchase_order_number: purchaseOrderNumber,\n\t\t});\n\t});\n}\n\nexport function getPurchaseOrderMethodConfiguration(): GatewayConfiguration {\n\treturn {\n\t\tname: getFieldName(),\n\t\tgatewayId: 'peachpay_purchase_order',\n\t\tdescription: `<span>${getDescription()}</span>`,\n\t\tassets: {\n\t\t\ttitle: {src: purchaseOrderImageURL},\n\t\t\tbadge: {src: purchaseOrderImageURL},\n\t\t},\n\t};\n}\n\nfunction injectPurchaseOrderFields() {\n\tconst newCustomerDiv = $qs('#pp-pms-new div.pp-pm-saved-option[data-gateway=\"peachpay_purchase_order\"]');\n\n\tnewCustomerDiv?.insertAdjacentHTML(\n\t\t'beforeend',\n\t\t/* Html */\n\t\t`<form class=\"pp-purchase-order-field\" onsubmit=\"event.preventDefault()\">\n\t\t\t<input id=\"pp-new-purchase-order-input\" name=\"purchase_order_number\" type=\"text\" class=\"text-input\" placeholder=\" \" required>\n\t\t\t<label for=\"pp-new-purchase-order-input\" class=\"pp-form-label\">${getFieldName()}</label>\n\t\t</form>`,\n\t);\n}\n\nfunction getFieldName(): string {\n\treturn Feature.metadata(FeatureFlag.PEACHPAY_PURCHASE_ORDER_GATEWAY, 'field_name') ?? getLocaleText('Purchase order');\n}\n\nfunction getDescription(): string {\n\treturn Feature.metadata(FeatureFlag.PEACHPAY_PURCHASE_ORDER_GATEWAY, 'description') ?? '';\n}\n","import {$qsAll} from '../../../../@shared/ts/dom';\nimport {type LoadingMode} from '../../models/IEnvironment';\nimport {Carts, DefaultCart} from '../../reducers/cartReducer';\nimport {Environment} from '../../reducers/environmentReducer';\nimport {store} from '../../store';\nimport {getLocaleText} from '../../util/translation';\n\nexport function setupFreeOrderButton() {\n\tstore.subscribe(() => {\n\t\trenderFreeOrderButtonDisplay(\n\t\t\tDefaultCart.contents().length,\n\t\t\tCarts.total(),\n\t\t\tEnvironment.modalUI.loadingMode(),\n\t\t);\n\n\t\trenderFreeOrderButtonLoading(\n\t\t\tEnvironment.modalUI.loadingMode(),\n\t\t);\n\t});\n}\n\n/**\n * Renders the free button display state.\n */\nfunction renderFreeOrderButtonDisplay(cartSize: number, allCartsTotal: number, loadingMode: LoadingMode) {\n\t// Hide show button container\n\tif (cartSize > 0 && allCartsTotal === 0) {\n\t\t$qsAll('.free-btn-container', $element => {\n\t\t\t$element.classList.remove('hide');\n\t\t});\n\t} else {\n\t\t$qsAll('.free-btn-container', $element => {\n\t\t\t$element.classList.add('hide');\n\t\t});\n\t}\n\n\t// Hide/Show button\n\tif (loadingMode !== 'loading' && allCartsTotal === 0) {\n\t\t$qsAll('.free-btn', $element => {\n\t\t\t$element.classList.remove('hide');\n\t\t});\n\t} else {\n\t\t$qsAll('.free-btn', $element => {\n\t\t\t$element.classList.add('hide');\n\t\t});\n\t}\n}\n\n/**\n * Renders the free button loading state.\n */\nfunction renderFreeOrderButtonLoading(mode: LoadingMode) {\n\t// Enable/Disable button\n\tif (mode === 'finished') {\n\t\t$qsAll<HTMLInputElement>('.free-btn', $element => {\n\t\t\t$element.disabled = false;\n\t\t});\n\t} else {\n\t\t$qsAll<HTMLInputElement>('.free-btn', $element => {\n\t\t\t$element.disabled = true;\n\t\t});\n\t}\n\n\t// Show/Hide shipping spinner\n\tif (mode === 'loading') {\n\t\t$qsAll('.pp-btn-spinner-container', $element => {\n\t\t\t$element.classList.remove('hide');\n\t\t});\n\t} else {\n\t\t$qsAll('.pp-btn-spinner-container ', $element => {\n\t\t\t$element.classList.add('hide');\n\t\t});\n\t}\n\n\t// Add/Remove Processing message + Payment Spinner\n\tif (mode === 'processing') {\n\t\t$qsAll('.free-btn > .button-text', $element => {\n\t\t\t$element.innerHTML = getLocaleText('Processing');\n\t\t});\n\t\t$qsAll('.free-btn-spinner', $element => {\n\t\t\t$element.classList.remove('hide');\n\t\t});\n\t} else {\n\t\t$qsAll('.free-btn > .button-text', $element => {\n\t\t\t$element.innerHTML = getLocaleText('Place order');\n\t\t});\n\t\t$qsAll('.free-btn-spinner', $element => {\n\t\t\t$element.classList.add('hide');\n\t\t});\n\t}\n}\n","import {type GatewayConfiguration} from '../../models/GatewayConfiguration';\nimport {$qsAll} from '../../../../@shared/ts/dom';\nimport {checkRequiredFields} from '../../features/additionalFields';\nimport {updateCustomerDataInBrowser} from '../../features/customer';\nimport {startModalProcessing, stopModalLoading} from '../../reducers/environmentReducer';\nimport {store} from '../../store';\nimport {displayPaymentErrorMessage, type OrderService} from '../order';\nimport {setupFreeOrderButton} from './button';\nimport {clearLocalSession} from '../session';\nimport {getErrorString} from '../../../../@shared/ts/error';\nimport {getLocaleText} from '../../util/translation';\n\nexport function initFreeOrderSupport(orderService: OrderService) {\n\tconst confirm = async (event: MouseEvent) => {\n\t\tif (!checkRequiredFields()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst $target = event.target as HTMLElement | null;\n\t\tconst $button = $target?.closest<HTMLButtonElement>('button');\n\t\tif (!$button) {\n\t\t\treturn;\n\t\t}\n\n\t\tawait freeOrderFlow(orderService);\n\t};\n\n\t$qsAll<HTMLElement>('.free-btn', $el => {\n\t\t$el.addEventListener('click', confirm);\n\t});\n\n\tsetupFreeOrderButton();\n}\n\nexport function getFreeMethodConfiguration(): GatewayConfiguration {\n\treturn {\n\t\tname: 'PeachPay Free',\n\t\tdescription: '',\n\t\tgatewayId: 'peachpay_free',\n\t\tassets: {\n\t\t\tbadge: {src: ''},\n\t\t},\n\t};\n}\n\nasync function freeOrderFlow(orderService: OrderService) {\n\tstore.dispatch(startModalProcessing());\n\n\tconst {error: transactionError, result: transaction} = await orderService.startTransaction('peachpay_free');\n\tif (transactionError || !transaction) {\n\t\tconst errorMessage = transactionError ? getErrorString(transactionError) : getLocaleText('An unknown error occured while starting the transaction. Please refresh the page and try again.');\n\t\tdisplayPaymentErrorMessage(errorMessage);\n\n\t\tstore.dispatch(stopModalLoading());\n\t\treturn;\n\t}\n\n\tconst {error: orderError, result: orderResult} = await orderService.placeOrder(transaction);\n\tif (orderError || !orderResult || orderResult.result !== 'success') {\n\t\tstore.dispatch(stopModalLoading());\n\t\treturn;\n\t}\n\n\tupdateCustomerDataInBrowser();\n\tclearLocalSession();\n\n\tif (window.top) {\n\t\tawait transaction.complete({paymentStatus: 'success', orderStatus: 'success'});\n\t\twindow.top.location = orderResult.redirect;\n\t}\n}\n","import {displayPaymentErrorMessage, type OrderService} from '../order';\nimport {type GatewayConfiguration} from '../../models/GatewayConfiguration';\nimport {Feature, stopModalLoading} from '../../reducers/environmentReducer';\nimport {getLocaleText} from '../../util/translation';\nimport {addButtonListener, defaultOrderFlow} from './peachpay';\nimport {FeatureFlag} from '../../../../@type/features';\nimport codImageURL from '../../../img/marks/cash.svg';\nimport {getErrorString} from '../../../../@shared/ts/error';\nimport {store} from '../../store';\n\nexport function initCODSupport(orderService: OrderService) {\n\tif (!Feature.enabled(FeatureFlag.WOOCOMMERCE_COD_GATEWAY)) {\n\t\treturn;\n\t}\n\n\taddButtonListener(getCODMethodConfiguration().gatewayId, async () => {\n\t\tconst {error: transactionError, result: transaction} = await orderService.startTransaction(getCODMethodConfiguration().gatewayId);\n\t\tif (transactionError || !transaction) {\n\t\t\tconst errorMessage = transactionError ? getErrorString(transactionError) : getLocaleText('An unknown error occured while starting the transaction. Please refresh the page and try again.');\n\t\t\tdisplayPaymentErrorMessage(errorMessage);\n\n\t\t\tstore.dispatch(stopModalLoading());\n\t\t\treturn;\n\t\t}\n\n\t\tawait defaultOrderFlow(orderService, transaction);\n\t});\n}\n\nexport function getCODMethodConfiguration(): GatewayConfiguration {\n\treturn {\n\t\tname: getTitle(),\n\t\tgatewayId: 'cod',\n\t\tdescription: getDescription(),\n\t\tassets: {\n\t\t\ttitle: {src: codImageURL},\n\t\t\tbadge: {src: codImageURL},\n\t\t},\n\t};\n}\n\nfunction getTitle(): string {\n\treturn Feature.metadata(FeatureFlag.WOOCOMMERCE_COD_GATEWAY, 'title') ?? getLocaleText('Cheque');\n}\n\nfunction getDescription(): string {\n\tconst description = Feature.metadata<string>(FeatureFlag.WOOCOMMERCE_COD_GATEWAY, 'description') ?? getLocaleText('Pay with a cheque');\n\tconst instructions = Feature.metadata<string>(FeatureFlag.WOOCOMMERCE_COD_GATEWAY, 'instructions') ?? '';\n\tif (instructions) {\n\t\treturn /* html */ `\n\t\t\t<span>${description}</span>\n\t\t\t</br></br>\n\t\t\t<span>${instructions}</span>\n\t\t`;\n\t}\n\n\treturn description;\n}\n","import {displayPaymentErrorMessage, type OrderService} from '../order';\nimport {type GatewayConfiguration} from '../../models/GatewayConfiguration';\nimport {Feature, stopModalLoading} from '../../reducers/environmentReducer';\nimport {getLocaleText} from '../../util/translation';\nimport {addButtonListener, defaultOrderFlow} from './peachpay';\nimport {FeatureFlag} from '../../../../@type/features';\nimport checkImageURL from '../../../img/marks/check.svg';\nimport {getErrorString} from '../../../../@shared/ts/error';\nimport {store} from '../../store';\n\nexport function initChequeSupport(orderService: OrderService) {\n\tif (!Feature.enabled(FeatureFlag.WOOCOMMERCE_CHEQUE_GATEWAY)) {\n\t\treturn;\n\t}\n\n\taddButtonListener(getChequeMethodConfiguration().gatewayId, async () => {\n\t\tconst {error: transactionError, result: transaction} = await orderService.startTransaction(getChequeMethodConfiguration().gatewayId);\n\t\tif (transactionError || !transaction) {\n\t\t\tconst errorMessage = transactionError ? getErrorString(transactionError) : getLocaleText('An unknown error occured while starting the transaction. Please refresh the page and try again.');\n\t\t\tdisplayPaymentErrorMessage(errorMessage);\n\n\t\t\tstore.dispatch(stopModalLoading());\n\t\t\treturn;\n\t\t}\n\n\t\tawait defaultOrderFlow(orderService, transaction);\n\t});\n}\n\nexport function getChequeMethodConfiguration(): GatewayConfiguration {\n\treturn {\n\t\tname: getTitle(),\n\t\tgatewayId: 'cheque',\n\t\tdescription: getDescription(),\n\t\tassets: {\n\t\t\ttitle: {src: checkImageURL},\n\t\t\tbadge: {src: checkImageURL},\n\t\t},\n\t};\n}\n\nfunction getTitle(): string {\n\treturn Feature.metadata(FeatureFlag.WOOCOMMERCE_CHEQUE_GATEWAY, 'title') ?? getLocaleText('Cheque');\n}\n\nfunction getDescription(): string {\n\tconst description = Feature.metadata<string>(FeatureFlag.WOOCOMMERCE_CHEQUE_GATEWAY, 'description') ?? getLocaleText('Pay with a cheque');\n\tconst instructions = Feature.metadata<string>(FeatureFlag.WOOCOMMERCE_CHEQUE_GATEWAY, 'instructions') ?? '';\n\tif (instructions) {\n\t\treturn /* html */ `\n\t\t\t<span>${description}</span>\n\t\t\t</br></br>\n\t\t\t<span>${instructions}</span>\n\t\t`;\n\t}\n\n\treturn description;\n}\n","import {displayPaymentErrorMessage, type OrderService} from '../order';\nimport {type GatewayConfiguration} from '../../models/GatewayConfiguration';\nimport {Feature, stopModalLoading} from '../../reducers/environmentReducer';\nimport {getLocaleText} from '../../util/translation';\nimport {addButtonListener, defaultOrderFlow} from './peachpay';\nimport {FeatureFlag} from '../../../../@type/features';\nimport bacsImageURL from '../../../img/marks/transfer.svg';\nimport {getErrorString} from '../../../../@shared/ts/error';\nimport {store} from '../../store';\n\nexport function initBacsSupport(orderService: OrderService) {\n\tif (!Feature.enabled(FeatureFlag.WOOCOMMERCE_BACS_GATEWAY)) {\n\t\treturn;\n\t}\n\n\taddButtonListener(getBacsMethodConfiguration().gatewayId, async () => {\n\t\tconst {error: transactionError, result: transaction} = await orderService.startTransaction(getBacsMethodConfiguration().gatewayId);\n\t\tif (transactionError || !transaction) {\n\t\t\tconst errorMessage = transactionError ? getErrorString(transactionError) : getLocaleText('An unknown error occured while starting the transaction. Please refresh the page and try again.');\n\t\t\tdisplayPaymentErrorMessage(errorMessage);\n\n\t\t\tstore.dispatch(stopModalLoading());\n\t\t\treturn;\n\t\t}\n\n\t\tawait defaultOrderFlow(orderService, transaction);\n\t});\n}\n\nexport function getBacsMethodConfiguration(): GatewayConfiguration {\n\treturn {\n\t\tname: getTitle(),\n\t\tgatewayId: 'bacs',\n\t\tdescription: getDescription(),\n\t\tassets: {\n\t\t\ttitle: {src: bacsImageURL},\n\t\t\tbadge: {src: bacsImageURL},\n\t\t},\n\t};\n}\n\nfunction getTitle(): string {\n\treturn Feature.metadata(FeatureFlag.WOOCOMMERCE_BACS_GATEWAY, 'title') ?? getLocaleText('Wire/Bank Transfer');\n}\n\nfunction getDescription(): string {\n\tconst description = Feature.metadata<string>(FeatureFlag.WOOCOMMERCE_BACS_GATEWAY, 'description') ?? getLocaleText('Payment via Wire/Bank Transfer');\n\tconst instructions = Feature.metadata<string>(FeatureFlag.WOOCOMMERCE_BACS_GATEWAY, 'instructions') ?? '';\n\tif (instructions) {\n\t\treturn /* html */ `\n\t\t\t<span>${description}</span>\n\t\t\t</br></br>\n\t\t\t<span>${instructions}</span>\n\t\t`;\n\t}\n\n\treturn description;\n}\n","import {Feature, startModalProcessing, stopModalLoading} from '../../reducers/environmentReducer';\nimport {type GatewayConfiguration} from '../../models/GatewayConfiguration';\nimport {type Transaction, type OrderService} from '../order';\nimport {store} from '../../store';\nimport {setupPeachpayButton} from './button';\nimport {PaymentConfiguration, registerGatewayBatch} from '../../reducers/paymentConfigurationReducer';\nimport {getPurchaseOrderMethodConfiguration, initPurchaseOrderSupport} from './purchaseOrder';\nimport {getFreeMethodConfiguration, initFreeOrderSupport} from '../free/free';\nimport {getCODMethodConfiguration, initCODSupport} from './cod';\nimport {getChequeMethodConfiguration, initChequeSupport} from './cheque';\nimport {getBacsMethodConfiguration, initBacsSupport} from './bacs';\nimport {PeachPayCustomer, updateCustomerPreferredGateway} from '../../reducers/peachPayCustomerReducer';\nimport {updateCustomerDataInBrowser} from '../../features/customer';\nimport {$qsAll} from '../../../../@shared/ts/dom';\nimport {FeatureFlag} from '../../../../@type/features';\nimport {clearLocalSession} from '../session';\nimport {DefaultCart} from '../../reducers/cartReducer';\nimport {MerchantConfiguration} from '../../reducers/merchantConfigurationReducer';\nimport {type WCOrder} from '../../../../@type/woocommerce/order';\n\ntype CustomOrder = WCOrder & {\n\tresult: 'success';\n\tdetails?: {\n\t\tid?: number;\n\t\tcurrency?: string;\n\t\tpayment_method?: string;\n\t\ttotal?: string;\n\t\tbilling?: {\n\t\t\tfirst_name?: string;\n\t\t\tlast_name?: string;\n\t\t};\n\t};\n};\n\n/**\n * Here is where peachpay provided payment methods hook into the shared button.\n */\nconst buttonListeners: Record<string, (event: MouseEvent) => void> = {};\n\nexport function initPeachPayMethods(orderService: OrderService) {\n\tsetupPeachpayButton();\n\n\t// Important that methods are registered before init\n\tregisterGateways();\n\n\t// Initialize the methods, these are expected to handle their feature flags on their own.\n\tinitPurchaseOrderSupport(orderService);\n\tinitCODSupport(orderService);\n\tinitChequeSupport(orderService);\n\tinitBacsSupport(orderService);\n\tinitFreeOrderSupport(orderService);\n\n\t$qsAll<HTMLElement>('.peachpay-integrated-btn', $el => {\n\t\t$el.addEventListener('click', (event: MouseEvent) => {\n\t\t\tconst $target = event.target as HTMLElement | null;\n\t\t\tconst $button = $target?.closest<HTMLButtonElement>('button');\n\t\t\tif (!$button) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Run the registered listener for the appropriate payment method\n\t\t\tconst listener = buttonListeners[PaymentConfiguration.selectedGateway()];\n\t\t\tif (listener) {\n\t\t\t\tlistener(event);\n\t\t\t}\n\t\t});\n\t});\n}\n\nexport function addButtonListener(gatewayId: string, listener: (event: MouseEvent) => void) {\n\tbuttonListeners[gatewayId] = listener;\n}\n\nfunction registerGateways() {\n\tconst gatewayConfigurations: Record<string, GatewayConfiguration> = {};\n\n\tif (Feature.enabled(FeatureFlag.PEACHPAY_PURCHASE_ORDER_GATEWAY)) {\n\t\tconst config = getPurchaseOrderMethodConfiguration();\n\t\tgatewayConfigurations[config.gatewayId] = config;\n\t}\n\n\tif (Feature.enabled(FeatureFlag.WOOCOMMERCE_COD_GATEWAY)) {\n\t\tconst config = getCODMethodConfiguration();\n\t\tgatewayConfigurations[config.gatewayId] = config;\n\t}\n\n\tif (Feature.enabled(FeatureFlag.WOOCOMMERCE_CHEQUE_GATEWAY)) {\n\t\tconst config = getChequeMethodConfiguration();\n\t\tgatewayConfigurations[config.gatewayId] = config;\n\t}\n\n\tif (Feature.enabled(FeatureFlag.WOOCOMMERCE_BACS_GATEWAY)) {\n\t\tconst config = getBacsMethodConfiguration();\n\t\tgatewayConfigurations[config.gatewayId] = config;\n\t}\n\n\tconst freeConfig = getFreeMethodConfiguration();\n\tgatewayConfigurations[freeConfig.gatewayId] = freeConfig;\n\n\tstore.dispatch(registerGatewayBatch(gatewayConfigurations));\n}\n\nexport async function defaultOrderFlow(orderService: OrderService, transaction: Transaction, extraFormData: Record<string, string> = {}) {\n\tstore.dispatch(startModalProcessing());\n\n\tconst {error: orderError, result: orderResult} = await orderService.placeOrder(transaction, extraFormData);\n\tif (orderError || !orderResult || orderResult.result !== 'success') {\n\t\tstore.dispatch(stopModalLoading());\n\t\treturn;\n\t}\n\n\tstore.dispatch(updateCustomerPreferredGateway(PaymentConfiguration.selectedGateway()));\n\n\tupdateCustomerDataInBrowser();\n\tclearLocalSession();\n\n\tif (window.top) {\n\t\tconst customOrder = orderResult as CustomOrder;\n\n\t\tif (!customOrder.details) {\n\t\t\tcustomOrder.details = {\n\t\t\t\tid: customOrder.order_id,\n\t\t\t\tcurrency: MerchantConfiguration.currency.code(),\n\t\t\t\tpayment_method: PaymentConfiguration.selectedGateway(),\n\t\t\t\ttotal: String(DefaultCart.total()),\n\t\t\t\tbilling: {\n\t\t\t\t\tfirst_name: PeachPayCustomer.billing.firstName(),\n\t\t\t\t\tlast_name: PeachPayCustomer.billing.lastName(),\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\n\t\tawait transaction.complete({\n\t\t\torder: customOrder as unknown as WCOrder,\n\t\t\tpaymentStatus: 'on-hold',\n\t\t\torderStatus: 'on-hold',\n\t\t});\n\n\t\twindow.top.location = orderResult.redirect;\n\t}\n}\n","import {onWindowMessage} from '../../@shared/ts/dom';\nimport {type InitMessage} from '../../@type/window-messages';\nimport {GLOBAL} from './deprecated/global';\nimport {initMerchantAccount} from './features/account';\nimport {initAdditionalFields} from './features/additionalFields';\nimport {initAddressAutocomplete} from './features/addressAutocomplete';\nimport {initShippingForm} from './features/billingShippingFields';\nimport {initCart} from './features/cart';\nimport {initCouponInput} from './features/coupon';\nimport {initCurrency} from './features/currency';\nimport {initCurrencySwitcher} from './features/currencySwitch';\nimport {initCustomer, installCustomerBillingFields, installCustomerFormFields, loadCustomer} from './features/customer';\nimport {initCustomOrderMessaging} from './features/customOrderMessaging';\nimport {initGiftCardInput} from './features/giftCard';\nimport {initLanguage} from './features/language';\nimport {initMerchantLogo} from './features/merchantLogo';\nimport {initMetrics} from './features/metrics';\nimport {initModal} from './features/modal';\nimport {initOneClickUpsell} from './features/oneClickUpsell';\nimport {initDeliveryDate} from './features/orderDelivery';\nimport {initPaymentGatewaySelector} from './features/paymentSelector';\nimport {initRelatedProducts} from './features/relatedProducts';\nimport {initShipping} from './features/shipping';\nimport {initSummary} from './features/summary';\nimport {initVAT} from './features/vat';\nimport {initBotProtection} from './features/botProtection';\nimport {getOrderService, type OrderService} from './payment/order';\nimport {initPeachPayMethods} from './payment/peachpay/peachpay';\nimport {loadSession} from './payment/session';\nimport {FeatureFlag} from '../../@type/features';\nimport {Feature, setFeatureSupport, stopModalLoading, updateEnvironment} from './reducers/environmentReducer';\nimport {updateMerchantHostName, updateMerchantId, updateMerchantName} from './reducers/merchantConfigurationReducer';\nimport {store} from './store';\nimport {determinePageType} from './util/environment';\nimport {captureSentryException, initSentry} from '../../@shared/ts/sentry';\nimport {PLUGIN_VERSION} from '../../git';\n\n(window as any).store = store;\n\ninitSentry(`peachpay-checkout@${PLUGIN_VERSION}`, 'https://39b5a2e17e264bb5a6ea5abe9bc6cf61@o470066.ingest.sentry.io/5660513');\n\n/**\n * Entry point for the peachpay checkout.\n */\n(function () {\n\t/**\n\t * Inits data from the php side.\n\t */\n\tonWindowMessage<InitMessage>('init', async message => {\n\t\tGLOBAL.phpData = message.phpData;\n\n\t\t// We first need to initialize the language for use in the form fields\n\t\tstore.dispatch(setFeatureSupport(message.phpData.feature_support));\n\t\tinitLanguage(message);\n\n\t\t// #region Customer form fields Init\n\t\t// We then need to set the merchant hostname because addFormFields depends on it.\n\t\tstore.dispatch(updateMerchantHostName(message.merchantHostname));\n\t\t// It is important this function runs second because event listeners depend on the HTML it adds.\n\t\tinstallCustomerFormFields(message);\n\t\tinstallCustomerBillingFields(message);\n\t\t// #endregion\n\n\t\tloadSession();\n\n\t\tstore.dispatch(updateMerchantHostName(message.merchantHostname));\n\t\tstore.dispatch(updateMerchantName(message.phpData.merchant_name));\n\t\tstore.dispatch(updateMerchantId(message.phpData.merchant_id));\n\t\tstore.dispatch(updateEnvironment({\n\t\t\tpluginIsTestMode: Boolean(message.isTestMode),\n\t\t\tpluginPageType: determinePageType(message.isCartPage, message.isCheckoutPage, message.isShopPage),\n\t\t\tcustomerIsMobile: message.isMobile,\n\t\t\tpluginButtonColor: message.phpData.button_color,\n\t\t\tpluginVersion: message.phpData.version,\n\t\t}));\n\n\t\t/**\n\t\t * Feature callbacks to perform a action or insert data into the redux store once the data is available.\n\t\t */\n\t\tinitOneClickUpsell();\n\t\tinitDeliveryDate();\n\t\tinitMetrics();\n\t\tinitCart();\n\t\tinitBotProtection();\n\t\tinitSummary(message);\n\t\tinitCouponInput(message);\n\t\tinitGiftCardInput();\n\t\tinitShipping(message);\n\t\tinitShippingForm();\n\t\tinitCustomer(message);\n\t\tinitCurrency(message);\n\t\tinitMerchantAccount(message);\n\t\tinitVAT(message);\n\t\tinitRelatedProducts();\n\t\tinitAdditionalFields(message);\n\t\tinitCurrencySwitcher();\n\t\tinitPaymentGatewaySelector();\n\t\tinitModal(message);\n\t\tinitAddressAutocomplete(message);\n\t\tinitCustomOrderMessaging();\n\t\tinitMerchantLogo();\n\n\t\t// Payment Processor support\n\t\tconst orderService = getOrderService();\n\n\t\tinitPeachPayMethods(orderService);\n\n\t\tconst initPaymentIntegrationResponse = await Promise.allSettled([\n\t\t\timportPaymentIntegration(importGateway.authnet, orderService),\n\t\t\timportPaymentIntegration(importGateway.stripe, orderService),\n\t\t\timportPaymentIntegration(importGateway.square, orderService),\n\t\t\timportPaymentIntegration(importGateway.paypal, orderService),\n\t\t\timportPaymentIntegration(importGateway.amazon, orderService),\n\t\t\timportPaymentIntegration(importGateway.poynt, orderService),\n\t\t]);\n\n\t\tinitPaymentIntegrationResponse.forEach(response => {\n\t\t\tif (response.status === 'fulfilled') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconsole.error(response.reason);\n\t\t});\n\n\t\tawait loadCustomer();\n\t\twindow.dispatchEvent(new CustomEvent('pp-update-afterpay-branding'));\n\n\t\tif (!store.getState().peachPayCustomer.preferred_payment_method) {\n\t\t\tstore.dispatch(updateEnvironment({modalPageType: 'info'}));\n\t\t}\n\n\t\tstore.dispatch(stopModalLoading());\n\n\t\twindow.parent?.postMessage('pp-loaded', location.origin);\n\t});\n\n\tonWindowMessage('captureInfiniteLoadingError', async (event: any) => {\n\t\tcaptureSentryException(new Error('pp-button stuck loading infinitely'), {\n\t\t\t...event.data,\n\t\t\tcheckout_window_state: JSON.stringify(store.getState()),\n\t\t\tpeachpay_data: JSON.stringify(GLOBAL.phpData),\n\t\t});\n\t});\n})();\n\ntype GatewayIntegrationImport = {\n\tfeatureFlag: FeatureFlag;\n\timport_: () => Promise<{default: (orderService: OrderService) => Promise<void> | void}>;\n};\n\nconst importGateway = {\n\tauthnet: {\n\t\tfeatureFlag: FeatureFlag.AUTHNET_GATEWAY,\n\t\timport_: async () => import('./payment/authnet/authnet'),\n\t},\n\tstripe: {\n\t\tfeatureFlag: FeatureFlag.STRIPE_GATEWAYS,\n\t\timport_: async () => import('./payment/stripe/stripe'),\n\t},\n\tsquare: {\n\t\tfeatureFlag: FeatureFlag.SQUARE_GATEWAYS,\n\t\timport_: async () => import('./payment/square/square'),\n\t},\n\tpaypal: {\n\t\tfeatureFlag: FeatureFlag.PAYPAL_GATEWAYS,\n\t\timport_: async () => import('./payment/paypal/paypal'),\n\t},\n\tamazon: {\n\t\tfeatureFlag: FeatureFlag.AMAZON_GATEWAY,\n\t\timport_: async () => import('./payment/amazon/amazon'),\n\t},\n\tpoynt: {\n\t\tfeatureFlag: FeatureFlag.POYNT_GATEWAYS,\n\t\timport_: async () => import('./payment/poynt/poynt'),\n\t},\n} satisfies Record<string, GatewayIntegrationImport>;\n\n/**\n * Import payment dynamically based on given information.\n *\n * @param importGateway\n * @param orderService\n */\nasync function importPaymentIntegration(importGateway: GatewayIntegrationImport, orderService: OrderService) {\n\tif (!Feature.enabled(importGateway.featureFlag)) {\n\t\treturn null;\n\t}\n\n\treturn new Promise((resolve, reject) => {\n\t\timportGateway.import_()\n\t\t\t.then(gateway => {\n\t\t\t\tresolve(gateway.default(orderService));\n\t\t\t})\n\t\t\t.catch(e => {\n\t\t\t\tconsole.error(`Failed to import payment integration: ${importGateway.featureFlag}`, e);\n\t\t\t\treject(e);\n\t\t\t});\n\t});\n}\n","declare const __PEACHPAY_GIT_VERSION__: string;\ndeclare const __PEACHPAY_GIT_COMMITHASH__: string;\ndeclare const __PEACHPAY_GIT_BRANCH__: string;\ndeclare const __PEACHPAY_GIT_LASTCOMMITDATETIME__: string;\ndeclare const __PLUGIN_VERSION__: string;\n\nconst VERSION = __PEACHPAY_GIT_VERSION__;\nconst COMMITHASH = __PEACHPAY_GIT_COMMITHASH__;\nconst BRANCH = __PEACHPAY_GIT_BRANCH__;\nconst LASTCOMMITDATETIME = __PEACHPAY_GIT_LASTCOMMITDATETIME__;\n\nconst PLUGIN_VERSION = __PLUGIN_VERSION__;\n\nexport {\n\tVERSION,\n\tCOMMITHASH,\n\tBRANCH,\n\tLASTCOMMITDATETIME,\n\tPLUGIN_VERSION,\n};\n","import {$qsAll, $qs} from '../../../@shared/ts/dom';\nimport {FeatureFlag} from '../../../@type/features';\nimport {Feature} from '../reducers/environmentReducer';\n\nfunction initMerchantLogo() {\n\tconst logoSrc = Feature.metadata<string>(FeatureFlag.MERCHANT_LOGO, 'logo_src');\n\tif (Feature.enabled(FeatureFlag.MERCHANT_LOGO) && logoSrc) {\n\t\t$qsAll('.pp-merchant-logo-container', $el => {\n\t\t\t$el.insertAdjacentHTML('afterbegin', /* html */ `<img class=\"pp-merchant-logo\" src=\"${logoSrc}\">`);\n\t\t\t$el.style.opacity = '1';\n\t\t\t$el.classList.remove('hide');\n\t\t});\n\n\t\t$qs('#pp-checkout-status-container')?.classList.remove('center');\n\t\t$qs('#pp-checkout-status-container')?.classList.add('merchant-logo');\n\t} else {\n\t\t$qsAll('.pp-merchant-logo-container', $el => {\n\t\t\t$el.style.opacity = '0';\n\t\t});\n\t}\n}\n\nexport {initMerchantLogo};\n"],"names":["inProgress","dataWebpackPrefix","__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","this","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","__generator","body","f","y","g","_","label","sent","trys","ops","verb","Symbol","iterator","v","op","TypeError","pop","push","create","__values","o","m","__read","r","ar","error","self","ampersandTest","nativeURLSearchParams","URLSearchParams","get","isSupportObjectConstructor","a","toString","decodesPlusesCorrectly","encodesAmpersandsCorrectly","append","URLSearchParamsPolyfill","iterable","propValue","name","appendTo","dict","has","getAll","slice","set","key","query","encode","join","Proxy","construct","target","args","Function","bind","defineProperty","USPProto","polyfill","forEach","callback","parseToDict","getOwnPropertyNames","sort","k","j","keys","values","items","item","makeIterator","entries","search","str","replace","encodeURIComponent","match","decode","decodeURIComponent","arr","shift","undefined","isArray","indexOf","pairs","split","index","val","JSON","stringify","obj","prop","window","$qs","selector","cb","$element","document","querySelector","$qsAll","Array","from","querySelectorAll","loadScript","src","scriptWindowObject","$script","createElement","type","onreadystatechange","onload","onerror","head","appendChild","fetchWindowData","targetWindow","endpoint","request","channel","MessageChannel","port1","onmessage","data","close","postMessage","event","location","origin","port2","Error","onWindowDataFetch","requestCallback","addEventListener","message","response","ports","secondaryError","originalError","originalErrorString","fetchHostWindowData","top","onWindowMessage","eventName","stripHtml","html","preFilterSelector","temporalDivElement","innerHTML","$el","remove","textContent","innerText","trim","getErrorString","stack","errorString","maybeFetch","input","init","fetch","json","catch","initSentry","release","dsn","isDevelopmentMode","test","hostname","Sentry","onLoad","environment","beforeSend","hint","originalException","ignoreErrors","allowUrls","captureSentryException","extra","fingerprint","withScope","scope","setExtra","setFingerprint","captureException","GLOBAL","phpData","linkedProductsIds","addOrderNotesToAdditionalFields","fieldData","additional_fields","fieldOrder","additional_fields_order","map","fo","Number","orderNotesData","field_default","field_enable","field_label","field_name","field_required","type_list","field_placeholder","width","temp","fieldId","filter","includes","initAdditionalFields","preventDefault","classList","field","fieldDataSingle","accordion","elementString","accordionBuilder","inner","formLabelBuilder","labelText","labelBuilder","isAdditionalFieldOuterLabel","textAreaBuilder","genericInputAreaBuilder","headerBuilder","selectBuilder","optionOrder","optionBuilder","optionList","radioFieldBuilder","checkboxBuilder","option_order","generateFieldElement","newPageElement","orderNumber","datum","fieldItem","generateFields","$ah","stopImmediatePropagation","toggleAccordionCollapseState","$as","setAttribute","accordionHeaderListener","removeEventListener","syncFields","addAdditionalFieldsEventHandlers","previousExtraFields","renderExtraFields","extraFields","renderAdditionalFields","$form","closest","fieldRecord","elements","tagName","$input","checked","$select","$textarea","handleNonTextInputAccessibility","accordionHeader","contains","add","$inner","nextElementSibling","setTimeout","$chevron","getElementsByTagName","style","transform","extraFieldData","$radio","$field","isInitial","toLowerCase","inputIsInitial","displayInputStatus","collectAdditionalFieldData","fieldDataRecord","fieldName","temporaryData","$selectedRadio","$checkbox","checkRequiredFields","modalPage","forms","checkValidity","reduce","acc","validity","modalPageType","requestedPage","reportValidity","accordionInner","inputMode","parentNode","firstElementChild","generateMainForm","form","id","container","formGenerator","billing_fields","billing_fields_order","generateShippingForm","shipping_fields","shipping_fields_order","initShippingForm","section","formIdDifferentiator","formId","formForm","formFormDiv","rowSpace","rowElement","labelNameTranslations","Shipping","Billing","Personal","fieldWidth","parseInt","element","alignItems","optional","Apartment","City","Country","Email","State","Province","isOptional","$canvas","getContext","font","tooLong","measureText","getLimitedLabel","updateEmail","radioFields","first","stateRegionBuilder","email","initBotProtection","script","async","defer","getCaptchaToken","grecaptcha","ready","execute","action","token","CHECKOUT_CUSTOMER_KEY","INPROGRESS_CUSTOMER_KEY","getCustomer","inprogress","parse","localStorage","getItem","setCustomer","customer","setItem","installCustomerFormFields","ppInfo","insertBefore","firstChild","installCustomerBillingFields","newForm","initCustomer","isChecked","store","customerSaveToBrowserSelected","renderCorrectProvinceField","wcCountryLocaleRuleRender","syncCustomerFieldChanges","formFields","form_fields","canMoveOn","$forwardButton","removeAttribute","initCustomerFormEvents","previousShipToDifferentAddress","previousCustomerStr","previousOpen","previousModalPage","shipToDifferentAddress","customerStr","renderCountryAndStateList","wc_location_info","$openShippingDetails","disabled","hideShippingDetails","renderShippingElements","shortAddress","getShortAddress","fullAddress","getFullAddress","renderCustomerHeader","renderCustomerFields","initCustomerEvents","hide","defaultFieldNames","customerDataRequiredFields","order","customerDataEnableFields","info","stateFieldInfo","country_locale_data","country","postalFieldInfo","required","page","infoFormName","countryElement","fieldStateFieldInfo","fieldPostalCodeFieldInfo","fieldCityFieldInfo","formIdentifier","stateField","fieldIsRequired","exec","wcStatefieldRule","unhideFields","postcodeFieldInfo","postcodeField","hidden","list","children","formElement","wcPostalCodeFieldRule","cityFieldInfo","wcCityFieldRule","fieldAttributeName","enabledField","collectCustomerFieldData","requestedFields","FormData","getAttribute","select","refreshCountryFeatures","dispatchEvent","CustomEvent","loadCustomer","inprogressCustomer","locationInfo","shipping_country","customer_default_country","store_country","shipping_state","customer_default_state_or_province","billing_country","billing_state","updateCustomerDataInBrowser","removeItem","clearCustomer","merchantShipping","allowed_states_or_provinces","$stateOrProvincesSelect","chevron","lastElementChild","$stateOrProvincesText","merchantLocationInfo","infoForms","$countries","selectACountry","countryOptions","allowed_countries","options","selectedIndex","Event","console","warn","customerInfoType","fullState","state","postal","city","address1","address2","getFullName","fullName","firstName","lastName","initDeliveryDate","checkDeliveryDateIsValid","todayDate","Date","maxDate","setDate","getDate","wc_od_max_delivery_days","$shippingDate","min","toISOString","max","renderDeliveryDate","collectDeliveryDate","dateString","day","getDay","delivery_unchecked_day","String","validateDateIsAvailable","initShipping","renderShipping","handleShippingSelectionEvent","isValidAddress","validateAddress","display","initShippingEvents","merchantConfiguration","general","wcLocationInfoData","shippingZones","num_shipping_zones","validateURL","wcBillingFields","formData","method","success","alert","error_messages","$target","$targetContainer","shippingMethodId","cartKey","dataset","packageKey","shippingPackageKey","packageMethodId","cart","renderOrderHeader","calculatedCarts","shippingOptionsHTML","cartCalculation","package_record","shippingPackage","renderShippingPackageOptions","cart_meta","renderCartShippingOptions","cartMeta","shouldShowPackageName","packageName","package_name","packageNameHTML","packageMethodOptionsHTML","methods","methodKey","selected","shippingMethodKey","shippingMethod","selected_method","description","title","total","shippingIsValid","GatewayEligibility","getOrderService","placeOrder","startTransaction","gatewayId","createPaymentTransaction","transactionId","complete","transactionUpdates","getId","update","pt","ct","updatePaymentTransaction","transaction","extraFormData","checkoutURL","checkoutNonce","credentials","orderError","orderResult","displayPaymentErrorMessage","note","messages","refresh","reload","requestCartCalculation","errorMessage","sync","cartUrl","calculationError","calculationResult","consumeCartCalculationResponse","notices","cartErrors","errorNotice","renderOrderNotice","notice","existingCustomerData","cart_calculation_record","gateway_availability_details","available_gateway_ids","noticeHTML","innerWidth","insertAdjacentHTML","paymentGateway","headers","session","merchant_id","merchant_name","merchant_url","plugin_version","payment_method","payment_method_variation","ok","transaction_id","requestURL","requestBody","paypal","stripe","square","purchase_order","purchaseOrder","payment_status","paymentStatus","order_status","orderStatus","responseBody","PEACHPAY_SESSION_KEY","createSession","d","d2","getTime","performance","now","c","Math","random","floor","created_on","toJSON","loadSession","currentDate","sessionDate","getMilliseconds","parseSession","sessionStorage","getData","saveSession","clearLocalSession","cartReducer","payload","newState","packageRecord","updateCartCalculation","updateCartPackageShippingMethod","DefaultCart","selectedShippingMethod","selectedShippingMethodDetails","contents","subtotal","summary","feeTotal","fee","fees_record","totalAppliedFees","previousValue","couponTotal","coupon","coupons_record","totalAppliedCoupons","couponRecord","giftCardTotal","giftCard","gift_card_record","totalAppliedGiftCards","totalShipping","total_shipping","totalTax","total_tax","shippingMethods","Carts","anyShippingMethodsAvailable","calculatedCart","virtual","is_virtual","anyVirtual","carts","collectSelectedShipping","selectedShippingMethods","selectedShipping","subscriptionPresent","subscription","cartSummaryViewData","cartSummary","amount","tax_lines","tax_line","parseFloat","environmentReducer","plugin","modalUI","language","translated_modal_terms","featureSupport","updateEnvironment","Environment","mobile","customerIsMobile","saveToBrowserSelected","version","pluginVersion","mode","pluginIsTestMode","buttonColor","pluginButtonColor","pageType","pluginPageType","open","modalIsOpen","loadingMode","modalLoading","setFeatureSupport","features","updateLanguage","updateTranslatedModalTerms","startModalLoading","startModalProcessing","stopModalLoading","testMode","apiURL","isTestOrDevSite","Feature","enabled","flag","metadata","dynamicMetadata","feature_metadata","initialState","peachPayOrder","sessionId","customerAddressValidated","additionalFields","peachPayCustomer","shipping_company","shipping_email","shipping_first_name","shipping_last_name","shipping_address_1","shipping_address_2","shipping_city","shipping_postcode","shipping_phone","billing_company","billing_email","billing_first_name","billing_last_name","billing_address_1","billing_address_2","billing_city","billing_postcode","billing_phone","hostName","currency","code","symbol","position","thousands_separator","decimal_separator","rounding","number_of_decimals","shipping","tax","displayPricesInCartAndCheckout","paymentConfiguration","selectedGateway","availableGateways","gatewayAvailabilityDetails","gatewayConfigurations","createDispatchUpdate","merchantConfigurationReducer","updateMerchantCurrencyConfig","updateMerchantTaxConfig","updateMerchantGeneralConfig","updateMerchantShippingConfig","updateMerchantHostName","updateMerchantName","updateMerchantId","MerchantConfiguration","configuration","displayMode","paymentConfigurationReducer","registerGatewayBatch","setSelectedPaymentGateway","updateAvailableGateways","updateGatewayDetails","PaymentConfiguration","gatewayConfig","eligibleGatewayDetails","config","details","browser","explanation","initialized","sortGatewaysByEligibility","displayIndex","sortedEligibility","eligibility","eligibleGateway","b","context","selectedContextIndex","findIndex","selectedContext","splice","spliceIndex","availabilityDetails","minimum","maximum","available_options","eligibleGatewayCount","count","checkEligibleOrFindAlternate","firstEligibleMethod","gatewayContexts","peachPayCustomerReducer","stripe_customer_id","preferred_payment_method","postcode","updateCustomerFields","updateCustomer","updateCustomerPreferredGateway","getShippingField","openShippingDetails","PeachPayCustomer","billing","phone","company","location_data","stripeId","stripeBillingDetails","address","line1","line2","postal_code","stripeShippingDetails","shippingShortAddress","wcShippingAddress","wcBillingAddress","preferredPaymentMethod","peachPayOrderReducer","setSessionId","updateCustomerAddressValidation","setExtraFields","setOrderError","PeachPayOrder","selectedShippingMethodsRecord","orderFormRecord","formInfoRecord","selectedOption","extraFieldsRecord","rootReducer","render","reducer","preloadedState","isDispatching","currentReducer","currentState","currentListeners","nextListeners","dispatch","listeners","listener","getState","subscribe","isSubscribed","capitalizeFirstLetter","string","stringToUpper","charAt","toUpperCase","cartIsVirtual","every","cartItemQuantity","cartItem","quantity","bundleQuantityLabel","bundleItemQuantity","is_part_of_bundle","bundle","find","item_key","bundled_by","isNaN","cartItemLabel","formatted_item_data","name_with_variation","variationTitle","attributes","variation_title","cartItemDisplayAmount","is_subscription","stringAmount","subscription_price_string","display_price","price","is_bundle","subItem","subItemPrice","cartItemVariationHTML","metaDataRowsHTML","formattedItemDataHTMLTemplate","variationRowHTML","formattedKey","formattedValue","meta_data","meta","keyText","addProductToCart","productId","addToCartURL","variationAttributes","variationId","Accept","stateProvinceOrCounty","countryCode","isEUCountry","formatCurrencyString","cost","formattedCurrency","negSymbol","formattedCost","formatCostString","abs","thousandsSeparator","decimalSeparator","decimals","numberOfDecimals","ceil","round","toFixed","formattedPrice","currencySplit","centsAmount","reverse","isDevEnvironment","baseUrl","getBaseURL","merchantHostname","isTestMode","URL","host","pathname","determinePageType","isCartPage","isCheckoutPage","isShopPage","formEntry","cleanFormFields","billingFields","shippingFields","isDefaultField","isRequiredField","fieldInfo","fieldDataInfo","Boolean","countryLocaleRule","isEnabledField","countryLocaleRuleNotHidden","isShortAddressEmpty","defaultShortAddress","fields","fieldPostalCodeInfo","fieldCityInfo","fieldStateInfo","shippingPostalCode","shippingCity","shippingState","shippingCountry","buildSubscriptionPriceMetaData","short","subscriptionPeriod","week","month","year","period","period_interval","buildSubscriptionFirstRenewalString","first_renewal","date","toLocaleString","getLocaleText","translatedModalTerms","clearInput","renderDropDownList","defaultOption","selectDropdown","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","exports","module","__webpack_modules__","definition","enumerable","chunkId","all","promises","u","miniCssF","globalThis","l","url","needAttach","scripts","charset","timeout","nc","onScriptComplete","prev","clearTimeout","doneFns","removeChild","fn","toStringTag","installedChunks","installedChunkData","promise","errorType","realSrc","webpackJsonpCallback","parentChunkLoadingFunction","chunkIds","moreModules","runtime","some","chunkLoadingGlobal","global","support","Blob","viewClasses","isArrayBufferView","ArrayBuffer","isView","normalizeName","normalizeValue","iteratorFor","Headers","header","consumed","bodyUsed","fileReaderReady","reader","readBlobAsArrayBuffer","blob","FileReader","readAsArrayBuffer","bufferClone","buf","view","Uint8Array","byteLength","buffer","Body","_initBody","_bodyInit","_bodyText","isPrototypeOf","_bodyBlob","_bodyFormData","DataView","_bodyArrayBuffer","arrayBuffer","isConsumed","byteOffset","text","readAsText","chars","fromCharCode","readArrayBufferAsText","oldValue","Request","upcased","signal","referrer","cache","reParamSearch","bytes","Response","bodyInit","status","statusText","clone","redirectStatuses","redirect","RangeError","DOMException","err","constructor","aborted","xhr","XMLHttpRequest","abortXhr","abort","rawHeaders","getAllResponseHeaders","substr","line","parts","responseURL","responseText","ontimeout","onabort","href","fixUrl","withCredentials","responseType","setRequestHeader","readyState","send","allSettled","mappedPromises","reason","initMerchantAccount","accountDetails","merchant_customer_account","logged_in","lostPasswordURL","checkout_login_enabled","ajaxURL","loginNonce","maybe","loginError","loginResult","htmlString","setupLoginEvents","checkout_registration_enabled","checkout_registration_with_subscription_enabled","usernameHTML","displayed","auto_generate_password","passwordHTML","auto_generate_username","showRegistration","shouldShowRegistration","showRegistrationCheckbox","shouldShowRegistrationCheckbox","showRegistrationCredentials","shouldShowRegistrationCredentials","containerHTML","mountRegistrationHTML","toggleRegistrationCredentialsDisplay","setupRegistrationEvents","previousCartContainsSubscription","unsubscribe","currentCartContainsSubscription","show","toggle","toggleRegistrationDisplay","toggleRegistrationCheckboxDisplay","allow_guest_checkout","shippingAutocomplete","newCustomerBillingAutocomplete","initAddressAutocomplete","activeLocations","shouldEnableAddressAutocomplete","shippingInput","newBillingInput","google","maps","places","Autocomplete","types","addListener","fillInAddress","preventSubmitListener","place","address1Field","address2Field","postalField","cityField","provinceField","getPlace","address_components","component","countryField","previousCountryFieldValue","short_name","long_name","allowedStatesOrProvinces","isInputField","stateValue","findStateKeyByValue","formatted_address","formattedAddress","addressChunks","regexContainsHouseNumber","getFormattedStreetAddress","focus","eventClick","initQuantityChangerEvent","$cartContainer","handleCartContainerEvent","$removeButtons","changeQuantity","once","activeElement","blur","$button","cartItemKey","quantityChangeURL","initCart","previousCartData","previousCurrencyData","cartData","currencyData","$tbody","$tbodyMobile","clearOrderSummary","$message","$cartRow","itemBundle","nextItem","renderCartItem","cloneNode","renderOrderSummaryItems","renderBundleItem","$imgDiv","getImgQtyDiv","$labelDiv","className","$bundleItemTopRow","$amountDiv","$amountP","$amount","$bundleItemSecondRow","$bundleItemInfoDiv","$bundleItem","imageSrc","image","showImage","gap","$imgQtyDiv","$itemInfoContainer","$itemInfo","$removerDiv","$variationInfo","bundleItem","showQuantityChanger","$div","buildQuantityChanger","$qtyContainer","quantityNumber","quantityChanger","stock_qty","initCouponInput","_message","displayCouponFeature","startCouponLoading","applyCoupon","stopCouponLoading","$openCoupon","showCouponInput","handleCouponInputEvents","$removeButton","removeCoupon","handleCouponRemoval","applyCouponURL","applyCouponNonce","hideCouponInput","removeCouponURL","removeCouponNonce","$dd","detectExitTap","initCurrency","right","renderCurrencySymbols","currency_info","peachpayUpdateCurrencyCookie","newCurrency","cookie","TRANSLATED_MODAL_TERMS_ALL_LANGUAGES","PPButtonLocation","renderCurrencySelector","$removeSelector","$insertionLocationNew","parentElement","$insertionLocationMobile","currencyInfo","insertAdjacentElement","buildCurrencySelectDiv","customClasses","$options","renderCurrencyList","mappedCurrencies","getCurrencyDropDownInfo","currencyContainer","$currencySelectTitle","$currencySelect","selectContainer","currencyEventListener","sendCurrencySwitchMessage","updateCurrencySwitcherForCountry","countryCSinput","switcherEnabledForCountry","curFeatureState","active_currency","set_cur","updateCurrencySwitcherFeature","refreshCurrencySelected","initCustomOrderMessaging","$a","childrenElements","child","renderCustomOrderMessaging","initGiftCardInput","displayGiftCardFeature","showGiftCardLoadingState","applyGiftCard","hideGiftCardLoadingState","$giftCard","showGiftCardInput","handleGiftcardInputEvents","giftCardNumber","applyGiftcardNonce","defaultErrorMessage","hideGiftCardInput","initLanguage","nodeName","placeholder","setCustomValidity","setCustomValidityMessage","renderLocaleText","pageLanguage","translatedModalTermsAllLanguages","initMetrics","recordNonPPButtonClick","buttonType","recordButtonClick","buttonID","isMiniCart","MiniCart","Cart","Checkout","Product","NotApplicable","getPPButtonLocation","ppButtonLocation","domain","isMobile","isProductionDomain","handleResponsiveness","ppModalContent","mobileWidth","matchMedia","matches","height","overflow","removeProperty","openSlideUpView","modalName","backgroundElement","backarrow","scrollIntoView","tapToClose","closeSlideUpView","dropDown","closeCartWithKeyPress","openCartWithKeyPress","openCart","cancelAndClose","formID","infoFormValidity","hasAttribute","confirm","renderModalPage","buttonShadowClass","renderInfoPageDisplay","renderShippingPageDisplay","renderPaymentPageDisplay","shippingToPayment","dispatchRequestedPage","continueToPayment","backToInfo","backToShipping","initModal","initPageSwitch","$body","$style","createTextNode","custom_checkout_css","insertCustomCheckoutCSS","prevCurrencyCode","cartCount","allCartsTotal","itemsHeight","color","documentElement","setProperty","renderButtonColorTheme","renderTestModeBannerDisplay","renderModalPageIndicator","renderModalNavigation","renderContinueButtonDisplay","renderContinueError","renderContinueButtonLoading","currencyChanged","ppBlurOnRecalculate","terms","renderTermsAndCondition","wc_terms_conditions","dispatchPayment","skipShippingPage","displayErrorMessage","$parent","$children","$child","clientHeight","openCheckoutModal","requestCloseModal","displayOCUPage","ocuHeadline","ocuSubHeadline","acceptBtnText","declineBtnText","customDesc","ocuProducts","zIndex","subHeadline","clearOCUSection","ocuContainer","ocuBody","prepend","renderOCUPage","closeOCUPage","markup","initOCUEvents","backgroundColor","initPaymentGatewaySelector","$pmType","click","setupPrimaryOptionsEvents","stopPropagation","$option","setupSecondaryOptionsEvents","defaultCurrency","setupCurrencyFallbackEvents","sortedEligibilityContext","unmountedElements","unmountedPrimaryElements","renderPrimaryOption","isHidden","renderPrimaryMoreOption","unmountedSecondaryElements","renderSecondaryOption","renderGatewayDescription","eligibilityDetails","eligibilityExplanations","detail","fallback_option","assets","badge","$span","renderEligibilityDescription","isSelected","initRelatedProducts","recommendedProducts","products","relatedList","relatedListMobile","isBundleOrVariable","variable","rpBody","img_src","sale","renderVariationFields","qtyChanger","renderQuantityChanger","permalink","targetMarkup","variationForm","product","variations","variation","variation_id","variationFieldsUI","renderRecommendedProductsMiniSlider","elementName","isAtLeftEnd","isAtRightEnd","fadeAdjuster","scrollLeft","offsetWidth","scrollWidth","formContainer","attr","option","opt","addToCartButton","cancelButton","product_id","initSummary","clearRenderedSummaries","cartSummariesHTML","summaryHTML","summaryTitleHTML","renderSummaryLine","renderSummaries","wc_tax_price_display","priceMetaHTML","initVAT","vat_required","renderVATIDInput","vat_self_verify","$verifyDiv","$verifyCheckbox","$descriptor","$divClone","$insertLocation2","renderVerifyLocation","$previousDivs","$EUVatDiv","$vatForm","$vatNumber","$prompt","$insertionLocation","setupPeachpayButton","renderButtonDisplay","renderButtonLoading","initPurchaseOrderSupport","orderService","newCustomerDiv","getFieldName","addButtonListener","getPurchaseOrderMethodConfiguration","transactionError","purchaseOrderNumber","purchase_order_number","defaultOrderFlow","setupFreeOrderButton","cartSize","renderFreeOrderButtonDisplay","renderFreeOrderButtonLoading","freeOrderFlow","getCODMethodConfiguration","instructions","getChequeMethodConfiguration","getBacsMethodConfiguration","buttonListeners","initPeachPayMethods","freeConfig","registerGateways","initCODSupport","initChequeSupport","initBacsSupport","initFreeOrderSupport","customOrder","order_id","first_name","last_name","feature_support","button_color","ocuFlow","initOneClickUpsell","logoSrc","opacity","initMerchantLogo","importPaymentIntegration","importGateway","authnet","amazon","poynt","parent","checkout_window_state","peachpay_data","featureFlag","import_","gateway","default"],"sourceRoot":""}