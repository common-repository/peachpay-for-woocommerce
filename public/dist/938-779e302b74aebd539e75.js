!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},a=(new Error).stack;a&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[a]="9a6144e1-e66a-402f-a422-59b6f82bc750",e._sentryDebugIdIdentifier="sentry-dbid-9a6144e1-e66a-402f-a422-59b6f82bc750")}catch(e){}}();var _global="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};_global.SENTRY_RELEASE={id:"1.97.0"},(self.webpackChunkpeachpay_for_woocommerce=self.webpackChunkpeachpay_for_woocommerce||[]).push([[938],{7714:(e,a,n)=>{n.r(a),n.d(a,{default:()=>D});var t=n(3940),o=n(7059),c=n(7629),r=n(7462),s=n(9350),i=n(3658),u=n(6673),d=n(9545);function l(){o.h.subscribe((function(){var e,a,n,t;e=c.hv.selectedGateway(),a=r.qA.modalUI.loadingMode(),n=u.z9.total(),t=u.z9.subscriptionPresent(),e.includes("peachpay_amazonpay")&&"finished"===a&&!t&&n>0?(0,d.HD)(".amazon-pay-payment-container").forEach((function(e){e.classList.remove("hide")})):(0,d.HD)(".amazon-pay-payment-container").forEach((function(e){e.classList.add("hide")}))}))}var p=n(3413),h=n(9970),m=n(5519),y=n(6204),f=n(8401);function v(){var e=h.gx.shipping,a=e.firstName,n=e.lastName,o=e.address1,c=e.address2,r=e.city,s=e.state,i=e.postal,u=e.country,d=e.phone,l=0===c().length?{}:{addressLine1:c()};return(0,t.pi)({name:a()+" "+n(),addressLine1:o(),city:r(),stateOrRegion:s(),postalCode:i(),countryCode:u(),phoneNumber:d()},l)}function b(e){switch(e){case"US":return"https://static-na.payments-amazon.com/checkout.js";case"JP":return"https://static-fe.payments-amazon.com/checkout.js";case"GB":case"DK":case"FR":case"DE":case"HU":case"IT":case"LU":case"AW":case"PT":case"ES":case"SE":return"https://static-eu.payments-amazon.com/checkout.js";default:return}}function g(e,a){return(0,t.mG)(this,void 0,void 0,(function(){var n;return(0,t.Jh)(this,(function(t){switch(t.label){case 0:return[4,fetch((0,p.BS)(s.l9.hostName(),r.qA.testMode())+"api/v1/amazonpay/signature",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session:{id:f.Z5.sessionId(),merchant_id:s.l9.id(),merchant_url:s.l9.hostName(),merchant_name:s.l9.name(),plugin_version:r.qA.plugin.version(),platform:"woocommerce"},transaction:{amazonpay:{payload:e,sandbox:a}}})})];case 1:return(n=t.sent()).ok?[4,n.json()]:[2,""];case 2:return[2,t.sent().signature]}}))}))}function _(e){var a,n,o;return(0,t.mG)(this,void 0,void 0,(function(){var c,i,d,l,p,h,m,y;return(0,t.Jh)(this,(function(f){switch(f.label){case 0:return c=null!==(a=r.L0.metadata("amazonpay_payment_method","public_key_id"))&&void 0!==a?a:"",i=null!==(n=r.L0.metadata("amazonpay_payment_method","store_id"))&&void 0!==n?n:"",d=null!==(o=r.L0.metadata("amazonpay_payment_method","merchant_id"))&&void 0!==o?o:"",l=r.qA.isTestOrDevSite(),p=s.l9.currency.configuration().number_of_decimals,h=u.z9.virtual()?{}:{addressDetails:v()},[4,g(m=(0,t.pi)({webCheckoutDetails:{checkoutResultReturnUrl:e,checkoutMode:"ProcessOrder"},storeId:i,scopes:["name","email","phoneNumber","billingAddress"],paymentDetails:{paymentIntent:"AuthorizeWithCapture",chargeAmount:{amount:u.AQ.total().toFixed(p),currencyCode:s.l9.currency.code()},presentmentCurrency:s.l9.currency.code()}},h),l)];case 1:return y=f.sent(),[2,{publicKeyId:c,storeId:i,merchantId:d,sandbox:l,addressDetails:h,payload:m,signature:y}]}}))}))}const z=n.p+"img/f3896d63aa9fcf4e95c0-amazon.svg",w=n.p+"img/2c43108c2527a9ce8f67-amazon-pay-card.svg";var I=n(3176),k=n(3305),A=n(2121),C=n(4071);function D(e){return(0,t.mG)(this,void 0,void 0,(function(){var a=this;return(0,t.Jh)(this,(function(n){switch(n.label){case 0:return[4,(0,d.ve)("https://static-na.payments-amazon.com/checkout.js","amazon",(function(){var n,s;n={},{}[(s={config:{name:"Amazon Pay",gatewayId:"peachpay_amazonpay",description:"Please click the Amazon Pay button to complete your checkout.",assets:{title:{src:w},badge:{src:z}}}}).config.gatewayId]=s,n[s.config.gatewayId]=s.config,o.h.dispatch((0,c.Cj)(n)),l();var i="",d=r.qA.modalUI.page();o.h.subscribe((function(){return(0,t.mG)(a,void 0,void 0,(function(){return(0,t.Jh)(this,(function(a){switch(a.label){case 0:return 0===u.AQ.total()?[2]:"peachpay_amazonpay"===c.hv.selectedGateway()&&"peachpay_amazonpay"!==i||"peachpay_amazonpay"===c.hv.selectedGateway()&&"payment"===r.qA.modalUI.page()&&"payment"!==d?(i="peachpay_amazonpay",d="payment",[4,P(e)]):[3,2];case 1:a.sent(),a.label=2;case 2:return c.hv.selectedGateway()!==i&&(i=c.hv.selectedGateway()),r.qA.modalUI.page()!==d&&(d=r.qA.modalUI.page()),[2]}}))}))}))}))];case 1:return n.sent(),[2]}}))}))}function P(e){var a,n,o;return(0,t.mG)(this,void 0,void 0,(function(){var c,r=this;return(0,t.Jh)(this,(function(i){switch(i.label){case 0:return(null===(a=k.a.phpData)||void 0===a?void 0:a.plugin_asset_url)?((0,d.HD)(".pp-amazon-pay-btn-container",(function(e){var a=e.id,n=e.parentElement;null==n||n.replaceChildren(),null!==n&&(n.innerHTML="");var t='<div id="'.concat(a,'" class=""></div>');null==n||n.insertAdjacentHTML("beforeend",t)})),null===(n=(0,d.MW)("#amazon-pay-btn-container"))||void 0===n||n.classList.add("pp-amazon-pay-btn-container"),null===(o=(0,d.MW)("#amazon-pay-btn-container-mobile"))||void 0===o||o.classList.add("pp-amazon-pay-btn-container"),[4,_("".concat(k.a.phpData.plugin_asset_url,"public/amazon-checkout.html"))]):[2];case 1:return c=i.sent(),["#amazon-pay-btn-container","#amazon-pay-btn-container-mobile"].forEach((function(a){amazon.Pay.renderButton(a,{merchantId:c.merchantId,publicKeyId:c.publicKeyId,ledgerCurrency:s.l9.currency.code(),checkoutLanguage:"en_US",productType:u.z9.virtual()?"PayOnly":"PayAndShip",placement:"Cart",buttonColor:"Gold",sandbox:c.sandbox}).onClick((function(){return(0,t.mG)(r,void 0,void 0,(function(){var a,n,o;return(0,t.Jh)(this,(function(t){switch(t.label){case 0:return(null===(n=k.a.phpData)||void 0===n?void 0:n.plugin_asset_url)?(null===(o=(0,d.MW)("body"))||void 0===o||o.classList.add("pp-disabled"),a="".concat(k.a.phpData.plugin_asset_url,"public/amazon-checkout.html"),[4,S(c,a,e)]):[2];case 1:return t.sent(),[2]}}))}))}))})),[2]}}))}))}function S(e,a,n){return(0,t.mG)(this,void 0,void 0,(function(){var c,l,m,y,v,g,_,z,w,k,D,P=this;return(0,t.Jh)(this,(function(S){switch(S.label){case 0:return c=s.l9.currency.configuration().number_of_decimals,l=btoa(JSON.stringify({buttonData:{merchantId:e.merchantId,publicKeyId:e.publicKeyId,ledgerCurrency:s.l9.currency.code(),checkoutLanguage:r.qA.language().replace("-","_"),productType:u.z9.virtual()?"PayOnly":"PayAndShip",placement:"Cart",buttonColor:"Gold",sandbox:e.sandbox},initCheckoutData:{createCheckoutSessionConfig:{payloadJSON:JSON.stringify(e.payload),signature:e.signature,publicKeyId:e.publicKeyId}},scriptLink:b(h.gx.billing.country())})),m=function(e,a,n,t,o){if(null!==(null==n?void 0:n.top)){var c=n.top.outerHeight/2+n.top.screenY-o/2,r=n.top.outerWidth/2+n.top.screenX-t/2;return n.open(e,a,"toolbar=no, location=no, directories=no, status=yes, menubar=no, scrollbars=yes, resizable=yes, copyhistory=no, width=".concat(t,", height=").concat(o,", top=").concat(c,", left=").concat(r))}return null}("".concat(a,"?amazon_data=").concat(l),"amazonPayPopup",window,550,515),y=setInterval((function(){var e;(null==m?void 0:m.closed)&&(clearInterval(y),null===(e=(0,d.MW)("body"))||void 0===e||e.classList.remove("pp-disabled"))}),1e3),null===m?[3,3]:[4,n.startTransaction("peachpay_amazonpay")];case 1:return v=S.sent(),g=v.error,_=v.result,g||!_?(z=g?(0,A.H)(g):(0,C.M)("An unknown error occured while starting the transaction. Please refresh the page and try again."),(0,i.j1)(z),o.h.dispatch((0,r.tv)()),[2]):[4,n.placeOrder(_)];case 2:if(w=S.sent(),k=w.error,D=w.result,k||!D||"success"!==D.result)return o.h.dispatch((0,r.tv)()),[2];(0,d.JM)("pp-amazon-popup-closed",(function(){var e;null===(e=(0,d.MW)("body"))||void 0===e||e.classList.remove("pp-disabled")})),(0,d.ml)("pp-amazon-checkout-failed",(function(a){o.h.dispatch((0,r.tv)()),window.alert("Amazon Pay was unable to proceed with checkout due to the following:\n".concat(a.message)),(0,I.W4)(new Error(a.message),{amazonpay_session:e})})),(0,d.ml)("pp-amazon-checkout-complete",(function(a){return(0,t.mG)(P,void 0,void 0,(function(){var n,i,d,l;return(0,t.Jh)(this,(function(t){switch(t.label){case 0:return n=a.sessionId,m.postMessage({event:"pp-amazon-received-session-id"},location.origin),i={session:{id:f.Z5.sessionId(),merchant_id:s.l9.id(),merchant_url:s.l9.hostName(),merchant_name:s.l9.name(),plugin_version:r.qA.plugin.version(),platform:"woocommerce"},transaction:{amazonpay:{payload:{chargeAmount:{amount:u.AQ.total().toFixed(c),currencyCode:s.l9.currency.code()}},session_id:n,sandbox:e.sandbox}},order:{id:String(D.order_id),amount:u.AQ.total().toFixed(c),currency:s.l9.currency.code(),data:D}},[4,fetch((0,p.BS)(s.l9.hostName(),r.qA.testMode())+"api/v1/amazonpay/checkout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)})];case 1:return(d=t.sent()).ok?[4,d.json()]:((0,I.W4)(new Error("Call to PeachPay API /amazonpay/checkout failed"),{amazonpay_session:e,request:i,response:d}),[2]);case 2:return l=t.sent(),o.h.dispatch((0,r.N5)()),[4,L(l,D)];case 3:return t.sent(),[2]}}))}))})),S.label=3;case 3:return[2]}}))}))}function L(e,a){return(0,t.mG)(this,void 0,void 0,(function(){return(0,t.Jh)(this,(function(n){return"Completed"!==e.data.statusDetails.state?o.h.dispatch((0,r.tv)()):(o.h.dispatch((0,h.H$)(c.hv.selectedGateway())),(0,m.ll)(),(0,y.c)(),window.top&&"success"===a.result&&(window.top.location=a.redirect)),[2]}))}))}}}]);
//# sourceMappingURL=938-779e302b74aebd539e75.js.map