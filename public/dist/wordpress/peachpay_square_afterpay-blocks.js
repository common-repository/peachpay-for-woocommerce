!function(){"use strict";var e={127:function(e,t,n){n.d(t,{Z:function(){return c}});var r=n(86),a=n(412),o=n(736);function c(e){return e.currency?(0,r.createElement)("div",{style:{display:"flex",flexDirection:"column"}},(0,r.createElement)("p",{style:{textAlign:"justify",margin:"0.5rem 0 0",fontSize:"smaller"}},e.name," ",(0,o.__)("does not support the currency you currently have chosen.","peachpay-for-woocommerce")," ",(0,r.createElement)("b",null,(0,o.__)("Update to","peachpay-for-woocommerce")," ",e.currency)," ",(0,o.__)("below to use this payment method.","peachpay-for-woocommerce")),(0,r.createElement)("button",{type:"button",className:"button currency-fallback-button",style:{fontSize:"smaller",marginBottom:"16px"},onClick:function(){e.currency&&((0,a.k)(e.currency),window.location.reload())}},(0,o.__)("Update to","peachpay-for-woocommerce")," ",e.currency)):null}},894:function(e,t,n){n.d(t,{d:function(){return a}});var r=["BIF","CLP","DJF","GNF","JPY","KMF","KRW","MGA","PYG","RWF","UGX","VND","VUV","XAF","XOF","XPF"];function a(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=Number.parseInt(e),c=Number.parseInt(t);return a&&(o+=c),r.includes(n)||(o/=100),o.toFixed(2)}},526:function(e,t,n){n.d(t,{f:function(){return o}});var r=n(894);function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function o(e){return{countryCode:e.merchantCountry,currencyCode:e.currency,lineItems:c(e),discounts:u(e),taxLineItems:i(e),shippingLineItems:s(e),total:l(e),requestBillingContact:!1,requestShippingContact:!1}}function c(e){var t,n=new Array,o=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return u=e.done,e},e:function(e){i=!0,c=e},f:function(){try{u||null==n.return||n.return()}finally{if(i)throw c}}}}(e.items);try{for(o.s();!(t=o.n()).done;){var c=t.value;n.push({id:c.sku,label:c.name+" Ã— "+c.quantity,amount:(0,r.d)(c.totals.line_subtotal,c.totals.line_subtotal_tax,c.totals.currency_code,e.displayPricesIncludingTax)})}}catch(e){o.e(e)}finally{o.f()}return n}function u(e){for(var t=new Array,n=0,a=e.summary;n<a.length;n++){var o=a[n];if("total_discount"===o.key&&0!==o.value){var c=String(e.displayPricesIncludingTax?o.valueWithTax:o.value);t.push({label:o.label,amount:(0,r.d)(c,"0",e.currency)})}}return t}function i(e){for(var t=new Array,n=0,a=e.summary;n<a.length;n++){var o=a[n];"total_tax"===o.key&&0!==o.value&&t.push({label:o.label,amount:(0,r.d)(String(o.value),"0",e.currency)})}return t}function s(e){for(var t=new Array,n=0,a=e.summary;n<a.length;n++){var o=a[n];"total_shipping"===o.key&&0!==o.value&&t.push({label:o.label,amount:(0,r.d)(String(o.value),"0",e.currency)})}return t}function l(e){return{label:e.total.label,amount:(0,r.d)(String(e.total.value),"0",e.currency)}}},412:function(e,t,n){function r(e){document.cookie=`pp_active_currency=${e};path=/`}n.d(t,{k:function(){return r}})},906:function(e,t,n){function r(e){if(e instanceof Error&&e.stack)return e.stack;var t=JSON.stringify(e);return t&&"{}"!==t?t:`${e}`}n.d(t,{HH:function(){return r}})},86:function(e){e.exports=window.React},284:function(e){e.exports=window.regeneratorRuntime},22:function(e){e.exports=window.peachpay_checkout_blocks},801:function(e){e.exports=window.wc.wcBlocksData},613:function(e){e.exports=window.wc.wcBlocksRegistry},617:function(e){e.exports=window.wc.wcSettings},818:function(e){e.exports=window.wp.data},307:function(e){e.exports=window.wp.element},629:function(e){e.exports=window.wp.htmlEntities},736:function(e){e.exports=window.wp.i18n},907:function(e,t,n){function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}n.d(t,{Z:function(){return r}})},878:function(e,t,n){function r(e){if(Array.isArray(e))return e}n.d(t,{Z:function(){return r}})},861:function(e,t,n){function r(e,t,n,r,a,o,c){try{var u=e[o](c),i=u.value}catch(e){return void n(e)}u.done?t(i):Promise.resolve(i).then(r,a)}function a(e){return function(){var t=this,n=arguments;return new Promise((function(a,o){var c=e.apply(t,n);function u(e){r(c,a,o,u,i,"next",e)}function i(e){r(c,a,o,u,i,"throw",e)}u(void 0)}))}}n.d(t,{Z:function(){return a}})},902:function(e,t,n){function r(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o,c,u=[],i=!0,s=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;i=!1}else for(;!(i=(r=o.call(n)).done)&&(u.push(r.value),u.length!==t);i=!0);}catch(e){s=!0,a=e}finally{try{if(!i&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(s)throw a}}return u}}n.d(t,{Z:function(){return r}})},267:function(e,t,n){function r(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}n.d(t,{Z:function(){return r}})},324:function(e,t,n){n.d(t,{Z:function(){return u}});var r=n(878),a=n(902),o=n(181),c=n(267);function u(e,t){return(0,r.Z)(e)||(0,a.Z)(e,t)||(0,o.Z)(e,t)||(0,c.Z)()}},181:function(e,t,n){n.d(t,{Z:function(){return a}});var r=n(907);function a(e,t){if(e){if("string"==typeof e)return(0,r.Z)(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?(0,r.Z)(e,t):void 0}}}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,n),o.exports}n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e=n(861),t=n(324),r=n(86),a=n(284),o=n.n(a),c=n(736),u=n(613),i=n(617),s=n(629),l=n(307),p=n(22),f=n(906),y=n(127),d=n(526),m=n(818),h=n(801),v=p.z.object({icon:p.z.string(),title:p.z.string(),description:p.z.string(),fallback_currency:p.z.string().nullable(),supports:p.z.string().array(),square:p.z.object({application_id:p.z.string(),location_id:p.z.string(),country_code:p.z.string()})}).safeParse((0,i.getSetting)("peachpay_square_afterpay_data"));if(!v.success)throw new Error(`Payment method "peachpay_square_afterpay" setup aborted. Invalid settings.\n\n${v.error.message}`);var w,g=v.data,_=(0,s.decodeEntities)(g.title),b=(0,s.decodeEntities)(g.description);if(!window.Square)throw new Error('Payment method "peachpay_square_afterpay" setup aborted. Square SDK not loaded.');try{w=window.Square.payments(g.square.application_id,g.square.location_id)}catch(e){throw new Error(`Payment method "peachpay_square_afterpay" setup aborted. Could not create Payments instance.\n\n${(0,f.HH)(e)}`)}var x=(0,c.__)("Clearpay","peachpay-for-woocommerce"),E=(0,c.__)("Afterpay","peachpay-for-woocommerce");function S(t){var n=t.billing,a=t.cartData,u=t.eventRegistration,i=t.emitResponse,s=u.onPaymentSetup,m=u.onCheckoutFail,h=(0,l.useRef)(null),v=(0,l.useRef)(null),x=(0,l.useRef)(null);return(0,l.useEffect)((function(){var t=function(){var t=(0,e.Z)(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return v.current=w.paymentRequest((0,d.f)({merchantCountry:g.square.country_code,currency:n.currency.code,items:a.cartItems,summary:n.cartTotalItems,total:n.cartTotal,displayPricesIncludingTax:n.displayPricesIncludingTax})),e.next=3,w.afterpayClearpay(v.current);case 3:if(x.current=e.sent,null===(t=h.current)||void 0===t||!t.id){e.next=8;break}return h.current.innerHTML="",e.next=8,x.current.attach(`#${h.current.id}`);case 8:case"end":return e.stop()}}),e)})));return function(){return t.apply(this,arguments)}}();return t().catch(console.error),function(){var e;null===(e=x.current)||void 0===e||e.destroy().catch(console.error)}}),[]),(0,l.useEffect)((function(){var e;null===(e=v.current)||void 0===e||e.update((0,d.f)({merchantCountry:g.square.country_code,currency:n.currency.code,items:a.cartItems,summary:n.cartTotalItems,total:n.cartTotal,displayPricesIncludingTax:n.displayPricesIncludingTax}))}),[a.cartItems,n.currency.code,n.cartTotalItems,n.cartTotal,n.displayPricesIncludingTax]),(0,l.useEffect)((function(){return s((0,e.Z)(o().mark((function e(){var t,n,r,a,u,s,l,y,d,m;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,p.startTransaction)("peachpay_square_afterpay");case 2:if(t=e.sent,n=t.result,!(r=t.error)&&n){e.next=7;break}return e.abrupt("return",{type:i.responseTypes.ERROR,message:null!==(a=(0,f.HH)(r))&&void 0!==a?a:(0,c.__)("An unknown error occured while creating the transaction.","peachpay-for-woocommerce")});case 7:if(x.current){e.next=12;break}return u=(0,c.__)("Missing ref to Square Afterpay element. Please try again or use a different payment method.","peachpay-for-woocommerce"),e.next=11,(0,p.updateTransaction)(n,{note:u,paymentStatus:"creationfailed"});case 11:return e.abrupt("return",{type:i.responseTypes.ERROR,message:u});case 12:return s=null,e.prev=13,e.next=16,x.current.tokenize();case 16:if("OK"===(s=e.sent).status&&s.token){e.next=23;break}return d=null!==(l=null===(y=s.errors)||void 0===y||null===(y=y.map((function(e){return e.message})))||void 0===y?void 0:y.join("<br/>"))&&void 0!==l?l:(0,c.__)("Afterpay tokenization failed. Please try again or use a different payment method.","peachpay-for-woocommerce"),"Cancel"===s.status&&(d=(0,c.__)("Payment was cancelled","peachpay-for-woocommerce")),e.next=22,(0,p.updateTransaction)(n,{note:d,paymentStatus:"creationfailed"});case 22:return e.abrupt("return",{type:i.responseTypes.ERROR,message:d});case 23:e.next=31;break;case 25:return e.prev=25,e.t0=e.catch(13),m=(0,f.HH)(e.t0),e.next=30,(0,p.updateTransaction)(n,{note:m,paymentStatus:"creationfailed"});case 30:return e.abrupt("return",{type:i.responseTypes.ERROR,message:m});case 31:return e.abrupt("return",{type:i.responseTypes.SUCCESS,meta:{paymentMethodData:{peachpay_transaction_id:n,peachpay_square_source_id:s.token}}});case 32:case"end":return e.stop()}}),e,null,[[13,25]])}))))}),[n.billingAddress,s]),(0,l.useEffect)((function(){return m(function(){var t=(0,e.Z)(o().mark((function e(t){var n,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{type:i.responseTypes.ERROR,message:null!==(n=null===(r=t.processingResponse)||void 0===r||null===(r=r.paymentDetails)||void 0===r?void 0:r.message)&&void 0!==n?n:(0,c.__)("An unknown error occured while processing the payment.","peachpay-for-woocommerce"),messageContext:i.noticeContexts.PAYMENTS});case 1:case"end":return e.stop()}}),e)})));return function(_x){return t.apply(this,arguments)}}())}),[m]),g.fallback_currency?(0,r.createElement)(y.Z,{name:_,currency:g.fallback_currency}):(0,r.createElement)(r.Fragment,null,(0,r.createElement)("img",{style:{maxHeight:"25px"},src:g.icon}),(0,r.createElement)("p",{style:{textAlign:"left",margin:"0.5rem 0 0"}},_," ",(0,c.__)("selected for checkout.","peachpay-for-woocommerce")),(0,r.createElement)("hr",{style:{margin:"0.5rem 0"}}),(0,r.createElement)("p",{style:{textAlign:"left",margin:"0",fontSize:"smaller"}},b),(0,r.createElement)("div",{style:{display:"none"},id:"pp-square-afterpay-container",ref:h},"Loading..."))}(0,u.registerPaymentMethod)({name:"peachpay_square_afterpay",ariaLabel:_,canMakePayment(e){return e.paymentMethods.includes("peachpay_square_afterpay")},label:(0,r.createElement)((function(e){var n,a=e.components,o=a.PaymentMethodLabel,u=a.PaymentMethodIcons,i=(0,l.useState)(_),s=(0,t.Z)(i,2),p=s[0],f=s[1],y=null===(n=(0,m.select)(h.CART_STORE_KEY))||void 0===n?void 0:n.getCartData();return(0,l.useEffect)((function(){_!==x&&_!==E||("GB"===y.billingAddress.country?f((0,c.__)("Clearpay","peachpay-for-woocommerce")):f((0,c.__)("Afterpay","peachpay-for-woocommerce")))}),[y.billingAddress.country]),(0,r.createElement)(r.Fragment,null,(0,r.createElement)(o,{text:p}),(0,r.createElement)(u,{className:"pp-label-icon",icons:[{id:"peachpay_square_afterpay",src:g.icon,alt:p}]}))}),null),content:(0,r.createElement)(S,null),edit:(0,r.createElement)(S,null),supports:{features:g.supports}})}()}();
//# sourceMappingURL=peachpay_square_afterpay-blocks.js.map