!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},a=(new Error).stack;a&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[a]="0e4a41fe-5995-45b4-88b8-cc718d16c4ca",e._sentryDebugIdIdentifier="sentry-dbid-0e4a41fe-5995-45b4-88b8-cc718d16c4ca")}catch(e){}}();var _global="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};_global.SENTRY_RELEASE={id:"1.96.0"},(self.webpackChunkpeachpay_for_woocommerce=self.webpackChunkpeachpay_for_woocommerce||[]).push([[938],{7714:(e,a,n)=>{n.r(a),n.d(a,{default:()=>k});var t=n(3940),o=n(7059),c=n(7629),s=n(7462),r=n(9350),i=n(6673),u=n(9545);function d(){o.h.subscribe((function(){var e,a,n,t;e=c.hv.selectedGateway(),a=s.qA.modalUI.loadingMode(),n=i.z9.total(),t=i.z9.subscriptionPresent(),e.includes("peachpay_amazonpay")&&"finished"===a&&!t&&n>0?(0,u.HD)(".amazon-pay-payment-container").forEach((function(e){e.classList.remove("hide")})):(0,u.HD)(".amazon-pay-payment-container").forEach((function(e){e.classList.add("hide")}))}))}var l=n(3413),p=n(9970),m=n(5519),h=n(6204),y=n(8401);function f(){var e=p.gx.shipping,a=e.firstName,n=e.lastName,o=e.address1,c=e.address2,s=e.city,r=e.state,i=e.postal,u=e.country,d=e.phone,l=0===c().length?{}:{addressLine1:c()};return(0,t.pi)({name:a()+" "+n(),addressLine1:o(),city:s(),stateOrRegion:r(),postalCode:i(),countryCode:u(),phoneNumber:d()},l)}function b(e){switch(e){case"US":return"https://static-na.payments-amazon.com/checkout.js";case"JP":return"https://static-fe.payments-amazon.com/checkout.js";case"GB":case"DK":case"FR":case"DE":case"HU":case"IT":case"LU":case"AW":case"PT":case"ES":case"SE":return"https://static-eu.payments-amazon.com/checkout.js";default:return}}function v(e,a){return(0,t.mG)(this,void 0,void 0,(function(){var n;return(0,t.Jh)(this,(function(t){switch(t.label){case 0:return[4,fetch((0,l.BS)(r.l9.hostName(),s.qA.testMode())+"api/v1/amazonpay/signature",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session:{id:y.Z5.sessionId(),merchant_id:r.l9.id(),merchant_url:r.l9.hostName(),merchant_name:r.l9.name(),plugin_version:s.qA.plugin.version(),platform:"woocommerce"},transaction:{amazonpay:{payload:e,sandbox:a}}})})];case 1:return(n=t.sent()).ok?[4,n.json()]:[2,""];case 2:return[2,t.sent().signature]}}))}))}function g(e){var a,n,o;return(0,t.mG)(this,void 0,void 0,(function(){var c,u,d,l,p,m,h,y;return(0,t.Jh)(this,(function(b){switch(b.label){case 0:return c=null!==(a=s.L0.metadata("amazonpay_payment_method","public_key_id"))&&void 0!==a?a:"",u=null!==(n=s.L0.metadata("amazonpay_payment_method","store_id"))&&void 0!==n?n:"",d=null!==(o=s.L0.metadata("amazonpay_payment_method","merchant_id"))&&void 0!==o?o:"",l=s.qA.isTestOrDevSite(),p=r.l9.currency.configuration().number_of_decimals,m=i.z9.virtual()?{}:{addressDetails:f()},[4,v(h=(0,t.pi)({webCheckoutDetails:{checkoutResultReturnUrl:e,checkoutMode:"ProcessOrder"},storeId:u,scopes:["name","email","phoneNumber","billingAddress"],paymentDetails:{paymentIntent:"AuthorizeWithCapture",chargeAmount:{amount:i.AQ.total().toFixed(p),currencyCode:r.l9.currency.code()},presentmentCurrency:r.l9.currency.code()}},m),l)];case 1:return y=b.sent(),[2,{publicKeyId:c,storeId:u,merchantId:d,sandbox:l,addressDetails:m,payload:h,signature:y}]}}))}))}const _=n.p+"img/f3896d63aa9fcf4e95c0-amazon.svg",z=n.p+"img/2c43108c2527a9ce8f67-amazon-pay-card.svg";var w=n(3176),I=n(3305);function k(e){return(0,t.mG)(this,void 0,void 0,(function(){var a=this;return(0,t.Jh)(this,(function(n){switch(n.label){case 0:return[4,(0,u.ve)("https://static-na.payments-amazon.com/checkout.js","amazon",(function(){var n,r;n={},{}[(r={config:{name:"Amazon Pay",gatewayId:"peachpay_amazonpay",description:"Please click the Amazon Pay button to complete your checkout.",assets:{title:{src:z},badge:{src:_}}}}).config.gatewayId]=r,n[r.config.gatewayId]=r.config,o.h.dispatch((0,c.Cj)(n)),d();var u="",l=s.qA.modalUI.page();o.h.subscribe((function(){return(0,t.mG)(a,void 0,void 0,(function(){return(0,t.Jh)(this,(function(a){switch(a.label){case 0:return 0===i.AQ.total()?[2]:"peachpay_amazonpay"===c.hv.selectedGateway()&&"peachpay_amazonpay"!==u||"peachpay_amazonpay"===c.hv.selectedGateway()&&"payment"===s.qA.modalUI.page()&&"payment"!==l?(u="peachpay_amazonpay",l="payment",[4,A(e)]):[3,2];case 1:a.sent(),a.label=2;case 2:return c.hv.selectedGateway()!==u&&(u=c.hv.selectedGateway()),s.qA.modalUI.page()!==l&&(l=s.qA.modalUI.page()),[2]}}))}))}))}))];case 1:return n.sent(),[2]}}))}))}function A(e){var a,n,o;return(0,t.mG)(this,void 0,void 0,(function(){var c,s=this;return(0,t.Jh)(this,(function(d){switch(d.label){case 0:return(null===(a=I.a.phpData)||void 0===a?void 0:a.plugin_asset_url)?((0,u.HD)(".pp-amazon-pay-btn-container",(function(e){var a=e.id,n=e.parentElement;null==n||n.replaceChildren(),null!==n&&(n.innerHTML="");var t='<div id="'.concat(a,'" class=""></div>');null==n||n.insertAdjacentHTML("beforeend",t)})),null===(n=(0,u.MW)("#amazon-pay-btn-container"))||void 0===n||n.classList.add("pp-amazon-pay-btn-container"),null===(o=(0,u.MW)("#amazon-pay-btn-container-mobile"))||void 0===o||o.classList.add("pp-amazon-pay-btn-container"),[4,g("".concat(I.a.phpData.plugin_asset_url,"public/amazon-checkout.html"))]):[2];case 1:return c=d.sent(),["#amazon-pay-btn-container","#amazon-pay-btn-container-mobile"].forEach((function(a){amazon.Pay.renderButton(a,{merchantId:c.merchantId,publicKeyId:c.publicKeyId,ledgerCurrency:r.l9.currency.code(),checkoutLanguage:"en_US",productType:i.z9.virtual()?"PayOnly":"PayAndShip",placement:"Cart",buttonColor:"Gold",sandbox:c.sandbox}).onClick((function(){return(0,t.mG)(s,void 0,void 0,(function(){var a,n,o;return(0,t.Jh)(this,(function(t){switch(t.label){case 0:return(null===(n=I.a.phpData)||void 0===n?void 0:n.plugin_asset_url)?(null===(o=(0,u.MW)("body"))||void 0===o||o.classList.add("pp-disabled"),a="".concat(I.a.phpData.plugin_asset_url,"public/amazon-checkout.html"),[4,C(c,a,e)]):[2];case 1:return t.sent(),[2]}}))}))}))})),[2]}}))}))}function C(e,a,n){return(0,t.mG)(this,void 0,void 0,(function(){var c,d,m,h,f,v,g=this;return(0,t.Jh)(this,(function(_){switch(_.label){case 0:return c=r.l9.currency.configuration().number_of_decimals,d=btoa(JSON.stringify({buttonData:{merchantId:e.merchantId,publicKeyId:e.publicKeyId,ledgerCurrency:r.l9.currency.code(),checkoutLanguage:s.qA.language().replace("-","_"),productType:i.z9.virtual()?"PayOnly":"PayAndShip",placement:"Cart",buttonColor:"Gold",sandbox:e.sandbox},initCheckoutData:{createCheckoutSessionConfig:{payloadJSON:JSON.stringify(e.payload),signature:e.signature,publicKeyId:e.publicKeyId}},scriptLink:b(p.gx.billing.country())})),m=function(e,a,n,t,o){if(null!==(null==n?void 0:n.top)){var c=n.top.outerHeight/2+n.top.screenY-o/2,s=n.top.outerWidth/2+n.top.screenX-t/2;return n.open(e,a,"toolbar=no, location=no, directories=no, status=yes, menubar=no, scrollbars=yes, resizable=yes, copyhistory=no, width=".concat(t,", height=").concat(o,", top=").concat(c,", left=").concat(s))}return null}("".concat(a,"?amazon_data=").concat(d),"amazonPayPopup",window,550,515),h=setInterval((function(){var e;(null==m?void 0:m.closed)&&(clearInterval(h),null===(e=(0,u.MW)("body"))||void 0===e||e.classList.remove("pp-disabled"))}),1e3),null===m?[3,3]:[4,n.startTransaction("peachpay_amazonpay")];case 1:return f=_.sent(),[4,n.placeOrder(f)];case 2:if(v=_.sent(),!f||"success"!==v.result)return[2];(0,u.JM)("pp-amazon-popup-closed",(function(){var e;null===(e=(0,u.MW)("body"))||void 0===e||e.classList.remove("pp-disabled")})),(0,u.ml)("pp-amazon-checkout-failed",(function(a){o.h.dispatch((0,s.tv)()),window.alert("Amazon Pay was unable to proceed with checkout due to the following:\n".concat(a.message)),(0,w.W4)(new Error(a.message),{amazonpay_session:e})})),(0,u.ml)("pp-amazon-checkout-complete",(function(a){return(0,t.mG)(g,void 0,void 0,(function(){var u,d,p,h;return(0,t.Jh)(this,(function(t){switch(t.label){case 0:return u=a.sessionId,m.postMessage({event:"pp-amazon-received-session-id"},location.origin),d={session:{id:y.Z5.sessionId(),merchant_id:r.l9.id(),merchant_url:r.l9.hostName(),merchant_name:r.l9.name(),plugin_version:s.qA.plugin.version(),platform:"woocommerce"},transaction:{amazonpay:{payload:{chargeAmount:{amount:i.AQ.total().toFixed(c),currencyCode:r.l9.currency.code()}},session_id:u,sandbox:e.sandbox}},order:{id:String(v.order_id),amount:i.AQ.total().toFixed(c),currency:r.l9.currency.code(),data:v}},[4,fetch((0,l.BS)(r.l9.hostName(),s.qA.testMode())+"api/v1/amazonpay/checkout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)})];case 1:return(p=t.sent()).ok?[4,p.json()]:((0,w.W4)(new Error("Call to PeachPay API /amazonpay/checkout failed"),{amazonpay_session:e,request:d,response:p}),[2]);case 2:return h=t.sent(),o.h.dispatch((0,s.N5)()),[4,S(h,u,n,f,v)];case 3:return t.sent(),[2]}}))}))})),_.label=3;case 3:return[2]}}))}))}function S(e,a,n,r,i){return(0,t.mG)(this,void 0,void 0,(function(){return(0,t.Jh)(this,(function(t){switch(t.label){case 0:return"Completed"===e.data.statusDetails.state?[3,1]:(o.h.dispatch((0,s.tv)()),[3,3]);case 1:return[4,n.setOrderStatus(i,r,{amazonpay:{session_id:a},paymentStatus:"success",orderStatus:"success"})];case 2:t.sent(),o.h.dispatch((0,p.H$)(c.hv.selectedGateway())),(0,m.ll)(),(0,h.c)(),window.top&&(window.top.location=i.redirect),t.label=3;case 3:return[2]}}))}))}}}]);
//# sourceMappingURL=938.bundle.js.map